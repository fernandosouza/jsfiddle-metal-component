(function(){this.metal=this.metal||{},this.metalNamed=this.metalNamed||{};var e={};e["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),e.defineProperty=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.get=function t(e,n,a){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,a)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(a)},e.inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},e.possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},e.toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},function(){/**
   * @license
   * Copyright 2015 The Incremental DOM Authors. All Rights Reserved.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *      http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS-IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
!function(e,t){t(e.IncrementalDOM=e.IncrementalDOM||{})}(window,function(t){"use strict";function n(){}function a(e,t){this.attrs=s(),this.attrsArr=[],this.newAttrs=s(),this.staticsApplied=!1,this.key=t,this.keyMap=s(),this.keyMapValid=!0,this.focused=!1,this.nodeName=e,this.text=null}function r(){this.created=p.nodesCreated&&[],this.deleted=p.nodesDeleted&&[]}var i=Object.prototype.hasOwnProperty;n.prototype=Object.create(null);var o=function(e,t){return i.call(e,t)},s=function(){return new n},l="__incrementalDOMData",u=function(e,t,n){var r=new a(t,n);return e[l]=r,r},c=function(e){return d(e),e[l]},d=function ue(e){if(!e[l]){var t=e instanceof Element,n=t?e.localName:e.nodeName,a=t?e.getAttribute("key"):null,r=u(e,n,a);if(a&&(c(e.parentNode).keyMap[a]=e),t)for(var i=e.attributes,o=r.attrs,s=r.newAttrs,d=r.attrsArr,h=0;h<i.length;h+=1){var m=i[h],f=m.name,p=m.value;o[f]=p,s[f]=void 0,d.push(f),d.push(p)}for(var v=e.firstChild;v;v=v.nextSibling)ue(v)}},h=function(e,t){return"svg"===e?"http://www.w3.org/2000/svg":"foreignObject"===c(t).nodeName?null:t.namespaceURI},m=function(e,t,n,a){var r=h(n,t),i=void 0;return i=r?e.createElementNS(r,n):e.createElement(n),u(i,n,a),i},f=function(e){var t=e.createTextNode("");return u(t,"#text",null),t},p={nodesCreated:null,nodesDeleted:null};r.prototype.markCreated=function(e){this.created&&this.created.push(e)},r.prototype.markDeleted=function(e){this.deleted&&this.deleted.push(e)},r.prototype.notifyChanges=function(){this.created&&this.created.length>0&&p.nodesCreated(this.created),this.deleted&&this.deleted.length>0&&p.nodesDeleted(this.deleted)};var v=function(e){return e instanceof Document||e instanceof DocumentFragment},_=function(e,t){for(var n=[],a=e;a!==t;)n.push(a),a=a.parentNode;return n},y=function(e){for(var t=e,n=t;t;)n=t,t=t.parentNode;return n},g=function(e){var t=y(e);return v(t)?t.activeElement:null},C=function(e,t){var n=g(e);return n&&e.contains(n)?_(n,t):[]},k=function(e,t,n){for(var a=t.nextSibling,r=n;r!==t;){var i=r.nextSibling;e.insertBefore(r,a),r=i}},E=null,N=null,b=null,D=null,O=function(e,t){for(var n=0;n<e.length;n+=1)c(e[n]).focused=t},I=function(e){var t=function(t,n,a){var i=E,o=D,s=N,l=b;E=new r,D=t.ownerDocument,b=t.parentNode;var u=C(t,b);O(u,!0);var c=e(t,n,a);return O(u,!1),E.notifyChanges(),E=i,D=o,N=s,b=l,c};return t},S=I(function(e,t,n){return N=e,L(),t(n),j(),e}),R=I(function(e,t,n){var a={nextSibling:e};return N=a,t(n),e!==N&&e.parentNode&&x(b,e,c(b).keyMap),a===N?null:N}),w=function(e,t,n){var a=c(e);return t===a.nodeName&&n==a.key},M=function(e,t){if(!N||!w(N,e,t)){var n=c(b),a=N&&c(N),r=n.keyMap,i=void 0;if(t){var o=r[t];o&&(w(o,e,t)?i=o:o===N?E.markDeleted(o):x(b,o,r))}i||(i="#text"===e?f(D):m(D,b,e,t),t&&(r[t]=i),E.markCreated(i)),c(i).focused?k(b,i,N):a&&a.key&&!a.focused?(b.replaceChild(i,N),n.keyMapValid=!1):b.insertBefore(i,N),N=i}},x=function(e,t,n){e.removeChild(t),E.markDeleted(t);var a=c(t).key;a&&delete n[a]},A=function(){var e=b,t=c(e),n=t.keyMap,a=t.keyMapValid,r=e.lastChild,i=void 0;if(r!==N||!a){for(;r!==N;)x(e,r,n),r=e.lastChild;if(!a){for(i in n)r=n[i],r.parentNode!==e&&(E.markDeleted(r),delete n[i]);t.keyMapValid=!0}}},L=function(){b=N,N=null},P=function(){return N?N.nextSibling:b.firstChild},T=function(){N=P()},j=function(){A(),N=b,b=b.parentNode},K=function(e,t){return T(),M(e,t),L(),b},V=function(){return j(),N},F=function(){return T(),M("#text",null),N},U=function(){return b},H=function(){return P()},B=function(){N=b.lastChild},G=T,X={"default":"__default"},J=function(e){return 0===e.lastIndexOf("xml:",0)?"http://www.w3.org/XML/1998/namespace":0===e.lastIndexOf("xlink:",0)?"http://www.w3.org/1999/xlink":void 0},W=function(e,t,n){if(null==n)e.removeAttribute(t);else{var a=J(t);a?e.setAttributeNS(a,t,n):e.setAttribute(t,n)}},q=function(e,t,n){e[t]=n},Z=function(e,t,n){t.indexOf("-")>=0?e.setProperty(t,n):e[t]=n},Y=function(e,t,n){if("string"==typeof n)e.style.cssText=n;else{e.style.cssText="";var a=e.style,r=n;for(var i in r)o(r,i)&&Z(a,i,r[i])}},Q=function(t,n,a){var r="undefined"==typeof a?"undefined":e["typeof"](a);"object"===r||"function"===r?q(t,n,a):W(t,n,a)},z=function(e,t,n){var a=c(e),r=a.attrs;if(r[t]!==n){var i=$[t]||$[X["default"]];i(e,t,n),r[t]=n}},$=s();$[X["default"]]=Q,$.style=Y;var ee=3,te=[],ne=function(e,t,n,a){var r=K(e,t),i=c(r);if(!i.staticsApplied){if(n)for(var o=0;o<n.length;o+=2){var s=n[o],l=n[o+1];z(r,s,l)}i.staticsApplied=!0}for(var u=i.attrsArr,d=i.newAttrs,h=!u.length,m=ee,f=0;m<arguments.length;m+=2,f+=2){var p=arguments[m];if(h)u[f]=p,d[p]=void 0;else if(u[f]!==p)break;var l=arguments[m+1];(h||u[f+1]!==l)&&(u[f+1]=l,z(r,p,l))}if(m<arguments.length||f<u.length){for(;m<arguments.length;m+=1,f+=1)u[f]=arguments[m];for(f<u.length&&(u.length=f),m=0;m<u.length;m+=2){var s=u[m],l=u[m+1];d[s]=l}for(var v in d)z(r,v,d[v]),d[v]=void 0}return r},ae=function(e,t,n){te[0]=e,te[1]=t,te[2]=n},re=function(e,t){te.push(e),te.push(t)},ie=function(){var e=ne.apply(null,te);return te.length=0,e},oe=function(e){var t=V();return t},se=function(e,t,n,a){return ne.apply(null,arguments),oe(e)},le=function(e,t){var n=F(),a=c(n);if(a.text!==e){a.text=e;for(var r=e,i=1;i<arguments.length;i+=1){var o=arguments[i];r=o(r)}n.data=r}return n};t.patch=S,t.patchInner=S,t.patchOuter=R,t.currentElement=U,t.currentPointer=H,t.skip=B,t.skipNode=G,t.elementVoid=se,t.elementOpenStart=ae,t.elementOpenEnd=ie,t.elementOpen=ne,t.elementClose=oe,t.text=le,t.attr=re,t.symbols=X,t.attributes=$,t.applyAttr=W,t.applyProp=q,t.notifications=p,t.importNode=d})}.call(this),function(){function t(){throw Error("Unimplemented abstract method")}function n(e,t){for(var n=[e[t]];e.__proto__&&!e.__proto__.isPrototypeOf(Function);)e=e.__proto__,n.push(e[t]);return n}function a(){N=null}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};N=e}function i(){return N||"undefined"!=typeof window&&window.__METAL_COMPATIBILITY__&&r(window.__METAL_COMPATIBILITY__),N}function o(e){if(!e.name){var t=e.toString();e.name=t.substring(9,t.indexOf("("))}return e.name}function s(e,t){if(e){var n=e[D];return t&&!e.hasOwnProperty(D)&&(n=null),n||(e[D]=b++)}return b++}function l(e){return e}function u(e){return"boolean"==typeof e}function c(e){return void 0!==e}function d(e){return c(e)&&!p(e)}function h(t){return t&&"object"===("undefined"==typeof t?"undefined":e["typeof"](t))&&9===t.nodeType}function m(t){return t&&"object"===("undefined"==typeof t?"undefined":e["typeof"](t))&&1===t.nodeType}function f(e){return"function"==typeof e}function p(e){return null===e}function v(e){return"number"==typeof e}function _(e){return null!==e&&e===e.window}function y(t){var n="undefined"==typeof t?"undefined":e["typeof"](t);return"object"===n&&null!==t||"function"===n}function g(t){return t&&"object"===("undefined"==typeof t?"undefined":e["typeof"](t))&&"function"==typeof t.then}function C(e){return"string"==typeof e||e instanceof String}function k(e,t,a){var r=t+"_MERGED";if(e.hasOwnProperty(r))return!1;var i=n(e,t);return a&&(i=a(i)),e[r]=i,!0}function E(){}var N=void 0,b=1,D="core_"+(1e9*Math.random()>>>0);this.metalNamed.coreNamed=this.metalNamed.coreNamed||{},this.metalNamed.coreNamed.UID_PROPERTY=D,this.metalNamed.coreNamed.abstractMethod=t,this.metalNamed.coreNamed.collectSuperClassesProperty=n,this.metalNamed.coreNamed.disableCompatibilityMode=a,this.metalNamed.coreNamed.enableCompatibilityMode=r,this.metalNamed.coreNamed.getCompatibilityModeData=i,this.metalNamed.coreNamed.getFunctionName=o,this.metalNamed.coreNamed.getUid=s,this.metalNamed.coreNamed.identityFunction=l,this.metalNamed.coreNamed.isBoolean=u,this.metalNamed.coreNamed.isDef=c,this.metalNamed.coreNamed.isDefAndNotNull=d,this.metalNamed.coreNamed.isDocument=h,this.metalNamed.coreNamed.isElement=m,this.metalNamed.coreNamed.isFunction=f,this.metalNamed.coreNamed.isNull=p,this.metalNamed.coreNamed.isNumber=v,this.metalNamed.coreNamed.isWindow=_,this.metalNamed.coreNamed.isObject=y,this.metalNamed.coreNamed.isPromise=g,this.metalNamed.coreNamed.isString=C,this.metalNamed.coreNamed.mergeSuperClassesProperty=k,this.metalNamed.coreNamed.nullFunction=E}.call(this),function(){var e=this.metalNamed.coreNamed;this.metal.core=e,this.metalNamed.core=this.metalNamed.core||{},this.metalNamed.core.core=e,Object.keys(this.metalNamed.coreNamed).forEach(function(e){this.metalNamed.core[e]=this.metalNamed.coreNamed[e]})}.call(this),function(){var t=this.metalNamed.core.isDef,n=function(){function n(){e.classCallCheck(this,n)}return e.createClass(n,null,[{key:"equal",value:function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}},{key:"firstDefinedValue",value:function(e){for(var t=0;t<e.length;t++)if(void 0!==e[t])return e[t]}},{key:"flatten",value:function(e,t){for(var a=t||[],r=0;r<e.length;r++)Array.isArray(e[r])?n.flatten(e[r],a):a.push(e[r]);return a}},{key:"remove",value:function(e,t){var a,r=e.indexOf(t);return(a=r>=0)&&n.removeAt(e,r),a}},{key:"removeAt",value:function(e,t){return 1===Array.prototype.splice.call(e,t,1).length}},{key:"slice",value:function(e,n,a){for(var r=[],i=t(a)?a:e.length,o=n;o<i;o++)r.push(e[o]);return r}}]),n}();this.metal.array=n}.call(this),function(){var e={};e.throwException=function(t){e.nextTick(function(){throw t})},e.run=function(t,n){e.run.workQueueScheduled_||(e.nextTick(e.run.processWorkQueue),e.run.workQueueScheduled_=!0),e.run.workQueue_.push(new e.run.WorkItem_(t,n))},e.run.workQueueScheduled_=!1,e.run.workQueue_=[],e.run.processWorkQueue=function(){for(;e.run.workQueue_.length;){var t=e.run.workQueue_;e.run.workQueue_=[];for(var n=0;n<t.length;n++){var a=t[n];try{a.fn.call(a.scope)}catch(r){e.throwException(r)}}}e.run.workQueueScheduled_=!1},e.run.WorkItem_=function(e,t){this.fn=e,this.scope=t},e.nextTick=function(t,n){var a=t;return n&&(a=t.bind(n)),a=e.nextTick.wrapCallback_(a),"function"==typeof setImmediate?void setImmediate(a):(e.nextTick.setImmediate_||(e.nextTick.setImmediate_=e.nextTick.getSetImmediateEmulator_()),void e.nextTick.setImmediate_(a))},e.nextTick.setImmediate_=null,e.nextTick.getSetImmediateEmulator_=function(){var e;if("function"==typeof MessageChannel&&(e=MessageChannel),"undefined"==typeof e&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&(e=function(){var e=document.createElement("iframe");e.style.display="none",e.src="",document.documentElement.appendChild(e);var t=e.contentWindow,n=t.document;n.open(),n.write(""),n.close();var a="callImmediate"+Math.random(),r=t.location.protocol+"//"+t.location.host,i=function(e){e.origin!==r&&e.data!==a||this.port1.onmessage()}.bind(this);t.addEventListener("message",i,!1),this.port1={},this.port2={postMessage:function(){t.postMessage(a,r)}}}),"undefined"!=typeof e){var t=new e,n={},a=n;return t.port1.onmessage=function(){n=n.next;var e=n.cb;n.cb=null,e()},function(e){a.next={cb:e},a=a.next,t.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("script")?function(e){var t=document.createElement("script");t.onreadystatechange=function(){t.onreadystatechange=null,t.parentNode.removeChild(t),t=null,e(),e=null},document.documentElement.appendChild(t)}:function(e){setTimeout(e,0)}},e.nextTick.wrapCallback_=function(e){return e},this.metal.async=e}.call(this),function(){var t=function(){function t(){e.classCallCheck(this,t),this.disposed_=!1}return e.createClass(t,[{key:"dispose",value:function(){this.disposed_||(this.disposeInternal(),this.disposed_=!0)}},{key:"disposeInternal",value:function(){}},{key:"isDisposed",value:function(){return this.disposed_}}]),t}();this.metal.Disposable=t}.call(this),function(){var t=function(){function t(){e.classCallCheck(this,t)}return e.createClass(t,null,[{key:"mixin",value:function(e){for(var t,n,a=1;a<arguments.length;a++){n=arguments[a];for(t in n)e[t]=n[t]}return e}},{key:"getObjectByName",value:function(e,t){var n=t||window,a=e.split(".");return a.reduce(function(e,t){return e[t]},n)}},{key:"map",value:function(e,t){for(var n={},a=Object.keys(e),r=0;r<a.length;r++)n[a[r]]=t(a[r],e[a[r]]);return n}},{key:"shallowEqual",value:function(e,t){if(e===t)return!0;var n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(var r=0;r<n.length;r++)if(e[n[r]]!==t[n[r]])return!1;return!0}}]),t}();this.metal.object=t}.call(this),function(){var t=function(){function t(){e.classCallCheck(this,t)}return e.createClass(t,null,[{key:"collapseBreakingSpaces",value:function(e){return e.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")}},{key:"escapeRegex",value:function(e){return String(e).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")}},{key:"getRandomString",value:function(){var e=2147483648;return Math.floor(Math.random()*e).toString(36)+Math.abs(Math.floor(Math.random()*e)^Date.now()).toString(36)}},{key:"hashCode",value:function(e){for(var t=0,n=0,a=e.length;n<a;n++)t=31*t+e.charCodeAt(n),t%=4294967296;return t}},{key:"replaceInterval",value:function(e,t,n,a){return e.substring(0,t)+a+e.substring(n)}}]),t}();this.metal.string=t}.call(this),function(){var e=this.metal.core,t=this.metal.array,n=this.metal.async,a=this.metal.Disposable,r=this.metal.object,i=this.metal.string;this.metalNamed.metal=this.metalNamed.metal||{},Object.keys(this.metalNamed.core).forEach(function(e){this.metalNamed.metal[e]=this.metalNamed.core[e]}),this.metalNamed.metal.array=t,this.metalNamed.metal.async=n,this.metalNamed.metal.Disposable=a,this.metalNamed.metal.object=r,this.metalNamed.metal.string=i,this.metal.metal=e}.call(this),function(){var t="__metal_data__",n=function(){function n(){e.classCallCheck(this,n)}return e.createClass(n,null,[{key:"get",value:function(e){return e[t]||(e[t]={delegating:{},listeners:{}}),e[t]}}]),n}();this.metal.domData=n}.call(this),function(){var t=this.metalNamed.metal.Disposable,n=function(t){function n(t,a,r){e.classCallCheck(this,n);var i=e.possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return i.emitter_=t,i.event_=a,i.listener_=r,i}return e.inherits(n,t),e.createClass(n,[{key:"disposeInternal",value:function(){this.removeListener(),this.emitter_=null,this.listener_=null}},{key:"removeListener",value:function(){this.emitter_.isDisposed()||this.emitter_.removeListener(this.event_,this.listener_)}}]),n}(t);this.metal.EventHandle=n}.call(this),function(){var t=this.metalNamed.metal.array,n=this.metalNamed.metal.Disposable,a=this.metalNamed.metal.isFunction,r=this.metalNamed.metal.isString,i=this.metal.EventHandle,o=function(n){function o(){e.classCallCheck(this,o);var t=e.possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return t.events_=[],t.maxListeners_=10,t.shouldUseFacade_=!1,t}return e.inherits(o,n),e.createClass(o,[{key:"addListener",value:function(e,t,n){this.validateListener_(t),e=this.normalizeEvents_(e);for(var a=0;a<e.length;a++)this.addSingleListener_(e[a],t,n);return new i(this,e,t)}},{key:"addSingleListener_",value:function(e,t,n,a){this.emit("newListener",e,t),this.events_[e]||(this.events_[e]=[]),this.events_[e].push({"default":n,fn:t,origin:a});var r=this.events_[e];r.length>this.maxListeners_&&!r.warned&&(r.warned=!0)}},{key:"disposeInternal",value:function(){this.events_=[]}},{key:"emit",value:function(e){var n,a=t.slice(arguments,1),r=(this.events_[e]||[]).concat();this.getShouldUseFacade()&&(n={preventDefault:function(){n.preventedDefault=!0},target:this,type:e},a.push(n));for(var i=[],o=0;o<r.length;o++)r[o]["default"]?i.push(r[o]):r[o].fn.apply(this,a);if(!n||!n.preventedDefault)for(var s=0;s<i.length;s++)i[s].fn.apply(this,a);return"*"!==e&&this.emit.apply(this,["*",e].concat(a)),r.length>0}},{key:"getShouldUseFacade",value:function(){return this.shouldUseFacade_}},{key:"listeners",value:function(e){return(this.events_[e]||[]).map(function(e){return e.fn})}},{key:"many",value:function(e,t,n){e=this.normalizeEvents_(e);for(var a=0;a<e.length;a++)this.many_(e[a],t,n);return new i(this,e,n)}},{key:"many_",value:function(e,t,n){function a(){0===--t&&r.removeListener(e,a),n.apply(r,arguments)}var r=this;t<=0||r.addSingleListener_(e,a,!1,n)}},{key:"matchesListener_",value:function(e,t){return e.fn===t||e.origin&&e.origin===t}},{key:"normalizeEvents_",value:function(e){return r(e)?[e]:e}},{key:"off",value:function(e,t){this.validateListener_(t),e=this.normalizeEvents_(e);for(var n=0;n<e.length;n++){var a=this.events_[e[n]]||[];this.removeMatchingListenerObjs_(a,t)}return this}},{key:"on",value:function(){return this.addListener.apply(this,arguments)}},{key:"once",value:function(e,t){return this.many(e,1,t)}},{key:"removeAllListeners",value:function(e){if(e)for(var t=this.normalizeEvents_(e),n=0;n<t.length;n++)this.events_[t[n]]=null;else this.events_={};return this}},{key:"removeMatchingListenerObjs_",value:function(e,t){for(var n=e.length-1;n>=0;n--)this.matchesListener_(e[n],t)&&e.splice(n,1)}},{key:"removeListener",value:function(){return this.off.apply(this,arguments)}},{key:"setMaxListeners",value:function(e){return this.maxListeners_=e,this}},{key:"setShouldUseFacade",value:function(e){return this.shouldUseFacade_=e,this}},{key:"validateListener_",value:function(e){if(!a(e))throw new TypeError("Listener must be a function")}}]),o}(n);this.metal.EventEmitter=o}.call(this),function(){var t=this.metalNamed.metal.array,n=this.metalNamed.metal.object,a=this.metalNamed.metal.Disposable,r=function(a){function r(t,a,i,o){e.classCallCheck(this,r);var s=e.possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return s.blacklist_=n.mixin({newListener:!0},i),s.originEmitter_=t,s.pendingEvents_=[],s.proxiedEvents_={},s.targetEmitter_=a,s.whitelist_=o,s.startProxy_(),s}return e.inherits(r,a),e.createClass(r,[{key:"addListener_",value:function(e,t){return this.originEmitter_.on(e,t)}},{key:"addListenerForEvent_",value:function(e){return this.addListener_(e,this.emitOnTarget_.bind(this,e))}},{key:"disposeInternal",value:function(){this.removeListeners_(),this.proxiedEvents_=null,this.originEmitter_=null,this.targetEmitter_=null}},{key:"emitOnTarget_",value:function(e){var n=[e].concat(t.slice(arguments,1));this.targetEmitter_.emit.apply(this.targetEmitter_,n)}},{key:"proxyEvent",value:function(e){this.shouldProxyEvent_(e)&&this.tryToAddListener_(e)}},{key:"removeListeners_",value:function(){for(var e=Object.keys(this.proxiedEvents_),t=0;t<e.length;t++)this.proxiedEvents_[e[t]].removeListener();this.proxiedEvents_={},this.pendingEvents_=[]}},{key:"setOriginEmitter",value:function(e){var t=this,n=this.originEmitter_?Object.keys(this.proxiedEvents_):this.pendingEvents_;this.removeListeners_(),this.originEmitter_=e,n.forEach(function(e){return t.proxyEvent(e)})}},{key:"shouldProxyEvent_",value:function(e){return!(this.whitelist_&&!this.whitelist_[e])&&(!this.blacklist_[e]&&!this.proxiedEvents_[e])}},{key:"startProxy_",value:function(){this.targetEmitter_.on("newListener",this.proxyEvent.bind(this))}},{key:"tryToAddListener_",value:function(e){this.originEmitter_?this.proxiedEvents_[e]=this.addListenerForEvent_(e):this.pendingEvents_.push(e)}}]),r}(a);this.metal.EventEmitterProxy=r}.call(this),function(){var t=this.metalNamed.metal.Disposable,n=function(t){function n(){e.classCallCheck(this,n);var t=e.possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.eventHandles_=[],t}return e.inherits(n,t),e.createClass(n,[{key:"add",value:function(){for(var e=0;e<arguments.length;e++)this.eventHandles_.push(arguments[e])}},{key:"disposeInternal",value:function(){this.eventHandles_=null}},{key:"removeAllListeners",value:function(){for(var e=0;e<this.eventHandles_.length;e++)this.eventHandles_[e].removeListener();this.eventHandles_=[]}}]),n}(t);this.metal.EventHandler=n}.call(this),function(){var e=this.metal.EventEmitter,t=this.metal.EventEmitterProxy,n=this.metal.EventHandle,a=this.metal.EventHandler;this.metal.events=e,this.metalNamed.events=this.metalNamed.events||{},this.metalNamed.events.EventEmitter=e,this.metalNamed.events.EventEmitterProxy=t,this.metalNamed.events.EventHandle=n,this.metalNamed.events.EventHandler=a}.call(this),function(){var t=this.metalNamed.metal.array,n=this.metalNamed.metal.isString,a=this.metal.domData,r=this.metalNamed.events.EventHandle,i=function(r){function i(t,n,a,r){e.classCallCheck(this,i);var o=e.possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n,a));return o.selector_=r,o}return e.inherits(i,r),e.createClass(i,[{key:"removeListener",value:function(){var e=a.get(this.emitter_),r=this.selector_,i=n(r)?e.delegating[this.event_].selectors:e.listeners,o=n(r)?r:this.event_;t.remove(i[o]||[],this.listener_),i[o]&&0===i[o].length&&delete i[o]}}]),i}(r);this.metal.DomDelegatedEventHandle=i}.call(this),function(){var t=this.metalNamed.events.EventHandle,n=function(t){function n(t,a,r,i){e.classCallCheck(this,n);var o=e.possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,a,r));return o.capture_=i,o}return e.inherits(n,t),e.createClass(n,[{key:"removeListener",value:function(){this.emitter_.removeEventListener(this.event_,this.listener_,this.capture_)}}]),n}(t);this.metal.DomEventHandle=n}.call(this),function(){function e(e,a){if(q(e)&&Z(a)){e.length||(e=[e]);for(var r=0;r<e.length;r++)"classList"in e[r]?t(e[r],a):n(e[r],a)}}function t(e,t){t.split(" ").forEach(function(t){t&&e.classList.add(t)})}function n(e,t){var n=" "+e.className+" ",a="";t=t.split(" ");for(var r=0;r<t.length;r++){var i=t[r];n.indexOf(" "+i+" ")===-1&&(a+=" "+i)}a&&(e.className=e.className+a)}function a(e,t,n){var a=Q.get(e);i(a.listeners,t,n)}function r(e,t,n,a){var r=Q.get(e);i(r.delegating[t].selectors,n,a)}function i(e,t,n){e[t]||(e[t]=[]),e[t].push(n)}function o(e,t){var n=Q.get(e);n.delegating[t]||(n.delegating[t]={handle:b(e,t,p,!!ae[t]),selectors:{}})}function s(e,t){for(;e&&!C(e,t);)e=e.parentNode;return e}function l(e,t){if(Z(t)&&(t=u(t)),t instanceof NodeList)for(var n=Array.prototype.slice.call(t),a=0;a<n.length;a++)e.appendChild(n[a]);else e.appendChild(t);return t}function u(e){var t=document.createElement("div");t.innerHTML="<br>"+e,t.removeChild(t.firstChild);for(var n=document.createDocumentFragment();t.firstChild;)n.appendChild(t.firstChild);return n}function c(e,t){return J(e)?e.documentElement.contains(t):e.contains(t)}function d(e,t,n,i,s){var l=te[t];return l&&l.delegate&&(t=l.originalEvent,i=l.handler.bind(l,i)),s&&(i=i.bind(),i.defaultListener_=!0),o(e,t),Z(n)?r(e,t,n,i):a(n,t,i),new z(Z(n)?e:n,t,i,Z(n)?n:null)}function h(e,t,n){if(n&&"click"===t&&2===n.button)return!1;var a=["BUTTON","INPUT","SELECT","TEXTAREA","FIELDSET"];return!("click"===t&&a.indexOf(e.tagName)>-1)||!(e.disabled||O(e,"fieldset[disabled]"))}function m(e){e&&l(document.body,e)}function f(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function p(e){N(e);var t=X(e[ne])?e[ne]:e.target,n=!0,a=e.currentTarget,r=e.currentTarget.parentNode,i=[];return n&=j(a,t,e,r,i),n&=T(i,e),e.delegateTarget=null,e[ne]=r,n}function v(e,t){return"classList"in e?_(e,t):y(e,t)}function _(e,t){return e.classList.contains(t)}function y(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>=0}function g(e){return 0===e.childNodes.length}function C(e,t){if(!e||1!==e.nodeType)return!1;var n=Element.prototype,a=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector;return a?a.call(e,t):k(e,t)}function k(e,t){for(var n=document.querySelectorAll(t,e.parentNode),a=0;a<n.length;++a)if(n[a]===e)return!0;return!1}function E(e,t){do if(e=e.nextSibling,e&&C(e,t))return e;while(e);return null}function N(e){e.stopPropagation=L,e.stopImmediatePropagation=A}function b(e,t,n,a){if(Z(e))return d(document,t,e,n);var r=te[t];return r&&r.event&&(t=r.originalEvent,n=r.handler.bind(r,n)),e.addEventListener(t,n,a),new $(e,t,n,a)}function D(e,t,n){var a=b(e,t,function(){return a.removeListener(),n.apply(this,arguments)});return a}function O(e,t){return s(e.parentNode,t)}function I(e,t){te[e]=t}function S(e){for(var t;t=e.firstChild;)e.removeChild(t)}function R(e,t){if(q(e)&&Z(t)){e.length||(e=[e]);for(var n=0;n<e.length;n++)"classList"in e[n]?w(e[n],t):M(e[n],t)}}function w(e,t){t.split(" ").forEach(function(t){t&&e.classList.remove(t)})}function M(e,t){var n=" "+e.className+" ";t=t.split(" ");for(var a=0;a<t.length;a++)n=n.replace(" "+t[a]+" "," ");e.className=n.trim()}function x(e,t){e&&t&&e!==t&&e.parentNode&&(e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e))}function A(){var e=this;e.stopped=!0,e.stoppedImmediate=!0,Event.prototype.stopImmediatePropagation.call(e)}function L(){var e=this;e.stopped=!0,Event.prototype.stopPropagation.call(e)}function P(e,t){return!!te[t]||(Z(e)&&(ee[e]||(ee[e]=document.createElement(e)),e=ee[e]),"on"+t in e)}function T(e,t){for(var n=!0,a=0;a<e.length&&!t.defaultPrevented;a++)t.delegateTarget=e[a].element,n&=e[a].fn(t);return n}function j(e,t,n,a,r){for(var i=!0;t&&t!==a&&!n.stopped;)h(t,n.type,n)&&(n.delegateTarget=t,i&=G(e,t,n,r)),t=t.parentNode;return i}function K(e){return W(e)||J(e)?e:Z(e)?"#"===e[0]&&e.indexOf(" ")===-1?document.getElementById(e.substr(1)):document.querySelector(e):null}function V(e,t){q(e)&&Z(t)&&("classList"in e?F(e,t):U(e,t))}function F(e,t){t.split(" ").forEach(function(t){e.classList.toggle(t)})}function U(e,t){var n=" "+e.className+" ";t=t.split(" ");for(var a=0;a<t.length;a++){var r=" "+t[a]+" ",i=n.indexOf(r);n=i===-1?n+t[a]+" ":n.substring(0,i)+" "+n.substring(i+r.length)}e.className=n.trim()}function H(e,t,n){if(h(e,t,n)){var a=document.createEvent("HTMLEvents");a.initEvent(t,!0,!0),Y.mixin(a,n),e.dispatchEvent(a)}}function B(e,t,n,a){var r=!0;e=e||[];for(var i=0;i<e.length&&!t.stoppedImmediate;i++)e[i].defaultListener_?a.push({element:n,fn:e[i]}):r&=e[i](t);return r}function G(e,t,n,a){for(var r=Q.get(t),i=r.listeners[n.type],o=B(i,n,t,a),s=Q.get(e).delegating[n.type].selectors,l=Object.keys(s),u=0;u<l.length&&!n.stoppedImmediate;u++)C(t,l[u])&&(i=s[l[u]],o&=B(i,n,t,a));return o}var X=this.metalNamed.metal.isDef,J=this.metalNamed.metal.isDocument,W=this.metalNamed.metal.isElement,q=this.metalNamed.metal.isObject,Z=this.metalNamed.metal.isString,Y=this.metalNamed.metal.object,Q=this.metal.domData,z=this.metal.DomDelegatedEventHandle,$=this.metal.DomEventHandle,ee={},te={};this.metalNamed.domNamed=this.metalNamed.domNamed||{},this.metalNamed.domNamed.customEvents=te;var ne="__metal_next_target__",ae={blur:!0,error:!0,focus:!0,invalid:!0,load:!0,scroll:!0};this.metalNamed.domNamed.addClasses=e,this.metalNamed.domNamed.closest=s,this.metalNamed.domNamed.append=l,this.metalNamed.domNamed.buildFragment=u,this.metalNamed.domNamed.contains=c,this.metalNamed.domNamed.delegate=d,this.metalNamed.domNamed.enterDocument=m,this.metalNamed.domNamed.exitDocument=f,this.metalNamed.domNamed.hasClass=v,this.metalNamed.domNamed.isEmpty=g,this.metalNamed.domNamed.match=C,this.metalNamed.domNamed.next=E,this.metalNamed.domNamed.on=b,this.metalNamed.domNamed.once=D,this.metalNamed.domNamed.parent=O,this.metalNamed.domNamed.registerCustomEvent=I,this.metalNamed.domNamed.removeChildren=S,this.metalNamed.domNamed.removeClasses=R,this.metalNamed.domNamed.replace=x,this.metalNamed.domNamed.supportsEvent=P,this.metalNamed.domNamed.toElement=K,this.metalNamed.domNamed.toggleClasses=V,this.metalNamed.domNamed.triggerEvent=H}.call(this),function(){var e=this.metalNamed.domNamed;this.metal.dom=e,this.metalNamed.dom=this.metalNamed.dom||{},this.metalNamed.dom.dom=e,Object.keys(this.metalNamed.domNamed).forEach(function(e){this.metalNamed.dom[e]=this.metalNamed.domNamed[e]})}.call(this),function(){var t=this.metalNamed.dom.delegate,n=this.metalNamed.dom.on,a=this.metalNamed.dom.supportsEvent,r=this.metalNamed.events.EventEmitterProxy,i=function(r){function i(){return e.classCallCheck(this,i),e.possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return e.inherits(i,r),e.createClass(i,[{key:"addListener_",value:function(a,r){if(this.originEmitter_.addEventListener){if(this.isDelegateEvent_(a)){var o=a.indexOf(":",9),s=a.substring(9,o),l=a.substring(o+1);return t(this.originEmitter_,s,l,r)}return n(this.originEmitter_,a,r)}return e.get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"addListener_",this).call(this,a,r)}},{key:"isDelegateEvent_",value:function(e){return"delegate:"===e.substr(0,9)}},{key:"isSupportedDomEvent_",value:function(e){return!this.originEmitter_||!this.originEmitter_.addEventListener||(this.isDelegateEvent_(e)&&e.indexOf(":",9)!==-1||a(this.originEmitter_,e))}},{key:"shouldProxyEvent_",value:function(t){return e.get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"shouldProxyEvent_",this).call(this,t)&&this.isSupportedDomEvent_(t)}}]),i}(r);this.metal.DomEventEmitterProxy=i}.call(this),function(){var t=this.metalNamed.dom.append,n=this.metalNamed.metal.string,a=function(){function a(){e.classCallCheck(this,a)}return e.createClass(a,null,[{key:"checkAnimationEventName",value:function(){return void 0===a.animationEventName_&&(a.animationEventName_={animation:a.checkAnimationEventName_("animation"),transition:a.checkAnimationEventName_("transition")}),a.animationEventName_}},{key:"checkAnimationEventName_",value:function(e){for(var t=["Webkit","MS","O",""],r=n.replaceInterval(e,0,1,e.substring(0,1).toUpperCase()),i=[r+"End",r+"End",r+"End",e+"end"],o=0;o<t.length;o++)if(void 0!==a.animationElement_.style[t[o]+r])return t[o].toLowerCase()+i[o];return e+"end"}},{key:"checkAttrOrderChange",value:function(){if(void 0===a.attrOrderChange_){var e='<div data-component="" data-ref=""></div>',n=document.createElement("div");t(n,e),a.attrOrderChange_=e!==n.innerHTML}return a.attrOrderChange_}}]),a}();a.animationElement_=document.createElement("div"),a.animationEventName_=void 0,a.attrOrderChange_=void 0,this.metal.features=a}.call(this),function(){var t=this.metalNamed.metal.async,n=this.metalNamed.dom.exitDocument,a=this.metalNamed.dom.once,r=function(){function r(){e.classCallCheck(this,r)}return e.createClass(r,null,[{key:"run",value:function(e,t){var a=document.createElement("script");return a.text=e,t?t(a):document.head.appendChild(a),n(a),a}},{key:"runFile",value:function(e,t,r){var i=document.createElement("script");i.src=e;var o=function(){n(i),t&&t()};return a(i,"load",o),a(i,"error",o),r?r(i):document.head.appendChild(i),i}},{key:"runScript",value:function(e,a,i){var o=function(){a&&a()};return e.type&&"text/javascript"!==e.type?void t.nextTick(o):(n(e),e.src?r.runFile(e.src,a,i):(t.nextTick(o),r.run(e.text,i)))}},{key:"runScriptsInElement",value:function(e,n,a){var i=e.querySelectorAll("script");i.length?r.runScriptsInOrder(i,0,n,a):n&&t.nextTick(n)}},{key:"runScriptsInOrder",value:function(e,n,a,i){r.runScript(e.item(n),function(){n<e.length-1?r.runScriptsInOrder(e,n+1,a,i):a&&t.nextTick(a)},i)}}]),r}();this.metal.globalEval=r}.call(this),function(){var t=this.metalNamed.metal.async,n=this.metalNamed.dom.once,a=function(){function a(){e.classCallCheck(this,a)}return e.createClass(a,null,[{key:"run",value:function(e,t){var n=document.createElement("style");return n.innerHTML=e,t?t(n):document.head.appendChild(n),n}},{key:"runFile",value:function(e,t,n){var r=document.createElement("link");return r.rel="stylesheet",r.href=e,a.runStyle(r,t,n),r}},{key:"runStyle",value:function(e,a,r){var i=function(){a&&a()};return e.rel&&"stylesheet"!==e.rel?void t.nextTick(i):("STYLE"===e.tagName?t.nextTick(i):(n(e,"load",i),n(e,"error",i)),r?r(e):document.head.appendChild(e),e)}},{key:"runStylesInElement",value:function(e,n,r){var i=e.querySelectorAll("style,link");if(0===i.length&&n)return void t.nextTick(n);for(var o=0,s=function(){n&&++o===i.length&&t.nextTick(n)},l=0;l<i.length;l++)a.runStyle(i[l],s,r)}}]),a}();this.metal.globalEvalStyles=a}.call(this),function(){var e=this.metalNamed.dom.registerCustomEvent,t=this.metal.features,n={mouseenter:"mouseover",mouseleave:"mouseout",
pointerenter:"pointerover",pointerleave:"pointerout"};Object.keys(n).forEach(function(t){e(t,{delegate:!0,handler:function(e,n){var a=n.relatedTarget,r=n.delegateTarget;if(!a||a!==r&&!r.contains(a))return n.customType=t,e(n)},originalEvent:n[t]})});var a={animation:"animationend",transition:"transitionend"};Object.keys(a).forEach(function(n){var r=a[n];e(r,{event:!0,delegate:!0,handler:function(e,t){return t.customType=r,e(t)},originalEvent:t.checkAnimationEventName()[n]})})}.call(this),function(){var e=this.metal.dom,t=this.metal.domData,n=this.metal.DomEventEmitterProxy,a=this.metal.DomEventHandle,r=this.metal.features,i=this.metal.globalEval,o=this.metal.globalEvalStyles;this.metalNamed.dom=this.metalNamed.dom||{},Object.keys(this.metalNamed.dom).forEach(function(e){this.metalNamed.dom[e]=this.metalNamed.dom[e]}),this.metalNamed.dom.domData=t,this.metalNamed.dom.DomEventEmitterProxy=n,this.metalNamed.dom.DomEventHandle=a,this.metalNamed.dom.features=r,this.metalNamed.dom.globalEval=i,this.metalNamed.dom.globalEvalStyles=o,this.metal.dom=e}.call(this),function(){function t(e,t,n){var a=n?o(n.constructor):null,r=n&&n.getRenderer&&n.getRenderer(),i=r&&r.getParent?n.getRenderer().getParent():null,s=i?o(i.constructor):null,l=s?"Check render method of '"+s+"'.":"";return new Error("Warning: Invalid state passed to '"+t+"'. "+(e+" Passed to '"+a+"'. "+l))}function n(t){var n="undefined"==typeof t?"undefined":e["typeof"](t);return Array.isArray(t)?"array":n}function a(e){return e instanceof Error}function r(e){return function(t,n,a){return!(s(t)&&!u(t))||e(t,n,a)}}function i(e){var a=r(function(a,r,i){var o=n(a);return o===e||t("Expected type '"+e+"', but received type '"+o+"'.",r,i)});return function(){return 0===arguments.length?a:a.apply(void 0,arguments)}}var o=this.metalNamed.metal.getFunctionName,s=this.metalNamed.metal.isDef,l=this.metalNamed.metal.isDefAndNotNull,u=this.metalNamed.metal.isNull,c={any:function(){return function(){return!0}},array:i("array"),bool:i("boolean"),func:i("function"),number:i("number"),object:i("object"),string:i("string"),arrayOf:function(e){return r(function(n,r,i){var o=c.array(n,r,i);if(a(o))return o;for(var s=0;s<n.length;s++)if(a(e(n[s],r,i)))return t("Expected an array of single type",r,i);return!0})},instanceOf:function(e){return r(function(n,a,r){return n instanceof e||t("Expected instance of "+e,a,r)})},objectOf:function(e){return r(function(n,r,i){for(var o in n)if(a(e(n[o])))return t("Expected object of one type",r,i);return!0})},oneOf:function(e){return r(function(n,r,i){var o=c.array(e,r,i);if(a(o))return o;for(var s=0;s<e.length;s++){var l=e[s];if(n===l)return!0}return t("Expected one of given values.",r,i)})},oneOfType:function(e){return r(function(n,r,i){var o=c.array(e,r,i);if(a(o))return o;for(var s=0;s<e.length;s++)if(!a(e[s](n,r,i)))return!0;return t("Expected one of given types.",r,i)})},shapeOf:function(e){return r(function(n,r,i){var o=c.object(e,r,i);if(a(o))return o;for(var s in e){var u=!1,d=e[s];if(d.config&&(u=d.config.required,d=d.config.validator),u&&!l(n[s])||a(d(n[s])))return t("Expected object with a specific shape",r,i)}return!0})}};this.metal.validators=c}.call(this),function(){function e(e,n){var r=e;return r===a&&(r=Object.create(a),r.config={}),t.mixin(r.config,n),r}var t=this.metalNamed.metal.object,n=this.metal.validators,a={required:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e(this,{required:t})},setter:function(t){return e(this,{setter:t})},validator:function(t){return e(this,{validator:t})},value:function(t){return e(this,{value:t})}},r=Object.keys(n);r.forEach(function(e){return a[e]=function(){return this.validator(n[e])}}),this.metal.Config=a}.call(this),function(){var t=this.metalNamed.metal.array,n=this.metalNamed.metal.async,a=this.metalNamed.metal.isDefAndNotNull,r=this.metalNamed.metal.isFunction,i=this.metalNamed.metal.isObject,o=this.metalNamed.metal.isString,s=this.metalNamed.metal.mergeSuperClassesProperty,l=this.metalNamed.metal.object,u=this.metalNamed.events.EventEmitter,c=function(u){function c(t,n,a,r){e.classCallCheck(this,c);var i=e.possibleConstructorReturn(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return i.commonOpts_=r,i.context_=a||i,i.keysBlacklist_={},i.obj_=n||i,i.scheduledBatchData_=null,i.stateInfo_={},i.setShouldUseFacade(!0),i.mergeInvalidKeys_(),i.addToStateFromStaticHint_(t),i}return e.inherits(c,u),e.createClass(c,[{key:"addKeyToState",value:function(e,t,n){this.buildKeyInfo_(e,t,n,arguments.length>2),Object.defineProperty(this.obj_,e,this.buildKeyPropertyDef_(e)),this.validateInitialValue_(e),this.assertGivenIfRequired_(e)}},{key:"addToState",value:function(e,t,n){if(o(e))return this.addKeyToState.apply(this,arguments);for(var a=t||{},r=Object.keys(e),i={},s=0;s<r.length;s++){var l=r[s];this.buildKeyInfo_(l,e[l],a[l],a.hasOwnProperty(l)),i[l]=this.buildKeyPropertyDef_(l,n),this.assertGivenIfRequired_(l)}n!==!1&&Object.defineProperties(n||this.obj_,i);for(var u=0;u<r.length;u++)this.validateInitialValue_(r[u])}},{key:"addToStateFromStaticHint_",value:function(e){var t,n=this.constructor,a=c.mergeStateStatic(n);this.obj_===this&&(t=!!a&&n.prototype),this.addToState(n.STATE_MERGED,e,t)}},{key:"assertGivenIfRequired_",value:function(e){var t=this.stateInfo_[e];if(t.config.required){var n=t.state===c.KeyStates.INITIALIZED?this.get(e):t.initialValue;!a(n)}}},{key:"assertValidStateKeyName_",value:function(e){if(this.constructor.INVALID_KEYS_MERGED[e]||this.keysBlacklist_[e])throw new Error("It's not allowed to create a state key with the name \""+e+'".')}},{key:"buildKeyInfo_",value:function(e,t,n,a){this.assertValidStateKeyName_(e),t=t&&t.config?t.config:t||{},this.commonOpts_&&(t=l.mixin({},t,this.commonOpts_)),this.stateInfo_[e]={config:t,state:c.KeyStates.UNINITIALIZED},a&&(this.stateInfo_[e].initialValue=n)}},{key:"buildKeyPropertyDef_",value:function(e,t){var n=t===this.constructor.prototype?null:this;return{configurable:!0,enumerable:!0,get:function(){return(n||this).getStateKeyValue_(e)},set:function(t){(n||this).setStateKeyValue_(e,t)}}}},{key:"callFunction_",value:function(e,t){return o(e)?this.context_[e].apply(this.context_,t):r(e)?e.apply(this.context_,t):void 0}},{key:"callSetter_",value:function(e,t,n){var a=this.stateInfo_[e],r=a.config;return r.setter&&(t=this.callFunction_(r.setter,[t,n])),t}},{key:"callValidator_",value:function(e,t){var n=this.stateInfo_[e],a=n.config;if(a.validator){var r=this.callFunction_(a.validator,[t,e,this.context_]);return r instanceof Error,r}return!0}},{key:"canSetState",value:function(e){var t=this.stateInfo_[e];return!t.config.writeOnce||!t.written}},{key:"disposeInternal",value:function(){e.get(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposeInternal",this).call(this),this.stateInfo_=null,this.scheduledBatchData_=null}},{key:"emitBatchEvent_",value:function(){if(!this.isDisposed()){var e=this.scheduledBatchData_;this.scheduledBatchData_=null,this.emit("stateChanged",e)}}},{key:"get",value:function(e){return this.obj_[e]}},{key:"getState",value:function(e){for(var t={},n=e||this.getStateKeys(),a=0;a<n.length;a++)t[n[a]]=this.get(n[a]);return t}},{key:"getStateKeyConfig",value:function(e){return(this.stateInfo_[e]||{}).config}},{key:"getStateKeys",value:function(){return this.stateInfo_?Object.keys(this.stateInfo_):[]}},{key:"getStateKeyValue_",value:function(e){if(!this.warnIfDisposed_(e))return this.initStateKey_(e),this.stateInfo_[e].value}},{key:"hasBeenSet",value:function(e){var t=this.stateInfo_[e];return t.state===c.KeyStates.INITIALIZED||this.hasInitialValue_(e)}},{key:"hasInitialValue_",value:function(e){return this.stateInfo_[e].hasOwnProperty("initialValue")}},{key:"hasStateKey",value:function(e){if(!this.warnIfDisposed_(e))return!!this.stateInfo_[e]}},{key:"informChange_",value:function(e,t){if(this.shouldInformChange_(e,t)){var n={key:e,newVal:this.get(e),prevVal:t};this.emit(e+"Changed",n),this.emit("stateKeyChanged",n),this.scheduleBatchEvent_(n)}}},{key:"initStateKey_",value:function(e){var t=this.stateInfo_[e];t.state===c.KeyStates.UNINITIALIZED&&(t.state=c.KeyStates.INITIALIZING,this.setInitialValue_(e),t.written||this.setDefaultValue(e),t.state=c.KeyStates.INITIALIZED)}},{key:"mergeInvalidKeys_",value:function(){s(this.constructor,"INVALID_KEYS",function(e){return t.flatten(e).reduce(function(e,t){return t&&(e[t]=!0),e},{})})}},{key:"removeStateKey",value:function(e){this.stateInfo_[e]=null,delete this.obj_[e]}},{key:"scheduleBatchEvent_",value:function(e){this.scheduledBatchData_||(n.nextTick(this.emitBatchEvent_,this),this.scheduledBatchData_={changes:{}});var t=e.key,a=this.scheduledBatchData_.changes;a[t]?a[t].newVal=e.newVal:a[t]=e}},{key:"set",value:function(e,t){this.hasStateKey(e)&&(this.obj_[e]=t)}},{key:"setDefaultValue",value:function(e){var t=this.stateInfo_[e].config;void 0!==t.value?this.set(e,t.value):this.set(e,this.callFunction_(t.valueFn))}},{key:"setInitialValue_",value:function(e){if(this.hasInitialValue_(e)){var t=this.stateInfo_[e];this.set(e,t.initialValue),t.initialValue=void 0}}},{key:"setKeysBlacklist_",value:function(e){this.keysBlacklist_=e}},{key:"setState",value:function(e,t){var n=this;Object.keys(e).forEach(function(t){return n.set(t,e[t])}),t&&this.scheduledBatchData_&&this.once("stateChanged",t)}},{key:"setStateKeyValue_",value:function(e,t){if(!this.warnIfDisposed_(e)&&this.canSetState(e)&&this.validateKeyValue_(e,t)){var n=this.stateInfo_[e];this.hasInitialValue_(e)||n.state!==c.KeyStates.UNINITIALIZED||(n.state=c.KeyStates.INITIALIZED);var a=this.get(e);n.value=this.callSetter_(e,t,a),this.assertGivenIfRequired_(e),n.written=!0,this.informChange_(e,a)}}},{key:"shouldInformChange_",value:function(e,t){var n=this.stateInfo_[e];return n.state===c.KeyStates.INITIALIZED&&(i(t)||t!==this.get(e))}},{key:"validateInitialValue_",value:function(e){var t=this.stateInfo_[e];this.hasInitialValue_(e)&&!this.callValidator_(e,t.initialValue)&&delete t.initialValue}},{key:"validateKeyValue_",value:function(e,t){var n=this.stateInfo_[e];return n.state===c.KeyStates.INITIALIZING||this.callValidator_(e,t)}},{key:"warnIfDisposed_",value:function(e){var t=this.isDisposed();return t}}],[{key:"mergeState",value:function(e){return l.mixin.apply(null,[{}].concat(e.reverse()))}},{key:"mergeStateStatic",value:function(e){return s(e,"STATE",c.mergeState)}}]),c}(u);c.INVALID_KEYS=["state","stateKey"],c.KeyStates={UNINITIALIZED:0,INITIALIZING:1,INITIALIZED:2},this.metal.State=c}.call(this),function(){var e=this.metal.validators,t=this.metal.Config,n=this.metal.State;this.metal.state=n,this.metalNamed.state=this.metalNamed.state||{},this.metalNamed.state.validators=e,this.metalNamed.state.Config=t,this.metalNamed.state.State=n}.call(this),function(){var t=this.metalNamed.metal.array,n=this.metalNamed.metal.mergeSuperClassesProperty,a=this.metalNamed.metal.object,r=this.metalNamed.events.EventEmitter,i=this.metalNamed.events.EventEmitterProxy,o=this.metal.state,s=function(r){function s(a,r){e.classCallCheck(this,s);var i=e.possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return i.component_=a,n(i.constructor,"BLACKLIST",t.firstDefinedValue),o.mergeStateStatic(i.component_.constructor),i.createState_(r,i.component_),i}return e.inherits(s,r),e.createClass(s,[{key:"add",value:function(){var e;(e=this.state_).addToState.apply(e,arguments)}},{key:"buildStateInstanceData_",value:function(e){return a.mixin({},e,this.component_.constructor.STATE_MERGED)}},{key:"createState_",value:function(e,t){var n=new o({},t,this.component_);n.setKeysBlacklist_(this.constructor.BLACKLIST_MERGED),n.addToState(this.buildStateInstanceData_(e),this.component_.getInitialConfig());var a=this.emit_.bind(this);n.on("stateChanged",a),n.on("stateKeyChanged",a),this.state_=n,this.proxy_=new i(n,this.component_)}},{key:"disposeInternal",value:function(){e.get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"disposeInternal",this).call(this),this.state_.dispose(),this.state_=null,this.proxy_.dispose(),this.proxy_=null}},{key:"emit_",value:function(e,t){var n=t.type,a="stateChanged"===n?"dataChanged":"dataPropChanged";this.emit(a,e)}},{key:"get",value:function(e){return this.state_.get(e)}},{key:"getSyncKeys",value:function(){return this.state_.getStateKeys()}},{key:"getStateKeys",value:function(){return this.state_.getStateKeys()}},{key:"getState",value:function(){return this.state_.getState()}},{key:"getStateInstance",value:function(){return this.state_}},{key:"replaceNonInternal",value:function(e){s.replaceNonInternal(e,this.state_)}},{key:"setState",value:function(e,t){this.state_.setState(e,t)}}],[{key:"replaceNonInternal",value:function(e,t){for(var n=t.getStateKeys(),a=0;a<n.length;a++){var r=n[a];t.getStateKeyConfig(r).internal||(e.hasOwnProperty(r)?t.set(r,e[r]):t.setDefaultValue(r))}}}]),s}(r);s.BLACKLIST={components:!0,context:!0,element:!0,refs:!0,wasRendered:!0},this.metal.ComponentDataManager=s}.call(this),function(){var t=this.metalNamed.events.EventEmitter,n=this.metalNamed.events.EventHandler,a=function(t){function a(t){e.classCallCheck(this,a);var r=e.possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return r.component_=t,r.componentRendererEvents_=new n,r.componentRendererEvents_.add(r.component_.once("render",r.render.bind(r))),r.on("rendered",r.handleRendered_),t.on("dataManagerCreated",r.handleDataManagerCreated_.bind(r)),r}return e.inherits(a,t),e.createClass(a,[{key:"disposeInternal",value:function(){this.componentRendererEvents_.removeAllListeners(),this.componentRendererEvents_=null}},{key:"getComponent",value:function(){return this.component_}},{key:"handleDataManagerCreated_",value:function(){var e=this.component_.getDataManager();this.component_.constructor.SYNC_UPDATES_MERGED?this.componentRendererEvents_.add(e.on("dataPropChanged",this.handleManagerDataPropChanged_.bind(this))):this.componentRendererEvents_.add(e.on("dataChanged",this.handleManagerDataChanged_.bind(this)))}},{key:"handleManagerDataChanged_",value:function(e){this.shouldRerender_()&&this.update(e)}},{key:"handleManagerDataPropChanged_",value:function(t){this.shouldRerender_()&&this.update({changes:e.defineProperty({},t.key,t)})}},{key:"handleRendered_",value:function(){this.isRendered_=!0}},{key:"render",value:function(){this.component_.element||(this.component_.element=document.createElement("div")),this.emit("rendered",!this.isRendered_)}},{key:"shouldRerender_",value:function(){return this.isRendered_&&!this.skipUpdates_}},{key:"startSkipUpdates",value:function(){this.skipUpdates_=!0}},{key:"stopSkipUpdates",value:function(){this.skipUpdates_=!1}},{key:"update",value:function(){}}]),a}(t);this.metal.ComponentRenderer=a}.call(this),function(){var t=this.metalNamed.metal.array,n=(this.metalNamed.metal.getFunctionName,this.metalNamed.metal.isBoolean),a=this.metalNamed.metal.isDefAndNotNull,r=this.metalNamed.metal.isElement,i=this.metalNamed.metal.isFunction,o=this.metalNamed.metal.isObject,s=this.metalNamed.metal.isString,l=this.metalNamed.metal.mergeSuperClassesProperty,u=this.metalNamed.metal.object,c=this.metalNamed.dom.DomEventEmitterProxy,d=this.metalNamed.dom.toElement,h=this.metal.ComponentDataManager,m=this.metal.ComponentRenderer,f=this.metalNamed.events.EventEmitter,p=this.metalNamed.events.EventHandler,v=function(n){function h(n,a){e.classCallCheck(this,h);var r=e.possibleConstructorReturn(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return r.attachedListeners_={},r.components={},r.elementEventProxy_=null,r.eventsStateKeyHandler_=new p,r.inDocument=!1,r.initialConfig_=n||{},r.wasRendered=!1,r.DEFAULT_ELEMENT_PARENT=document.body,l(r.constructor,"ELEMENT_CLASSES",r.mergeElementClasses_),l(r.constructor,"SYNC_UPDATES",t.firstDefinedValue),r.element=r.initialConfig_.element,r.renderer_=r.createRenderer(),r.renderer_.on("rendered",r.handleRendererRendered_.bind(r)),r.dataManager_=r.createDataManager(),r.emit("dataManagerCreated"),r.on("stateChanged",r.handleStateChanged_),r.newListenerHandle_=r.on("newListener",r.handleNewListener_),r.on("eventsChanged",r.onEventsChanged_),r.addListenersFromObj_(r.dataManager_.get("events")),r.created(),r.componentCreated_=!0,a!==!1&&r.render_(a),r.on("elementChanged",r.onElementChanged_),r}return e.inherits(h,n),e.createClass(h,[{key:"addListenersFromObj_",value:function(e){for(var t=Object.keys(e||{}),n=0;n<t.length;n++){var a=this.extractListenerInfo_(e[t[n]]);if(a.fn){var r;r=a.selector?this.delegate(t[n],a.selector,a.fn):this.on(t[n],a.fn),this.eventsStateKeyHandler_.add(r)}}}},{key:"attach",value:function(e,t){return this.inDocument||(this.renderElement_(e,t),this.inDocument=!0,this.emit("attached",{parent:e,sibling:t}),this.attached()),this}},{key:"attached",value:function(){}},{key:"addSubComponent",value:function(e,t){this.components[e]=t}},{key:"created",value:function(){}},{key:"createDataManager",value:function(){return l(this.constructor,"DATA_MANAGER",t.firstDefinedValue),new this.constructor.DATA_MANAGER_MERGED(this,h.DATA)}},{key:"createRenderer",value:function(){return l(this.constructor,"RENDERER",t.firstDefinedValue),new this.constructor.RENDERER_MERGED(this)}},{key:"delegate",value:function(e,t,n){return this.on("delegate:"+e+":"+t,n)}},{key:"detach",value:function(){return this.inDocument&&(this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.inDocument=!1,this.detached()),this.emit("detached"),this}},{key:"detached",value:function(){}},{key:"disposed",value:function(){}},{key:"disposeInternal",value:function(){this.disposed(),this.detach(),this.elementEventProxy_&&(this.elementEventProxy_.dispose(),this.elementEventProxy_=null),this.disposeSubComponents(Object.keys(this.components)),this.components=null,this.dataManager_.dispose(),this.dataManager_=null,this.renderer_.dispose(),this.renderer_=null,e.get(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"disposeInternal",this).call(this)}},{key:"disposeSubComponents",value:function(e){for(var t=0;t<e.length;t++){var n=this.components[e[t]];n&&!n.isDisposed()&&(n.element=null,n.dispose(),delete this.components[e[t]])}}},{key:"extractListenerInfo_",value:function(e){var t={fn:e};return o(e)&&!i(e)&&(t.selector=e.selector,t.fn=e.fn),s(t.fn)&&(t.fn=this.getListenerFn(t.fn)),t}},{key:"getDataManager",value:function(){return this.dataManager_}},{key:"getInitialConfig",value:function(){return this.initialConfig_}},{key:"getListenerFn",value:function(e){if(i(this[e]))return this[e].bind(this)}},{key:"getState",value:function(){return this.dataManager_.getState()}},{key:"getStateKeys",value:function(){return this.dataManager_.getStateKeys()}},{key:"fireStateKeyChange_",value:function(e,t){var n=this["sync"+e.charAt(0).toUpperCase()+e.slice(1)];if(i(n)){if(!t){var a=this.getDataManager();t={newVal:a.get(e),prevVal:void 0}}n.call(this,t.newVal,t.prevVal)}}},{key:"getRenderer",value:function(){return this.renderer_}},{key:"handleRendererRendered_",value:function(e){this.rendered(e),this.emit("rendered",e)}},{key:"handleStateChanged_",value:function(e){this.syncStateFromChanges_(e.changes),this.emit("stateSynced",e)}},{key:"handleNewListener_",value:function(e){this.attachedListeners_[e]=!0}},{key:"mergeElementClasses_",value:function(e){var t={};return e.filter(function(e){return!(!e||t[e])&&(t[e]=!0,!0)}).join(" ")}},{key:"onElementChanged_",value:function(e){this.setUpProxy_(),this.elementEventProxy_.setOriginEmitter(e.newVal),e.newVal&&this.syncVisible(this.dataManager_.get("visible"))}},{key:"onEventsChanged_",value:function(e){this.eventsStateKeyHandler_.removeAllListeners(),this.addListenersFromObj_(e.newVal)}},{key:"render_",value:function(e,t){t||this.emit("render"),this.setUpProxy_(),this.syncState_(),this.attach(e),this.wasRendered=!0}},{key:"renderAsSubComponent",value:function(){this.render_(null,!0)}},{key:"renderElement_",value:function(e,t){var n=this.element;if(n&&(t||!n.parentNode)){var a=d(e)||this.DEFAULT_ELEMENT_PARENT;a.insertBefore(n,d(t))}}},{key:"setState",value:function(e,t){this.dataManager_.setState(e,t)}},{key:"setterElementClassesFn_",value:function(e){return this.constructor.ELEMENT_CLASSES_MERGED&&(e+=" "+this.constructor.ELEMENT_CLASSES_MERGED),e.trim()}},{key:"setUpProxy_",value:function(){if(!this.elementEventProxy_){var e=new c(this.element,this);this.elementEventProxy_=e,u.map(this.attachedListeners_,e.proxyEvent.bind(e)),this.attachedListeners_=null,this.newListenerHandle_.removeListener(),this.newListenerHandle_=null}}},{key:"syncState_",value:function(){for(var e=this.dataManager_.getSyncKeys(),t=0;t<e.length;t++)this.fireStateKeyChange_(e[t])}},{key:"syncStateFromChanges_",value:function(e){for(var t in e)this.fireStateKeyChange_(t,e[t])}},{key:"syncVisible",value:function(e){this.element&&(this.element.style.display=e?"":"none")}},{key:"rendered",value:function(){}},{key:"validatorEventsFn_",value:function(e){return!a(e)||o(e)}},{key:"element",get:function(){return this.elementVal_},set:function(e){if((r(e)||s(e)||!a(e))&&(e&&(e=d(e)||this.elementVal_),this.elementVal_!==e)){var t=this.elementVal_;this.elementVal_=e,this.componentCreated_&&this.emit("elementChanged",{prevVal:t,newVal:e})}}}],[{key:"isComponentCtor",value:function(e){return e.prototype&&e.prototype[h.COMPONENT_FLAG]}},{key:"render",value:function(e,t,n){var a=t,i=n;r(t)&&(a=null,i=t);var o=new e(a,(!1));return o.render_(i),o}}]),h}(f);v.DATA={elementClasses:{setter:"setterElementClassesFn_",validator:s,value:""},events:{validator:"validatorEventsFn_",value:null},visible:{validator:n,value:!0}},v.COMPONENT_FLAG="__metal_component__",v.DATA_MANAGER=h,v.ELEMENT_CLASSES="",v.RENDERER=m,v.SYNC_UPDATES=!1,v.prototype[v.COMPONENT_FLAG]=!0,this.metal.Component=v}.call(this),function(){var t=this.metalNamed.metal.getFunctionName,n=function(){function n(){e.classCallCheck(this,n)}return e.createClass(n,null,[{key:"getConstructor",value:function(e){var t=n.components_[e];return t}},{key:"register",value:function(e,a){var r=a;r||(r=e.hasOwnProperty("NAME")?e.NAME:t(e)),e.NAME=r,n.components_[r]=e}}]),n}();n.components_={},this.metal.ComponentRegistry=n}.call(this),function(){var e=this.metal.Component,t=this.metal.ComponentDataManager,n=this.metal.ComponentRegistry,a=this.metal.ComponentRenderer;this.metal.component=e,this.metalNamed.component=this.metalNamed.component||{},this.metalNamed.component.Component=e,this.metalNamed.component.ComponentDataManager=t,this.metalNamed.component.ComponentRegistry=n,this.metalNamed.component.ComponentRenderer=a}.call(this),function(){function t(e,t){d.push(e,t)}function n(e,t,n){d=[e,t,n]}function a(){return i("elementOpen").apply(null,d)}function r(e){return i("elementOpen").apply(null,arguments),i("elementClose")(e)}function i(e){return c[c.length-1][e]}function o(e){return i(e).apply(null,s.slice(arguments,1))}var s=this.metalNamed.metal.array,l=this.metalNamed.metal.object,u=function(){function i(){e.classCallCheck(this,i)}return e.createClass(i,null,[{key:"getOriginalFns",value:function(){return c[0]}},{key:"startInterception",value:function(e){var o=i.getOriginalFns();e=l.map(e,function(e,t){return t.bind(null,o[e])}),c.push(l.mixin({},o,e,{attr:t,elementOpenEnd:a,elementOpenStart:n,elementVoid:r}))}},{key:"stopInterception",value:function(){c.length>1&&c.pop()}}]),i}(),c=[{attr:IncrementalDOM.attr,attributes:IncrementalDOM.attributes[IncrementalDOM.symbols["default"]],elementClose:IncrementalDOM.elementClose,elementOpen:IncrementalDOM.elementOpen,elementOpenEnd:IncrementalDOM.elementOpenEnd,elementOpenStart:IncrementalDOM.elementOpenStart,elementVoid:IncrementalDOM.elementVoid,text:IncrementalDOM.text}],d=[];IncrementalDOM.attr=o.bind(null,"attr"),IncrementalDOM.elementClose=o.bind(null,"elementClose"),IncrementalDOM.elementOpen=o.bind(null,"elementOpen"),IncrementalDOM.elementOpenEnd=o.bind(null,"elementOpenEnd"),IncrementalDOM.elementOpenStart=o.bind(null,"elementOpenStart"),IncrementalDOM.elementVoid=o.bind(null,"elementVoid"),IncrementalDOM.text=o.bind(null,"text"),IncrementalDOM.attributes[IncrementalDOM.symbols["default"]]=o.bind(null,"attributes"),this.metal.IncrementalDomAop=u}.call(this),function(){var t=this.metalNamed.metal.isString,n=function(){function n(){e.classCallCheck(this,n)}return e.createClass(n,null,[{key:"buildConfigFromCall",value:function(e){var t={};e[1]&&(t.key=e[1]);for(var n=(e[2]||[]).concat(e.slice(3)),a=0;a<n.length;a+=2)t[n[a]]=n[a+1];return t}},{key:"buildCallFromConfig",value:function(e,t){for(var n=[e,t.key,[]],a=Object.keys(t),r=0;r<a.length;r++)"children"!==a[r]&&n.push(a[r],t[a[r]]);return n}},{key:"isComponentTag",value:function(e){return!t(e)||e[0]===e[0].toUpperCase()}}]),n}();this.metal.IncrementalDomUtils=n}.call(this),function(){function t(t,a){var r=e.defineProperty({parent:l},f.CHILD_OWNER,u);return a?(r.text=t[0],t.length>1&&(r.args=t)):(r.tag=t[0],r.props=m.buildConfigFromCall(t),r.props.children=[],r.config=r.props),n(r),r}function n(e){l.props.children.push(e)}function a(){l===c?(h.stopInterception(),p=!1,o(c),o=null,l=null,u=null,c=null):l=l.parent}function r(e){for(var n=arguments.length,a=Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];l=t(a)}function i(e){for(var n=arguments.length,a=Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];t(a,!0)}var o,s,l,u,c,d=this.metalNamed.metal.isDef,h=this.metal.IncrementalDomAop,m=this.metal.IncrementalDomUtils,f=function(){function t(){e.classCallCheck(this,t)}return e.createClass(t,null,[{key:"capture",value:function(e,t){u=e,o=t,c={props:{children:[]}},c.config=c.props,l=c,p=!0,h.startInterception({elementClose:a,elementOpen:r,text:i})}},{key:"getCurrentOwner",value:function(){return s}},{key:"getOwner",value:function(e){return e[t.CHILD_OWNER]}},{key:"render",value:function(e,a){if(p)return void n(e);if(s=t.getOwner(e),a&&a(e))return void(s=null);if(d(e.text)){var r=e.args?e.args:[];r[0]=e.text,IncrementalDOM.text.apply(null,r)}else{var i=m.buildCallFromConfig(e.tag,e.props);if(IncrementalDOM.elementOpen.apply(null,i),e.props.children)for(var o=0;o<e.props.children.length;o++)t.render(e.props.children[o],a);IncrementalDOM.elementClose(e.tag)}s=null}}]),t}(),p=!1;f.CHILD_OWNER="__metalChildOwner",this.metal.IncrementalDomChildren=f}.call(this),function(){var t=[],n=!1,a=function(){function a(){e.classCallCheck(this,a)}return e.createClass(a,null,[{key:"disposeUnused",value:function(){if(!n){n=!0;for(var e=0;e<t.length;e++){var a=t[e];a.isDisposed()||a.getRenderer().getParent()||(a.element=null,a.dispose())}t=[],n=!1}}},{key:"schedule",value:function(e){for(var n=0;n<e.length;n++)e[n].isDisposed()||(e[n].getRenderer().parent_=null,t.push(e[n]))}}]),a}();this.metal.IncrementalDomUnusedComponents=a}.call(this),function(){var t=this.metalNamed.metal.getCompatibilityModeData,n=this.metalNamed.metal.getUid,a=this.metalNamed.metal.isBoolean,r=this.metalNamed.metal.isDef,i=this.metalNamed.metal.isDefAndNotNull,o=this.metalNamed.metal.isString,s=this.metalNamed.metal.object,l=this.metalNamed.dom.append,u=this.metalNamed.dom.delegate,c=this.metalNamed.dom.domData,d=this.metalNamed.dom.exitDocument,h=this.metalNamed.component.Component,m=this.metalNamed.component.ComponentRegistry,f=this.metalNamed.component.ComponentRenderer,p=this.metal.IncrementalDomAop,v=this.metal.IncrementalDomChildren,_=this.metal.IncrementalDomUnusedComponents,y=this.metal.IncrementalDomUtils,g=function(f){function g(t){e.classCallCheck(this,g);var n=e.possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,t));return t.context={},t.refs={},n.config_=t.getInitialConfig(),n.childComponents_=[],n.clearChanges_(),t.on("attached",n.handleAttached_.bind(n)),n.handleInterceptedAttributesCall_=n.handleInterceptedAttributesCall_.bind(n),n.handleInterceptedCloseCall_=n.handleInterceptedCloseCall_.bind(n),n.handleInterceptedOpenCall_=n.handleInterceptedOpenCall_.bind(n),n.handleChildrenCaptured_=n.handleChildrenCaptured_.bind(n),n.handleChildRender_=n.handleChildRender_.bind(n),n.renderInsidePatchDontSkip_=n.renderInsidePatchDontSkip_.bind(n),n}return e.inherits(g,f),e.createClass(g,[{key:"addElementClasses_",value:function(e,t){for(var n=3;n<t.length;n+=2)if("class"===t[n])return void(t[n+1]=this.removeDuplicateClasses_(t[n+1]+" "+e));for(;t.length<3;)t.push(null);t.push("class",e)}},{key:"attachDecoratedListeners_",value:function(e,t){if(!this.component_.wasRendered)for(var n=(t[2]||[]).concat(t.slice(3)),a=0;a<n.length;a+=2){var r=this.getEventFromListenerAttr_(n[a]);r&&!e[r+"__handle__"]&&this.attachEvent_(e,n[a],r,n[a+1])}}},{key:"attachEvent_",value:function(e,t,n,a){var r=n+"__handle__";e[r]&&(e[r].removeListener(),e[r]=null),e[t]=a,a?(o(a)&&("d"===t[0]&&e.setAttribute(t,a),a=this.component_.getListenerFn(a)),e[r]=u(document,n,e,a)):e.removeAttribute(t)}},{key:"buildChildren_",value:function(e){return 0===e.length?k:e}},{key:"buildShouldUpdateArgs_",value:function(){return[this.changes_]}},{key:"clearChanges_",value:function(){this.changes_={}}},{key:"disposeInternal",value:function(){e.get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"disposeInternal",this).call(this);var t=this.component_,n=this.config_.ref,a=this.getOwner();a&&a.components&&a.components[n]===t&&delete a.components[n];for(var r=0;r<this.childComponents_.length;r++){var i=this.childComponents_[r];i.isDisposed()||(i.element=null,i.dispose())}this.childComponents_=null}},{key:"getEventFromListenerAttr_",value:function(e){var t=g.LISTENER_REGEX.exec(e),n=t?t[1]?t[1]:t[2]:null;return n?n.toLowerCase():null}},{key:"getOwner",value:function(){return this.owner_}},{key:"getParent",value:function(){return this.parent_}},{key:"getRef_",value:function(e){var n=t();if(n){var a=n.renderers,r=!a||a.indexOf(this.constructor)!==-1||a.indexOf(this.constructor.RENDERER_NAME)!==-1;if(r&&e.key&&!e.ref)return e.key}return e.ref}},{key:"getSubComponent_",value:function(e,t,a){var i=e;o(i)&&(i=m.getConstructor(e));var s,l=this.getRef_(t),u=g.getCurrentData();if(r(l))s=this.match_(a.components[l],i,t),a.addSubComponent(l,s),a.refs[l]=s;else if(r(t.key))s=this.match_(u.prevComps.keys[t.key],i,t),u.currComps.keys[t.key]=s;else{var c=n(i,!0);u.currComps.order[c]=u.currComps.order[c]||[];var d=u.currComps.order[c];s=this.match_((u.prevComps.order[c]||[])[d.length],i,t),d.push(s)}return s}},{key:"guaranteeParent_",value:function(){var e=this.component_.element;if(!e||!e.parentNode){var t=document.createElement("div");return e&&l(t,e),t}}},{key:"handleAttached_",value:function(e){this.attachData_=e}},{key:"handleChildrenCaptured_",value:function(e){var t=this.componentToRender_,n=t.props,a=t.tag;n.children=this.buildChildren_(e.props.children),this.componentToRender_=null,this.renderFromTag_(a,n)}},{key:"handleChildRender_",value:function(e){if(e.tag&&y.isComponentTag(e.tag))return e.props.children=this.buildChildren_(e.props.children),this.renderFromTag_(e.tag,e.props),!0}},{key:"handleDataManagerCreated_",value:function(){e.get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"handleDataManagerCreated_",this).call(this);var t=this.component_.getDataManager();this.component_.constructor.SYNC_UPDATES_MERGED||t.on("dataPropChanged",this.handleDataPropChanged_.bind(this)),t.add("children",{validator:Array.isArray,value:k},this.config_.children||k)}},{key:"handleDataPropChanged_",value:function(e){this.changes_[e.key]=e}},{key:"handleInterceptedAttributesCall_",value:function(e,t,n,r){var o=this.getEventFromListenerAttr_(n);return o?void this.attachEvent_(t,n,o,r):("checked"===n&&(r=i(r)&&r!==!1),"value"===n&&t.value!==r&&(t[n]=r),void(a(r)?(t[n]=r,r?t.setAttribute(n,""):t.removeAttribute(n)):e(t,n,r)))}},{key:"handleInterceptedCloseCall_",value:function(e,t){this.emit(g.ELEMENT_CLOSED,{tag:t});var n=e(t);return this.resetData_(c.get(n).incDomData_),n}},{key:"handleInterceptedOpenCall_",value:function(e,t){return y.isComponentTag(t)?this.handleSubComponentCall_.apply(this,arguments):this.handleRegularCall_.apply(this,arguments);
}},{key:"handleManagerDataPropChanged_",value:function(t){this.handleDataPropChanged_(t),e.get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"handleManagerDataPropChanged_",this).call(this,t)}},{key:"handleRegularCall_",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];this.emit(g.ELEMENT_OPENED,{args:n});var r=g.getComponentBeingRendered(),o=r.getRenderer();if(!o.rootElementReached_){o.config_.key&&(n[1]=o.config_.key);var s=r.getDataManager().get("elementClasses");s&&this.addElementClasses_(s,n)}var l=e.apply(null,n);this.attachDecoratedListeners_(l,n),this.updateElementIfNotReached_(l);var u=y.buildConfigFromCall(n);if(i(u.ref)){var c=v.getCurrentOwner()||this;c.getComponent().refs[u.ref]=l}return l}},{key:"handleSubComponentCall_",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var r=y.buildConfigFromCall(n);this.componentToRender_={props:r,tag:n[0]},v.capture(this,this.handleChildrenCaptured_)}},{key:"hasDataChanged_",value:function(){return Object.keys(this.changes_).length>0}},{key:"intercept_",value:function(){p.startInterception({attributes:this.handleInterceptedAttributesCall_,elementClose:this.handleInterceptedCloseCall_,elementOpen:this.handleInterceptedOpenCall_})}},{key:"isMatch_",value:function(e,t){return!(!e||e.constructor!==t||e.isDisposed())&&e.getRenderer().getOwner()===this.component_}},{key:"match_",value:function(e,t,n){return this.isMatch_(e,t)||(e=new t(n,(!1))),e.wasRendered&&(e.getRenderer().startSkipUpdates(),e.getDataManager().replaceNonInternal(n),e.getRenderer().stopSkipUpdates()),e.getRenderer().config_=n,e}},{key:"patch",value:function(){if(!this.component_.element&&this.parent_)return void this.parent_.getRenderer().patch();var e=this.guaranteeParent_();if(e)IncrementalDOM.patch(e,this.renderInsidePatchDontSkip_),d(this.component_.element),this.component_.element&&this.component_.inDocument&&this.component_.renderElement_(this.attachData_.parent,this.attachData_.sibling);else{var t=this.component_.element;IncrementalDOM.patchOuter(t,this.renderInsidePatchDontSkip_)}}},{key:"removeDuplicateClasses_",value:function(e){for(var t=[],n=e.split(/\s+/),a={},r=0;r<n.length;r++)a[n[r]]||(a[n[r]]=!0,t.push(n[r]));return t.join(" ")}},{key:"render",value:function(){this.patch()}},{key:"renderChild",value:function(e){this.intercept_(),v.render(e,this.handleChildRender_),p.stopInterception()}},{key:"renderFromTag_",value:function(e,t){if(o(e)||e.prototype.getRenderer){var n=this.renderSubComponent_(e,t);return this.updateElementIfNotReached_(n.element),n.element}return e(t)}},{key:"renderIncDom",value:function(){this.component_.render?this.component_.render():IncrementalDOM.elementVoid("div")}},{key:"renderInsidePatch",value:function(){return this.component_.wasRendered&&!this.shouldUpdate()&&IncrementalDOM.currentPointer()===this.component_.element?void(this.component_.element&&IncrementalDOM.skipNode()):void this.renderInsidePatchDontSkip_()}},{key:"renderInsidePatchDontSkip_",value:function(){g.startedRenderingComponent(this.component_),this.clearChanges_(),this.rootElementReached_=!1,_.schedule(this.childComponents_),this.childComponents_=[],this.component_.refs={},this.intercept_(),this.renderIncDom(),p.stopInterception(),this.rootElementReached_||(this.component_.element=null),this.emit("rendered",!this.isRendered_),g.finishedRenderingComponent(),this.resetData_(this.incDomData_)}},{key:"renderSubComponent_",value:function(e,t){var n=v.getCurrentOwner()||this,a=n.getComponent(),r=this.getSubComponent_(e,t,a);this.updateContext_(r);var i=r.getRenderer();if(i instanceof g){var o=g.getComponentBeingRendered(),s=o.getRenderer();s.childComponents_.push(r),i.parent_=o,i.owner_=a,t.key||s.rootElementReached_||(t.key=s.config_.key),i.renderInsidePatch()}return r.wasRendered||r.renderAsSubComponent(),r}},{key:"resetData_",value:function(e){e&&(e.prevComps.keys=e.currComps.keys,e.prevComps.order=e.currComps.order,e.currComps.keys={},e.currComps.order={})}},{key:"shouldUpdate",value:function(){if(!this.hasDataChanged_())return!1;if(this.component_.shouldUpdate){var t;return(t=this.component_).shouldUpdate.apply(t,e.toConsumableArray(this.buildShouldUpdateArgs_()))}return!0}},{key:"skipNextChildrenDisposal",value:function(){this.childComponents_=[]}},{key:"update",value:function(){this.shouldUpdate()&&this.patch()}},{key:"updateElementIfNotReached_",value:function(e){var t=g.getComponentBeingRendered(),n=t.getRenderer();n.rootElementReached_||(n.rootElementReached_=!0,t.element!==e&&(t.element=e))}},{key:"updateContext_",value:function(e){var t=e.context,n=g.getComponentBeingRendered(),a=n.getChildContext?n.getChildContext():{};s.mixin(t,n.context,a),e.context=t}}],[{key:"finishedRenderingComponent",value:function(){C.pop(),0===C.length&&_.disposeUnused()}},{key:"getComponentBeingRendered",value:function(){return C[C.length-1]}},{key:"getCurrentData",value:function(){var e=IncrementalDOM.currentElement(),t=g.getComponentBeingRendered(),n=t.getRenderer(),a=n;return n.rootElementReached_&&e!==t.element.parentNode&&(a=c.get(e)),a.incDomData_=a.incDomData_||{currComps:{keys:{},order:{}},prevComps:{keys:{},order:{}}},a.incDomData_}},{key:"isIncDomNode",value:function(e){return!!e[v.CHILD_OWNER]}},{key:"render",value:function(t,n,a){if(!h.isComponentCtor(t)){var r=t,i=function(t){function n(){return e.classCallCheck(this,n),e.possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e.inherits(n,t),e.createClass(n,[{key:"created",value:function(){g.getComponentBeingRendered()&&this.getRenderer().updateContext_(this)}},{key:"render",value:function(){r(this.getRenderer().config_)}}]),n}(h);i.RENDERER=g,t=i}return h.render(t,n,a)}},{key:"renderChild",value:function(e){e[v.CHILD_OWNER].renderChild(e)}},{key:"startedRenderingComponent",value:function(e){C.push(e)}}]),g}(f),C=[],k=[];g.ELEMENT_OPENED="elementOpened",g.ELEMENT_CLOSED="elementClosed",g.LISTENER_REGEX=/^(?:on([A-Z]\w+))|(?:data-on(\w+))$/,g.RENDERER_NAME="incremental-dom",this.metal.IncrementalDomRenderer=g}.call(this),function(){var t=this.metalNamed.metal.isDefAndNotNull,n=this.metal.IncrementalDomRenderer,a=[],r=function(r){function i(t){e.classCallCheck(this,i);var a=e.possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return a.on(n.ELEMENT_OPENED,a.handleJSXElementOpened_),a.on(n.ELEMENT_CLOSED,a.handleJSXElementClosed_),a}return e.inherits(i,r),e.createClass(i,[{key:"buildShouldUpdateArgs_",value:function(){return[this.changes_,this.propChanges_]}},{key:"clearChanges_",value:function(){e.get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"clearChanges_",this).call(this),this.propChanges_={}}},{key:"handleDataPropChanged_",value:function(t){"props"===t.type?this.propChanges_[t.key]=t:e.get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"handleDataPropChanged_",this).call(this,t)}},{key:"handleJSXElementOpened_",value:function(e){var n=e.args,r=0;if(a.length>0&&(r=++a[a.length-1]),!t(n[1]))if(r)n[1]=i.KEY_PREFIX+r;else{var o=IncrementalDOM.currentPointer();o&&o.__incrementalDOMData&&(n[1]=o.__incrementalDOMData.key)}a.push(0)}},{key:"handleJSXElementClosed_",value:function(){a.pop()}},{key:"hasDataChanged_",value:function(){return e.get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"hasDataChanged_",this).call(this)||Object.keys(this.propChanges_).length>0}},{key:"renderIncDom",value:function(){this.component_.render?iDOMHelpers.renderArbitrary(this.component_.render()):e.get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"renderIncDom",this).call(this)}}],[{key:"skipChild",value:function(){a.length>0&&a[a.length-1]++}}]),i}(n);r.KEY_PREFIX="_metal_jsx_",r.RENDERER_NAME="jsx",this.metal.JSXRenderer=r}.call(this),function(){var t=this.metal.IncrementalDomRenderer,n=this.metal.JSXRenderer;window.iDOMHelpers=window.iDOMHelpers||{},window.iDOMHelpers.attr=function(e,t){IncrementalDOM.attr(t,e)},window.iDOMHelpers.forOwn=function(e,t){var n=Object.prototype.hasOwnProperty;for(var a in e)n.call(e,a)&&t(e[a],a)},window.iDOMHelpers.jsxWrapper=function(e,t){var n=t?function(){return e.apply(this,t)}:e;return n.__jsxDOMWrapper=!0,n},window.iDOMHelpers.renderArbitrary=function(a){var r="undefined"==typeof a?"undefined":e["typeof"](a);"number"===r||"string"===r||a&&a instanceof String?IncrementalDOM.text(a):"function"===r&&a.__jsxDOMWrapper?a():Array.isArray(a)?a.forEach(window.iDOMHelpers.renderArbitrary):"[object Object]"===String(a)?t.isIncDomNode(a)?t.renderChild(a):window.iDOMHelpers.forOwn(a,window.iDOMHelpers.renderArbitrary):a||n.skipChild()},this.metal.iDOMHelpers=window.iDOMHelpers}.call(this),function(){var t=this.metalNamed.metal.mergeSuperClassesProperty,n=this.metalNamed.metal.object,a=this.metalNamed.component.ComponentDataManager,r=this.metal.state,i=function(i){function o(){return e.classCallCheck(this,o),e.possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return e.inherits(o,i),e.createClass(o,[{key:"add",value:function(){var e;(e=this.props_).addToState.apply(e,arguments)}},{key:"addUnconfiguredProps_",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)this.props_.hasStateKey(t[n])||(this.component_.props[t[n]]=e[t[n]])}},{key:"buildStateInstanceData_",value:function(e){var a=this.component_.constructor;return t(a,"PROPS",r.mergeState),n.mixin({},e,this.component_.constructor.PROPS_MERGED)}},{key:"createState_",value:function(t){var n=this;this.component_.props={},e.get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"createState_",this).call(this,t,this.component_.props),this.props_=this.state_,this.addUnconfiguredProps_(this.component_.getInitialConfig()),this.component_.state={},this.state_=new r({},this.component_.state,this.component_,{internal:!0}),this.state_.addToState(this.component_.constructor.STATE_MERGED);var a=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return n.emit_.apply(n,t.concat(["state"]))};this.state_.on("stateChanged",a),this.state_.on("stateKeyChanged",a)}},{key:"disposeInternal",value:function(){e.get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"disposeInternal",this).call(this),this.props_.dispose(),this.props_=null}},{key:"emit_",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"props";t.type=a,e.get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"emit_",this).call(this,t,n)}},{key:"get",value:function(e){return this.props_.get(e)}},{key:"getPropsInstance",value:function(){return this.props_}},{key:"getSyncKeys",value:function(){return this.props_.getStateKeys()}},{key:"replaceNonInternal",value:function(e){var t=n.mixin({},this.component_.props);a.replaceNonInternal(e,this.props_),this.addUnconfiguredProps_(e),this.component_.propsChanged&&this.component_.propsChanged(t)}}]),o}(a);i.BLACKLIST={},this.metal.JSXDataManager=i}.call(this),function(){var t=this.metalNamed.state.validators,n=this.metalNamed.state.Config,a=this.metal.component,r=this.metal.IncrementalDomRenderer,i=this.metal.JSXDataManager,o=this.metal.JSXRenderer,s=function(t){function n(){return e.classCallCheck(this,n),e.possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e.inherits(n,t),e.createClass(n,null,[{key:"render",value:function(){return r.render.apply(r,arguments)}}]),n}(a);s.DATA_MANAGER=i,s.RENDERER=o,this.metal.JSXComponent=s,this.metalNamed.JSXComponent=this.metalNamed.JSXComponent||{},this.metalNamed.JSXComponent.validators=t,this.metalNamed.JSXComponent.Config=n,this.metalNamed.JSXComponent.JSXComponent=s}.call(this),function(){var t=this.metal.JSXComponent,n=function(t){function n(){return e.classCallCheck(this,n),e.possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e.inherits(n,t),e.createClass(n,[{key:"render",value:function(){return IncrementalDOM.elementOpen("div"),IncrementalDOM.text("Hello World"),IncrementalDOM.elementClose("div")}}]),n}(t);this.metal.JsFiddleMetalComponent=n}.call(this)}).call(this);