{"version":3,"sources":["incremental-dom.js","coreNamed.js","core.js","array.js","async.js","Disposable.js","object.js","string.js","metal.js","domData.js","EventHandle.js","EventEmitter.js","EventEmitterProxy.js","EventHandler.js","events.js","DomDelegatedEventHandle.js","DomEventHandle.js","domNamed.js","dom.js","DomEventEmitterProxy.js","features.js","globalEval.js","globalEvalStyles.js","validators.js","Config.js","State.js","state.js","ComponentDataManager.js","ComponentRenderer.js","Component.js","ComponentRegistry.js","component.js","IncrementalDomAop.js","IncrementalDomUtils.js","IncrementalDomChildren.js","IncrementalDomUnusedComponents.js","IncrementalDomRenderer.js","JSXRenderer.js","iDOMHelpers.js","JSXDataManager.js","JSXComponent.js","JsFiddleMetalComponent.js"],"names":["global","factory","IncrementalDOM","window","exports","hasOwnProperty","Object","prototype","Blank","create","has","map","property","call","createMap","DATA_PROP","NodeData","nodeName","key","attrs","attrsArr","newAttrs","staticsApplied","keyMap","keyMapValid","focused","text","initData","node","data","getData","importNode","isElement","Element","localName","getAttribute","parentNode","attributes","i","length","attr","name","value","undefined","push","child","firstChild","nextSibling","getNamespaceForTag","tag","parent","namespaceURI","createElement","doc","namespace","el","createElementNS","createText","createTextNode","notifications","nodesCreated","nodesDeleted","Context","created","deleted","markCreated","markDeleted","notifyChanges","isDocumentRoot","Document","DocumentFragment","getAncestry","root","ancestry","cur","getRoot","prev","getActiveElement","activeElement","getFocusedPath","contains","moveBefore","referenceNode","insertReferenceNode","next","insertBefore","context","currentNode","currentParent","markFocused","focusPath","patchFactory","run","f","fn","prevContext","prevDoc","prevCurrentNode","prevCurrentParent","previousInAttributes","previousInSkip","ownerDocument","retVal","patchInner","enterNode","exitNode","patchOuter","startNode","expectedNextNode","expectedPrevNode","removeChild","matches","matchNode","alignWithDOM","parentData","currentNodeData","keyNode","replaceChild","clearUnvisitedDOM","lastChild","getNextNode","nextNode","coreElementOpen","coreElementClose","coreText","currentElement","currentPointer","skip","skipNode","symbols","default","getNamespace","lastIndexOf","applyAttr","removeAttribute","attrNS","setAttributeNS","setAttribute","applyProp","setStyleValue","style","prop","indexOf","setProperty","applyStyle","cssText","elStyle","obj","applyAttributeTyped","type","updateAttribute","mutator","ATTRIBUTES_OFFSET","argsBuilder","elementOpen","statics","var_args","_i","isNew","j","arguments","_attr","_attr2","elementOpenStart","elementOpenEnd","apply","elementClose","elementVoid","formatted","patch","compatibilityModeData_","uniqueIdCounter_","UID_PROPERTY","Math","random","abstractMethod","Error","collectSuperClassesProperty","constructor","propertyName","propertyValues","__proto__","isPrototypeOf","Function","disableCompatibilityMode","enableCompatibilityMode","opt_data","getCompatibilityModeData","__METAL_COMPATIBILITY__","getFunctionName","str","toString","substring","getUid","opt_object","opt_noInheritance","id","identityFunction","opt_returnValue","isBoolean","val","isDef","isDefAndNotNull","isNull","isDocument","nodeType","isFunction","isNumber","isWindow","isObject","isPromise","then","isString","String","mergeSuperClassesProperty","opt_mergeFn","mergedName","merged","nullFunction","core","array","arr1","arr2","arr","opt_output","output","Array","isArray","flatten","rv","removeAt","splice","start","opt_end","sliced","end","async","throwException","exception","nextTick","callback","opt_context","workQueueScheduled_","processWorkQueue","workQueue_","WorkItem_","workItems","workItem","scope","e","cb","bind","wrapCallback_","setImmediate","setImmediate_","getSetImmediateEmulator_","Channel","MessageChannel","postMessage","addEventListener","iframe","document","display","src","documentElement","appendChild","win","contentWindow","open","write","close","message","origin","location","protocol","host","onmessage","port1","port2","channel","head","tail","script","onreadystatechange","setTimeout","Disposable","disposed_","disposeInternal","object","target","source","opt_obj","parts","split","reduce","part","mappedObj","keys","obj1","obj2","keys1","keys2","string","replace","x","floor","abs","Date","now","hash","len","charCodeAt","METAL_DATA","domData","element","delegating","listeners","EventHandle","emitter","event","listener","emitter_","event_","listener_","removeListener","isDisposed","EventEmitter","events_","maxListeners_","shouldUseFacade_","events","opt_default","validateListener_","normalizeEvents_","addSingleListener_","opt_origin","emit","warned","console","warn","args","slice","concat","facade","getShouldUseFacade","preventDefault","preventedDefault","defaultListeners","amount","many_","self","handlerInternal","listenerObj","listenerObjs","removeMatchingListenerObjs_","addListener","many","opt_events","matchesListener_","off","max","shouldUseFacade","TypeError","EventEmitterProxy","originEmitter","targetEmitter","opt_blacklist","opt_whitelist","blacklist_","mixin","newListener","originEmitter_","pendingEvents_","proxiedEvents_","targetEmitter_","whitelist_","startProxy_","on","addListener_","emitOnTarget_","removeListeners_","eventType","shouldProxyEvent_","tryToAddListener_","forEach","proxyEvent","addListenerForEvent_","EventHandler","eventHandles_","DomDelegatedEventHandle","opt_selector","selector_","get","selector","selectors","remove","DomEventHandle","opt_capture","capture_","removeEventListener","elementsByTag_","customEvents","NEXT_TARGET","USE_CAPTURE","blur","error","focus","invalid","load","scroll","addClasses","elements","classes","addClassesWithNative_","addClassesWithoutNative_","className","classList","add","elementClassName","classesToAppend","addElementListener_","eventName","addToArr_","addSelectorListener_","attachDelegateEvent_","handle","handleDelegateEvent_","closest","match","append","buildFragment","NodeList","childArr","htmlString","tempDiv","innerHTML","fragment","createDocumentFragment","element1","element2","delegate","selectorOrTarget","customConfig","originalEvent","handler","defaultListener_","isAbleToInteractWith_","opt_eventObj","button","matchesSelector","tagName","disabled","enterDocument","body","exitDocument","normalizeDelegateEvent_","currElement","ret","container","currentTarget","limit","defFns","triggerDelegatedListeners_","triggerDefaultDelegatedListeners_","delegateTarget","hasClass","hasClassWithNative_","hasClassWithoutNative_","isEmpty","childNodes","p","m","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","matchFallback_","nodes","querySelectorAll","stopPropagation","stopPropagation_","stopImmediatePropagation","stopImmediatePropagation_","once","domEventHandle","registerCustomEvent","removeChildren","removeClasses","removeClassesWithNative_","removeClassesWithoutNative_","trim","stopped","stoppedImmediate","Event","supportsEvent","defaultPrevented","defaultFns","triggerMatchedListeners_","toElement","selectorOrElement","getElementById","substr","querySelector","toggleClasses","toggleClassesWithNative_","toggleClassesWithoutNative_","toggle","classIndex","triggerEvent","eventObj","createEvent","initEvent","dispatchEvent","triggerListeners_","selectorsMap","dom","DomEventEmitterProxy","isDelegateEvent_","index","isSupportedDomEvent_","features","animationEventName_","animation","checkAnimationEventName_","transition","prefixes","typeTitleCase","replaceInterval","toUpperCase","suffixes","animationElement_","toLowerCase","attrOrderChange_","originalContent","globalEval","opt_appendFn","opt_callback","runFile","scripts","runScriptsInOrder","runScript","item","globalEvalStyles","href","link","rel","runStyle","styles","loadCount","mouseEventMap","mouseenter","mouseleave","pointerenter","pointerleave","related","relatedTarget","customType","animationEventMap","checkAnimationEventName","validators","any","validateType","bool","func","number","arrayOf","validator","maybe","result","isInvalid","composeError","instanceOf","expectedClass","objectOf","typeValidator","oneOf","arrayOfValues","oneOfValue","oneOfType","arrayOfTypeValidators","shapeOf","shape","required","config","compName","renderer","getRenderer","getParent","parentName","getType","expectedType","validatorFn","Config","mergeConfig","setter","fnNames","State","opt_config","opt_commonOpts","commonOpts_","context_","keysBlacklist_","obj_","scheduledBatchData_","stateInfo_","setShouldUseFacade","mergeInvalidKeys_","addToStateFromStaticHint_","initialValue","buildKeyInfo_","defineProperty","buildKeyPropertyDef_","validateInitialValue_","assertGivenIfRequired_","configsOrName","opt_initialValuesOrConfig","opt_contextOrInitialValue","addKeyToState","initialValues","names","props","defineProperties","ctor","defineContext","mergeStateStatic","addToState","STATE_MERGED","info","state","KeyStates","INITIALIZED","INVALID_KEYS_MERGED","hasInitialValue","assertValidStateKeyName_","UNINITIALIZED","stateObj","configurable","enumerable","getStateKeyValue_","set","setStateKeyValue_","currentValue","callFunction_","validatorReturn","writeOnce","written","opt_names","getStateKeys","warnIfDisposed_","initStateKey_","hasInitialValue_","prevVal","shouldInformChange_","newVal","scheduleBatchEvent_","INITIALIZING","setInitialValue_","setDefaultValue","values","changeData","emitBatchEvent_","changes","hasStateKey","valueFn","blacklist","canSetState","validateKeyValue_","callSetter_","informChange_","callValidator_","disposed","reverse","mergeState","INVALID_KEYS","ComponentDataManager","component","component_","firstDefinedValue","createState_","state_","holder","setKeysBlacklist_","BLACKLIST_MERGED","buildStateInstanceData_","getInitialConfig","emit_","proxy_","dispose","orig","getState","replaceNonInternal","setState","getStateKeyConfig","internal","BLACKLIST","components","refs","wasRendered","ComponentRenderer","componentRendererEvents_","render","handleRendered_","handleDataManagerCreated_","removeAllListeners","manager","getDataManager","SYNC_UPDATES_MERGED","handleManagerDataPropChanged_","handleManagerDataChanged_","shouldRerender_","update","isRendered_","skipUpdates_","Component","opt_parentElement","attachedListeners_","elementEventProxy_","eventsStateKeyHandler_","inDocument","initialConfig_","DEFAULT_ELEMENT_PARENT","mergeElementClasses_","renderer_","createRenderer","handleRendererRendered_","dataManager_","createDataManager","handleStateChanged_","newListenerHandle_","handleNewListener_","onEventsChanged_","addListenersFromObj_","componentCreated_","render_","onElementChanged_","eventNames","extractListenerInfo_","opt_siblingElement","renderElement_","sibling","attached","ref","DATA_MANAGER_MERGED","DATA","RENDERER_MERGED","detached","detach","disposeSubComponents","getListenerFn","fnName","opt_change","charAt","rendered","syncStateFromChanges_","marked","filter","join","setUpProxy_","setOriginEmitter","syncVisible","opt_skipRender","syncState_","attach","ELEMENT_CLASSES_MERGED","proxy","getSyncKeys","fireStateKeyChange_","elementVal_","COMPONENT_FLAG","Ctor","opt_configOrElement","opt_element","instance","elementClasses","visible","DATA_MANAGER","ELEMENT_CLASSES","RENDERER","SYNC_UPDATES","ComponentRegistry","constructorFn","components_","opt_name","NAME","IncrementalDomAop","fnStack","fns","originals","getOriginalFns","fnAttr","fnOpenEnd","fnOpenStart","fnVoid","pop","collectedArgs","getFn","handleCall","IncrementalDomUtils","IncrementalDomChildren","callback_","tree_","children","currentParent_","isCapturing_","startInterception","handleInterceptedCloseCall_","handleInterceptedOpenCall_","handleInterceptedTextCall_","currNodeOwner_","CHILD_OWNER","tree","opt_skipNode","addChildToTree","getOwner","buildCallFromConfig","addChildCallToTree_","opt_isText","buildConfigFromCall","stopInterception","originalFn","comps_","disposing_","IncrementalDomUnusedComponents","comp","comps","parent_","IncrementalDomRenderer","config_","childComponents_","clearChanges_","handleAttached_","handleInterceptedAttributesCall_","handleChildrenCaptured_","handleChildRender_","renderInsidePatchDontSkip_","removeDuplicateClasses_","getEventFromListenerAttr_","attachEvent_","handleKey","emptyChildren_","changes_","owner","LISTENER_REGEX","exec","owner_","compatData","renderers","useKey","RENDERER_NAME","tagOrCtor","getConstructor","getRef_","getCurrentData","match_","addSubComponent","prevComps","currComps","order","attachData_","componentToRender_","buildChildren_","renderFromTag_","isComponentTag","handleDataPropChanged_","ELEMENT_CLOSED","resetData_","incDomData_","handleSubComponentCall_","handleRegularCall_","ELEMENT_OPENED","currComp","getComponentBeingRendered","currRenderer","rootElementReached_","addElementClasses_","attachDecoratedListeners_","updateElementIfNotReached_","getCurrentOwner","getComponent","capture","isMatch_","startSkipUpdates","stopSkipUpdates","tempParent","guaranteeParent_","cssClasses","noDuplicates","all","used","intercept_","renderSubComponent_","shouldUpdate","startedRenderingComponent","schedule","renderIncDom","finishedRenderingComponent","ownerRenderer","getSubComponent_","updateContext_","parentComp","parentRenderer","renderInsidePatch","renderAsSubComponent","hasDataChanged_","buildShouldUpdateArgs_","childContext","getChildContext","renderingComponents_","disposeUnused","fnOrCtor","opt_dataOrElement","opt_parent","isComponentCtor","TempComponent","renderChild","childrenCount","JSXRenderer","handleJSXElementOpened_","handleJSXElementClosed_","propChanges_","count","KEY_PREFIX","__incrementalDOMData","iDOMHelpers","renderArbitrary","attrName","forOwn","iterator","hasOwn","jsxWrapper","elementClosure","wrapper","__jsxDOMWrapper","isIncDomNode","skipChild","JSXDataManager","props_","PROPS_MERGED","addUnconfiguredProps_","opt_type","prevProps","propsChanged","JSXComponent","JsFiddleMetalComponent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA;;;;;;;;;;;;;;;;;AAiBC,aAAUA,MAAV,EAAkBC,OAAlB,EAA2B;AACzBA,YAASD,OAAOE,cAAP,GAAwBF,OAAOE,cAAP,IAAyB,EAA1D,CAAD;AACD,GAFA,EAECC,MAFD,EAES,UAAUC,OAAV,EAAmB;AAAE;;AAE7B;;;;;;;;;;;;;;;;AAgBA;;;;AAGA,QAAIC,iBAAiBC,OAAOC,SAAP,CAAiBF,cAAtC;;AAEA;;;;AAIA,aAASG,KAAT,GAAiB,CAAE;;AAEnBA,UAAMD,SAAN,GAAkBD,OAAOG,MAAP,CAAc,IAAd,CAAlB;;AAEA;;;;;;AAMA,QAAIC,MAAM,SAANA,GAAM,CAAUC,GAAV,EAAeC,QAAf,EAAyB;AACjC,aAAOP,eAAeQ,IAAf,CAAoBF,GAApB,EAAyBC,QAAzB,CAAP;AACD,KAFD;;AAIA;;;;AAIA,QAAIE,YAAY,SAAZA,SAAY,GAAY;AAC1B,aAAO,IAAIN,KAAJ,EAAP;AACD,KAFD;;AAIA;;;AAGA,QAAIO,YAAY,sBAAhB;;AAEA;;;;;;AAMA,aAASC,QAAT,CAAkBC,QAAlB,EAA4BC,GAA5B,EAAiC;AAC/B;;;;AAIA,WAAKC,KAAL,GAAaL,WAAb;;AAEA;;;;;;AAMA,WAAKM,QAAL,GAAgB,EAAhB;;AAEA;;;;AAIA,WAAKC,QAAL,GAAgBP,WAAhB;;AAEA;;;;AAIA,WAAKQ,cAAL,GAAsB,KAAtB;;AAEA;;;;;AAKA,WAAKJ,GAAL,GAAWA,GAAX;;AAEA;;;;AAIA,WAAKK,MAAL,GAAcT,WAAd;;AAEA;;;;AAIA,WAAKU,WAAL,GAAmB,IAAnB;;AAEA;;;;AAIA,WAAKC,OAAL,GAAe,KAAf;;AAEA;;;;AAIA,WAAKR,QAAL,GAAgBA,QAAhB;;AAEA;;;AAGA,WAAKS,IAAL,GAAY,IAAZ;AACD;;AAED;;;;;;;;AAQA,QAAIC,WAAW,SAAXA,QAAW,CAAUC,IAAV,EAAgBX,QAAhB,EAA0BC,GAA1B,EAA+B;AAC5C,UAAIW,OAAO,IAAIb,QAAJ,CAAaC,QAAb,EAAuBC,GAAvB,CAAX;AACAU,WAAKb,SAAL,IAAkBc,IAAlB;AACA,aAAOA,IAAP;AACD,KAJD;;AAMA;;;;;;AAMA,QAAIC,UAAU,SAAVA,OAAU,CAAUF,IAAV,EAAgB;AAC5BG,iBAAWH,IAAX;AACA,aAAOA,KAAKb,SAAL,CAAP;AACD,KAHD;;AAKA;;;;;AAKA,QAAIgB,aAAa,SAAbA,UAAa,CAAUH,IAAV,EAAgB;AAC/B,UAAIA,KAAKb,SAAL,CAAJ,EAAqB;AACnB;AACD;;AAED,UAAIiB,YAAYJ,gBAAgBK,OAAhC;AACA,UAAIhB,WAAWe,YAAYJ,KAAKM,SAAjB,GAA6BN,KAAKX,QAAjD;AACA,UAAIC,MAAMc,YAAYJ,KAAKO,YAAL,CAAkB,KAAlB,CAAZ,GAAuC,IAAjD;AACA,UAAIN,OAAOF,SAASC,IAAT,EAAeX,QAAf,EAAyBC,GAAzB,CAAX;;AAEA,UAAIA,GAAJ,EAAS;AACPY,gBAAQF,KAAKQ,UAAb,EAAyBb,MAAzB,CAAgCL,GAAhC,IAAuCU,IAAvC;AACD;;AAED,UAAII,SAAJ,EAAe;AACb,YAAIK,aAAaT,KAAKS,UAAtB;AACA,YAAIlB,QAAQU,KAAKV,KAAjB;AACA,YAAIE,WAAWQ,KAAKR,QAApB;AACA,YAAID,WAAWS,KAAKT,QAApB;;AAEA,aAAK,IAAIkB,IAAI,CAAb,EAAgBA,IAAID,WAAWE,MAA/B,EAAuCD,KAAK,CAA5C,EAA+C;AAC7C,cAAIE,OAAOH,WAAWC,CAAX,CAAX;AACA,cAAIG,OAAOD,KAAKC,IAAhB;AACA,cAAIC,QAAQF,KAAKE,KAAjB;;AAEAvB,gBAAMsB,IAAN,IAAcC,KAAd;AACArB,mBAASoB,IAAT,IAAiBE,SAAjB;AACAvB,mBAASwB,IAAT,CAAcH,IAAd;AACArB,mBAASwB,IAAT,CAAcF,KAAd;AACD;AACF;;AAED,WAAK,IAAIG,QAAQjB,KAAKkB,UAAtB,EAAkCD,KAAlC,EAAyCA,QAAQA,MAAME,WAAvD,EAAoE;AAClEhB,mBAAWc,KAAX;AACD;AACF,KAnCD;;AAqCA;;;;;;AAMA,QAAIG,qBAAqB,SAArBA,kBAAqB,CAAUC,GAAV,EAAeC,MAAf,EAAuB;AAC9C,UAAID,QAAQ,KAAZ,EAAmB;AACjB,eAAO,4BAAP;AACD;;AAED,UAAInB,QAAQoB,MAAR,EAAgBjC,QAAhB,KAA6B,eAAjC,EAAkD;AAChD,eAAO,IAAP;AACD;;AAED,aAAOiC,OAAOC,YAAd;AACD,KAVD;;AAYA;;;;;;;;AAQA,QAAIC,gBAAgB,SAAhBA,aAAgB,CAAUC,GAAV,EAAeH,MAAf,EAAuBD,GAAvB,EAA4B/B,GAA5B,EAAiC;AACnD,UAAIoC,YAAYN,mBAAmBC,GAAnB,EAAwBC,MAAxB,CAAhB;AACA,UAAIK,KAAKZ,SAAT;;AAEA,UAAIW,SAAJ,EAAe;AACbC,aAAKF,IAAIG,eAAJ,CAAoBF,SAApB,EAA+BL,GAA/B,CAAL;AACD,OAFD,MAEO;AACLM,aAAKF,IAAID,aAAJ,CAAkBH,GAAlB,CAAL;AACD;;AAEDtB,eAAS4B,EAAT,EAAaN,GAAb,EAAkB/B,GAAlB;;AAEA,aAAOqC,EAAP;AACD,KAbD;;AAeA;;;;;AAKA,QAAIE,aAAa,SAAbA,UAAa,CAAUJ,GAAV,EAAe;AAC9B,UAAIzB,OAAOyB,IAAIK,cAAJ,CAAmB,EAAnB,CAAX;AACA/B,eAASC,IAAT,EAAe,OAAf,EAAwB,IAAxB;AACA,aAAOA,IAAP;AACD,KAJD;;AAMA;;;;;;;;;;;;;;;;AAgBA;AACA,QAAI+B,gBAAgB;AAClB;;;;;AAKAC,oBAAc,IANI;;AAQlB;;;;;;AAMAC,oBAAc;AAdI,KAApB;;AAiBA;;;;AAIA,aAASC,OAAT,GAAmB;AACjB;;;AAGA,WAAKC,OAAL,GAAeJ,cAAcC,YAAd,IAA8B,EAA7C;;AAEA;;;AAGA,WAAKI,OAAL,GAAeL,cAAcE,YAAd,IAA8B,EAA7C;AACD;;AAED;;;AAGAC,YAAQvD,SAAR,CAAkB0D,WAAlB,GAAgC,UAAUrC,IAAV,EAAgB;AAC9C,UAAI,KAAKmC,OAAT,EAAkB;AAChB,aAAKA,OAAL,CAAanB,IAAb,CAAkBhB,IAAlB;AACD;AACF,KAJD;;AAMA;;;AAGAkC,YAAQvD,SAAR,CAAkB2D,WAAlB,GAAgC,UAAUtC,IAAV,EAAgB;AAC9C,UAAI,KAAKoC,OAAT,EAAkB;AAChB,aAAKA,OAAL,CAAapB,IAAb,CAAkBhB,IAAlB;AACD;AACF,KAJD;;AAMA;;;AAGAkC,YAAQvD,SAAR,CAAkB4D,aAAlB,GAAkC,YAAY;AAC5C,UAAI,KAAKJ,OAAL,IAAgB,KAAKA,OAAL,CAAaxB,MAAb,GAAsB,CAA1C,EAA6C;AAC3CoB,sBAAcC,YAAd,CAA2B,KAAKG,OAAhC;AACD;;AAED,UAAI,KAAKC,OAAL,IAAgB,KAAKA,OAAL,CAAazB,MAAb,GAAsB,CAA1C,EAA6C;AAC3CoB,sBAAcE,YAAd,CAA2B,KAAKG,OAAhC;AACD;AACF,KARD;;AAUA;;;;;;;;;;;;;;;;AAgBA;;;;AAIA,QAAII,iBAAiB,SAAjBA,cAAiB,CAAUxC,IAAV,EAAgB;AACnC;AACA;AACA;AACA,aAAOA,gBAAgByC,QAAhB,IAA4BzC,gBAAgB0C,gBAAnD;AACD,KALD;;AAOA;;;;;AAKA,QAAIC,cAAc,SAAdA,WAAc,CAAU3C,IAAV,EAAgB4C,IAAhB,EAAsB;AACtC,UAAIC,WAAW,EAAf;AACA,UAAIC,MAAM9C,IAAV;;AAEA,aAAO8C,QAAQF,IAAf,EAAqB;AACnBC,iBAAS7B,IAAT,CAAc8B,GAAd;AACAA,cAAMA,IAAItC,UAAV;AACD;;AAED,aAAOqC,QAAP;AACD,KAVD;;AAYA;;;;AAIA,QAAIE,UAAU,SAAVA,OAAU,CAAU/C,IAAV,EAAgB;AAC5B,UAAI8C,MAAM9C,IAAV;AACA,UAAIgD,OAAOF,GAAX;;AAEA,aAAOA,GAAP,EAAY;AACVE,eAAOF,GAAP;AACAA,cAAMA,IAAItC,UAAV;AACD;;AAED,aAAOwC,IAAP;AACD,KAVD;;AAYA;;;;;AAKA,QAAIC,mBAAmB,SAAnBA,gBAAmB,CAAUjD,IAAV,EAAgB;AACrC,UAAI4C,OAAOG,QAAQ/C,IAAR,CAAX;AACA,aAAOwC,eAAeI,IAAf,IAAuBA,KAAKM,aAA5B,GAA4C,IAAnD;AACD,KAHD;;AAKA;;;;;;;AAOA,QAAIC,iBAAiB,SAAjBA,cAAiB,CAAUnD,IAAV,EAAgB4C,IAAhB,EAAsB;AACzC,UAAIM,gBAAgBD,iBAAiBjD,IAAjB,CAApB;;AAEA,UAAI,CAACkD,aAAD,IAAkB,CAAClD,KAAKoD,QAAL,CAAcF,aAAd,CAAvB,EAAqD;AACnD,eAAO,EAAP;AACD;;AAED,aAAOP,YAAYO,aAAZ,EAA2BN,IAA3B,CAAP;AACD,KARD;;AAUA;;;;;;;AAOA,QAAIS,aAAa,SAAbA,UAAa,CAAU7C,UAAV,EAAsBR,IAAtB,EAA4BsD,aAA5B,EAA2C;AAC1D,UAAIC,sBAAsBvD,KAAKmB,WAA/B;AACA,UAAI2B,MAAMQ,aAAV;;AAEA,aAAOR,QAAQ9C,IAAf,EAAqB;AACnB,YAAIwD,OAAOV,IAAI3B,WAAf;AACAX,mBAAWiD,YAAX,CAAwBX,GAAxB,EAA6BS,mBAA7B;AACAT,cAAMU,IAAN;AACD;AACF,KATD;;AAWA;AACA,QAAIE,UAAU,IAAd;;AAEA;AACA,QAAIC,cAAc,IAAlB;;AAEA;AACA,QAAIC,gBAAgB,IAApB;;AAEA;AACA,QAAInC,MAAM,IAAV;;AAEA;;;;AAIA,QAAIoC,cAAc,SAAdA,WAAc,CAAUC,SAAV,EAAqBjE,OAArB,EAA8B;AAC9C,WAAK,IAAIa,IAAI,CAAb,EAAgBA,IAAIoD,UAAUnD,MAA9B,EAAsCD,KAAK,CAA3C,EAA8C;AAC5CR,gBAAQ4D,UAAUpD,CAAV,CAAR,EAAsBb,OAAtB,GAAgCA,OAAhC;AACD;AACF,KAJD;;AAMA;;;;;;;AAOA,QAAIkE,eAAe,SAAfA,YAAe,CAAUC,GAAV,EAAe;AAChC;;;;;;;;;;AAUA,UAAIC,IAAI,SAAJA,CAAI,CAAUjE,IAAV,EAAgBkE,EAAhB,EAAoBjE,IAApB,EAA0B;AAChC,YAAIkE,cAAcT,OAAlB;AACA,YAAIU,UAAU3C,GAAd;AACA,YAAI4C,kBAAkBV,WAAtB;AACA,YAAIW,oBAAoBV,aAAxB;AACA,YAAIW,uBAAuB,KAA3B;AACA,YAAIC,iBAAiB,KAArB;;AAEAd,kBAAU,IAAIxB,OAAJ,EAAV;AACAT,cAAMzB,KAAKyE,aAAX;AACAb,wBAAgB5D,KAAKQ,UAArB;;AAEA,YAAI,iBAAiB,YAArB,EAAmC,CAAE;;AAErC,YAAIsD,YAAYX,eAAenD,IAAf,EAAqB4D,aAArB,CAAhB;AACAC,oBAAYC,SAAZ,EAAuB,IAAvB;AACA,YAAIY,SAASV,IAAIhE,IAAJ,EAAUkE,EAAV,EAAcjE,IAAd,CAAb;AACA4D,oBAAYC,SAAZ,EAAuB,KAAvB;;AAEA,YAAI,iBAAiB,YAArB,EAAmC,CAAE;;AAErCJ,gBAAQnB,aAAR;;AAEAmB,kBAAUS,WAAV;AACA1C,cAAM2C,OAAN;AACAT,sBAAcU,eAAd;AACAT,wBAAgBU,iBAAhB;;AAEA,eAAOI,MAAP;AACD,OA7BD;AA8BA,aAAOT,CAAP;AACD,KA1CD;;AA4CA;;;;;;;;;;;AAWA,QAAIU,aAAaZ,aAAa,UAAU/D,IAAV,EAAgBkE,EAAhB,EAAoBjE,IAApB,EAA0B;AACtD0D,oBAAc3D,IAAd;;AAEA4E;AACAV,SAAGjE,IAAH;AACA4E;;AAEA,UAAI,iBAAiB,YAArB,EAAmC,CAAE;;AAErC,aAAO7E,IAAP;AACD,KAVgB,CAAjB;;AAYA;;;;;;;;;;;;AAYA,QAAI8E,aAAaf,aAAa,UAAU/D,IAAV,EAAgBkE,EAAhB,EAAoBjE,IAApB,EAA0B;AACtD,UAAI8E,YAAY,uBAAuB,EAAE5D,aAAanB,IAAf,EAAvC;AACA,UAAIgF,mBAAmB,IAAvB;AACA,UAAIC,mBAAmB,IAAvB;;AAEA,UAAI,iBAAiB,YAArB,EAAmC,CAAE;;AAErCtB,oBAAcoB,SAAd;AACAb,SAAGjE,IAAH;;AAEA,UAAI,iBAAiB,YAArB,EAAmC,CAAE;;AAErC,UAAID,SAAS2D,WAAT,IAAwB3D,KAAKQ,UAAjC,EAA6C;AAC3C0E,oBAAYtB,aAAZ,EAA2B5D,IAA3B,EAAiCE,QAAQ0D,aAAR,EAAuBjE,MAAxD;AACD;;AAED,aAAOoF,cAAcpB,WAAd,GAA4B,IAA5B,GAAmCA,WAA1C;AACD,KAjBgB,CAAjB;;AAmBA;;;;;;;;;AASA,QAAIwB,UAAU,SAAVA,OAAU,CAAUC,SAAV,EAAqB/F,QAArB,EAA+BC,GAA/B,EAAoC;AAChD,UAAIW,OAAOC,QAAQkF,SAAR,CAAX;;AAEA;AACA;AACA;AACA,aAAO/F,aAAaY,KAAKZ,QAAlB,IAA8BC,OAAOW,KAAKX,GAAjD;AACD,KAPD;;AASA;;;;;;;AAOA,QAAI+F,eAAe,SAAfA,YAAe,CAAUhG,QAAV,EAAoBC,GAApB,EAAyB;AAC1C,UAAIqE,eAAewB,QAAQxB,WAAR,EAAqBtE,QAArB,EAA+BC,GAA/B,CAAnB,EAAwD;AACtD;AACD;;AAED,UAAIgG,aAAapF,QAAQ0D,aAAR,CAAjB;AACA,UAAI2B,kBAAkB5B,eAAezD,QAAQyD,WAAR,CAArC;AACA,UAAIhE,SAAS2F,WAAW3F,MAAxB;AACA,UAAIK,OAAOe,SAAX;;AAEA;AACA,UAAIzB,GAAJ,EAAS;AACP,YAAIkG,UAAU7F,OAAOL,GAAP,CAAd;AACA,YAAIkG,OAAJ,EAAa;AACX,cAAIL,QAAQK,OAAR,EAAiBnG,QAAjB,EAA2BC,GAA3B,CAAJ,EAAqC;AACnCU,mBAAOwF,OAAP;AACD,WAFD,MAEO,IAAIA,YAAY7B,WAAhB,EAA6B;AAClCD,oBAAQpB,WAAR,CAAoBkD,OAApB;AACD,WAFM,MAEA;AACLN,wBAAYtB,aAAZ,EAA2B4B,OAA3B,EAAoC7F,MAApC;AACD;AACF;AACF;;AAED;AACA,UAAI,CAACK,IAAL,EAAW;AACT,YAAIX,aAAa,OAAjB,EAA0B;AACxBW,iBAAO6B,WAAWJ,GAAX,CAAP;AACD,SAFD,MAEO;AACLzB,iBAAOwB,cAAcC,GAAd,EAAmBmC,aAAnB,EAAkCvE,QAAlC,EAA4CC,GAA5C,CAAP;AACD;;AAED,YAAIA,GAAJ,EAAS;AACPK,iBAAOL,GAAP,IAAcU,IAAd;AACD;;AAED0D,gBAAQrB,WAAR,CAAoBrC,IAApB;AACD;;AAED;AACA;AACA;AACA,UAAIE,QAAQF,IAAR,EAAcH,OAAlB,EAA2B;AACzB;AACAwD,mBAAWO,aAAX,EAA0B5D,IAA1B,EAAgC2D,WAAhC;AACD,OAHD,MAGO,IAAI4B,mBAAmBA,gBAAgBjG,GAAnC,IAA0C,CAACiG,gBAAgB1F,OAA/D,EAAwE;AAC7E;AACA;AACA;AACA+D,sBAAc6B,YAAd,CAA2BzF,IAA3B,EAAiC2D,WAAjC;AACA2B,mBAAW1F,WAAX,GAAyB,KAAzB;AACD,OANM,MAMA;AACLgE,sBAAcH,YAAd,CAA2BzD,IAA3B,EAAiC2D,WAAjC;AACD;;AAEDA,oBAAc3D,IAAd;AACD,KAxDD;;AA0DA;;;;;AAKA,QAAIkF,cAAc,SAAdA,WAAc,CAAUlF,IAAV,EAAgBiB,KAAhB,EAAuBtB,MAAvB,EAA+B;AAC/CK,WAAKkF,WAAL,CAAiBjE,KAAjB;AACAyC,cAAQpB,WAAR,EAAqB,mBAAmBrB,KAAxC;;AAEA,UAAI3B,MAAMY,QAAQe,KAAR,EAAe3B,GAAzB;AACA,UAAIA,GAAJ,EAAS;AACP,eAAOK,OAAOL,GAAP,CAAP;AACD;AACF,KARD;;AAUA;;;;AAIA,QAAIoG,oBAAoB,SAApBA,iBAAoB,GAAY;AAClC,UAAI1F,OAAO4D,aAAX;AACA,UAAI3D,OAAOC,QAAQF,IAAR,CAAX;AACA,UAAIL,SAASM,KAAKN,MAAlB;AACA,UAAIC,cAAcK,KAAKL,WAAvB;AACA,UAAIqB,QAAQjB,KAAK2F,SAAjB;AACA,UAAIrG,MAAMyB,SAAV;;AAEA,UAAIE,UAAU0C,WAAV,IAAyB/D,WAA7B,EAA0C;AACxC;AACD;;AAED,aAAOqB,UAAU0C,WAAjB,EAA8B;AAC5BuB,oBAAYlF,IAAZ,EAAkBiB,KAAlB,EAAyBtB,MAAzB;AACAsB,gBAAQjB,KAAK2F,SAAb;AACD;;AAED;AACA,UAAI,CAAC/F,WAAL,EAAkB;AAChB,aAAKN,GAAL,IAAYK,MAAZ,EAAoB;AAClBsB,kBAAQtB,OAAOL,GAAP,CAAR;AACA,cAAI2B,MAAMT,UAAN,KAAqBR,IAAzB,EAA+B;AAC7B0D,oBAAQpB,WAAR,CAAoBrB,KAApB;AACA,mBAAOtB,OAAOL,GAAP,CAAP;AACD;AACF;;AAEDW,aAAKL,WAAL,GAAmB,IAAnB;AACD;AACF,KA7BD;;AA+BA;;;AAGA,QAAIgF,YAAY,SAAZA,SAAY,GAAY;AAC1BhB,sBAAgBD,WAAhB;AACAA,oBAAc,IAAd;AACD,KAHD;;AAKA;;;AAGA,QAAIiC,cAAc,SAAdA,WAAc,GAAY;AAC5B,UAAIjC,WAAJ,EAAiB;AACf,eAAOA,YAAYxC,WAAnB;AACD,OAFD,MAEO;AACL,eAAOyC,cAAc1C,UAArB;AACD;AACF,KAND;;AAQA;;;AAGA,QAAI2E,WAAW,SAAXA,QAAW,GAAY;AACzBlC,oBAAciC,aAAd;AACD,KAFD;;AAIA;;;AAGA,QAAIf,WAAW,SAAXA,QAAW,GAAY;AACzBa;;AAEA/B,oBAAcC,aAAd;AACAA,sBAAgBA,cAAcpD,UAA9B;AACD,KALD;;AAOA;;;;;;;;;;AAUA,QAAIsF,kBAAkB,SAAlBA,eAAkB,CAAUzE,GAAV,EAAe/B,GAAf,EAAoB;AACxCuG;AACAR,mBAAahE,GAAb,EAAkB/B,GAAlB;AACAsF;AACA,aAAQ,wBAAuBhB;AAA/B;AAED,KAND;;AAQA;;;;;;AAMA,QAAImC,mBAAmB,SAAnBA,gBAAmB,GAAY;AACjC,UAAI,iBAAiB,YAArB,EAAmC,CAAE;;AAErClB;AACA,aAAQ,wBAAuBlB;AAA/B;AAED,KAND;;AAQA;;;;;;AAMA,QAAIqC,WAAW,SAAXA,QAAW,GAAY;AACzBH;AACAR,mBAAa,OAAb,EAAsB,IAAtB;AACA,aAAQ,qBAAoB1B;AAA5B;AAED,KALD;;AAOA;;;;AAIA,QAAIsC,iBAAiB,SAAjBA,cAAiB,GAAY;AAC/B,UAAI,iBAAiB,YAArB,EAAmC,CAAE;AACrC,aAAQ,wBAAuBrC;AAA/B;AAED,KAJD;;AAMA;;;AAGA,QAAIsC,iBAAiB,SAAjBA,cAAiB,GAAY;AAC/B,UAAI,iBAAiB,YAArB,EAAmC,CAAE;AACrC,aAAON,aAAP;AACD,KAHD;;AAKA;;;;AAIA,QAAIO,OAAO,SAAPA,IAAO,GAAY;AACrB,UAAI,iBAAiB,YAArB,EAAmC,CAAE;AACrCxC,oBAAcC,cAAc+B,SAA5B;AACD,KAHD;;AAKA;;;;AAIA,QAAIS,WAAWP,QAAf;;AAEA;;;;;;;;;;;;;;;;AAgBA;AACA,QAAIQ,UAAU;AACZC,eAAS;AADG,KAAd;;AAIA;;;;AAIA,QAAIC,eAAe,SAAfA,YAAe,CAAU1F,IAAV,EAAgB;AACjC,UAAIA,KAAK2F,WAAL,CAAiB,MAAjB,EAAyB,CAAzB,MAAgC,CAApC,EAAuC;AACrC,eAAO,sCAAP;AACD;;AAED,UAAI3F,KAAK2F,WAAL,CAAiB,QAAjB,EAA2B,CAA3B,MAAkC,CAAtC,EAAyC;AACvC,eAAO,8BAAP;AACD;AACF,KARD;;AAUA;;;;;;;;AAQA,QAAIC,YAAY,SAAZA,SAAY,CAAU9E,EAAV,EAAcd,IAAd,EAAoBC,KAApB,EAA2B;AACzC,UAAIA,SAAS,IAAb,EAAmB;AACjBa,WAAG+E,eAAH,CAAmB7F,IAAnB;AACD,OAFD,MAEO;AACL,YAAI8F,SAASJ,aAAa1F,IAAb,CAAb;AACA,YAAI8F,MAAJ,EAAY;AACVhF,aAAGiF,cAAH,CAAkBD,MAAlB,EAA0B9F,IAA1B,EAAgCC,KAAhC;AACD,SAFD,MAEO;AACLa,aAAGkF,YAAH,CAAgBhG,IAAhB,EAAsBC,KAAtB;AACD;AACF;AACF,KAXD;;AAaA;;;;;;AAMA,QAAIgG,YAAY,SAAZA,SAAY,CAAUnF,EAAV,EAAcd,IAAd,EAAoBC,KAApB,EAA2B;AACzCa,SAAGd,IAAH,IAAWC,KAAX;AACD,KAFD;;AAIA;;;;;;;AAOA,QAAIiG,gBAAgB,SAAhBA,aAAgB,CAAUC,KAAV,EAAiBC,IAAjB,EAAuBnG,KAAvB,EAA8B;AAChD,UAAImG,KAAKC,OAAL,CAAa,GAAb,KAAqB,CAAzB,EAA4B;AAC1BF,cAAMG,WAAN,CAAkBF,IAAlB,EAAwB,qBAAqBnG,KAA7C;AACD,OAFD,MAEO;AACLkG,cAAMC,IAAN,IAAcnG,KAAd;AACD;AACF,KAND;;AAQA;;;;;;;;AAQA,QAAIsG,aAAa,SAAbA,UAAa,CAAUzF,EAAV,EAAcd,IAAd,EAAoBmG,KAApB,EAA2B;AAC1C,UAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC7BrF,WAAGqF,KAAH,CAASK,OAAT,GAAmBL,KAAnB;AACD,OAFD,MAEO;AACLrF,WAAGqF,KAAH,CAASK,OAAT,GAAmB,EAAnB;AACA,YAAIC,UAAU3F,GAAGqF,KAAjB;AACA,YAAIO,MAAM,qCAAqCP,KAA/C;;AAEA,aAAK,IAAIC,IAAT,IAAiBM,GAAjB,EAAsB;AACpB,cAAIzI,IAAIyI,GAAJ,EAASN,IAAT,CAAJ,EAAoB;AAClBF,0BAAcO,OAAd,EAAuBL,IAAvB,EAA6BM,IAAIN,IAAJ,CAA7B;AACD;AACF;AACF;AACF,KAdD;;AAgBA;;;;;;;;AAQA,QAAIO,sBAAsB,SAAtBA,mBAAsB,CAAU7F,EAAV,EAAcd,IAAd,EAAoBC,KAApB,EAA2B;AACnD,UAAI2G,cAAc3G,KAAd,qDAAcA,KAAd,CAAJ;;AAEA,UAAI2G,SAAS,QAAT,IAAqBA,SAAS,UAAlC,EAA8C;AAC5CX,kBAAUnF,EAAV,EAAcd,IAAd,EAAoBC,KAApB;AACD,OAFD,MAEO;AACL2F,kBAAU9E,EAAV,EAAcd,IAAd,EAAoB,uCAAuCC,KAA3D;AACD;AACF,KARD;;AAUA;;;;;;AAMA,QAAI4G,kBAAkB,SAAlBA,eAAkB,CAAU/F,EAAV,EAAcd,IAAd,EAAoBC,KAApB,EAA2B;AAC/C,UAAIb,OAAOC,QAAQyB,EAAR,CAAX;AACA,UAAIpC,QAAQU,KAAKV,KAAjB;;AAEA,UAAIA,MAAMsB,IAAN,MAAgBC,KAApB,EAA2B;AACzB;AACD;;AAED,UAAI6G,UAAUlH,WAAWI,IAAX,KAAoBJ,WAAW4F,QAAQC,OAAnB,CAAlC;AACAqB,cAAQhG,EAAR,EAAYd,IAAZ,EAAkBC,KAAlB;;AAEAvB,YAAMsB,IAAN,IAAcC,KAAd;AACD,KAZD;;AAcA;;;;AAIA,QAAIL,aAAavB,WAAjB;;AAEA;AACA;AACAuB,eAAW4F,QAAQC,OAAnB,IAA8BkB,mBAA9B;;AAEA/G,eAAW,OAAX,IAAsB2G,UAAtB;;AAEA;;;;;AAKA,QAAIQ,oBAAoB,CAAxB;;AAEA;;;;;AAKA,QAAIC,cAAc,EAAlB;;AAEA;;;;;;;;;;;;AAYA,QAAIC,cAAc,SAAdA,WAAc,CAAUzG,GAAV,EAAe/B,GAAf,EAAoByI,OAApB,EAA6BC,QAA7B,EAAuC;AACvD,UAAI,iBAAiB,YAArB,EAAmC,CAAE;;AAErC,UAAIhI,OAAO8F,gBAAgBzE,GAAhB,EAAqB/B,GAArB,CAAX;AACA,UAAIW,OAAOC,QAAQF,IAAR,CAAX;;AAEA,UAAI,CAACC,KAAKP,cAAV,EAA0B;AACxB,YAAIqI,OAAJ,EAAa;AACX,eAAK,IAAIE,KAAK,CAAd,EAAiBA,KAAKF,QAAQpH,MAA9B,EAAsCsH,MAAM,CAA5C,EAA+C;AAC7C,gBAAIpH,OAAO,qBAAqBkH,QAAQE,EAAR,CAAhC;AACA,gBAAInH,QAAQiH,QAAQE,KAAK,CAAb,CAAZ;AACAP,4BAAgB1H,IAAhB,EAAsBa,IAAtB,EAA4BC,KAA5B;AACD;AACF;AACD;AACA;AACA;AACAb,aAAKP,cAAL,GAAsB,IAAtB;AACD;;AAED;;;;;;AAMA,UAAIF,WAAWS,KAAKT,QAApB;AACA,UAAIC,WAAWQ,KAAKR,QAApB;AACA,UAAIyI,QAAQ,CAAC1I,SAASmB,MAAtB;AACA,UAAID,IAAIkH,iBAAR;AACA,UAAIO,IAAI,CAAR;;AAEA,aAAOzH,IAAI0H,UAAUzH,MAArB,EAA6BD,KAAK,CAAL,EAAQyH,KAAK,CAA1C,EAA6C;AAC3C,YAAIE,QAAQD,UAAU1H,CAAV,CAAZ;AACA,YAAIwH,KAAJ,EAAW;AACT1I,mBAAS2I,CAAT,IAAcE,KAAd;AACA5I,mBAAS4I,KAAT,IAAkBtH,SAAlB;AACD,SAHD,MAGO,IAAIvB,SAAS2I,CAAT,MAAgBE,KAApB,EAA2B;AAChC;AACD;;AAED,YAAIvH,QAAQsH,UAAU1H,IAAI,CAAd,CAAZ;AACA,YAAIwH,SAAS1I,SAAS2I,IAAI,CAAb,MAAoBrH,KAAjC,EAAwC;AACtCtB,mBAAS2I,IAAI,CAAb,IAAkBrH,KAAlB;AACA4G,0BAAgB1H,IAAhB,EAAsBqI,KAAtB,EAA6BvH,KAA7B;AACD;AACF;;AAED,UAAIJ,IAAI0H,UAAUzH,MAAd,IAAwBwH,IAAI3I,SAASmB,MAAzC,EAAiD;AAC/C,eAAOD,IAAI0H,UAAUzH,MAArB,EAA6BD,KAAK,CAAL,EAAQyH,KAAK,CAA1C,EAA6C;AAC3C3I,mBAAS2I,CAAT,IAAcC,UAAU1H,CAAV,CAAd;AACD;;AAED,YAAIyH,IAAI3I,SAASmB,MAAjB,EAAyB;AACvBnB,mBAASmB,MAAT,GAAkBwH,CAAlB;AACD;;AAED;;;AAGA,aAAKzH,IAAI,CAAT,EAAYA,IAAIlB,SAASmB,MAAzB,EAAiCD,KAAK,CAAtC,EAAyC;AACvC,cAAIG,OAAO,qBAAqBrB,SAASkB,CAAT,CAAhC;AACA,cAAII,QAAQtB,SAASkB,IAAI,CAAb,CAAZ;AACAjB,mBAASoB,IAAT,IAAiBC,KAAjB;AACD;;AAED,aAAK,IAAIwH,MAAT,IAAmB7I,QAAnB,EAA6B;AAC3BiI,0BAAgB1H,IAAhB,EAAsBsI,MAAtB,EAA8B7I,SAAS6I,MAAT,CAA9B;AACA7I,mBAAS6I,MAAT,IAAmBvH,SAAnB;AACD;AACF;;AAED,aAAOf,IAAP;AACD,KAzED;;AA2EA;;;;;;;;;;;;;;AAcA,QAAIuI,mBAAmB,SAAnBA,gBAAmB,CAAUlH,GAAV,EAAe/B,GAAf,EAAoByI,OAApB,EAA6B;AAClD,UAAI,iBAAiB,YAArB,EAAmC,CAAE;;AAErCF,kBAAY,CAAZ,IAAiBxG,GAAjB;AACAwG,kBAAY,CAAZ,IAAiBvI,GAAjB;AACAuI,kBAAY,CAAZ,IAAiBE,OAAjB;AACD,KAND;;AAQA;;;;;;;AAOA,QAAInH,OAAO,SAAPA,IAAO,CAAUC,IAAV,EAAgBC,KAAhB,EAAuB;AAChC,UAAI,iBAAiB,YAArB,EAAmC,CAAE;;AAErC+G,kBAAY7G,IAAZ,CAAiBH,IAAjB;AACAgH,kBAAY7G,IAAZ,CAAiBF,KAAjB;AACD,KALD;;AAOA;;;;AAIA,QAAI0H,iBAAiB,SAAjBA,cAAiB,GAAY;AAC/B,UAAI,iBAAiB,YAArB,EAAmC,CAAE;;AAErC,UAAIxI,OAAO8H,YAAYW,KAAZ,CAAkB,IAAlB,EAAwBZ,WAAxB,CAAX;AACAA,kBAAYlH,MAAZ,GAAqB,CAArB;AACA,aAAOX,IAAP;AACD,KAND;;AAQA;;;;;;AAMA,QAAI0I,eAAe,SAAfA,YAAe,CAAUrH,GAAV,EAAe;AAChC,UAAI,iBAAiB,YAArB,EAAmC,CAAE;;AAErC,UAAIrB,OAAO+F,kBAAX;;AAEA,UAAI,iBAAiB,YAArB,EAAmC,CAAE;;AAErC,aAAO/F,IAAP;AACD,KARD;;AAUA;;;;;;;;;;;;;;AAcA,QAAI2I,cAAc,SAAdA,WAAc,CAAUtH,GAAV,EAAe/B,GAAf,EAAoByI,OAApB,EAA6BC,QAA7B,EAAuC;AACvDF,kBAAYW,KAAZ,CAAkB,IAAlB,EAAwBL,SAAxB;AACA,aAAOM,aAAarH,GAAb,CAAP;AACD,KAHD;;AAKA;;;;;;;;;AASA,QAAIvB,OAAO,SAAPA,IAAO,CAAUgB,KAAV,EAAiBkH,QAAjB,EAA2B;AACpC,UAAI,iBAAiB,YAArB,EAAmC,CAAE;;AAErC,UAAIhI,OAAOgG,UAAX;AACA,UAAI/F,OAAOC,QAAQF,IAAR,CAAX;;AAEA,UAAIC,KAAKH,IAAL,KAAcgB,KAAlB,EAAyB;AACvBb,aAAKH,IAAL,GAAY,qBAAqBgB,KAAjC;;AAEA,YAAI8H,YAAY9H,KAAhB;AACA,aAAK,IAAIJ,IAAI,CAAb,EAAgBA,IAAI0H,UAAUzH,MAA9B,EAAsCD,KAAK,CAA3C,EAA8C;AAC5C;;;;AAIA,cAAIwD,KAAKkE,UAAU1H,CAAV,CAAT;AACAkI,sBAAY1E,GAAG0E,SAAH,CAAZ;AACD;;AAED5I,aAAKC,IAAL,GAAY2I,SAAZ;AACD;;AAED,aAAO5I,IAAP;AACD,KAvBD;;AAyBAxB,YAAQqK,KAAR,GAAgBlE,UAAhB;AACAnG,YAAQmG,UAAR,GAAqBA,UAArB;AACAnG,YAAQsG,UAAR,GAAqBA,UAArB;AACAtG,YAAQyH,cAAR,GAAyBA,cAAzB;AACAzH,YAAQ0H,cAAR,GAAyBA,cAAzB;AACA1H,YAAQ2H,IAAR,GAAeA,IAAf;AACA3H,YAAQ4H,QAAR,GAAmBA,QAAnB;AACA5H,YAAQmK,WAAR,GAAsBA,WAAtB;AACAnK,YAAQ+J,gBAAR,GAA2BA,gBAA3B;AACA/J,YAAQgK,cAAR,GAAyBA,cAAzB;AACAhK,YAAQsJ,WAAR,GAAsBA,WAAtB;AACAtJ,YAAQkK,YAAR,GAAuBA,YAAvB;AACAlK,YAAQsB,IAAR,GAAeA,IAAf;AACAtB,YAAQoC,IAAR,GAAeA,IAAf;AACApC,YAAQ6H,OAAR,GAAkBA,OAAlB;AACA7H,YAAQiC,UAAR,GAAqBA,UAArB;AACAjC,YAAQiI,SAAR,GAAoBA,SAApB;AACAjI,YAAQsI,SAAR,GAAoBA,SAApB;AACAtI,YAAQuD,aAAR,GAAwBA,aAAxB;AACAvD,YAAQ2B,UAAR,GAAqBA,UAArB;AAED,GA/qCA,CAAD;;AAirCA;;ACpsCA;;AAEA;;;;;;AAKA,MAAI2I,+BAAJ;;AAEA;;;;;AAKA,MAAIC,mBAAmB,CAAvB;;AAEA;;;;;AAKO,MAAMC,eAAe,WAAYC,KAAKC,MAAL,KAAgB,GAAjB,KAA0B,CAArC,CAArB;;;oDAAMF,cAEb;;;;;;;;;;;AAUO,WAASG,cAAT,GAA0B;AAChC,UAAMC,MAAM,+BAAN,CAAN;AACA;;sDAFeD,gBAIhB;;;;;;;;;;AASO,WAASE,2BAAT,CAAqCC,WAArC,EAAkDC,YAAlD,EAAgE;AACtE,QAAIC,iBAAiB,CAACF,YAAYC,YAAZ,CAAD,CAArB;AACA,WAAOD,YAAYG,SAAZ,IAAyB,CAACH,YAAYG,SAAZ,CAAsBC,aAAtB,CAAoCC,QAApC,CAAjC,EAAgF;AAC/EL,oBAAcA,YAAYG,SAA1B;AACAD,qBAAexI,IAAf,CAAoBsI,YAAYC,YAAZ,CAApB;AACA;AACD,WAAOC,cAAP;AACA;;mEAPeH,6BAShB;;;;AAGO,WAASO,wBAAT,GAAoC;AAC1Cd,6BAAyB,IAAzB;AACA;;gEAFec,0BAIhB;;;;;;;;;;;;;;;;;AAgBO,WAASC,uBAAT,GAAgD;AAAA,QAAfC,QAAe,uEAAJ,EAAI;;AACtDhB,6BAAyBgB,QAAzB;AACA;;+DAFeD,yBAIhB;;;;;;AAKO,WAASE,wBAAT,GAAoC;AAC1C;AACA,QAAI,CAACjB,sBAAL,EAA6B;AAC5B,UAAI,OAAOvK,MAAP,KAAkB,WAAlB,IAAiCA,OAAOyL,uBAA5C,EAAqE;AACpEH,gCAAwBtL,OAAOyL,uBAA/B;AACA;AACD;AACD,WAAOlB,sBAAP;AACA;;gEAReiB,0BAUhB;;;;;;;;AAOO,WAASE,eAAT,CAAyB/F,EAAzB,EAA6B;AACnC,QAAI,CAACA,GAAGrD,IAAR,EAAc;AACb,UAAIqJ,MAAMhG,GAAGiG,QAAH,EAAV;AACAjG,SAAGrD,IAAH,GAAUqJ,IAAIE,SAAJ,CAAc,CAAd,EAAiBF,IAAIhD,OAAJ,CAAY,GAAZ,CAAjB,CAAV;AACA;AACD,WAAOhD,GAAGrD,IAAV;AACA;;uDANeoJ,iBAQhB;;;;;;;;;;;;AAWO,WAASI,MAAT,CAAgBC,UAAhB,EAA4BC,iBAA5B,EAA+C;AACrD,QAAID,UAAJ,EAAgB;AACf,UAAIE,KAAKF,WAAWtB,YAAX,CAAT;AACA,UAAIuB,qBAAqB,CAACD,WAAW7L,cAAX,CAA0BuK,YAA1B,CAA1B,EAAmE;AAClEwB,aAAK,IAAL;AACA;AACD,aAAOA,OAAOF,WAAWtB,YAAX,IAA2BD,kBAAlC,CAAP;AACA;AACD,WAAOA,kBAAP;AACA;;8CATesB,QAWhB;;;;;;AAKO,WAASI,gBAAT,CAA0BC,eAA1B,EAA2C;AACjD,WAAOA,eAAP;AACA;;wDAFeD,kBAIhB;;;;;;AAKO,WAASE,SAAT,CAAmBC,GAAnB,EAAwB;AAC9B,WAAO,OAAOA,GAAP,KAAe,SAAtB;AACA;;iDAFeD,WAIhB;;;;;;AAKO,WAASE,KAAT,CAAeD,GAAf,EAAoB;AAC1B,WAAOA,QAAQ7J,SAAf;AACA;;6CAFe8J,OAIhB;;;;;;AAKO,WAASC,eAAT,CAAyBF,GAAzB,EAA8B;AACpC,WAAOC,MAAMD,GAAN,KAAc,CAACG,OAAOH,GAAP,CAAtB;AACA;;uDAFeE,iBAIhB;;;;;;AAKO,WAASE,UAAT,CAAoBJ,GAApB,EAAyB;AAC/B,WAAOA,OAAO,QAAOA,GAAP,qDAAOA,GAAP,OAAe,QAAtB,IAAkCA,IAAIK,QAAJ,KAAiB,CAA1D;AACA;;kDAFeD,YAIhB;;;;;;AAKO,WAAS5K,SAAT,CAAmBwK,GAAnB,EAAwB;AAC9B,WAAOA,OAAO,QAAOA,GAAP,qDAAOA,GAAP,OAAe,QAAtB,IAAkCA,IAAIK,QAAJ,KAAiB,CAA1D;AACA;;iDAFe7K,WAIhB;;;;;;AAKO,WAAS8K,UAAT,CAAoBN,GAApB,EAAyB;AAC/B,WAAO,OAAOA,GAAP,KAAe,UAAtB;AACA;;kDAFeM,YAIhB;;;;;;AAKO,WAASH,MAAT,CAAgBH,GAAhB,EAAqB;AAC3B,WAAOA,QAAQ,IAAf;AACA;;8CAFeG,QAIhB;;;;;;AAKO,WAASI,QAAT,CAAkBP,GAAlB,EAAuB;AAC7B,WAAO,OAAOA,GAAP,KAAe,QAAtB;AACA;;gDAFeO,UAIhB;;;;;;AAKO,WAASC,QAAT,CAAkBR,GAAlB,EAAuB;AAC7B,WAAOA,QAAQ,IAAR,IAAgBA,QAAQA,IAAIrM,MAAnC;AACA;;gDAFe6M,UAIhB;;;;;;;AAMO,WAASC,QAAT,CAAkBT,GAAlB,EAAuB;AAC7B,QAAInD,cAAcmD,GAAd,qDAAcA,GAAd,CAAJ;AACA,WAAOnD,SAAS,QAAT,IAAqBmD,QAAQ,IAA7B,IAAqCnD,SAAS,UAArD;AACA;;gDAHe4D,UAKhB;;;;;;AAKO,WAASC,SAAT,CAAmBV,GAAnB,EAAwB;AAC9B,WAAOA,OAAO,QAAOA,GAAP,qDAAOA,GAAP,OAAe,QAAtB,IAAkC,OAAOA,IAAIW,IAAX,KAAoB,UAA7D;AACA;;iDAFeD,WAIhB;;;;;;AAKO,WAASE,QAAT,CAAkBZ,GAAlB,EAAuB;AAC7B,WAAO,OAAOA,GAAP,KAAe,QAAf,IAA2BA,eAAea,MAAjD;AACA;;gDAFeD,UAIhB;;;;;;;;;;;;;AAYO,WAASE,yBAAT,CAAmCpC,WAAnC,EAAgDC,YAAhD,EAA8DoC,WAA9D,EAA2E;AACjF,QAAIC,aAAarC,eAAe,SAAhC;AACA,QAAID,YAAY7K,cAAZ,CAA2BmN,UAA3B,CAAJ,EAA4C;AAC3C,aAAO,KAAP;AACA;;AAED,QAAIC,SAASxC,4BAA4BC,WAA5B,EAAyCC,YAAzC,CAAb;AACA,QAAIoC,WAAJ,EAAiB;AAChBE,eAASF,YAAYE,MAAZ,CAAT;AACA;AACDvC,gBAAYsC,UAAZ,IAA0BC,MAA1B;AACA,WAAO,IAAP;AACA;;iEAZeH,2BAchB;;;;;AAIO,WAASI,YAAT,GAAwB,CAAE;oDAAjBA;;AC3RhB;;AAEA;AACA;AACA;AACA;;;MACYC;0BAEGA;;uCACNA;;;;;ACTT;;;KAESlB;;KAEHmB;;;;;;;;AACL;;;;;;yBAMaC,MAAMC,MAAM;AACxB,QAAID,KAAKtL,MAAL,KAAgBuL,KAAKvL,MAAzB,EAAiC;AAChC,YAAO,KAAP;AACA;AACD,SAAK,IAAID,IAAI,CAAb,EAAgBA,IAAIuL,KAAKtL,MAAzB,EAAiCD,GAAjC,EAAsC;AACrC,SAAIuL,KAAKvL,CAAL,MAAYwL,KAAKxL,CAAL,CAAhB,EAAyB;AACxB,aAAO,KAAP;AACA;AACD;AACD,WAAO,IAAP;AACA;;AAED;;;;;;;;qCAKyByL,KAAK;AAC7B,SAAK,IAAIzL,IAAI,CAAb,EAAgBA,IAAIyL,IAAIxL,MAAxB,EAAgCD,GAAhC,EAAqC;AACpC,SAAIyL,IAAIzL,CAAJ,MAAWK,SAAf,EAA0B;AACzB,aAAOoL,IAAIzL,CAAJ,CAAP;AACA;AACD;AACD;;AAED;;;;;;;;;2BAMeyL,KAAKC,YAAY;AAC/B,QAAIC,SAASD,cAAc,EAA3B;AACA,SAAK,IAAI1L,IAAI,CAAb,EAAgBA,IAAIyL,IAAIxL,MAAxB,EAAgCD,GAAhC,EAAqC;AACpC,SAAI4L,MAAMC,OAAN,CAAcJ,IAAIzL,CAAJ,CAAd,CAAJ,EAA2B;AAC1BsL,YAAMQ,OAAN,CAAcL,IAAIzL,CAAJ,CAAd,EAAsB2L,MAAtB;AACA,MAFD,MAEO;AACNA,aAAOrL,IAAP,CAAYmL,IAAIzL,CAAJ,CAAZ;AACA;AACD;AACD,WAAO2L,MAAP;AACA;;AAED;;;;;;;;;;0BAOcF,KAAK5E,KAAK;AACvB,QAAI7G,IAAIyL,IAAIjF,OAAJ,CAAYK,GAAZ,CAAR;AACA,QAAIkF,EAAJ;AACA,QAAMA,KAAK/L,KAAK,CAAhB,EAAqB;AACpBsL,WAAMU,QAAN,CAAeP,GAAf,EAAoBzL,CAApB;AACA;AACD,WAAO+L,EAAP;AACA;;AAED;;;;;;;;;4BAMgBN,KAAKzL,GAAG;AACvB,WAAO4L,MAAM3N,SAAN,CAAgBgO,MAAhB,CAAuB1N,IAAvB,CAA4BkN,GAA5B,EAAiCzL,CAAjC,EAAoC,CAApC,EAAuCC,MAAvC,KAAkD,CAAzD;AACA;;AAED;;;;;;;;;;;;;yBAUawL,KAAKS,OAAOC,SAAS;AACjC,QAAIC,SAAS,EAAb;AACA,QAAIC,MAAMlC,MAAMgC,OAAN,IAAiBA,OAAjB,GAA2BV,IAAIxL,MAAzC;AACA,SAAK,IAAID,IAAIkM,KAAb,EAAoBlM,IAAIqM,GAAxB,EAA6BrM,GAA7B,EAAkC;AACjCoM,YAAO9L,IAAP,CAAYmL,IAAIzL,CAAJ,CAAZ;AACA;AACD,WAAOoM,MAAP;AACA;;;;;0BAGad;;ACpGf;;;;;AAKA;;;AAEA,KAAIgB,QAAQ,EAAZ;;AAGA;;;;;;;AAOAA,OAAMC,cAAN,GAAuB,UAASC,SAAT,EAAoB;AAC1C;AACAF,QAAMG,QAAN,CAAe,YAAW;AACzB,SAAMD,SAAN;AACA,GAFD;AAGA,EALD;;AAQA;;;;;;;;AAQAF,OAAMhJ,GAAN,GAAY,UAASoJ,QAAT,EAAmBC,WAAnB,EAAgC;AAC3C,MAAI,CAACL,MAAMhJ,GAAN,CAAUsJ,mBAAf,EAAoC;AACnC;AACAN,SAAMG,QAAN,CAAeH,MAAMhJ,GAAN,CAAUuJ,gBAAzB;AACAP,SAAMhJ,GAAN,CAAUsJ,mBAAV,GAAgC,IAAhC;AACA;;AAEDN,QAAMhJ,GAAN,CAAUwJ,UAAV,CAAqBxM,IAArB,CACC,IAAIgM,MAAMhJ,GAAN,CAAUyJ,SAAd,CAAwBL,QAAxB,EAAkCC,WAAlC,CADD;AAEA,EATD;;AAYA;AACAL,OAAMhJ,GAAN,CAAUsJ,mBAAV,GAAgC,KAAhC;;AAGA;AACAN,OAAMhJ,GAAN,CAAUwJ,UAAV,GAAuB,EAAvB;;AAEA;;;;;AAKAR,OAAMhJ,GAAN,CAAUuJ,gBAAV,GAA6B,YAAW;AACvC;AACA,SAAOP,MAAMhJ,GAAN,CAAUwJ,UAAV,CAAqB7M,MAA5B,EAAoC;AACnC;AACA,OAAI+M,YAAYV,MAAMhJ,GAAN,CAAUwJ,UAA1B;AACAR,SAAMhJ,GAAN,CAAUwJ,UAAV,GAAuB,EAAvB;AACA,QAAK,IAAI9M,IAAI,CAAb,EAAgBA,IAAIgN,UAAU/M,MAA9B,EAAsCD,GAAtC,EAA2C;AAC1C,QAAIiN,WAAWD,UAAUhN,CAAV,CAAf;AACA,QAAI;AACHiN,cAASzJ,EAAT,CAAYjF,IAAZ,CAAiB0O,SAASC,KAA1B;AACA,KAFD,CAEE,OAAOC,CAAP,EAAU;AACXb,WAAMC,cAAN,CAAqBY,CAArB;AACA;AACD;AACD;;AAED;AACAb,QAAMhJ,GAAN,CAAUsJ,mBAAV,GAAgC,KAAhC;AACA,EAlBD;;AAqBA;;;;;;;;;AASAN,OAAMhJ,GAAN,CAAUyJ,SAAV,GAAsB,UAASvJ,EAAT,EAAa0J,KAAb,EAAoB;AACzC;AACA,OAAK1J,EAAL,GAAUA,EAAV;AACA;AACA,OAAK0J,KAAL,GAAaA,KAAb;AACA,EALD;;AAQA;;;;;;;;;AASAZ,OAAMG,QAAN,GAAiB,UAASC,QAAT,EAAmBC,WAAnB,EAAgC;AAChD,MAAIS,KAAKV,QAAT;AACA,MAAIC,WAAJ,EAAiB;AAChBS,QAAKV,SAASW,IAAT,CAAcV,WAAd,CAAL;AACA;AACDS,OAAKd,MAAMG,QAAN,CAAea,aAAf,CAA6BF,EAA7B,CAAL;AACA;AACA;AACA;AACA;AACA;AACA,MAAI,OAAOG,YAAP,KAAwB,UAA5B,EAAwC;AACvCA,gBAAaH,EAAb;AACA;AACA;AACD;AACA,MAAI,CAACd,MAAMG,QAAN,CAAee,aAApB,EAAmC;AAClClB,SAAMG,QAAN,CAAee,aAAf,GAA+BlB,MAAMG,QAAN,CAAegB,wBAAf,EAA/B;AACA;AACDnB,QAAMG,QAAN,CAAee,aAAf,CAA6BJ,EAA7B;AACA,EApBD;;AAuBA;;;;;AAKAd,OAAMG,QAAN,CAAee,aAAf,GAA+B,IAA/B;;AAGA;;;;;;AAMAlB,OAAMG,QAAN,CAAegB,wBAAf,GAA0C,YAAW;AACpD;AACA;AACA,MAAIC,OAAJ;;AAEA;AACA;AACA;AACA;AACA,MAAI,OAAOC,cAAP,KAA0B,UAA9B,EAA0C;AACzCD,aAAUC,cAAV;AACA;;AAED;AACA;AACA;AACA;AACA,MAAI,OAAOD,OAAP,KAAmB,WAAnB,IAAkC,OAAO7P,MAAP,KAAkB,WAApD,IACHA,OAAO+P,WADJ,IACmB/P,OAAOgQ,gBAD9B,EACgD;AAC/C;AACAH,aAAU,mBAAW;AACpB;AACA,QAAII,SAASC,SAASjN,aAAT,CAAuB,QAAvB,CAAb;AACAgN,WAAOxH,KAAP,CAAa0H,OAAb,GAAuB,MAAvB;AACAF,WAAOG,GAAP,GAAa,EAAb;AACAF,aAASG,eAAT,CAAyBC,WAAzB,CAAqCL,MAArC;AACA,QAAIM,MAAMN,OAAOO,aAAjB;AACA,QAAItN,MAAMqN,IAAIL,QAAd;AACAhN,QAAIuN,IAAJ;AACAvN,QAAIwN,KAAJ,CAAU,EAAV;AACAxN,QAAIyN,KAAJ;AACA,QAAIC,UAAU,kBAAkBlG,KAAKC,MAAL,EAAhC;AACA,QAAIkG,SAASN,IAAIO,QAAJ,CAAaC,QAAb,GAAwB,IAAxB,GAA+BR,IAAIO,QAAJ,CAAaE,IAAzD;AACA,QAAIC,YAAY,UAAS3B,CAAT,EAAY;AAC3B;AACA;AACA,SAAIA,EAAEuB,MAAF,KAAaA,MAAb,IAAuBvB,EAAE5N,IAAF,KAAWkP,OAAtC,EAA+C;AAC9C;AACA;AACD,UAAKM,KAAL,CAAWD,SAAX;AACA,KAPe,CAOdzB,IAPc,CAOT,IAPS,CAAhB;AAQAe,QAAIP,gBAAJ,CAAqB,SAArB,EAAgCiB,SAAhC,EAA2C,KAA3C;AACA,SAAKC,KAAL,GAAa,EAAb;AACA,SAAKC,KAAL,GAAa;AACZpB,kBAAa,uBAAW;AACvBQ,UAAIR,WAAJ,CAAgBa,OAAhB,EAAyBC,MAAzB;AACA;AAHW,KAAb;AAKA,IA5BD;AA6BA;AACD,MAAI,OAAOhB,OAAP,KAAmB,WAAvB,EAAoC;AACnC,OAAIuB,UAAU,IAAIvB,OAAJ,EAAd;AACA;AACA,OAAIwB,OAAO,EAAX;AACA,OAAIC,OAAOD,IAAX;AACAD,WAAQF,KAAR,CAAcD,SAAd,GAA0B,YAAW;AACpCI,WAAOA,KAAKpM,IAAZ;AACA,QAAIsK,KAAK8B,KAAK9B,EAAd;AACA8B,SAAK9B,EAAL,GAAU,IAAV;AACAA;AACA,IALD;AAMA,UAAO,UAASA,EAAT,EAAa;AACnB+B,SAAKrM,IAAL,GAAY;AACXsK,SAAIA;AADO,KAAZ;AAGA+B,WAAOA,KAAKrM,IAAZ;AACAmM,YAAQD,KAAR,CAAcpB,WAAd,CAA0B,CAA1B;AACA,IAND;AAOA;AACD;AACA;AACA,MAAI,OAAOG,QAAP,KAAoB,WAApB,IAAmC,wBACtCA,SAASjN,aAAT,CAAuB,QAAvB,CADD,EACmC;AAClC,UAAO,UAASsM,EAAT,EAAa;AACnB,QAAIgC,SAASrB,SAASjN,aAAT,CAAuB,QAAvB,CAAb;AACAsO,WAAOC,kBAAP,GAA4B,YAAW;AACtC;AACAD,YAAOC,kBAAP,GAA4B,IAA5B;AACAD,YAAOtP,UAAP,CAAkB0E,WAAlB,CAA8B4K,MAA9B;AACAA,cAAS,IAAT;AACAhC;AACAA,UAAK,IAAL;AACA,KAPD;AAQAW,aAASG,eAAT,CAAyBC,WAAzB,CAAqCiB,MAArC;AACA,IAXD;AAYA;AACD;AACA;AACA,SAAO,UAAShC,EAAT,EAAa;AACnBkC,cAAWlC,EAAX,EAAe,CAAf;AACA,GAFD;AAGA,EA3FD;;AA8FA;;;;;;;AAOAd,OAAMG,QAAN,CAAea,aAAf,GAA+B,UAAStD,eAAT,EAA0B;AACxD,SAAOA,eAAP;AACA,EAFD;;0BAIesC;;ACtPf;;AAEA;;;;;;;;;KAOMiD;AACL,wBAAc;AAAA;;AACb;;;;;AAKA,QAAKC,SAAL,GAAiB,KAAjB;AACA;;AAED;;;;;;;6BAGU;AACT,QAAI,CAAC,KAAKA,SAAV,EAAqB;AACpB,UAAKC,eAAL;AACA,UAAKD,SAAL,GAAiB,IAAjB;AACA;AACD;;AAED;;;;;;;;qCAKkB,CAAE;;AAEpB;;;;;;;gCAIa;AACZ,WAAO,KAAKA,SAAZ;AACA;;;;;+BAGaD;;AC7Cf;;;KAEMG;;;;;;;;AACL;;;;;;yBAMaC,QAAQ;AACpB,QAAI/Q,GAAJ,EAASgR,MAAT;AACA,SAAK,IAAI5P,IAAI,CAAb,EAAgBA,IAAI0H,UAAUzH,MAA9B,EAAsCD,GAAtC,EAA2C;AAC1C4P,cAASlI,UAAU1H,CAAV,CAAT;AACA,UAAKpB,GAAL,IAAYgR,MAAZ,EAAoB;AACnBD,aAAO/Q,GAAP,IAAcgR,OAAOhR,GAAP,CAAd;AACA;AACD;AACD,WAAO+Q,MAAP;AACA;;AAED;;;;;;;;;;mCAOuBxP,MAAM0P,SAAS;AACrC,QAAI3C,QAAQ2C,WAAWhS,MAAvB;AACA,QAAIiS,QAAQ3P,KAAK4P,KAAL,CAAW,GAAX,CAAZ;AACA,WAAOD,MAAME,MAAN,CAAa,UAACC,IAAD,EAAOrR,GAAP;AAAA,YAAeqR,KAAKrR,GAAL,CAAf;AAAA,KAAb,EAAuCsO,KAAvC,CAAP;AACA;;AAED;;;;;;;;;;uBAOWrG,KAAKrD,IAAI;AACnB,QAAI0M,YAAY,EAAhB;AACA,QAAIC,OAAOnS,OAAOmS,IAAP,CAAYtJ,GAAZ,CAAX;AACA,SAAK,IAAI7G,IAAI,CAAb,EAAgBA,IAAImQ,KAAKlQ,MAAzB,EAAiCD,GAAjC,EAAsC;AACrCkQ,eAAUC,KAAKnQ,CAAL,CAAV,IAAqBwD,GAAG2M,KAAKnQ,CAAL,CAAH,EAAY6G,IAAIsJ,KAAKnQ,CAAL,CAAJ,CAAZ,CAArB;AACA;AACD,WAAOkQ,SAAP;AACA;;AAED;;;;;;;;gCAKoBE,MAAMC,MAAM;AAC/B,QAAID,SAASC,IAAb,EAAmB;AAClB,YAAO,IAAP;AACA;;AAED,QAAIC,QAAQtS,OAAOmS,IAAP,CAAYC,IAAZ,CAAZ;AACA,QAAIG,QAAQvS,OAAOmS,IAAP,CAAYE,IAAZ,CAAZ;AACA,QAAIC,MAAMrQ,MAAN,KAAiBsQ,MAAMtQ,MAA3B,EAAmC;AAClC,YAAO,KAAP;AACA;;AAED,SAAK,IAAID,IAAI,CAAb,EAAgBA,IAAIsQ,MAAMrQ,MAA1B,EAAkCD,GAAlC,EAAuC;AACtC,SAAIoQ,KAAKE,MAAMtQ,CAAN,CAAL,MAAmBqQ,KAAKC,MAAMtQ,CAAN,CAAL,CAAvB,EAAuC;AACtC,aAAO,KAAP;AACA;AACD;AACD,WAAO,IAAP;AACA;;;;;2BAGa0P;;AC1Ef;;;KAEMc;;;;;;;;AACL;;;;;;;0CAO8BhH,KAAK;AAClC,WAAOA,IAAIiH,OAAJ,CAAY,aAAZ,EAA2B,GAA3B,EAAgCA,OAAhC,CAAwC,0BAAxC,EAAoE,EAApE,CAAP;AACA;;AAED;;;;;;;;;+BAMmBjH,KAAK;AACvB,WAAOuB,OAAOvB,GAAP,EACLiH,OADK,CACG,+BADH,EACoC,MADpC,EAELA,OAFK,CAEG,OAFH,EAEY,OAFZ,CAAP;AAGA;;AAED;;;;;;;qCAIyB;AACxB,QAAIC,IAAI,UAAR;AACA,WAAOnI,KAAKoI,KAAL,CAAWpI,KAAKC,MAAL,KAAgBkI,CAA3B,EAA8BjH,QAA9B,CAAuC,EAAvC,IACNlB,KAAKqI,GAAL,CAASrI,KAAKoI,KAAL,CAAWpI,KAAKC,MAAL,KAAgBkI,CAA3B,IAAgCG,KAAKC,GAAL,EAAzC,EAAqDrH,QAArD,CAA8D,EAA9D,CADD;AAEA;;AAED;;;;;;;;;;;;4BASgBS,KAAK;AACpB,QAAI6G,OAAO,CAAX;AACA,SAAK,IAAI/Q,IAAI,CAAR,EAAWgR,MAAM9G,IAAIjK,MAA1B,EAAkCD,IAAIgR,GAAtC,EAA2ChR,GAA3C,EAAgD;AAC/C+Q,YAAO,KAAKA,IAAL,GAAY7G,IAAI+G,UAAJ,CAAejR,CAAf,CAAnB;AACA+Q,aAAQ,WAAR;AACA;AACD,WAAOA,IAAP;AACA;;AAED;;;;;;;;;;;;mCASuBvH,KAAK0C,OAAOG,KAAKjM,OAAO;AAC9C,WAAOoJ,IAAIE,SAAJ,CAAc,CAAd,EAAiBwC,KAAjB,IAA0B9L,KAA1B,GAAkCoJ,IAAIE,SAAJ,CAAc2C,GAAd,CAAzC;AACA;;;;;2BAGamE;;ACpEf;;;MAEOnF;MACAC;MACAgB;MACAiD;MACAG;MACAc;;;;;yCAGElF;yCAAOgB;8CAAOiD;0CAAYG;0CAAQc;2BAC5BnF;;ACXf;;;AAEA,KAAM6F,aAAa,gBAAnB;;KAEMC;;;;;;;;AACL;;;;;uBAKWC,SAAS;AACnB,QAAI,CAACA,QAAQF,UAAR,CAAL,EAA0B;AACzBE,aAAQF,UAAR,IAAsB;AACrBG,kBAAY,EADS;AAErBC,iBAAW;AAFU,MAAtB;AAIA;AACD,WAAOF,QAAQF,UAAR,CAAP;AACA;;;;;4BAGaC;;ACrBf;;;KAES5B;;AAET;;;;;;;;;;;;;KAYMgC;;;AACL,uBAAYC,OAAZ,EAAqBC,KAArB,EAA4BC,QAA5B,EAAsC;AAAA;;AAGrC;;;;;AAHqC;;AAQrC,SAAKC,QAAL,GAAgBH,OAAhB;;AAEA;;;;;AAKA,SAAKI,MAAL,GAAcH,KAAd;;AAEA;;;;;AAKA,SAAKI,SAAL,GAAiBH,QAAjB;AAtBqC;AAuBrC;;AAED;;;;;;;;qCAIkB;AACjB,SAAKI,cAAL;AACA,SAAKH,QAAL,GAAgB,IAAhB;AACA,SAAKE,SAAL,GAAiB,IAAjB;AACA;;AAED;;;;;;oCAGiB;AAChB,QAAI,CAAC,KAAKF,QAAL,CAAcI,UAAd,EAAL,EAAiC;AAChC,UAAKJ,QAAL,CAAcG,cAAd,CAA6B,KAAKF,MAAlC,EAA0C,KAAKC,SAA/C;AACA;AACD;;;GA3CwBtC;;gCA8CXgC;;AC9Df;;;KAESjG;KAAOiE;KAAY/E;KAAYM;KACjCyG;;AAEP;;;;;;KAKMS;;;AACL,0BAAc;AAAA;;AAGb;;;;;AAHa;;AAQb,SAAKC,OAAL,GAAe,EAAf;;AAEA;;;;;;AAMA,SAAKC,aAAL,GAAqB,EAArB;;AAEA;;;;;;;AAOA,SAAKC,gBAAL,GAAwB,KAAxB;AAzBa;AA0Bb;;AAED;;;;;;;;;;;;;+BASYC,QAAQV,UAAUW,aAAa;AAC1C,SAAKC,iBAAL,CAAuBZ,QAAvB;;AAEAU,aAAS,KAAKG,gBAAL,CAAsBH,MAAtB,CAAT;AACA,SAAK,IAAIpS,IAAI,CAAb,EAAgBA,IAAIoS,OAAOnS,MAA3B,EAAmCD,GAAnC,EAAwC;AACvC,UAAKwS,kBAAL,CAAwBJ,OAAOpS,CAAP,CAAxB,EAAmC0R,QAAnC,EAA6CW,WAA7C;AACA;;AAED,WAAO,IAAId,WAAJ,CAAgB,IAAhB,EAAsBa,MAAtB,EAA8BV,QAA9B,CAAP;AACA;;AAED;;;;;;;;;;;;;;;sCAYmBD,OAAOC,UAAUW,aAAaI,YAAY;AAC5D,SAAKC,IAAL,CAAU,aAAV,EAAyBjB,KAAzB,EAAgCC,QAAhC;;AAEA,QAAI,CAAC,KAAKO,OAAL,CAAaR,KAAb,CAAL,EAA0B;AACzB,UAAKQ,OAAL,CAAaR,KAAb,IAAsB,EAAtB;AACA;AACD,SAAKQ,OAAL,CAAaR,KAAb,EAAoBnR,IAApB,CAAyB;AACxBsF,cAASyM,WADe;AAExB7O,SAAIkO,QAFoB;AAGxBhD,aAAQ+D;AAHgB,KAAzB;;AAMA,QAAInB,YAAY,KAAKW,OAAL,CAAaR,KAAb,CAAhB;AACA,QAAIH,UAAUrR,MAAV,GAAmB,KAAKiS,aAAxB,IAAyC,CAACZ,UAAUqB,MAAxD,EAAgE;AAC/DC,aAAQC,IAAR,CACC,oEACA,gEAFD,EAGCvB,UAAUrR,MAHX,EAICwR,KAJD;AAMAH,eAAUqB,MAAV,GAAmB,IAAnB;AACA;AACD;;AAED;;;;;;;qCAIkB;AACjB,SAAKV,OAAL,GAAe,EAAf;AACA;;AAED;;;;;;;;;wBAMKR,OAAO;AACX,QAAIqB,OAAOxH,MAAMyH,KAAN,CAAYrL,SAAZ,EAAuB,CAAvB,CAAX;AACA,QAAI4J,YAAY,CAAC,KAAKW,OAAL,CAAaR,KAAb,KAAuB,EAAxB,EAA4BuB,MAA5B,EAAhB;;AAEA,QAAIC,MAAJ;AACA,QAAI,KAAKC,kBAAL,EAAJ,EAA+B;AAC9BD,cAAS;AACRE,sBAAgB,0BAAW;AAC1BF,cAAOG,gBAAP,GAA0B,IAA1B;AACA,OAHO;AAIRzD,cAAQ,IAJA;AAKR5I,YAAM0K;AALE,MAAT;AAOAqB,UAAKxS,IAAL,CAAU2S,MAAV;AACA;;AAED,QAAII,mBAAmB,EAAvB;AACA,SAAK,IAAIrT,IAAI,CAAb,EAAgBA,IAAIsR,UAAUrR,MAA9B,EAAsCD,GAAtC,EAA2C;AAC1C,SAAIsR,UAAUtR,CAAV,EAAa4F,OAAjB,EAA0B;AACzByN,uBAAiB/S,IAAjB,CAAsBgR,UAAUtR,CAAV,CAAtB;AACA,MAFD,MAEO;AACNsR,gBAAUtR,CAAV,EAAawD,EAAb,CAAgBuE,KAAhB,CAAsB,IAAtB,EAA4B+K,IAA5B;AACA;AACD;AACD,QAAI,CAACG,MAAD,IAAW,CAACA,OAAOG,gBAAvB,EAAyC;AACxC,UAAK,IAAI3L,IAAI,CAAb,EAAgBA,IAAI4L,iBAAiBpT,MAArC,EAA6CwH,GAA7C,EAAkD;AACjD4L,uBAAiB5L,CAAjB,EAAoBjE,EAApB,CAAuBuE,KAAvB,CAA6B,IAA7B,EAAmC+K,IAAnC;AACA;AACD;;AAGD,QAAIrB,UAAU,GAAd,EAAmB;AAClB,UAAKiB,IAAL,CAAU3K,KAAV,CAAgB,IAAhB,EAAsB,CAAC,GAAD,EAAM0J,KAAN,EAAauB,MAAb,CAAoBF,IAApB,CAAtB;AACA;;AAED,WAAOxB,UAAUrR,MAAV,GAAmB,CAA1B;AACA;;AAED;;;;;;;;;wCAMqB;AACpB,WAAO,KAAKkS,gBAAZ;AACA;;AAED;;;;;;;;6BAKUV,OAAO;AAChB,WAAO,CAAC,KAAKQ,OAAL,CAAaR,KAAb,KAAuB,EAAxB,EAA4BpT,GAA5B,CAAgC;AAAA,YAAYqT,SAASlO,EAArB;AAAA,KAAhC,CAAP;AACA;;AAED;;;;;;;;;;;;;wBAUK4O,QAAQkB,QAAQ5B,UAAU;AAC9BU,aAAS,KAAKG,gBAAL,CAAsBH,MAAtB,CAAT;AACA,SAAK,IAAIpS,IAAI,CAAb,EAAgBA,IAAIoS,OAAOnS,MAA3B,EAAmCD,GAAnC,EAAwC;AACvC,UAAKuT,KAAL,CAAWnB,OAAOpS,CAAP,CAAX,EAAsBsT,MAAtB,EAA8B5B,QAA9B;AACA;;AAED,WAAO,IAAIH,WAAJ,CAAgB,IAAhB,EAAsBa,MAAtB,EAA8BV,QAA9B,CAAP;AACA;;AAED;;;;;;;;;;;;;yBAUMD,OAAO6B,QAAQ5B,UAAU;AAC9B,QAAI8B,OAAO,IAAX;;AAEA,QAAIF,UAAU,CAAd,EAAiB;AAChB;AACA;;AAED,aAASG,eAAT,GAA2B;AAC1B,SAAI,EAAEH,MAAF,KAAa,CAAjB,EAAoB;AACnBE,WAAK1B,cAAL,CAAoBL,KAApB,EAA2BgC,eAA3B;AACA;AACD/B,cAAS3J,KAAT,CAAeyL,IAAf,EAAqB9L,SAArB;AACA;;AAED8L,SAAKhB,kBAAL,CAAwBf,KAAxB,EAA+BgC,eAA/B,EAAgD,KAAhD,EAAuD/B,QAAvD;AACA;;AAED;;;;;;;;;;;oCAQiBgC,aAAahC,UAAU;AACvC,WAAOgC,YAAYlQ,EAAZ,KAAmBkO,QAAnB,IACLgC,YAAYhF,MAAZ,IAAsBgF,YAAYhF,MAAZ,KAAuBgD,QAD/C;AAEA;;AAED;;;;;;;;;oCAMiBU,QAAQ;AACxB,WAAOtH,SAASsH,MAAT,IAAmB,CAACA,MAAD,CAAnB,GAA8BA,MAArC;AACA;;AAED;;;;;;;;;;uBAOIA,QAAQV,UAAU;AACrB,SAAKY,iBAAL,CAAuBZ,QAAvB;;AAEAU,aAAS,KAAKG,gBAAL,CAAsBH,MAAtB,CAAT;AACA,SAAK,IAAIpS,IAAI,CAAb,EAAgBA,IAAIoS,OAAOnS,MAA3B,EAAmCD,GAAnC,EAAwC;AACvC,SAAI2T,eAAe,KAAK1B,OAAL,CAAaG,OAAOpS,CAAP,CAAb,KAA2B,EAA9C;AACA,UAAK4T,2BAAL,CAAiCD,YAAjC,EAA+CjC,QAA/C;AACA;;AAED,WAAO,IAAP;AACA;;AAED;;;;;;;;;wBAMK;AACJ,WAAO,KAAKmC,WAAL,CAAiB9L,KAAjB,CAAuB,IAAvB,EAA6BL,SAA7B,CAAP;AACA;;AAED;;;;;;;;;;wBAOK0K,QAAQV,UAAU;AACtB,WAAO,KAAKoC,IAAL,CAAU1B,MAAV,EAAkB,CAAlB,EAAqBV,QAArB,CAAP;AACA;;AAED;;;;;;;;;;sCAOmBqC,YAAY;AAC9B,QAAIA,UAAJ,EAAgB;AACf,SAAI3B,SAAS,KAAKG,gBAAL,CAAsBwB,UAAtB,CAAb;AACA,UAAK,IAAI/T,IAAI,CAAb,EAAgBA,IAAIoS,OAAOnS,MAA3B,EAAmCD,GAAnC,EAAwC;AACvC,WAAKiS,OAAL,CAAaG,OAAOpS,CAAP,CAAb,IAA0B,IAA1B;AACA;AACD,KALD,MAKO;AACN,UAAKiS,OAAL,GAAe,EAAf;AACA;AACD,WAAO,IAAP;AACA;;AAED;;;;;;;;;;+CAO4B0B,cAAcjC,UAAU;AACnD,SAAK,IAAI1R,IAAI2T,aAAa1T,MAAb,GAAsB,CAAnC,EAAsCD,KAAK,CAA3C,EAA8CA,GAA9C,EAAmD;AAClD,SAAI,KAAKgU,gBAAL,CAAsBL,aAAa3T,CAAb,CAAtB,EAAuC0R,QAAvC,CAAJ,EAAsD;AACrDiC,mBAAa1H,MAAb,CAAoBjM,CAApB,EAAuB,CAAvB;AACA;AACD;AACD;;AAED;;;;;;;;;;oCAOiB;AAChB,WAAO,KAAKiU,GAAL,CAASlM,KAAT,CAAe,IAAf,EAAqBL,SAArB,CAAP;AACA;;AAED;;;;;;;;;;;mCAQgBwM,KAAK;AACpB,SAAKhC,aAAL,GAAqBgC,GAArB;AACA,WAAO,IAAP;AACA;;AAED;;;;;;;;;;sCAOmBC,iBAAiB;AACnC,SAAKhC,gBAAL,GAAwBgC,eAAxB;AACA,WAAO,IAAP;AACA;;AAED;;;;;;;;qCAKkBzC,UAAU;AAC3B,QAAI,CAAClH,WAAWkH,QAAX,CAAL,EAA2B;AAC1B,WAAM,IAAI0C,SAAJ,CAAc,6BAAd,CAAN;AACA;AACD;;;GAxVyB7E;;iCA2VZyC;;ACrWf;;;KAES1G;KAAOoE;KAAQH;;AAExB;;;;;;;;;;;;;;;KAcM8E;;;AACL,6BAAYC,aAAZ,EAA2BC,aAA3B,EAA0CC,aAA1C,EAAyDC,aAAzD,EAAwE;AAAA;;AAGvE;;;;;AAHuE;;AAQvE,SAAKC,UAAL,GAAkBhF,OAAOiF,KAAP,CAAa;AAC9BC,iBAAa;AADiB,IAAb,EAEfJ,aAFe,CAAlB;;AAIA;;;;;;AAMA,SAAKK,cAAL,GAAsBP,aAAtB;;AAEA;;;;;;;AAOA,SAAKQ,cAAL,GAAsB,EAAtB;;AAEA;;;;;AAKA,SAAKC,cAAL,GAAsB,EAAtB;;AAEA;;;;;;AAMA,SAAKC,cAAL,GAAsBT,aAAtB;;AAEA;;;;;AAKA,SAAKU,UAAL,GAAkBR,aAAlB;;AAEA,SAAKS,WAAL;AAnDuE;AAoDvE;;AAED;;;;;;;;;;;gCAOazD,OAAOC,UAAU;AAC7B,WAAO,KAAKmD,cAAL,CAAoBM,EAApB,CAAuB1D,KAAvB,EAA8BC,QAA9B,CAAP;AACA;;AAED;;;;;;;;;wCAMqBD,OAAO;AAC3B,WAAO,KAAK2D,YAAL,CAAkB3D,KAAlB,EAAyB,KAAK4D,aAAL,CAAmBhI,IAAnB,CAAwB,IAAxB,EAA8BoE,KAA9B,CAAzB,CAAP;AACA;;AAED;;;;;;qCAGkB;AACjB,SAAK6D,gBAAL;AACA,SAAKP,cAAL,GAAsB,IAAtB;AACA,SAAKF,cAAL,GAAsB,IAAtB;AACA,SAAKG,cAAL,GAAsB,IAAtB;AACA;;AAED;;;;;;;;iCAKcO,WAAW;AACxB,QAAIzC,OAAO,CAACyC,SAAD,EAAYvC,MAAZ,CAAmB1H,MAAMyH,KAAN,CAAYrL,SAAZ,EAAuB,CAAvB,CAAnB,CAAX;AACA,SAAKsN,cAAL,CAAoBtC,IAApB,CAAyB3K,KAAzB,CAA+B,KAAKiN,cAApC,EAAoDlC,IAApD;AACA;;AAED;;;;;;;8BAIWrB,OAAO;AACjB,QAAI,KAAK+D,iBAAL,CAAuB/D,KAAvB,CAAJ,EAAmC;AAClC,UAAKgE,iBAAL,CAAuBhE,KAAvB;AACA;AACD;;AAED;;;;;;;sCAImB;AAClB,QAAIW,SAASpU,OAAOmS,IAAP,CAAY,KAAK4E,cAAjB,CAAb;AACA,SAAK,IAAI/U,IAAI,CAAb,EAAgBA,IAAIoS,OAAOnS,MAA3B,EAAmCD,GAAnC,EAAwC;AACvC,UAAK+U,cAAL,CAAoB3C,OAAOpS,CAAP,CAApB,EAA+B8R,cAA/B;AACA;AACD,SAAKiD,cAAL,GAAsB,EAAtB;AACA,SAAKD,cAAL,GAAsB,EAAtB;AACA;;AAED;;;;;;;;;oCAMiBR,eAAe;AAAA;;AAC/B,QAAIlC,SAAS,KAAKyC,cAAL,GACZ7W,OAAOmS,IAAP,CAAY,KAAK4E,cAAjB,CADY,GAEZ,KAAKD,cAFN;AAGA,SAAKQ,gBAAL;AACA,SAAKT,cAAL,GAAsBP,aAAtB;AACAlC,WAAOsD,OAAP,CAAe;AAAA,YAAS,OAAKC,UAAL,CAAgBlE,KAAhB,CAAT;AAAA,KAAf;AACA;;AAED;;;;;;;;;qCAMkBA,OAAO;AACxB,QAAI,KAAKwD,UAAL,IAAmB,CAAC,KAAKA,UAAL,CAAgBxD,KAAhB,CAAxB,EAAgD;AAC/C,YAAO,KAAP;AACA;AACD,QAAI,KAAKiD,UAAL,CAAgBjD,KAAhB,CAAJ,EAA4B;AAC3B,YAAO,KAAP;AACA;AACD,WAAO,CAAC,KAAKsD,cAAL,CAAoBtD,KAApB,CAAR;AACA;;AAED;;;;;;;iCAIc;AACb,SAAKuD,cAAL,CAAoBG,EAApB,CAAuB,aAAvB,EAAsC,KAAKQ,UAAL,CAAgBtI,IAAhB,CAAqB,IAArB,CAAtC;AACA;;AAED;;;;;;;;;qCAMkBoE,OAAO;AACxB,QAAI,KAAKoD,cAAT,EAAyB;AACxB,UAAKE,cAAL,CAAoBtD,KAApB,IAA6B,KAAKmE,oBAAL,CAA0BnE,KAA1B,CAA7B;AACA,KAFD,MAEO;AACN,UAAKqD,cAAL,CAAoBxU,IAApB,CAAyBmR,KAAzB;AACA;AACD;;;GA1K8BlC;;sCA6KjB8E;;AC/Lf;;;KAES9E;;AAET;;;;;;;KAMMsG;;;AACL,0BAAc;AAAA;;AAGb;;;;;;AAHa;;AASb,SAAKC,aAAL,GAAqB,EAArB;AATa;AAUb;;AAED;;;;;;;;;yBAKM;AACL,SAAK,IAAI9V,IAAI,CAAb,EAAgBA,IAAI0H,UAAUzH,MAA9B,EAAsCD,GAAtC,EAA2C;AAC1C,UAAK8V,aAAL,CAAmBxV,IAAnB,CAAwBoH,UAAU1H,CAAV,CAAxB;AACA;AACD;;AAED;;;;;;;qCAIkB;AACjB,SAAK8V,aAAL,GAAqB,IAArB;AACA;;AAED;;;;;;wCAGqB;AACpB,SAAK,IAAI9V,IAAI,CAAb,EAAgBA,IAAI,KAAK8V,aAAL,CAAmB7V,MAAvC,EAA+CD,GAA/C,EAAoD;AACnD,UAAK8V,aAAL,CAAmB9V,CAAnB,EAAsB8R,cAAtB;AACA;;AAED,SAAKgE,aAAL,GAAqB,EAArB;AACA;;;GAzCyBvG;;iCA4CZsG;;ACtDf;;;MAEO7D;MACAqC;MACA9C;MACAsE;4BAEQ7D;;iDACNA;sDAAcqC;gDAAmB9C;iDAAasE;;ACRvD;;;KAESvK;KAAOR;KACTqG;KACEI;;AAET;;;;;;KAKMwE;;;AACL;;;;;;;;;AASA,mCAAYvE,OAAZ,EAAqBC,KAArB,EAA4BC,QAA5B,EAAsCsE,YAAtC,EAAoD;AAAA;;AAAA,6JAC7CxE,OAD6C,EACpCC,KADoC,EAC7BC,QAD6B;;AAEnD,SAAKuE,SAAL,GAAiBD,YAAjB;AAFmD;AAGnD;;AAED;;;;;;;oCAGiB;AAChB,QAAIzW,OAAO4R,QAAQ+E,GAAR,CAAY,KAAKvE,QAAjB,CAAX;AACA,QAAIwE,WAAW,KAAKF,SAApB;AACA,QAAIxK,MAAMX,SAASqL,QAAT,IAAqB5W,KAAK8R,UAAL,CAAgB,KAAKO,MAArB,EAA6BwE,SAAlD,GAA8D7W,KAAK+R,SAA7E;AACA,QAAI1S,MAAMkM,SAASqL,QAAT,IAAqBA,QAArB,GAAgC,KAAKvE,MAA/C;;AAEAtG,UAAM+K,MAAN,CAAa5K,IAAI7M,GAAJ,KAAY,EAAzB,EAA6B,KAAKiT,SAAlC;AACA,QAAIpG,IAAI7M,GAAJ,KAAY6M,IAAI7M,GAAJ,EAASqB,MAAT,KAAoB,CAApC,EAAuC;AACtC,YAAOwL,IAAI7M,GAAJ,CAAP;AACA;AACD;;;GA5BoC2S;;4CA+BvBwE;;AC1Cf;;;KAESxE;;AAET;;;;;;KAKM+E;;;AACL;;;;;;;;;AASA,0BAAY9E,OAAZ,EAAqBC,KAArB,EAA4BC,QAA5B,EAAsC6E,WAAtC,EAAmD;AAAA;;AAAA,2IAC5C/E,OAD4C,EACnCC,KADmC,EAC5BC,QAD4B;;AAElD,SAAK8E,QAAL,GAAgBD,WAAhB;AAFkD;AAGlD;;AAED;;;;;;;oCAGiB;AAChB,SAAK5E,QAAL,CAAc8E,mBAAd,CAAkC,KAAK7E,MAAvC,EAA+C,KAAKC,SAApD,EAA+D,KAAK2E,QAApE;AACA;;;GApB2BjF;;mCAuBd+E;;AChCf;;;KAESnM;KAAOG;KAAY5K;KAAWiL;KAAUG;KAAU4E;KACpDyB;KACA4E;KACAO;;;AAEP,KAAMI,iBAAiB,EAAvB;AACO,KAAMC,eAAe,EAArB;;;kDAAMA;AAEb,KAAMC,cAAc,uBAApB;AACA,KAAMC,cAAc;AACnBC,QAAM,IADa;AAEnBC,SAAO,IAFY;AAGnBC,SAAO,IAHY;AAInBC,WAAS,IAJU;AAKnBC,QAAM,IALa;AAMnBC,UAAQ;AANW,EAApB;;AASA;;;;;AAKO,UAASC,UAAT,CAAoBC,QAApB,EAA8BC,OAA9B,EAAuC;AAC7C,MAAI,CAAC3M,SAAS0M,QAAT,CAAD,IAAuB,CAACvM,SAASwM,OAAT,CAA5B,EAA+C;AAC9C;AACA;;AAED,MAAI,CAACD,SAASpX,MAAd,EAAsB;AACrBoX,cAAW,CAACA,QAAD,CAAX;AACA;;AAED,OAAK,IAAIrX,IAAI,CAAb,EAAgBA,IAAIqX,SAASpX,MAA7B,EAAqCD,GAArC,EAA0C;AACzC,OAAI,eAAeqX,SAASrX,CAAT,CAAnB,EAAgC;AAC/BuX,0BAAsBF,SAASrX,CAAT,CAAtB,EAAmCsX,OAAnC;AACA,IAFD,MAEO;AACNE,6BAAyBH,SAASrX,CAAT,CAAzB,EAAsCsX,OAAtC;AACA;AACD;AACD;;gDAhBeF,YAkBhB;;;;;;;AAMA,UAASG,qBAAT,CAA+BnG,OAA/B,EAAwCkG,OAAxC,EAAiD;AAChDA,UAAQvH,KAAR,CAAc,GAAd,EAAmB2F,OAAnB,CAA2B,UAAS+B,SAAT,EAAoB;AAC9C,OAAIA,SAAJ,EAAe;AACdrG,YAAQsG,SAAR,CAAkBC,GAAlB,CAAsBF,SAAtB;AACA;AACD,GAJD;AAKA;;AAED;;;;;;AAMA,UAASD,wBAAT,CAAkCpG,OAAlC,EAA2CkG,OAA3C,EAAoD;AACnD,MAAIM,mBAAmB,MAAMxG,QAAQqG,SAAd,GAA0B,GAAjD;AACA,MAAII,kBAAkB,EAAtB;;AAEAP,YAAUA,QAAQvH,KAAR,CAAc,GAAd,CAAV;;AAEA,OAAK,IAAI/P,IAAI,CAAb,EAAgBA,IAAIsX,QAAQrX,MAA5B,EAAoCD,GAApC,EAAyC;AACxC,OAAIyX,YAAYH,QAAQtX,CAAR,CAAhB;;AAEA,OAAI4X,iBAAiBpR,OAAjB,CAAyB,MAAMiR,SAAN,GAAkB,GAA3C,MAAoD,CAAC,CAAzD,EAA4D;AAC3DI,uBAAmB,MAAMJ,SAAzB;AACA;AACD;;AAED,MAAII,eAAJ,EAAqB;AACpBzG,WAAQqG,SAAR,GAAoBrG,QAAQqG,SAAR,GAAoBI,eAAxC;AACA;AACD;;AAED;;;;;;;AAOA,UAASC,mBAAT,CAA6B1G,OAA7B,EAAsC2G,SAAtC,EAAiDrG,QAAjD,EAA2D;AAC1D,MAAInS,OAAO4R,QAAQ+E,GAAR,CAAY9E,OAAZ,CAAX;AACA4G,YAAUzY,KAAK+R,SAAf,EAA0ByG,SAA1B,EAAqCrG,QAArC;AACA;;AAED;;;;;;;;;AASA,UAASuG,oBAAT,CAA8B7G,OAA9B,EAAuC2G,SAAvC,EAAkD5B,QAAlD,EAA4DzE,QAA5D,EAAsE;AACrE,MAAInS,OAAO4R,QAAQ+E,GAAR,CAAY9E,OAAZ,CAAX;AACA4G,YAAUzY,KAAK8R,UAAL,CAAgB0G,SAAhB,EAA2B3B,SAArC,EAAgDD,QAAhD,EAA0DzE,QAA1D;AACA;;AAED;;;;;;;;AAQA,UAASsG,SAAT,CAAmBvM,GAAnB,EAAwB7M,GAAxB,EAA6BwB,KAA7B,EAAoC;AACnC,MAAI,CAACqL,IAAI7M,GAAJ,CAAL,EAAe;AACd6M,OAAI7M,GAAJ,IAAW,EAAX;AACA;AACD6M,MAAI7M,GAAJ,EAAS0B,IAAT,CAAcF,KAAd;AACA;;AAED;;;;;;AAMA,UAAS8X,oBAAT,CAA8B9G,OAA9B,EAAuC2G,SAAvC,EAAkD;AACjD,MAAIxY,OAAO4R,QAAQ+E,GAAR,CAAY9E,OAAZ,CAAX;AACA,MAAI,CAAC7R,KAAK8R,UAAL,CAAgB0G,SAAhB,CAAL,EAAiC;AAChCxY,QAAK8R,UAAL,CAAgB0G,SAAhB,IAA6B;AAC5BI,YAAQhD,GACP/D,OADO,EAEP2G,SAFO,EAGPK,oBAHO,EAIP,CAAC,CAACvB,YAAYkB,SAAZ,CAJK,CADoB;AAO5B3B,eAAW;AAPiB,IAA7B;AASA;AACD;;AAED;;;;;;;AAOO,UAASiC,OAAT,CAAiBjH,OAAjB,EAA0B+E,QAA1B,EAAoC;AAC1C,SAAO/E,WAAW,CAACkH,MAAMlH,OAAN,EAAe+E,QAAf,CAAnB,EAA6C;AAC5C/E,aAAUA,QAAQtR,UAAlB;AACA;AACD,SAAOsR,OAAP;AACA;;6CALeiH,SAOhB;;;;;;;;;AAQO,UAASE,MAAT,CAAgB3X,MAAhB,EAAwBL,KAAxB,EAA+B;AACrC,MAAIuK,SAASvK,KAAT,CAAJ,EAAqB;AACpBA,WAAQiY,cAAcjY,KAAd,CAAR;AACA;AACD,MAAIA,iBAAiBkY,QAArB,EAA+B;AAC9B,OAAIC,WAAW9M,MAAM3N,SAAN,CAAgB8U,KAAhB,CAAsBxU,IAAtB,CAA2BgC,KAA3B,CAAf;AACA,QAAK,IAAIP,IAAI,CAAb,EAAgBA,IAAI0Y,SAASzY,MAA7B,EAAqCD,GAArC,EAA0C;AACzCY,WAAOuN,WAAP,CAAmBuK,SAAS1Y,CAAT,CAAnB;AACA;AACD,GALD,MAKO;AACNY,UAAOuN,WAAP,CAAmB5N,KAAnB;AACA;AACD,SAAOA,KAAP;AACA;;4CAbegY,QAehB;;;;;;AAKO,UAASC,aAAT,CAAuBG,UAAvB,EAAmC;AACzC,MAAIC,UAAU7K,SAASjN,aAAT,CAAuB,KAAvB,CAAd;AACA8X,UAAQC,SAAR,GAAoB,SAASF,UAA7B;AACAC,UAAQpU,WAAR,CAAoBoU,QAAQpY,UAA5B;;AAEA,MAAIsY,WAAW/K,SAASgL,sBAAT,EAAf;AACA,SAAOH,QAAQpY,UAAf,EAA2B;AAC1BsY,YAAS3K,WAAT,CAAqByK,QAAQpY,UAA7B;AACA;AACD,SAAOsY,QAAP;AACA;;mDAVeN,eAYhB;;;;;;;AAMO,UAAS9V,QAAT,CAAkBsW,QAAlB,EAA4BC,QAA5B,EAAsC;AAC5C,MAAI3O,WAAW0O,QAAX,CAAJ,EAA0B;AACzB;AACA,UAAOA,SAAS9K,eAAT,CAAyBxL,QAAzB,CAAkCuW,QAAlC,CAAP;AACA,GAHD,MAGO;AACN,UAAOD,SAAStW,QAAT,CAAkBuW,QAAlB,CAAP;AACA;AACD;;8CAPevW,UAShB;;;;;;;;;;;;;;;;;AAgBO,UAASwW,QAAT,CAAkB9H,OAAlB,EAA2B2G,SAA3B,EAAsCoB,gBAAtC,EAAwDzM,QAAxD,EAAkE2F,WAAlE,EAA+E;AACrF,MAAI+G,eAAezC,aAAaoB,SAAb,CAAnB;AACA,MAAIqB,gBAAgBA,aAAaF,QAAjC,EAA2C;AAC1CnB,eAAYqB,aAAaC,aAAzB;AACA3M,cAAW0M,aAAaE,OAAb,CAAqBjM,IAArB,CAA0B+L,YAA1B,EAAwC1M,QAAxC,CAAX;AACA;;AAED,MAAI2F,WAAJ,EAAiB;AAChB;AACA3F,cAAWA,SAASW,IAAT,EAAX;AACAX,YAAS6M,gBAAT,GAA4B,IAA5B;AACA;;AAEDrB,uBAAqB9G,OAArB,EAA8B2G,SAA9B;AACA,MAAIjN,SAASqO,gBAAT,CAAJ,EAAgC;AAC/BlB,wBAAqB7G,OAArB,EAA8B2G,SAA9B,EAAyCoB,gBAAzC,EAA2DzM,QAA3D;AACA,GAFD,MAEO;AACNoL,uBAAoBqB,gBAApB,EAAsCpB,SAAtC,EAAiDrL,QAAjD;AACA;;AAED,SAAO,IAAIqJ,uBAAJ,CACNjL,SAASqO,gBAAT,IAA6B/H,OAA7B,GAAuC+H,gBADjC,EAENpB,SAFM,EAGNrL,QAHM,EAIN5B,SAASqO,gBAAT,IAA6BA,gBAA7B,GAAgD,IAJ1C,CAAP;AAMA;;8CA1BeD,UA4BhB;;;;;;;;AAOA,UAASM,qBAAT,CAA+Bla,IAA/B,EAAqCyY,SAArC,EAAgD0B,YAAhD,EAA8D;AAC7D,MAAIA,gBAAgB1B,cAAc,OAA9B,IAAyC0B,aAAaC,MAAb,KAAwB,CAArE,EAAwE;AACvE;AACA;AACA;AACA,UAAO,KAAP;AACA;;AAEA,MAAIC,kBAAkB,CAAC,QAAD,EAAW,OAAX,EAAoB,QAApB,EAA8B,UAA9B,EAA0C,UAA1C,CAAtB;AACA,MAAI5B,cAAc,OAAd,IAAyB4B,gBAAgBnT,OAAhB,CAAwBlH,KAAKsa,OAA7B,IAAwC,CAAC,CAAtE,EAAyE;AACvE,UAAO,EAAEta,KAAKua,QAAL,IAAiBjZ,OAAOtB,IAAP,EAAa,oBAAb,CAAnB,CAAP;AACD;AACD,SAAO,IAAP;AACD;;AAED;;;;AAIO,UAASwa,aAAT,CAAuBxa,IAAvB,EAA6B;AACnCA,UAAQiZ,OAAOxK,SAASgM,IAAhB,EAAsBza,IAAtB,CAAR;AACA;;mDAFewa,eAIhB;;;;;AAIO,UAASE,YAAT,CAAsB1a,IAAtB,EAA4B;AAClC,MAAIA,QAAQA,KAAKQ,UAAjB,EAA6B;AAC5BR,QAAKQ,UAAL,CAAgB0E,WAAhB,CAA4BlF,IAA5B;AACA;AACD;;kDAJe0a,cAMhB;;;;;;;;;;AASA,UAAS5B,oBAAT,CAA8B3G,KAA9B,EAAqC;AACpCwI,0BAAwBxI,KAAxB;AACA,MAAIyI,cAAc/P,MAAMsH,MAAMmF,WAAN,CAAN,IACjBnF,MAAMmF,WAAN,CADiB,GAEjBnF,MAAM9B,MAFP;AAGA,MAAIwK,MAAM,IAAV;AACA,MAAIC,YAAY3I,MAAM4I,aAAtB;AACA,MAAIC,QAAQ7I,MAAM4I,aAAN,CAAoBva,UAAhC;AACA,MAAIya,SAAS,EAAb;;AAEAJ,SAAOK,2BAA2BJ,SAA3B,EAAsCF,WAAtC,EAAmDzI,KAAnD,EAA0D6I,KAA1D,EAAiEC,MAAjE,CAAP;AACAJ,SAAOM,kCAAkCF,MAAlC,EAA0C9I,KAA1C,CAAP;;AAEAA,QAAMiJ,cAAN,GAAuB,IAAvB;AACAjJ,QAAMmF,WAAN,IAAqB0D,KAArB;AACA,SAAOH,GAAP;AACA;;AAED;;;;;;AAMO,UAASQ,QAAT,CAAkBvJ,OAAlB,EAA2BqG,SAA3B,EAAsC;AAC5C,MAAI,eAAerG,OAAnB,EAA4B;AAC3B,UAAOwJ,oBAAoBxJ,OAApB,EAA6BqG,SAA7B,CAAP;AACA,GAFD,MAEO;AACN,UAAOoD,uBAAuBzJ,OAAvB,EAAgCqG,SAAhC,CAAP;AACA;AACD;;8CANekD,UAQhB;;;;;;;;AAOA,UAASC,mBAAT,CAA6BxJ,OAA7B,EAAsCqG,SAAtC,EAAiD;AAChD,SAAOrG,QAAQsG,SAAR,CAAkBhV,QAAlB,CAA2B+U,SAA3B,CAAP;AACA;;AAED;;;;;;;AAOA,UAASoD,sBAAT,CAAgCzJ,OAAhC,EAAyCqG,SAAzC,EAAoD;AACnD,SAAO,CAAC,MAAMrG,QAAQqG,SAAd,GAA0B,GAA3B,EAAgCjR,OAAhC,CAAwC,MAAMiR,SAAN,GAAkB,GAA1D,KAAkE,CAAzE;AACA;;AAED;;;;;AAKO,UAASqD,OAAT,CAAiB1J,OAAjB,EAA0B;AAChC,SAAOA,QAAQ2J,UAAR,CAAmB9a,MAAnB,KAA8B,CAArC;AACA;;6CAFe6a,SAIhB;;;;;;;AAMO,UAASxC,KAAT,CAAelH,OAAf,EAAwB+E,QAAxB,EAAkC;AACxC,MAAI,CAAC/E,OAAD,IAAYA,QAAQ7G,QAAR,KAAqB,CAArC,EAAwC;AACvC,UAAO,KAAP;AACA;;AAED,MAAIyQ,IAAIrb,QAAQ1B,SAAhB;AACA,MAAIgd,IAAID,EAAEvW,OAAF,IAAauW,EAAEE,qBAAf,IAAwCF,EAAEG,kBAA1C,IAAgEH,EAAEI,iBAAlE,IAAuFJ,EAAEK,gBAAjG;AACA,MAAIJ,CAAJ,EAAO;AACN,UAAOA,EAAE1c,IAAF,CAAO6S,OAAP,EAAgB+E,QAAhB,CAAP;AACA;;AAED,SAAOmF,eAAelK,OAAf,EAAwB+E,QAAxB,CAAP;AACA;;2CAZemC,OAchB;;;;;;;;;AAQA,UAASgD,cAAT,CAAwBlK,OAAxB,EAAiC+E,QAAjC,EAA2C;AAC1C,MAAIoF,QAAQxN,SAASyN,gBAAT,CAA0BrF,QAA1B,EAAoC/E,QAAQtR,UAA5C,CAAZ;AACA,OAAK,IAAIE,IAAI,CAAb,EAAgBA,IAAIub,MAAMtb,MAA1B,EAAkC,EAAED,CAApC,EAAuC;AACtC,OAAIub,MAAMvb,CAAN,MAAaoR,OAAjB,EAA0B;AACzB,WAAO,IAAP;AACA;AACD;AACD,SAAO,KAAP;AACA;;AAED;;;;;;AAMO,UAAStO,IAAT,CAAcsO,OAAd,EAAuB+E,QAAvB,EAAiC;AACvC,KAAG;AACF/E,aAAUA,QAAQ3Q,WAAlB;AACA,OAAI2Q,WAAWkH,MAAMlH,OAAN,EAAe+E,QAAf,CAAf,EAAyC;AACxC,WAAO/E,OAAP;AACA;AACD,GALD,QAKSA,OALT;AAMA,SAAO,IAAP;AACA;;0CARetO,MAUhB;;;;;;AAKA,UAASmX,uBAAT,CAAiCxI,KAAjC,EAAwC;AACvCA,QAAMgK,eAAN,GAAwBC,gBAAxB;AACAjK,QAAMkK,wBAAN,GAAiCC,yBAAjC;AACA;;AAED;;;;;;;;;;;;;AAaO,UAASzG,EAAT,CAAY/D,OAAZ,EAAqB2G,SAArB,EAAgCrL,QAAhC,EAA0C6J,WAA1C,EAAuD;AAC7D,MAAIzL,SAASsG,OAAT,CAAJ,EAAuB;AACtB,UAAO8H,SAASnL,QAAT,EAAmBgK,SAAnB,EAA8B3G,OAA9B,EAAuC1E,QAAvC,CAAP;AACA;AACD,MAAI0M,eAAezC,aAAaoB,SAAb,CAAnB;AACA,MAAIqB,gBAAgBA,aAAa3H,KAAjC,EAAwC;AACvCsG,eAAYqB,aAAaC,aAAzB;AACA3M,cAAW0M,aAAaE,OAAb,CAAqBjM,IAArB,CAA0B+L,YAA1B,EAAwC1M,QAAxC,CAAX;AACA;AACD0E,UAAQvD,gBAAR,CAAyBkK,SAAzB,EAAoCrL,QAApC,EAA8C6J,WAA9C;AACA,SAAO,IAAID,cAAJ,CAAmBlF,OAAnB,EAA4B2G,SAA5B,EAAuCrL,QAAvC,EAAiD6J,WAAjD,CAAP;AACA;;wCAXepB,IAahB;;;;;;;;;;;AAUO,UAAS0G,IAAT,CAAczK,OAAd,EAAuB2G,SAAvB,EAAkCrL,QAAlC,EAA4C;AAClD,MAAIoP,iBAAiB3G,GAAG/D,OAAH,EAAY2G,SAAZ,EAAuB,YAAW;AACtD+D,kBAAehK,cAAf;AACA,UAAOpF,SAAS3E,KAAT,CAAe,IAAf,EAAqBL,SAArB,CAAP;AACA,GAHoB,CAArB;AAIA,SAAOoU,cAAP;AACA;;0CANeD,MAQhB;;;;;;;;AAOO,UAASjb,MAAT,CAAgBwQ,OAAhB,EAAyB+E,QAAzB,EAAmC;AACzC,SAAOkC,QAAQjH,QAAQtR,UAAhB,EAA4BqW,QAA5B,CAAP;AACA;;4CAFevV,QAIhB;;;;;;;AAMO,UAASmb,mBAAT,CAA6BhE,SAA7B,EAAwCqB,YAAxC,EAAsD;AAC5DzC,eAAaoB,SAAb,IAA0BqB,YAA1B;AACA;;yDAFe2C,qBAIhB;;;;;AAIO,UAASC,cAAT,CAAwB1c,IAAxB,EAA8B;AACpC,MAAIiB,KAAJ;AACA,SAAQA,QAAQjB,KAAKkB,UAArB,EAAkC;AACjClB,QAAKkF,WAAL,CAAiBjE,KAAjB;AACA;AACD;;oDALeyb,gBAOhB;;;;;;AAKO,UAASC,aAAT,CAAuB5E,QAAvB,EAAiCC,OAAjC,EAA0C;AAChD,MAAI,CAAC3M,SAAS0M,QAAT,CAAD,IAAuB,CAACvM,SAASwM,OAAT,CAA5B,EAA+C;AAC9C;AACA;;AAED,MAAI,CAACD,SAASpX,MAAd,EAAsB;AACrBoX,cAAW,CAACA,QAAD,CAAX;AACA;;AAED,OAAK,IAAIrX,IAAI,CAAb,EAAgBA,IAAIqX,SAASpX,MAA7B,EAAqCD,GAArC,EAA0C;AACzC,OAAI,eAAeqX,SAASrX,CAAT,CAAnB,EAAgC;AAC/Bkc,6BAAyB7E,SAASrX,CAAT,CAAzB,EAAsCsX,OAAtC;AACA,IAFD,MAEO;AACN6E,gCAA4B9E,SAASrX,CAAT,CAA5B,EAAyCsX,OAAzC;AACA;AACD;AACD;;mDAhBe2E,eAkBhB;;;;;;;AAMA,UAASC,wBAAT,CAAkC9K,OAAlC,EAA2CkG,OAA3C,EAAoD;AACnDA,UAAQvH,KAAR,CAAc,GAAd,EAAmB2F,OAAnB,CAA2B,UAAS+B,SAAT,EAAoB;AAC9C,OAAIA,SAAJ,EAAe;AACdrG,YAAQsG,SAAR,CAAkBrB,MAAlB,CAAyBoB,SAAzB;AACA;AACD,GAJD;AAKA;;AAED;;;;;;AAMA,UAAS0E,2BAAT,CAAqC/K,OAArC,EAA8CkG,OAA9C,EAAuD;AACtD,MAAIM,mBAAmB,MAAMxG,QAAQqG,SAAd,GAA0B,GAAjD;;AAEAH,YAAUA,QAAQvH,KAAR,CAAc,GAAd,CAAV;;AAEA,OAAK,IAAI/P,IAAI,CAAb,EAAgBA,IAAIsX,QAAQrX,MAA5B,EAAoCD,GAApC,EAAyC;AACxC4X,sBAAmBA,iBAAiBnH,OAAjB,CAAyB,MAAM6G,QAAQtX,CAAR,CAAN,GAAmB,GAA5C,EAAiD,GAAjD,CAAnB;AACA;;AAEDoR,UAAQqG,SAAR,GAAoBG,iBAAiBwE,IAAjB,EAApB;AACA;;AAED;;;;;AAKO,UAAS3L,OAAT,CAAiBuI,QAAjB,EAA2BC,QAA3B,EAAqC;AAC3C,MAAID,YAAYC,QAAZ,IAAwBD,aAAaC,QAArC,IAAiDD,SAASlZ,UAA9D,EAA0E;AACzEkZ,YAASlZ,UAAT,CAAoBiD,YAApB,CAAiCkW,QAAjC,EAA2CD,QAA3C;AACAA,YAASlZ,UAAT,CAAoB0E,WAApB,CAAgCwU,QAAhC;AACA;AACD;;6CALevI,SAOhB;;;;;AAIA,UAASmL,yBAAT,GAAqC;AACpC,MAAMnK,QAAQ,IAAd,CADoC,CAChB;AACpBA,QAAM4K,OAAN,GAAgB,IAAhB;AACA5K,QAAM6K,gBAAN,GAAyB,IAAzB;AACAC,QAAMte,SAAN,CAAgB0d,wBAAhB,CAAyCpd,IAAzC,CAA8CkT,KAA9C;AACA;;AAED;;;;AAIA,UAASiK,gBAAT,GAA4B;AAC3B,MAAMjK,QAAQ,IAAd,CAD2B,CACP;AACpBA,QAAM4K,OAAN,GAAgB,IAAhB;AACAE,QAAMte,SAAN,CAAgBwd,eAAhB,CAAgCld,IAAhC,CAAqCkT,KAArC;AACA;;AAED;;;;;;AAMO,UAAS+K,aAAT,CAAuBpL,OAAvB,EAAgC2G,SAAhC,EAA2C;AACjD,MAAIpB,aAAaoB,SAAb,CAAJ,EAA6B;AAC5B,UAAO,IAAP;AACA;;AAED,MAAIjN,SAASsG,OAAT,CAAJ,EAAuB;AACtB,OAAI,CAACsF,eAAetF,OAAf,CAAL,EAA8B;AAC7BsF,mBAAetF,OAAf,IAA0BrD,SAASjN,aAAT,CAAuBsQ,OAAvB,CAA1B;AACA;AACDA,aAAUsF,eAAetF,OAAf,CAAV;AACA;AACD,SAAO,OAAO2G,SAAP,IAAoB3G,OAA3B;AACA;;mDAZeoL,eAchB;;;;;;;;;AAQA,UAAS/B,iCAAT,CAA2CF,MAA3C,EAAmD9I,KAAnD,EAA0D;AACzD,MAAI0I,MAAM,IAAV;;AAEA,OAAK,IAAIna,IAAI,CAAb,EAAgBA,IAAIua,OAAOta,MAAX,IAAqB,CAACwR,MAAMgL,gBAA5C,EAA8Dzc,GAA9D,EAAmE;AAClEyR,SAAMiJ,cAAN,GAAuBH,OAAOva,CAAP,EAAUoR,OAAjC;AACA+I,UAAOI,OAAOva,CAAP,EAAUwD,EAAV,CAAaiO,KAAb,CAAP;AACA;;AAED,SAAO0I,GAAP;AACA;;AAED;;;;;;;;;;;;;AAaA,UAASK,0BAAT,CAAoCJ,SAApC,EAA+CF,WAA/C,EAA4DzI,KAA5D,EAAmE6I,KAAnE,EAA0EoC,UAA1E,EAAsF;AACrF,MAAIvC,MAAM,IAAV;;AAEA,SAAOD,eAAeA,gBAAgBI,KAA/B,IAAwC,CAAC7I,MAAM4K,OAAtD,EAA+D;AAC9D,OAAI7C,sBAAsBU,WAAtB,EAAmCzI,MAAM1K,IAAzC,EAA+C0K,KAA/C,CAAJ,EAA2D;AAC1DA,UAAMiJ,cAAN,GAAuBR,WAAvB;AACAC,WAAOwC,yBAAyBvC,SAAzB,EAAoCF,WAApC,EAAiDzI,KAAjD,EAAwDiL,UAAxD,CAAP;AACA;AACDxC,iBAAcA,YAAYpa,UAA1B;AACA;;AAED,SAAOqa,GAAP;AACA;;AAED;;;;;;;AAOO,UAASyC,SAAT,CAAmBC,iBAAnB,EAAsC;AAC5C,MAAInd,UAAUmd,iBAAV,KAAgCvS,WAAWuS,iBAAX,CAApC,EAAmE;AAClE,UAAOA,iBAAP;AACA,GAFD,MAEO,IAAI/R,SAAS+R,iBAAT,CAAJ,EAAiC;AACvC,OAAIA,kBAAkB,CAAlB,MAAyB,GAAzB,IAAgCA,kBAAkBrW,OAAlB,CAA0B,GAA1B,MAAmC,CAAC,CAAxE,EAA2E;AAC1E,WAAOuH,SAAS+O,cAAT,CAAwBD,kBAAkBE,MAAlB,CAAyB,CAAzB,CAAxB,CAAP;AACA,IAFD,MAEO;AACN,WAAOhP,SAASiP,aAAT,CAAuBH,iBAAvB,CAAP;AACA;AACD,GANM,MAMA;AACN,UAAO,IAAP;AACA;AACD;;+CAZeD,WAchB;;;;;;;AAMO,UAASK,aAAT,CAAuB7L,OAAvB,EAAgCkG,OAAhC,EAAyC;AAC/C,MAAI,CAAC3M,SAASyG,OAAT,CAAD,IAAsB,CAACtG,SAASwM,OAAT,CAA3B,EAA8C;AAC7C;AACA;;AAED,MAAI,eAAelG,OAAnB,EAA4B;AAC3B8L,4BAAyB9L,OAAzB,EAAkCkG,OAAlC;AACA,GAFD,MAEO;AACN6F,+BAA4B/L,OAA5B,EAAqCkG,OAArC;AACA;AACD;;mDAVe2F,eAYhB;;;;;;;;;AAQA,UAASC,wBAAT,CAAkC9L,OAAlC,EAA2CkG,OAA3C,EAAoD;AACnDA,UAAQvH,KAAR,CAAc,GAAd,EAAmB2F,OAAnB,CAA2B,UAAS+B,SAAT,EAAoB;AAC9CrG,WAAQsG,SAAR,CAAkB0F,MAAlB,CAAyB3F,SAAzB;AACA,GAFD;AAGA;;AAED;;;;;;;;AAQA,UAAS0F,2BAAT,CAAqC/L,OAArC,EAA8CkG,OAA9C,EAAuD;AACtD,MAAIM,mBAAmB,MAAMxG,QAAQqG,SAAd,GAA0B,GAAjD;;AAEAH,YAAUA,QAAQvH,KAAR,CAAc,GAAd,CAAV;;AAEA,OAAK,IAAI/P,IAAI,CAAb,EAAgBA,IAAIsX,QAAQrX,MAA5B,EAAoCD,GAApC,EAAyC;AACxC,OAAIyX,YAAY,MAAMH,QAAQtX,CAAR,CAAN,GAAmB,GAAnC;AACA,OAAIqd,aAAazF,iBAAiBpR,OAAjB,CAAyBiR,SAAzB,CAAjB;;AAEA,OAAI4F,eAAe,CAAC,CAApB,EAAuB;AACtBzF,uBAAmBA,mBAAmBN,QAAQtX,CAAR,CAAnB,GAAgC,GAAnD;AACA,IAFD,MAEO;AACN4X,uBAAmBA,iBAAiBlO,SAAjB,CAA2B,CAA3B,EAA8B2T,UAA9B,IAA4C,GAA5C,GAClBzF,iBAAiBlO,SAAjB,CAA2B2T,aAAa5F,UAAUxX,MAAlD,CADD;AAEA;AACD;;AAEDmR,UAAQqG,SAAR,GAAoBG,iBAAiBwE,IAAjB,EAApB;AACA;;AAED;;;;;;;;AAQO,UAASkB,YAAT,CAAsBlM,OAAtB,EAA+B2G,SAA/B,EAA0C0B,YAA1C,EAAwD;AAC9D,MAAID,sBAAsBpI,OAAtB,EAA+B2G,SAA/B,EAA0C0B,YAA1C,CAAJ,EAA6D;AAC5D,OAAI8D,WAAWxP,SAASyP,WAAT,CAAqB,YAArB,CAAf;AACAD,YAASE,SAAT,CAAmB1F,SAAnB,EAA8B,IAA9B,EAAoC,IAApC;AACArI,UAAOiF,KAAP,CAAa4I,QAAb,EAAuB9D,YAAvB;AACArI,WAAQsM,aAAR,CAAsBH,QAAtB;AACA;AACD;;kDAPeD,cAShB;;;;;;;;;;;;AAWA,UAASK,iBAAT,CAA2BrM,SAA3B,EAAsCG,KAAtC,EAA6CL,OAA7C,EAAsDsL,UAAtD,EAAkE;AACjE,MAAIvC,MAAM,IAAV;AACA7I,cAAYA,aAAa,EAAzB;AACA,OAAK,IAAItR,IAAI,CAAb,EAAgBA,IAAIsR,UAAUrR,MAAd,IAAwB,CAACwR,MAAM6K,gBAA/C,EAAiEtc,GAAjE,EAAsE;AACrE,OAAIsR,UAAUtR,CAAV,EAAauZ,gBAAjB,EAAmC;AAClCmD,eAAWpc,IAAX,CAAgB;AACf8Q,qBADe;AAEf5N,SAAI8N,UAAUtR,CAAV;AAFW,KAAhB;AAIA,IALD,MAKO;AACNma,WAAO7I,UAAUtR,CAAV,EAAayR,KAAb,CAAP;AACA;AACD;AACD,SAAO0I,GAAP;AACA;;AAED;;;;;;;;;;;;AAYA,UAASwC,wBAAT,CAAkCvC,SAAlC,EAA6ChJ,OAA7C,EAAsDK,KAAtD,EAA6DiL,UAA7D,EAAyE;AACxE,MAAInd,OAAO4R,QAAQ+E,GAAR,CAAY9E,OAAZ,CAAX;AACA,MAAIE,YAAY/R,KAAK+R,SAAL,CAAeG,MAAM1K,IAArB,CAAhB;AACA,MAAIoT,MAAMwD,kBAAkBrM,SAAlB,EAA6BG,KAA7B,EAAoCL,OAApC,EAA6CsL,UAA7C,CAAV;;AAEA,MAAIkB,eAAezM,QAAQ+E,GAAR,CAAYkE,SAAZ,EAAuB/I,UAAvB,CAAkCI,MAAM1K,IAAxC,EAA8CqP,SAAjE;AACA,MAAIA,YAAYpY,OAAOmS,IAAP,CAAYyN,YAAZ,CAAhB;AACA,OAAK,IAAI5d,IAAI,CAAb,EAAgBA,IAAIoW,UAAUnW,MAAd,IAAwB,CAACwR,MAAM6K,gBAA/C,EAAiEtc,GAAjE,EAAsE;AACrE,OAAIsY,MAAMlH,OAAN,EAAegF,UAAUpW,CAAV,CAAf,CAAJ,EAAkC;AACjCsR,gBAAYsM,aAAaxH,UAAUpW,CAAV,CAAb,CAAZ;AACAma,WAAOwD,kBAAkBrM,SAAlB,EAA6BG,KAA7B,EAAoCL,OAApC,EAA6CsL,UAA7C,CAAP;AACA;AACD;;AAED,SAAOvC,GAAP;AACA;;AC/yBD;;AAEA;AACA;AACA;AACA;;;MACY0D;yBAEGA;;qCACNA;;;;;ACTT;;;KAES3E;KAAU/D;KAAIqH;KACdnI;;AAET;;;;;;KAKMyJ;;;;;;;;;;;AACL;;;;;;;;gCAQarM,OAAOC,UAAU;AAC7B,QAAI,KAAKmD,cAAL,CAAoBhH,gBAAxB,EAA0C;AACzC,SAAI,KAAKkQ,gBAAL,CAAsBtM,KAAtB,CAAJ,EAAkC;AACjC,UAAIuM,QAAQvM,MAAMjL,OAAN,CAAc,GAAd,EAAmB,CAAnB,CAAZ;AACA,UAAIuR,YAAYtG,MAAM/H,SAAN,CAAgB,CAAhB,EAAmBsU,KAAnB,CAAhB;AACA,UAAI7H,WAAW1E,MAAM/H,SAAN,CAAgBsU,QAAQ,CAAxB,CAAf;AACA,aAAO9E,SAAS,KAAKrE,cAAd,EAA8BkD,SAA9B,EAAyC5B,QAAzC,EAAmDzE,QAAnD,CAAP;AACA,MALD,MAKO;AACN,aAAOyD,GAAG,KAAKN,cAAR,EAAwBpD,KAAxB,EAA+BC,QAA/B,CAAP;AACA;AACD,KATD,MASO;AACN,iKAA0BD,KAA1B,EAAiCC,QAAjC;AACA;AACD;;AAED;;;;;;;;;oCAMiBD,OAAO;AACvB,WAAOA,MAAMsL,MAAN,CAAa,CAAb,EAAgB,CAAhB,MAAuB,WAA9B;AACA;;AAED;;;;;;;;wCAKqBtL,OAAO;AAC3B,QAAI,CAAC,KAAKoD,cAAN,IAAwB,CAAC,KAAKA,cAAL,CAAoBhH,gBAAjD,EAAmE;AAClE,YAAO,IAAP;AACA;AACD,WAAQ,KAAKkQ,gBAAL,CAAsBtM,KAAtB,KAAgCA,MAAMjL,OAAN,CAAc,GAAd,EAAmB,CAAnB,MAA0B,CAAC,CAA5D,IACNgW,cAAc,KAAK3H,cAAnB,EAAmCpD,KAAnC,CADD;AAEA;;AAED;;;;;;;;;;qCAOkBA,OAAO;AACxB,WAAO,0JAAwBA,KAAxB,KAAkC,KAAKwM,oBAAL,CAA0BxM,KAA1B,CAAzC;AACA;;;GAxDiC4C;;yCA2DpByJ;;ACrEf;;;KAESvF;KACA/H;;AAET;;;;KAGM0N;;;;;;;;AACL;;;;;;6CAMiC;AAChC,QAAIA,SAASC,mBAAT,KAAiC9d,SAArC,EAAgD;AAC/C6d,cAASC,mBAAT,GAA+B;AAC9BC,iBAAWF,SAASG,wBAAT,CAAkC,WAAlC,CADmB;AAE9BC,kBAAYJ,SAASG,wBAAT,CAAkC,YAAlC;AAFkB,MAA/B;AAIA;AACD,WAAOH,SAASC,mBAAhB;AACA;;AAED;;;;;;;;4CAKgCpX,MAAM;AACrC,QAAIwX,WAAW,CAAC,QAAD,EAAW,IAAX,EAAiB,GAAjB,EAAsB,EAAtB,CAAf;AACA,QAAIC,gBAAgBhO,OAAOiO,eAAP,CAAuB1X,IAAvB,EAA6B,CAA7B,EAAgC,CAAhC,EAAmCA,KAAK2C,SAAL,CAAe,CAAf,EAAkB,CAAlB,EAAqBgV,WAArB,EAAnC,CAApB;AACA,QAAIC,WAAW,CAACH,gBAAgB,KAAjB,EAAwBA,gBAAgB,KAAxC,EAA+CA,gBAAgB,KAA/D,EAAsEzX,OAAO,KAA7E,CAAf;AACA,SAAK,IAAI/G,IAAI,CAAb,EAAgBA,IAAIue,SAASte,MAA7B,EAAqCD,GAArC,EAA0C;AACzC,SAAIke,SAASU,iBAAT,CAA2BtY,KAA3B,CAAiCiY,SAASve,CAAT,IAAcwe,aAA/C,MAAkEne,SAAtE,EAAiF;AAChF,aAAOke,SAASve,CAAT,EAAY6e,WAAZ,KAA4BF,SAAS3e,CAAT,CAAnC;AACA;AACD;AACD,WAAO+G,OAAO,KAAd;AACA;;AAED;;;;;;;;;0CAM8B;AAC7B,QAAImX,SAASY,gBAAT,KAA8Bze,SAAlC,EAA6C;AAC5C,SAAI0e,kBAAkB,2CAAtB;AACA,SAAI3N,UAAUrD,SAASjN,aAAT,CAAuB,KAAvB,CAAd;AACAyX,YAAOnH,OAAP,EAAgB2N,eAAhB;AACAb,cAASY,gBAAT,GAA4BC,oBAAoB3N,QAAQyH,SAAxD;AACA;AACD,WAAOqF,SAASY,gBAAhB;AACA;;;;;AAGFZ,UAASU,iBAAT,GAA6B7Q,SAASjN,aAAT,CAAuB,KAAvB,CAA7B;AACAod,UAASC,mBAAT,GAA+B9d,SAA/B;AACA6d,UAASY,gBAAT,GAA4Bze,SAA5B;;6BAEe6d;;AC/Df;;;KAES5R;KACA0N;KAAc6B;;AAEvB;;;;KAGMmD;;;;;;;;AACL;;;;;;;uBAOW5f,MAAM6f,cAAc;AAC9B,QAAI7P,SAASrB,SAASjN,aAAT,CAAuB,QAAvB,CAAb;AACAsO,WAAOhQ,IAAP,GAAcA,IAAd;AACA,QAAI6f,YAAJ,EAAkB;AACjBA,kBAAa7P,MAAb;AACA,KAFD,MAEO;AACNrB,cAASmB,IAAT,CAAcf,WAAd,CAA0BiB,MAA1B;AACA;AACD4K,iBAAa5K,MAAb;AACA,WAAOA,MAAP;AACA;;AAED;;;;;;;;;;;;2BASenB,KAAKiR,cAAcD,cAAc;AAC/C,QAAI7P,SAASrB,SAASjN,aAAT,CAAuB,QAAvB,CAAb;AACAsO,WAAOnB,GAAP,GAAaA,GAAb;;AAEA,QAAIvB,WAAW,SAAXA,QAAW,GAAW;AACzBsN,kBAAa5K,MAAb;AACA8P,qBAAgBA,cAAhB;AACA,KAHD;AAIArD,SAAKzM,MAAL,EAAa,MAAb,EAAqB1C,QAArB;AACAmP,SAAKzM,MAAL,EAAa,OAAb,EAAsB1C,QAAtB;;AAEA,QAAIuS,YAAJ,EAAkB;AACjBA,kBAAa7P,MAAb;AACA,KAFD,MAEO;AACNrB,cAASmB,IAAT,CAAcf,WAAd,CAA0BiB,MAA1B;AACA;;AAED,WAAOA,MAAP;AACA;;AAED;;;;;;;;;;;;6BASiBA,QAAQ8P,cAAcD,cAAc;AACpD,QAAIvS,WAAW,SAAXA,QAAW,GAAW;AACzBwS,qBAAgBA,cAAhB;AACA,KAFD;AAGA,QAAI9P,OAAOrI,IAAP,IAAeqI,OAAOrI,IAAP,KAAgB,iBAAnC,EAAsD;AACrDuF,WAAMG,QAAN,CAAeC,QAAf;AACA;AACA;AACDsN,iBAAa5K,MAAb;AACA,QAAIA,OAAOnB,GAAX,EAAgB;AACf,YAAO+Q,WAAWG,OAAX,CAAmB/P,OAAOnB,GAA1B,EAA+BiR,YAA/B,EAA6CD,YAA7C,CAAP;AACA,KAFD,MAEO;AACN3S,WAAMG,QAAN,CAAeC,QAAf;AACA,YAAOsS,WAAW1b,GAAX,CAAe8L,OAAOhQ,IAAtB,EAA4B6f,YAA5B,CAAP;AACA;AACD;;AAED;;;;;;;;;;;uCAQ2B7N,SAAS8N,cAAcD,cAAc;AAC/D,QAAIG,UAAUhO,QAAQoK,gBAAR,CAAyB,QAAzB,CAAd;AACA,QAAI4D,QAAQnf,MAAZ,EAAoB;AACnB+e,gBAAWK,iBAAX,CAA6BD,OAA7B,EAAsC,CAAtC,EAAyCF,YAAzC,EAAuDD,YAAvD;AACA,KAFD,MAEO,IAAIC,YAAJ,EAAkB;AACxB5S,WAAMG,QAAN,CAAeyS,YAAf;AACA;AACD;;AAED;;;;;;;;;;;;qCASyBE,SAASpB,OAAOkB,cAAcD,cAAc;AACpED,eAAWM,SAAX,CAAqBF,QAAQG,IAAR,CAAavB,KAAb,CAArB,EAA0C,YAAW;AACpD,SAAIA,QAAQoB,QAAQnf,MAAR,GAAiB,CAA7B,EAAgC;AAC/B+e,iBAAWK,iBAAX,CAA6BD,OAA7B,EAAsCpB,QAAQ,CAA9C,EAAiDkB,YAAjD,EAA+DD,YAA/D;AACA,MAFD,MAEO,IAAIC,YAAJ,EAAkB;AACxB5S,YAAMG,QAAN,CAAeyS,YAAf;AACA;AACD,KAND,EAMGD,YANH;AAOA;;;;;+BAGaD;;ACxHf;;;KAES1S;KACAuP;;AAET;;;;KAGM2D;;;;;;;;AACL;;;;;;;uBAOWpgB,MAAM6f,cAAc;AAC9B,QAAI3Y,QAAQyH,SAASjN,aAAT,CAAuB,OAAvB,CAAZ;AACAwF,UAAMuS,SAAN,GAAkBzZ,IAAlB;AACA,QAAI6f,YAAJ,EAAkB;AACjBA,kBAAa3Y,KAAb;AACA,KAFD,MAEO;AACNyH,cAASmB,IAAT,CAAcf,WAAd,CAA0B7H,KAA1B;AACA;AACD,WAAOA,KAAP;AACA;;AAED;;;;;;;;;;;;2BASemZ,MAAMP,cAAcD,cAAc;AAChD,QAAIS,OAAO3R,SAASjN,aAAT,CAAuB,MAAvB,CAAX;AACA4e,SAAKC,GAAL,GAAW,YAAX;AACAD,SAAKD,IAAL,GAAYA,IAAZ;AACAD,qBAAiBI,QAAjB,CAA0BF,IAA1B,EAAgCR,YAAhC,EAA8CD,YAA9C;AACA,WAAOS,IAAP;AACA;;AAED;;;;;;;;;;;;4BASgBpZ,OAAO4Y,cAAcD,cAAc;AAClD,QAAIvS,WAAW,SAAXA,QAAW,GAAW;AACzBwS,qBAAgBA,cAAhB;AACA,KAFD;AAGA,QAAI5Y,MAAMqZ,GAAN,IAAarZ,MAAMqZ,GAAN,KAAc,YAA/B,EAA6C;AAC5CrT,WAAMG,QAAN,CAAeC,QAAf;AACA;AACA;;AAED,QAAIpG,MAAMsT,OAAN,KAAkB,OAAtB,EAA+B;AAC9BtN,WAAMG,QAAN,CAAeC,QAAf;AACA,KAFD,MAEO;AACNmP,UAAKvV,KAAL,EAAY,MAAZ,EAAoBoG,QAApB;AACAmP,UAAKvV,KAAL,EAAY,OAAZ,EAAqBoG,QAArB;AACA;;AAED,QAAIuS,YAAJ,EAAkB;AACjBA,kBAAa3Y,KAAb;AACA,KAFD,MAEO;AACNyH,cAASmB,IAAT,CAAcf,WAAd,CAA0B7H,KAA1B;AACA;;AAED,WAAOA,KAAP;AACA;;AAED;;;;;;;;;;;sCAQ0B8K,SAAS8N,cAAcD,cAAc;AAC9D,QAAIY,SAASzO,QAAQoK,gBAAR,CAAyB,YAAzB,CAAb;AACA,QAAIqE,OAAO5f,MAAP,KAAkB,CAAlB,IAAuBif,YAA3B,EAAyC;AACxC5S,WAAMG,QAAN,CAAeyS,YAAf;AACA;AACA;;AAED,QAAIY,YAAY,CAAhB;AACA,QAAIpT,WAAW,SAAXA,QAAW,GAAW;AACzB,SAAIwS,gBAAgB,EAAEY,SAAF,KAAgBD,OAAO5f,MAA3C,EAAmD;AAClDqM,YAAMG,QAAN,CAAeyS,YAAf;AACA;AACD,KAJD;AAKA,SAAK,IAAIlf,IAAI,CAAb,EAAgBA,IAAI6f,OAAO5f,MAA3B,EAAmCD,GAAnC,EAAwC;AACvCwf,sBAAiBI,QAAjB,CAA0BC,OAAO7f,CAAP,CAA1B,EAAqC0M,QAArC,EAA+CuS,YAA/C;AACA;AACD;;;;;qCAGaO;;ARzGf;;;KAESzD;KACFmC;;;AAEP,KAAI6B,gBAAgB;AACnBC,cAAY,WADO;AAEnBC,cAAY,UAFO;AAGnBC,gBAAc,aAHK;AAInBC,gBAAc;AAJK,EAApB;AAMAniB,QAAOmS,IAAP,CAAY4P,aAAZ,EAA2BrK,OAA3B,CAAmC,UAASqC,SAAT,EAAoB;AACtDgE,sBAAoBhE,SAApB,EAA+B;AAC9BmB,aAAU,IADoB;AAE9BI,YAAS,iBAAS5M,QAAT,EAAmB+E,KAAnB,EAA0B;AAClC,QAAI2O,UAAU3O,MAAM4O,aAApB;AACA,QAAI1Q,SAAS8B,MAAMiJ,cAAnB;AACA,QAAI,CAAC0F,OAAD,IAAaA,YAAYzQ,MAAZ,IAAsB,CAACA,OAAOjN,QAAP,CAAgB0d,OAAhB,CAAxC,EAAmE;AAClE3O,WAAM6O,UAAN,GAAmBvI,SAAnB;AACA,YAAOrL,SAAS+E,KAAT,CAAP;AACA;AACD,IAT6B;AAU9B4H,kBAAe0G,cAAchI,SAAd;AAVe,GAA/B;AAYA,EAbD;;AAeA,KAAIwI,oBAAoB;AACvBnC,aAAW,cADY;AAEvBE,cAAY;AAFW,EAAxB;AAIAtgB,QAAOmS,IAAP,CAAYoQ,iBAAZ,EAA+B7K,OAA/B,CAAuC,UAASH,SAAT,EAAoB;AAC1D,MAAIwC,YAAYwI,kBAAkBhL,SAAlB,CAAhB;AACAwG,sBAAoBhE,SAApB,EAA+B;AAC9BtG,UAAO,IADuB;AAE9ByH,aAAU,IAFoB;AAG9BI,YAAS,iBAAS5M,QAAT,EAAmB+E,KAAnB,EAA0B;AAClCA,UAAM6O,UAAN,GAAmBvI,SAAnB;AACA,WAAOrL,SAAS+E,KAAT,CAAP;AACA,IAN6B;AAO9B4H,kBAAe6E,SAASsC,uBAAT,GAAmCjL,SAAnC;AAPe,GAA/B;AASA,EAXD;;AI9BA;;;MAEOsI;MACA1M;MACA2M;MACAxH;MACA4H;MACAc;MACAQ;;;;;yCAIErO;sDAAS2M;gDAAsBxH;0CAAgB4H;4CAAUc;kDAAYQ;yBAC/D3B;;AKbf;;;KAEStU;KAAiBY;KAAOC;KAAiBC;;AAElD;;;;;;;AAMA,KAAMoW,aAAa;AAClBC,OAAK;AAAA,UAAM;AAAA,WAAM,IAAN;AAAA,IAAN;AAAA,GADa;AAElBpV,SAAOqV,aAAa,OAAb,CAFW;AAGlBC,QAAMD,aAAa,SAAb,CAHY;AAIlBE,QAAMF,aAAa,UAAb,CAJY;AAKlBG,UAAQH,aAAa,QAAb,CALU;AAMlBjR,UAAQiR,aAAa,QAAb,CANU;AAOlBnQ,UAAQmQ,aAAa,QAAb,CAPU;;AASlB;;;;;AAKAI,WAAS,iBAASC,SAAT,EAAoB;AAC5B,UAAOC,MAAM,UAAC7gB,KAAD,EAAQD,IAAR,EAAc6C,OAAd,EAA0B;AACtC,QAAIke,SAAST,WAAWnV,KAAX,CAAiBlL,KAAjB,EAAwBD,IAAxB,EAA8B6C,OAA9B,CAAb;AACA,QAAIme,UAAUD,MAAV,CAAJ,EAAuB;AACtB,YAAOA,MAAP;AACA;AACD,SAAK,IAAIlhB,IAAI,CAAb,EAAgBA,IAAII,MAAMH,MAA1B,EAAkCD,GAAlC,EAAuC;AACtC,SAAImhB,UAAUH,UAAU5gB,MAAMJ,CAAN,CAAV,EAAoBG,IAApB,EAA0B6C,OAA1B,CAAV,CAAJ,EAAmD;AAClD,aAAOoe,aAAa,kCAAb,EAAiDjhB,IAAjD,EAAuD6C,OAAvD,CAAP;AACA;AACD;AACD,WAAO,IAAP;AACA,IAXM,CAAP;AAYA,GA3BiB;;AA6BlB;;;;;AAKAqe,cAAY,oBAASC,aAAT,EAAwB;AACnC,UAAOL,MAAM,UAAC7gB,KAAD,EAAQD,IAAR,EAAc6C,OAAd,EAA0B;AACtC,QAAI,EAAE5C,iBAAiBkhB,aAAnB,CAAJ,EAAuC;AACtC,YAAOF,uCACkBE,aADlB,EAENnhB,IAFM,EAGN6C,OAHM,CAAP;AAKA;AACD,WAAO,IAAP;AACA,IATM,CAAP;AAUA,GA7CiB;;AA+ClB;;;;;AAKAue,YAAU,kBAASC,aAAT,EAAwB;AACjC,UAAOP,MAAM,UAAC7gB,KAAD,EAAQD,IAAR,EAAc6C,OAAd,EAA0B;AACtC,SAAK,IAAIpE,GAAT,IAAgBwB,KAAhB,EAAuB;AACtB,SAAI+gB,UAAUK,cAAcphB,MAAMxB,GAAN,CAAd,CAAV,CAAJ,EAA0C;AACzC,aAAOwiB,aAAa,6BAAb,EAA4CjhB,IAA5C,EAAkD6C,OAAlD,CAAP;AACA;AACD;AACD,WAAO,IAAP;AACA,IAPM,CAAP;AAQA,GA7DiB;;AA+DlB;;;;;AAKAye,SAAO,eAASC,aAAT,EAAwB;AAC9B,UAAOT,MAAM,UAAC7gB,KAAD,EAAQD,IAAR,EAAc6C,OAAd,EAA0B;AACtC,QAAMke,SAAST,WAAWnV,KAAX,CAAiBoW,aAAjB,EAAgCvhB,IAAhC,EAAsC6C,OAAtC,CAAf;AACA,QAAIme,UAAUD,MAAV,CAAJ,EAAuB;AACtB,YAAOA,MAAP;AACA;;AAED,SAAK,IAAIlhB,IAAI,CAAb,EAAgBA,IAAI0hB,cAAczhB,MAAlC,EAA0CD,GAA1C,EAA+C;AAC9C,SAAM2hB,aAAaD,cAAc1hB,CAAd,CAAnB;AACA,SAAII,UAAUuhB,UAAd,EAA0B;AACzB,aAAO,IAAP;AACA;AACD;;AAED,WAAOP,aAAa,+BAAb,EAA8CjhB,IAA9C,EAAoD6C,OAApD,CAAP;AACA,IAdM,CAAP;AAeA,GApFiB;;AAsFlB;;;;;;;AAOA4e,aAAW,mBAASC,qBAAT,EAAgC;AAC1C,UAAOZ,MAAM,UAAC7gB,KAAD,EAAQD,IAAR,EAAc6C,OAAd,EAA0B;AACtC,QAAMke,SAAST,WAAWnV,KAAX,CAAiBuW,qBAAjB,EAAwC1hB,IAAxC,EAA8C6C,OAA9C,CAAf;AACA,QAAIme,UAAUD,MAAV,CAAJ,EAAuB;AACtB,YAAOA,MAAP;AACA;;AAED,SAAK,IAAIlhB,IAAI,CAAb,EAAgBA,IAAI6hB,sBAAsB5hB,MAA1C,EAAkDD,GAAlD,EAAuD;AACtD,SAAI,CAACmhB,UAAUU,sBAAsB7hB,CAAtB,EAAyBI,KAAzB,EAAgCD,IAAhC,EAAsC6C,OAAtC,CAAV,CAAL,EAAgE;AAC/D,aAAO,IAAP;AACA;AACD;;AAED,WAAOoe,aAAa,8BAAb,EAA6CjhB,IAA7C,EAAmD6C,OAAnD,CAAP;AACA,IAbM,CAAP;AAcA,GA5GiB;;AA8GlB;;;;;AAKA8e,WAAS,iBAASC,KAAT,EAAgB;AACxB,UAAOd,MAAM,UAAC7gB,KAAD,EAAQD,IAAR,EAAc6C,OAAd,EAA0B;AACtC,QAAMke,SAAST,WAAW/Q,MAAX,CAAkBqS,KAAlB,EAAyB5hB,IAAzB,EAA+B6C,OAA/B,CAAf;AACA,QAAIme,UAAUD,MAAV,CAAJ,EAAuB;AACtB,YAAOA,MAAP;AACA;;AAED,SAAK,IAAItiB,GAAT,IAAgBmjB,KAAhB,EAAuB;AACtB,SAAIC,WAAW,KAAf;AACA,SAAIhB,YAAYe,MAAMnjB,GAAN,CAAhB;AACA,SAAIoiB,UAAUiB,MAAd,EAAsB;AACrBD,iBAAWhB,UAAUiB,MAAV,CAAiBD,QAA5B;AACAhB,kBAAYA,UAAUiB,MAAV,CAAiBjB,SAA7B;AACA;AACD,SAAKgB,YAAY,CAAC5X,gBAAgBhK,MAAMxB,GAAN,CAAhB,CAAd,IACHuiB,UAAUH,UAAU5gB,MAAMxB,GAAN,CAAV,CAAV,CADD,EACmC;AAClC,aAAOwiB,aACN,uCADM,EAENjhB,IAFM,EAGN6C,OAHM,CAAP;AAKA;AACD;;AAED,WAAO,IAAP;AACA,IAxBM,CAAP;AAyBA;AA7IiB,EAAnB;;AAgJA;;;;;;;AAOA,UAASoe,YAAT,CAAsBrK,KAAtB,EAA6B5W,IAA7B,EAAmC6C,OAAnC,EAA4C;AAC3C,MAAMkf,WAAWlf,UAAUuG,gBAAgBvG,QAAQ4F,WAAxB,CAAV,GAAiD,IAAlE;AACA,MAAIuZ,WAAWnf,WAAWA,QAAQof,WAAnB,IAAkCpf,QAAQof,WAAR,EAAjD;AACA,MAAMxhB,SAASuhB,YAAYA,SAASE,SAArB,GACdrf,QAAQof,WAAR,GAAsBC,SAAtB,EADc,GAEd,IAFD;AAGA,MAAMC,aAAa1hB,SAAS2I,gBAAgB3I,OAAOgI,WAAvB,CAAT,GAA+C,IAAlE;AACA,MAAM+F,WAAW2T,2CAAwCA,UAAxC,WAAyD,EAA1E;AACA,SAAO,IAAI5Z,KAAJ,CACN,wCAAqCvI,IAArC,aACG4W,KADH,qBACuBmL,QADvB,YACqCvT,QADrC,CADM,CAAP;AAIA;;AAED;;;;;AAKA,UAAS4T,OAAT,CAAiBniB,KAAjB,EAAwB;AACvB,MAAM2G,cAAc3G,KAAd,qDAAcA,KAAd,CAAN;AACA,MAAIwL,MAAMC,OAAN,CAAczL,KAAd,CAAJ,EAA0B;AACzB,UAAO,OAAP;AACA;AACD,SAAO2G,IAAP;AACA;;AAED;;;;;AAKA,UAASoa,SAAT,CAAmBD,MAAnB,EAA2B;AAC1B,SAAOA,kBAAkBxY,KAAzB;AACA;;AAED;;;;;;AAMA,UAASuY,KAAT,CAAeO,aAAf,EAA8B;AAC7B,SAAO,UAACphB,KAAD,EAAQD,IAAR,EAAc6C,OAAd,EAA0B;AAChC,OAAI,CAACmH,MAAM/J,KAAN,CAAD,IAAiBiK,OAAOjK,KAAP,CAArB,EAAoC;AACnC,WAAO,IAAP;AACA;AACD,UAAOohB,cAAcphB,KAAd,EAAqBD,IAArB,EAA2B6C,OAA3B,CAAP;AACA,GALD;AAMA;;AAED;;;;;;;;;;AAUA,UAAS2d,YAAT,CAAsB6B,YAAtB,EAAoC;AACnC,MAAMC,cAAcxB,MAAM,UAAC7gB,KAAD,EAAQD,IAAR,EAAc6C,OAAd,EAA0B;AACnD,OAAM+D,OAAOwb,QAAQniB,KAAR,CAAb;AACA,OAAI2G,SAASyb,YAAb,EAA2B;AAC1B,WAAOpB,kCACYoB,YADZ,gCACiDzb,IADjD,UAEN5G,IAFM,EAGN6C,OAHM,CAAP;AAKA;AACD,UAAO,IAAP;AACA,GAVmB,CAApB;AAWA,SAAO,YAAa;AACnB,OAAI,UAAK/C,MAAL,KAAgB,CAApB,EAAuB;AACtB,WAAOwiB,WAAP;AACA,IAFD,MAEO;AACN,WAAOA,uCAAP;AACA;AACD,GAND;AAOA;;+BAEchC;;ACnPf;;;KAES/Q;KACF+Q;;AAEP;;;;;;;;;;;;;;;;;;;;;;;;AAuBA,KAAMiC,SAAS;AACd;;;;;AAKAV,UANc,sBAMY;AAAA,OAAjBA,SAAiB,uEAAN,IAAM;;AACzB,UAAOW,YAAY,IAAZ,EAAkB,EAACX,mBAAD,EAAlB,CAAP;AACA,GARa;;;AAUd;;;;;AAKAY,QAfc,kBAePA,OAfO,EAeC;AACd,UAAOD,YAAY,IAAZ,EAAkB,EAACC,eAAD,EAAlB,CAAP;AACA,GAjBa;;;AAmBd;;;;;AAKA5B,WAxBc,qBAwBJA,UAxBI,EAwBO;AACpB,UAAO2B,YAAY,IAAZ,EAAkB,EAAC3B,qBAAD,EAAlB,CAAP;AACA,GA1Ba;;;AA4Bd;;;;;AAKA5gB,OAjCc,iBAiCRA,MAjCQ,EAiCD;AACZ,UAAOuiB,YAAY,IAAZ,EAAkB,EAACviB,aAAD,EAAlB,CAAP;AACA;AAnCa,EAAf;;AAsCA;;;;;;AAMA,UAASuiB,WAAT,CAAqB3f,OAArB,EAA8Bif,MAA9B,EAAsC;AACrC,MAAIpb,MAAM7D,OAAV;AACA,MAAI6D,QAAQ6b,MAAZ,EAAoB;AACnB7b,SAAM7I,OAAOG,MAAP,CAAcukB,MAAd,CAAN;AACA7b,OAAIob,MAAJ,GAAa,EAAb;AACA;AACDvS,SAAOiF,KAAP,CAAa9N,IAAIob,MAAjB,EAAyBA,MAAzB;AACA,SAAOpb,GAAP;AACA;;AAED;AACA,KAAIgc,UAAU7kB,OAAOmS,IAAP,CAAYsQ,UAAZ,CAAd;AACAoC,SAAQnN,OAAR,CACC;AAAA,SAAQgN,OAAOviB,IAAP,IAAe,YAAW;AACjC,UAAO,KAAK6gB,SAAL,CAAeP,WAAWtgB,IAAX,CAAf,CAAP;AACA,GAFD;AAAA,EADD;;2BAMeuiB;;AC1Ff;;;KAGCpX;KACAgB;KACAlC;KACAI;KACAG;KACAG;KACAE;KACA0E;KAEQsC;;AAET;;;;;;;;KAOM8Q;;;AACL;;;;;;;;;;;;AAYA,iBAAYC,UAAZ,EAAwBlT,OAAxB,EAAiClD,WAAjC,EAA8CqW,cAA9C,EAA8D;AAAA;;AAG7D;;;;;AAH6D;;AAQ7D,SAAKC,WAAL,GAAmBD,cAAnB;;AAEA;;;;;AAKA,SAAKE,QAAL,GAAgBvW,oBAAhB;;AAEA;;;;;AAKA,SAAKwW,cAAL,GAAsB,EAAtB;;AAEA;;;;;AAKA,SAAKC,IAAL,GAAYvT,gBAAZ;;AAEA;;;;;;AAMA,SAAKwT,mBAAL,GAA2B,IAA3B;;AAEA;;;;;AAKA,SAAKC,UAAL,GAAkB,EAAlB;;AAEA,SAAKC,kBAAL,CAAwB,IAAxB;AACA,SAAKC,iBAAL;AACA,SAAKC,yBAAL,CAA+BV,UAA/B;AAhD6D;AAiD7D;;AAED;;;;;;;;;;;iCAOc5iB,MAAM8hB,QAAQyB,cAAc;AACzC,SAAKC,aAAL,CAAmBxjB,IAAnB,EAAyB8hB,MAAzB,EAAiCyB,YAAjC,EAA+Chc,UAAUzH,MAAV,GAAmB,CAAlE;AACAjC,WAAO4lB,cAAP,CACC,KAAKR,IADN,EAECjjB,IAFD,EAGC,KAAK0jB,oBAAL,CAA0B1jB,IAA1B,CAHD;AAKA,SAAK2jB,qBAAL,CAA2B3jB,IAA3B;AACA,SAAK4jB,sBAAL,CAA4B5jB,IAA5B;AACA;;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;8BAqCW6jB,eAAeC,2BAA2BC,2BAA2B;AAC/E,QAAIpZ,SAASkZ,aAAT,CAAJ,EAA6B;AAC5B,YAAO,KAAKG,aAAL,aAAsBzc,SAAtB,CAAP;AACA;;AAED,QAAI0c,gBAAgBH,6BAA6B,EAAjD;AACA,QAAII,QAAQrmB,OAAOmS,IAAP,CAAY6T,aAAZ,CAAZ;;AAEA,QAAIM,QAAQ,EAAZ;AACA,SAAK,IAAItkB,IAAI,CAAb,EAAgBA,IAAIqkB,MAAMpkB,MAA1B,EAAkCD,GAAlC,EAAuC;AACtC,SAAIG,OAAOkkB,MAAMrkB,CAAN,CAAX;AACA,UAAK2jB,aAAL,CACCxjB,IADD,EAEC6jB,cAAc7jB,IAAd,CAFD,EAGCikB,cAAcjkB,IAAd,CAHD,EAICikB,cAAcrmB,cAAd,CAA6BoC,IAA7B,CAJD;AAMAmkB,WAAMnkB,IAAN,IAAc,KAAK0jB,oBAAL,CAA0B1jB,IAA1B,EAAgC+jB,yBAAhC,CAAd;AACA,UAAKH,sBAAL,CAA4B5jB,IAA5B;AACA;;AAED,QAAI+jB,8BAA8B,KAAlC,EAAyC;AACxClmB,YAAOumB,gBAAP,CACCL,6BAA6B,KAAKd,IADnC,EAECkB,KAFD;AAIA;;AAED;AACA;AACA,SAAK,IAAItkB,KAAI,CAAb,EAAgBA,KAAIqkB,MAAMpkB,MAA1B,EAAkCD,IAAlC,EAAuC;AACtC,UAAK8jB,qBAAL,CAA2BO,MAAMrkB,EAAN,CAA3B;AACA;AACD;;AAED;;;;;;;;;6CAM0B+iB,YAAY;AACrC,QAAIyB,OAAO,KAAK5b,WAAhB;AACA,QAAI6b,aAAJ;AACA,QAAItZ,SAAS2X,MAAM4B,gBAAN,CAAuBF,IAAvB,CAAb;AACA,QAAI,KAAKpB,IAAL,KAAc,IAAlB,EAAwB;AACvBqB,qBAAgBtZ,SAASqZ,KAAKvmB,SAAd,GAA0B,KAA1C;AACA;AACD,SAAK0mB,UAAL,CAAgBH,KAAKI,YAArB,EAAmC7B,UAAnC,EAA+C0B,aAA/C;AACA;;AAED;;;;;;;;0CAKuBtkB,MAAM;AAC5B,QAAI0kB,OAAO,KAAKvB,UAAL,CAAgBnjB,IAAhB,CAAX;AACA,QAAI0kB,KAAK5C,MAAL,CAAYD,QAAhB,EAA0B;AACzB,SAAI5hB,QAAQykB,KAAKC,KAAL,KAAehC,MAAMiC,SAAN,CAAgBC,WAA/B,GACX,KAAK9O,GAAL,CAAS/V,IAAT,CADW,GAEX0kB,KAAKnB,YAFN;AAGA,SAAI,CAACtZ,gBAAgBhK,KAAhB,CAAL,EAA6B;AAC5BwS,cAAQmE,KAAR,CACC,0BAA0B5W,IAA1B,GAAiC,4BAAjC,GACA,kBAFD;AAIA;AACD;AACD;;AAED;;;;;;;;;;4CAOyBA,MAAM;AAC9B,QAAI,KAAKyI,WAAL,CAAiBqc,mBAAjB,CAAqC9kB,IAArC,KAA8C,KAAKgjB,cAAL,CAAoBhjB,IAApB,CAAlD,EAA6E;AAC5E,WAAM,IAAIuI,KAAJ,CAAU,4DAA4DvI,IAA5D,GAAmE,IAA7E,CAAN;AACA;AACD;;AAED;;;;;;;;;;;;iCAScA,MAAM8hB,QAAQyB,cAAcwB,iBAAiB;AAC1D,SAAKC,wBAAL,CAA8BhlB,IAA9B;AACA8hB,aAAUA,UAAUA,OAAOA,MAAlB,GAA4BA,OAAOA,MAAnC,GAA6CA,UAAU,EAAhE;AACA,QAAI,KAAKgB,WAAT,EAAsB;AACrBhB,cAASvS,OAAOiF,KAAP,CAAa,EAAb,EAAiBsN,MAAjB,EAAyB,KAAKgB,WAA9B,CAAT;AACA;AACD,SAAKK,UAAL,CAAgBnjB,IAAhB,IAAwB;AACvB8hB,mBADuB;AAEvB6C,YAAOhC,MAAMiC,SAAN,CAAgBK;AAFA,KAAxB;AAIA,QAAIF,eAAJ,EAAqB;AACpB,UAAK5B,UAAL,CAAgBnjB,IAAhB,EAAsBujB,YAAtB,GAAqCA,YAArC;AACA;AACD;;AAED;;;;;;;;;;wCAOqBvjB,MAAMwM,aAAa;AACvC,QAAI0Y,WAAW1Y,gBAAgB,KAAK/D,WAAL,CAAiB3K,SAAjC,GAA6C,IAA7C,GAAoD,IAAnE;AACA,WAAO;AACNqnB,mBAAc,IADR;AAENC,iBAAY,IAFN;AAGNrP,UAAK,eAAW;AACf,aAAO,CAACmP,YAAY,IAAb,EAAmBG,iBAAnB,CAAqCrlB,IAArC,CAAP;AACA,MALK;AAMNslB,UAAK,aAASvb,GAAT,EAAc;AAClB,OAACmb,YAAY,IAAb,EAAmBK,iBAAnB,CAAqCvlB,IAArC,EAA2C+J,GAA3C;AACA;AARK,KAAP;AAUA;;AAED;;;;;;;;;;;;iCASc1G,IAAIsP,MAAM;AACvB,QAAIhI,SAAStH,EAAT,CAAJ,EAAkB;AACjB,YAAO,KAAK0f,QAAL,CAAc1f,EAAd,EAAkBuE,KAAlB,CAAwB,KAAKmb,QAA7B,EAAuCpQ,IAAvC,CAAP;AACA,KAFD,MAEO,IAAItI,WAAWhH,EAAX,CAAJ,EAAoB;AAC1B,YAAOA,GAAGuE,KAAH,CAAS,KAAKmb,QAAd,EAAwBpQ,IAAxB,CAAP;AACA;AACD;;AAED;;;;;;;;;;;+BAQY3S,MAAMC,OAAOulB,cAAc;AACtC,QAAId,OAAO,KAAKvB,UAAL,CAAgBnjB,IAAhB,CAAX;AACA,QAAI8hB,SAAS4C,KAAK5C,MAAlB;AACA,QAAIA,OAAOW,MAAX,EAAmB;AAClBxiB,aAAQ,KAAKwlB,aAAL,CAAmB3D,OAAOW,MAA1B,EAAkC,CAACxiB,KAAD,EAAQulB,YAAR,CAAlC,CAAR;AACA;AACD,WAAOvlB,KAAP;AACA;;AAED;;;;;;;;;;;kCAQeD,MAAMC,OAAO;AAC3B,QAAIykB,OAAO,KAAKvB,UAAL,CAAgBnjB,IAAhB,CAAX;AACA,QAAI8hB,SAAS4C,KAAK5C,MAAlB;AACA,QAAIA,OAAOjB,SAAX,EAAsB;AACrB,SAAI6E,kBAAkB,KAAKD,aAAL,CACrB3D,OAAOjB,SADc,EAErB,CAAC5gB,KAAD,EAAQD,IAAR,EAAc,KAAK+iB,QAAnB,CAFqB,CAAtB;;AAKA,SAAI2C,2BAA2Bnd,KAA/B,EAAsC;AACrCkK,cAAQmE,KAAR,eAA0B8O,eAA1B;AACA;AACD,YAAOA,eAAP;AACA;AACD,WAAO,IAAP;AACA;;AAED;;;;;;;;+BAKY1lB,MAAM;AACjB,QAAI0kB,OAAO,KAAKvB,UAAL,CAAgBnjB,IAAhB,CAAX;AACA,WAAO,CAAC0kB,KAAK5C,MAAL,CAAY6D,SAAb,IAA0B,CAACjB,KAAKkB,OAAvC;AACA;;AAED;;;;;;qCAGkB;AACjB;AACA,SAAKzC,UAAL,GAAkB,IAAlB;AACA,SAAKD,mBAAL,GAA2B,IAA3B;AACA;;AAED;;;;;;;qCAIkB;AACjB,QAAI,CAAC,KAAKtR,UAAL,EAAL,EAAwB;AACvB,SAAIxS,OAAO,KAAK8jB,mBAAhB;AACA,UAAKA,mBAAL,GAA2B,IAA3B;AACA,UAAK3Q,IAAL,CAAU,cAAV,EAA0BnT,IAA1B;AACA;AACD;;AAED;;;;;;;;;;;uBAQIY,MAAM;AACT,WAAO,KAAKijB,IAAL,CAAUjjB,IAAV,CAAP;AACA;;AAED;;;;;;;;;4BAMS6lB,WAAW;AACnB,QAAIlB,QAAQ,EAAZ;AACA,QAAIT,QAAQ2B,aAAa,KAAKC,YAAL,EAAzB;;AAEA,SAAK,IAAIjmB,IAAI,CAAb,EAAgBA,IAAIqkB,MAAMpkB,MAA1B,EAAkCD,GAAlC,EAAuC;AACtC8kB,WAAMT,MAAMrkB,CAAN,CAAN,IAAkB,KAAKkW,GAAL,CAASmO,MAAMrkB,CAAN,CAAT,CAAlB;AACA;;AAED,WAAO8kB,KAAP;AACA;;AAED;;;;;;;;;qCAMkB3kB,MAAM;AACvB,WAAO,CAAC,KAAKmjB,UAAL,CAAgBnjB,IAAhB,KAAyB,EAA1B,EAA8B8hB,MAArC;AACA;;AAED;;;;;;;kCAIe;AACd,WAAO,KAAKqB,UAAL,GAAkBtlB,OAAOmS,IAAP,CAAY,KAAKmT,UAAjB,CAAlB,GAAiD,EAAxD;AACA;;AAED;;;;;;;;;;qCAOkBnjB,MAAM;AACvB,QAAI,CAAC,KAAK+lB,eAAL,CAAqB/lB,IAArB,CAAL,EAAiC;AAChC,UAAKgmB,aAAL,CAAmBhmB,IAAnB;AACA,YAAO,KAAKmjB,UAAL,CAAgBnjB,IAAhB,EAAsBC,KAA7B;AACA;AACD;;AAED;;;;;;;;;8BAMWD,MAAM;AAChB,QAAI0kB,OAAO,KAAKvB,UAAL,CAAgBnjB,IAAhB,CAAX;AACA,WAAO0kB,KAAKC,KAAL,KAAehC,MAAMiC,SAAN,CAAgBC,WAA/B,IACN,KAAKoB,gBAAL,CAAsBjmB,IAAtB,CADD;AAEA;;AAED;;;;;;;;;oCAMiBA,MAAM;AACtB,WAAO,KAAKmjB,UAAL,CAAgBnjB,IAAhB,EAAsBpC,cAAtB,CAAqC,cAArC,CAAP;AACA;;AAED;;;;;;;;+BAKYa,KAAK;AAChB,QAAI,CAAC,KAAKsnB,eAAL,CAAqBtnB,GAArB,CAAL,EAAgC;AAC/B,YAAO,CAAC,CAAC,KAAK0kB,UAAL,CAAgB1kB,GAAhB,CAAT;AACA;AACD;;AAED;;;;;;;;;;iCAOcuB,MAAMkmB,SAAS;AAC5B,QAAI,KAAKC,mBAAL,CAAyBnmB,IAAzB,EAA+BkmB,OAA/B,CAAJ,EAA6C;AAC5C,SAAI9mB,OAAO;AACVX,WAAKuB,IADK;AAEVomB,cAAQ,KAAKrQ,GAAL,CAAS/V,IAAT,CAFE;AAGVkmB,eAASA;AAHC,MAAX;AAKA,UAAK3T,IAAL,CAAUvS,OAAO,SAAjB,EAA4BZ,IAA5B;AACA,UAAKmT,IAAL,CAAU,iBAAV,EAA6BnT,IAA7B;AACA,UAAKinB,mBAAL,CAAyBjnB,IAAzB;AACA;AACD;;AAED;;;;;;;;iCAKcY,MAAM;AACnB,QAAI0kB,OAAO,KAAKvB,UAAL,CAAgBnjB,IAAhB,CAAX;AACA,QAAI0kB,KAAKC,KAAL,KAAehC,MAAMiC,SAAN,CAAgBK,aAAnC,EAAkD;AACjD;AACA;;AAEDP,SAAKC,KAAL,GAAahC,MAAMiC,SAAN,CAAgB0B,YAA7B;AACA,SAAKC,gBAAL,CAAsBvmB,IAAtB;AACA,QAAI,CAAC0kB,KAAKkB,OAAV,EAAmB;AAClB,UAAKY,eAAL,CAAqBxmB,IAArB;AACA;AACD0kB,SAAKC,KAAL,GAAahC,MAAMiC,SAAN,CAAgBC,WAA7B;AACA;;AAED;;;;;;;;;;;AAoBA;;;;;uCAKoB;AACnBha,8BAA0B,KAAKpC,WAA/B,EAA4C,cAA5C,EAA4D,UAASge,MAAT,EAAiB;AAC5E,YAAOtb,MAAMQ,OAAN,CAAc8a,MAAd,EAAsB5W,MAAtB,CAA6B,UAAS7E,MAAT,EAAiBjB,GAAjB,EAAsB;AACzD,UAAIA,GAAJ,EAAS;AACRiB,cAAOjB,GAAP,IAAc,IAAd;AACA;AACD,aAAOiB,MAAP;AACA,MALM,EAKJ,EALI,CAAP;AAMA,KAPD;AAQA;;AAED;;;;;;;kCAIehL,MAAM;AACpB,SAAKmjB,UAAL,CAAgBnjB,IAAhB,IAAwB,IAAxB;AACA,WAAO,KAAKijB,IAAL,CAAUjjB,IAAV,CAAP;AACA;;AAED;;;;;;;;uCAKoB0mB,YAAY;AAC/B,QAAI,CAAC,KAAKxD,mBAAV,EAA+B;AAC9B/W,WAAMG,QAAN,CAAe,KAAKqa,eAApB,EAAqC,IAArC;AACA,UAAKzD,mBAAL,GAA2B;AAC1B0D,eAAS;AADiB,MAA3B;AAGA;;AAED,QAAI5mB,OAAO0mB,WAAWjoB,GAAtB;AACA,QAAImoB,UAAU,KAAK1D,mBAAL,CAAyB0D,OAAvC;AACA,QAAIA,QAAQ5mB,IAAR,CAAJ,EAAmB;AAClB4mB,aAAQ5mB,IAAR,EAAcomB,MAAd,GAAuBM,WAAWN,MAAlC;AACA,KAFD,MAEO;AACNQ,aAAQ5mB,IAAR,IAAgB0mB,UAAhB;AACA;AACD;;AAED;;;;;;;;;;;;uBASI1mB,MAAMC,OAAO;AAChB,QAAI,KAAK4mB,WAAL,CAAiB7mB,IAAjB,CAAJ,EAA4B;AAC3B,UAAKijB,IAAL,CAAUjjB,IAAV,IAAkBC,KAAlB;AACA;AACD;;AAED;;;;;;;;mCAKgBD,MAAM;AACrB,QAAI8hB,SAAS,KAAKqB,UAAL,CAAgBnjB,IAAhB,EAAsB8hB,MAAnC;;AAEA,QAAIA,OAAO7hB,KAAP,KAAiBC,SAArB,EAAgC;AAC/B,UAAKolB,GAAL,CAAStlB,IAAT,EAAe8hB,OAAO7hB,KAAtB;AACA,KAFD,MAEO;AACN,UAAKqlB,GAAL,CAAStlB,IAAT,EAAe,KAAKylB,aAAL,CAAmB3D,OAAOgF,OAA1B,CAAf;AACA;AACD;;AAED;;;;;;;;;oCAMiB9mB,MAAM;AACtB,QAAI,KAAKimB,gBAAL,CAAsBjmB,IAAtB,CAAJ,EAAiC;AAChC,SAAI0kB,OAAO,KAAKvB,UAAL,CAAgBnjB,IAAhB,CAAX;AACA,UAAKslB,GAAL,CAAStlB,IAAT,EAAe0kB,KAAKnB,YAApB;AACAmB,UAAKnB,YAAL,GAAoBrjB,SAApB;AACA;AACD;;AAED;;;;;;;qCAIkB6mB,WAAW;AAC5B,SAAK/D,cAAL,GAAsB+D,SAAtB;AACA;;AAED;;;;;;;;;;4BAOSN,QAAQ1H,cAAc;AAAA;;AAC9BlhB,WAAOmS,IAAP,CAAYyW,MAAZ,EAAoBlR,OAApB,CAA4B;AAAA,YAAQ,OAAK+P,GAAL,CAAStlB,IAAT,EAAeymB,OAAOzmB,IAAP,CAAf,CAAR;AAAA,KAA5B;AACA,QAAI+e,gBAAgB,KAAKmE,mBAAzB,EAA8C;AAC7C,UAAKxH,IAAL,CAAU,cAAV,EAA0BqD,YAA1B;AACA;AACD;;AAED;;;;;;;;;;;qCAQkB/e,MAAMC,OAAO;AAC9B,QAAI,KAAK8lB,eAAL,CAAqB/lB,IAArB,KACH,CAAC,KAAKgnB,WAAL,CAAiBhnB,IAAjB,CADE,IAEH,CAAC,KAAKinB,iBAAL,CAAuBjnB,IAAvB,EAA6BC,KAA7B,CAFF,EAEuC;AACtC;AACA;;AAED,QAAIykB,OAAO,KAAKvB,UAAL,CAAgBnjB,IAAhB,CAAX;AACA,QAAI,CAAC,KAAKimB,gBAAL,CAAsBjmB,IAAtB,CAAD,IAAgC0kB,KAAKC,KAAL,KAAehC,MAAMiC,SAAN,CAAgBK,aAAnE,EAAkF;AACjFP,UAAKC,KAAL,GAAahC,MAAMiC,SAAN,CAAgBC,WAA7B;AACA;;AAED,QAAIqB,UAAU,KAAKnQ,GAAL,CAAS/V,IAAT,CAAd;AACA0kB,SAAKzkB,KAAL,GAAa,KAAKinB,WAAL,CAAiBlnB,IAAjB,EAAuBC,KAAvB,EAA8BimB,OAA9B,CAAb;AACA,SAAKtC,sBAAL,CAA4B5jB,IAA5B;AACA0kB,SAAKkB,OAAL,GAAe,IAAf;AACA,SAAKuB,aAAL,CAAmBnnB,IAAnB,EAAyBkmB,OAAzB;AACA;;AAED;;;;;;;;;;;;;;;uCAYoBlmB,MAAMkmB,SAAS;AAClC,QAAIxB,OAAO,KAAKvB,UAAL,CAAgBnjB,IAAhB,CAAX;AACA,WAAQ0kB,KAAKC,KAAL,KAAehC,MAAMiC,SAAN,CAAgBC,WAAhC,KACLra,SAAS0b,OAAT,KAAqBA,YAAY,KAAKnQ,GAAL,CAAS/V,IAAT,CAD5B,CAAP;AAEA;;AAED;;;;;;;;yCAKsBA,MAAM;AAC3B,QAAI0kB,OAAO,KAAKvB,UAAL,CAAgBnjB,IAAhB,CAAX;AACA,QAAI,KAAKimB,gBAAL,CAAsBjmB,IAAtB,KAA+B,CAAC,KAAKonB,cAAL,CAAoBpnB,IAApB,EAA0B0kB,KAAKnB,YAA/B,CAApC,EAAkF;AACjF,YAAOmB,KAAKnB,YAAZ;AACA;AACD;;AAED;;;;;;;;;;;qCAQkBvjB,MAAMC,OAAO;AAC9B,QAAIykB,OAAO,KAAKvB,UAAL,CAAgBnjB,IAAhB,CAAX;;AAEA,WAAO0kB,KAAKC,KAAL,KAAehC,MAAMiC,SAAN,CAAgB0B,YAA/B,IACN,KAAKc,cAAL,CAAoBpnB,IAApB,EAA0BC,KAA1B,CADD;AAEA;;AAED;;;;;;;;;mCAMgBD,MAAM;AACrB,QAAMqnB,WAAW,KAAKzV,UAAL,EAAjB;AACA,QAAIyV,QAAJ,EAAc;AACb5U,aAAQC,IAAR,wCACsC1S,IADtC;AAGA;AACD,WAAOqnB,QAAP;AACA;;;8BArNiBZ,QAAQ;AACzB,WAAOlX,OAAOiF,KAAP,CAAa5M,KAAb,CAAmB,IAAnB,EAAyB,CAAC,EAAD,EAAKiL,MAAL,CAAY4T,OAAOa,OAAP,EAAZ,CAAzB,CAAP;AACA;;AAED;;;;;;;;;oCAMwBjD,MAAM;AAC7B,WAAOxZ,0BAA0BwZ,IAA1B,EAAgC,OAAhC,EAAyC1B,MAAM4E,UAA/C,CAAP;AACA;;;GAzekB1V;;AAqrBpB;;;;;;;;AAMA8Q,OAAM6E,YAAN,GAAqB,CAAC,OAAD,EAAU,UAAV,CAArB;;AAEA;;;;AAIA7E,OAAMiC,SAAN,GAAkB;AACjBK,iBAAe,CADE;AAEjBqB,gBAAc,CAFG;AAGjBzB,eAAa;AAHI,EAAlB;;0BAMelC;;AC5tBf;;;MAEOrC;MACAiC;MACAI;2BAEQA;;8CACNrC;0CAAYiC;yCAAQI;;ACP7B;;;KAESxX;KAAON;KAA2B0E;KAClCsC;KAAcqC;KAChByO;;KAED8E;;;AACL;;;;;AAKA,gCAAYC,SAAZ,EAAuBtoB,IAAvB,EAA6B;AAAA;;AAAA;;AAE5B,SAAKuoB,UAAL,GAAkBD,SAAlB;;AAEA7c,6BACC,MAAKpC,WADN,EAEC,WAFD,EAGC0C,MAAMyc,iBAHP;AAKAjF,SAAM4B,gBAAN,CAAuB,MAAKoD,UAAL,CAAgBlf,WAAvC;;AAEA,SAAKof,YAAL,CAAkBzoB,IAAlB,EAAwB,MAAKuoB,UAA7B;AAX4B;AAY5B;;AAED;;;;;;;;;;yBAMM;AAAA;;AACL,oBAAKG,MAAL,EAAYtD,UAAZ,gBAA0Bjd,SAA1B;AACA;;AAED;;;;;;;;;2CAMwBnI,MAAM;AAC7B,WAAOmQ,OAAOiF,KAAP,CAAa,EAAb,EAAiBpV,IAAjB,EAAuB,KAAKuoB,UAAL,CAAgBlf,WAAhB,CAA4Bgc,YAAnD,CAAP;AACA;;AAED;;;;;;;;;gCAMarlB,MAAM2oB,QAAQ;AAC1B,QAAMpD,QAAQ,IAAIhC,KAAJ,CAAU,EAAV,EAAcoF,MAAd,EAAsB,KAAKJ,UAA3B,CAAd;AACAhD,UAAMqD,iBAAN,CAAwB,KAAKvf,WAAL,CAAiBwf,gBAAzC;AACAtD,UAAMH,UAAN,CACC,KAAK0D,uBAAL,CAA6B9oB,IAA7B,CADD,EAEC,KAAKuoB,UAAL,CAAgBQ,gBAAhB,EAFD;;AAKA,QAAM5W,WAAW,KAAK6W,KAAL,CAAWlb,IAAX,CAAgB,IAAhB,CAAjB;AACAyX,UAAM3P,EAAN,CAAS,cAAT,EAAyBzD,QAAzB;AACAoT,UAAM3P,EAAN,CAAS,iBAAT,EAA4BzD,QAA5B;AACA,SAAKuW,MAAL,GAAcnD,KAAd;;AAEA,SAAK0D,MAAL,GAAc,IAAInU,iBAAJ,CAAsByQ,KAAtB,EAA6B,KAAKgD,UAAlC,CAAd;AACA;;AAED;;;;;;qCAGkB;AACjB;;AAEA,SAAKG,MAAL,CAAYQ,OAAZ;AACA,SAAKR,MAAL,GAAc,IAAd;;AAEA,SAAKO,MAAL,CAAYC,OAAZ;AACA,SAAKD,MAAL,GAAc,IAAd;AACA;;AAED;;;;;;;;;yBAMMjpB,MAAMkS,OAAO;AAClB,QAAMiX,OAAOjX,MAAM1K,IAAnB;AACA,QAAM5G,OAAOuoB,SAAS,cAAT,GAA0B,aAA1B,GAA0C,iBAAvD;AACA,SAAKhW,IAAL,CAAUvS,IAAV,EAAgBZ,IAAhB;AACA;;AAED;;;;;;;;uBAKIY,MAAM;AACT,WAAO,KAAK8nB,MAAL,CAAY/R,GAAZ,CAAgB/V,IAAhB,CAAP;AACA;;AAED;;;;;;;iCAIc;AACb,WAAO,KAAK8nB,MAAL,CAAYhC,YAAZ,EAAP;AACA;;AAED;;;;;;;kCAIe;AACd,WAAO,KAAKgC,MAAL,CAAYhC,YAAZ,EAAP;AACA;;AAED;;;;;;;8BAIW;AACV,WAAO,KAAKgC,MAAL,CAAYU,QAAZ,EAAP;AACA;;AAED;;;;;;;sCAImB;AAClB,WAAO,KAAKV,MAAZ;AACA;;AAED;;;;;;;;sCAKmB1oB,MAAM;AACxBqoB,yBAAqBgB,kBAArB,CAAwCrpB,IAAxC,EAA8C,KAAK0oB,MAAnD;AACA;;AAED;;;;;;;;;;;AAoBA;;;;;;;4BAOSnD,OAAO5F,cAAc;AAC7B,SAAK+I,MAAL,CAAYY,QAAZ,CAAqB/D,KAArB,EAA4B5F,YAA5B;AACA;;;sCAvByB3f,MAAMulB,OAAO;AACtC,QAAM3U,OAAO2U,MAAMmB,YAAN,EAAb;AACA,SAAK,IAAIjmB,IAAI,CAAb,EAAgBA,IAAImQ,KAAKlQ,MAAzB,EAAiCD,GAAjC,EAAsC;AACrC,SAAMpB,MAAMuR,KAAKnQ,CAAL,CAAZ;AACA,SAAI,CAAC8kB,MAAMgE,iBAAN,CAAwBlqB,GAAxB,EAA6BmqB,QAAlC,EAA4C;AAC3C,UAAIxpB,KAAKxB,cAAL,CAAoBa,GAApB,CAAJ,EAA8B;AAC7BkmB,aAAMW,GAAN,CAAU7mB,GAAV,EAAeW,KAAKX,GAAL,CAAf;AACA,OAFD,MAEO;AACNkmB,aAAM6B,eAAN,CAAsB/nB,GAAtB;AACA;AACD;AACD;AACD;;;GA3JiCoT;;AAyKnC4V,sBAAqBoB,SAArB,GAAiC;AAChCC,cAAY,IADoB;AAEhCjmB,WAAS,IAFuB;AAGhCoO,WAAS,IAHuB;AAIhC8X,QAAM,IAJ0B;AAKhCC,eAAa;AALmB,EAAjC;;yCAQevB;;ACvLf;;;KAES5V;KAAc6D;;AAEvB;;;;;KAIMuT;;;AACL;;;;;AAKA,6BAAYvB,SAAZ,EAAuB;AAAA;;AAAA;;AAEtB,SAAKC,UAAL,GAAkBD,SAAlB;;AAEA,SAAKwB,wBAAL,GAAgC,IAAIxT,YAAJ,EAAhC;AACA,SAAKwT,wBAAL,CAA8B1R,GAA9B,CACC,MAAKmQ,UAAL,CAAgBjM,IAAhB,CAAqB,QAArB,EAA+B,MAAKyN,MAAL,CAAYjc,IAAZ,OAA/B,CADD;AAGA,SAAK8H,EAAL,CAAQ,UAAR,EAAoB,MAAKoU,eAAzB;AACA1B,aAAU1S,EAAV,CAAa,oBAAb,EAAmC,MAAKqU,yBAAL,CAA+Bnc,IAA/B,OAAnC;AATsB;AAUtB;;AAED;;;;;;;qCAGkB;AACjB,SAAKgc,wBAAL,CAA8BI,kBAA9B;AACA,SAAKJ,wBAAL,GAAgC,IAAhC;AACA;;AAED;;;;;;;kCAIe;AACd,WAAO,KAAKvB,UAAZ;AACA;;AAED;;;;;;;;+CAK4B;AAC3B,QAAM4B,UAAU,KAAK5B,UAAL,CAAgB6B,cAAhB,EAAhB;AACA,QAAI,KAAK7B,UAAL,CAAgBlf,WAAhB,CAA4BghB,mBAAhC,EAAqD;AACpD,UAAKP,wBAAL,CAA8B1R,GAA9B,CACC+R,QAAQvU,EAAR,CACC,iBADD,EAEC,KAAK0U,6BAAL,CAAmCxc,IAAnC,CAAwC,IAAxC,CAFD,CADD;AAMA,KAPD,MAOO;AACN,UAAKgc,wBAAL,CAA8B1R,GAA9B,CACC+R,QAAQvU,EAAR,CACC,aADD,EAEC,KAAK2U,yBAAL,CAA+Bzc,IAA/B,CAAoC,IAApC,CAFD,CADD;AAMA;AACD;;AAED;;;;;;;;;;;;6CAS0B0Z,SAAS;AAClC,QAAI,KAAKgD,eAAL,EAAJ,EAA4B;AAC3B,UAAKC,MAAL,CAAYjD,OAAZ;AACA;AACD;;AAED;;;;;;;;;;iDAO8BxnB,MAAM;AACnC,QAAI,KAAKwqB,eAAL,EAAJ,EAA4B;AAC3B,UAAKC,MAAL,CAAY;AACXjD,+CACExnB,KAAKX,GADP,EACaW,IADb;AADW,MAAZ;AAKA;AACD;;AAED;;;;;;;qCAIkB;AACjB,SAAK0qB,WAAL,GAAmB,IAAnB;AACA;;AAED;;;;;;4BAGS;AACR,QAAI,CAAC,KAAKnC,UAAL,CAAgB1W,OAArB,EAA8B;AAC7B,UAAK0W,UAAL,CAAgB1W,OAAhB,GAA0BrD,SAASjN,aAAT,CAAuB,KAAvB,CAA1B;AACA;AACD,SAAK4R,IAAL,CAAU,UAAV,EAAsB,CAAC,KAAKuX,WAA5B;AACA;;AAED;;;;;;;;qCAKkB;AACjB,WAAO,KAAKA,WAAL,IAAoB,CAAC,KAAKC,YAAjC;AACA;;AAED;;;;;;sCAGmB;AAClB,SAAKA,YAAL,GAAoB,IAApB;AACA;;AAED;;;;;;qCAGkB;AACjB,SAAKA,YAAL,GAAoB,KAApB;AACA;;AAED;;;;;;;;;;4BAOS,CAAE;;;GA1IoBlY;;sCA6IjBoX;;ACrJf;;;KAGC9d;KACA/B;KACAU;KACAG;KACA1K;KACA8K;KACAG;KACAG;KACAE;KACA0E;KAEQoO;KAAsBlB;KACxBgL;KACAwB;KACEpX;KAAc6D;;AAEvB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KA4CMsU;;;AACL;;;;;;;;;;AAUA,qBAAYpH,UAAZ,EAAwBqH,iBAAxB,EAA2C;AAAA;;AAG1C;;;;;;AAH0C;;AAS1C,SAAKC,kBAAL,GAA0B,EAA1B;;AAEA;;;;AAIA,SAAKpB,UAAL,GAAkB,EAAlB;;AAEA;;;;;;AAMA,SAAKqB,kBAAL,GAA0B,IAA1B;;AAEA;;;;;AAKA,SAAKC,sBAAL,GAA8B,IAAI1U,YAAJ,EAA9B;;AAEA;;;;AAIA,SAAK2U,UAAL,GAAkB,KAAlB;;AAEA;;;;;AAKA,SAAKC,cAAL,GAAsB1H,cAAc,EAApC;;AAEA;;;;AAIA,SAAKoG,WAAL,GAAmB,KAAnB;;AAEA;;;;;;AAMA,SAAKuB,sBAAL,GAA8B3c,SAASgM,IAAvC;;AAEA/O,6BAA0B,MAAKpC,WAA/B,EAA4C,iBAA5C,EAA+D,MAAK+hB,oBAApE;AACA3f,6BAA0B,MAAKpC,WAA/B,EAA4C,cAA5C,EAA4D0C,MAAMyc,iBAAlE;;AAEA,SAAK3W,OAAL,GAAe,MAAKqZ,cAAL,CAAoBrZ,OAAnC;;AAEA,SAAKwZ,SAAL,GAAiB,MAAKC,cAAL,EAAjB;AACA,SAAKD,SAAL,CAAezV,EAAf,CAAkB,UAAlB,EAA8B,MAAK2V,uBAAL,CAA6Bzd,IAA7B,OAA9B;;AAEA,SAAK0d,YAAL,GAAoB,MAAKC,iBAAL,EAApB;AACA,SAAKtY,IAAL,CAAU,oBAAV;;AAEA,SAAKyC,EAAL,CAAQ,cAAR,EAAwB,MAAK8V,mBAA7B;AACA,SAAKC,kBAAL,GAA0B,MAAK/V,EAAL,CAAQ,aAAR,EAAuB,MAAKgW,kBAA5B,CAA1B;AACA,SAAKhW,EAAL,CAAQ,eAAR,EAAyB,MAAKiW,gBAA9B;AACA,SAAKC,oBAAL,CAA0B,MAAKN,YAAL,CAAkB7U,GAAlB,CAAsB,QAAtB,CAA1B;;AAEA,SAAKzU,OAAL;AACA,SAAK6pB,iBAAL,GAAyB,IAAzB;AACA,OAAIlB,sBAAsB,KAA1B,EAAiC;AAChC,UAAKmB,OAAL,CAAanB,iBAAb;AACA;AACD,SAAKjV,EAAL,CAAQ,gBAAR,EAA0B,MAAKqW,iBAA/B;AAhF0C;AAiF1C;;AAED;;;;;;;;;;AAQA;;;;;wCAKqBpZ,QAAQ;AAC5B,QAAIqZ,aAAaztB,OAAOmS,IAAP,CAAYiC,UAAU,EAAtB,CAAjB;AACA,SAAK,IAAIpS,IAAI,CAAb,EAAgBA,IAAIyrB,WAAWxrB,MAA/B,EAAuCD,GAAvC,EAA4C;AAC3C,SAAI6kB,OAAO,KAAK6G,oBAAL,CAA0BtZ,OAAOqZ,WAAWzrB,CAAX,CAAP,CAA1B,CAAX;AACA,SAAI6kB,KAAKrhB,EAAT,EAAa;AACZ,UAAI8V,OAAJ;AACA,UAAIuL,KAAK1O,QAAT,EAAmB;AAClBmD,iBAAU,KAAKJ,QAAL,CAAcuS,WAAWzrB,CAAX,CAAd,EAA6B6kB,KAAK1O,QAAlC,EAA4C0O,KAAKrhB,EAAjD,CAAV;AACA,OAFD,MAEO;AACN8V,iBAAU,KAAKnE,EAAL,CAAQsW,WAAWzrB,CAAX,CAAR,EAAuB6kB,KAAKrhB,EAA5B,CAAV;AACA;AACD,WAAK+mB,sBAAL,CAA4B5S,GAA5B,CAAgC2B,OAAhC;AACA;AACD;AACD;;AAED;;;;;;;;;;;;;;;;0BAaO8Q,mBAAmBuB,oBAAoB;AAC7C,QAAI,CAAC,KAAKnB,UAAV,EAAsB;AACrB,UAAKoB,cAAL,CAAoBxB,iBAApB,EAAuCuB,kBAAvC;AACA,UAAKnB,UAAL,GAAkB,IAAlB;AACA,UAAK9X,IAAL,CAAU,UAAV,EAAsB;AACrB9R,cAAQwpB,iBADa;AAErByB,eAASF;AAFY,MAAtB;AAIA,UAAKG,QAAL;AACA;AACD,WAAO,IAAP;AACA;;AAED;;;;;;;;;;8BAOW,CAAE;;AAEb;;;;;;;;mCAKgBC,KAAKlE,WAAW;AAC/B,SAAKoB,UAAL,CAAgB8C,GAAhB,IAAuBlE,SAAvB;AACA;;AAED;;;;;;;6BAIU,CAAE;;AAEZ;;;;;;;;uCAKoB;AACnB7c,8BAA0B,KAAKpC,WAA/B,EAA4C,cAA5C,EAA4D0C,MAAMyc,iBAAlE;AACA,WAAO,IAAI,KAAKnf,WAAL,CAAiBojB,mBAArB,CAAyC,IAAzC,EAA+C7B,UAAU8B,IAAzD,CAAP;AACA;;AAED;;;;;;;;oCAKiB;AAChBjhB,8BAA0B,KAAKpC,WAA/B,EAA4C,UAA5C,EAAwD0C,MAAMyc,iBAA9D;AACA,WAAO,IAAI,KAAKnf,WAAL,CAAiBsjB,eAArB,CAAqC,IAArC,CAAP;AACA;;AAED;;;;;;;;;;;;4BASSnU,WAAW5B,UAAUzJ,UAAU;AACvC,WAAO,KAAKyI,EAAL,CAAQ,cAAc4C,SAAd,GAA0B,GAA1B,GAAgC5B,QAAxC,EAAkDzJ,QAAlD,CAAP;AACA;;AAED;;;;;;;;;;4BAOS;AACR,QAAI,KAAK8d,UAAT,EAAqB;AACpB,SAAI,KAAKpZ,OAAL,IAAgB,KAAKA,OAAL,CAAatR,UAAjC,EAA6C;AAC5C,WAAKsR,OAAL,CAAatR,UAAb,CAAwB0E,WAAxB,CAAoC,KAAK4M,OAAzC;AACA;AACD,UAAKoZ,UAAL,GAAkB,KAAlB;AACA,UAAK2B,QAAL;AACA;AACD,SAAKzZ,IAAL,CAAU,UAAV;AACA,WAAO,IAAP;AACA;;AAED;;;;;;;;;;8BAOW,CAAE;;AAEb;;;;;;;8BAIW,CAAE;;AAEb;;;;;;qCAGkB;AACjB,SAAK8U,QAAL;;AAEA,SAAK4E,MAAL;;AAEA,QAAI,KAAK9B,kBAAT,EAA6B;AAC5B,UAAKA,kBAAL,CAAwB7B,OAAxB;AACA,UAAK6B,kBAAL,GAA0B,IAA1B;AACA;;AAED,SAAK+B,oBAAL,CAA0BruB,OAAOmS,IAAP,CAAY,KAAK8Y,UAAjB,CAA1B;AACA,SAAKA,UAAL,GAAkB,IAAlB;;AAEA,SAAK8B,YAAL,CAAkBtC,OAAlB;AACA,SAAKsC,YAAL,GAAoB,IAApB;;AAEA,SAAKH,SAAL,CAAenC,OAAf;AACA,SAAKmC,SAAL,GAAiB,IAAjB;;AAEA;AACA;;AAED;;;;;;;wCAIqBza,MAAM;AAC1B,SAAK,IAAInQ,IAAI,CAAb,EAAgBA,IAAImQ,KAAKlQ,MAAzB,EAAiCD,GAAjC,EAAsC;AACrC,SAAI6nB,YAAY,KAAKoB,UAAL,CAAgB9Y,KAAKnQ,CAAL,CAAhB,CAAhB;AACA,SAAI6nB,aAAa,CAACA,UAAU9V,UAAV,EAAlB,EAA0C;AACzC8V,gBAAUzW,OAAV,GAAoB,IAApB;AACAyW,gBAAUY,OAAV;AACA,aAAO,KAAKQ,UAAL,CAAgB9Y,KAAKnQ,CAAL,CAAhB,CAAP;AACA;AACD;AACD;;AAED;;;;;;;;;wCAMqBI,OAAO;AAC3B,QAAIykB,OAAO;AACVrhB,SAAIpD;AADM,KAAX;AAGA,QAAIuK,SAASvK,KAAT,KAAmB,CAACoK,WAAWpK,KAAX,CAAxB,EAA2C;AAC1CykB,UAAK1O,QAAL,GAAgB/V,MAAM+V,QAAtB;AACA0O,UAAKrhB,EAAL,GAAUpD,MAAMoD,EAAhB;AACA;AACD,QAAIsH,SAAS+Z,KAAKrhB,EAAd,CAAJ,EAAuB;AACtBqhB,UAAKrhB,EAAL,GAAU,KAAK8oB,aAAL,CAAmBzH,KAAKrhB,EAAxB,CAAV;AACA;AACD,WAAOqhB,IAAP;AACA;;AAED;;;;;;;oCAIiB;AAChB,WAAO,KAAKkG,YAAZ;AACA;;AAED;;;;;;;sCAImB;AAClB,WAAO,KAAKN,cAAZ;AACA;;AAED;;;;;;;;;;iCAOc8B,QAAQ;AACrB,QAAI/hB,WAAW,KAAK+hB,MAAL,CAAX,CAAJ,EAA8B;AAC7B,YAAO,KAAKA,MAAL,EAAalf,IAAb,CAAkB,IAAlB,CAAP;AACA,KAFD,MAEO;AACNuF,aAAQmE,KAAR,CAAc,wBAAwBwV,MAAxB,GAAiC,qBAAjC,GACb,aADa,GACGhjB,gBAAgB,KAAKX,WAArB,CADH,GACuC,UADvC,GAEb,0EAFD;AAIA;AACD;;AAED;;;;;;;8BAIW;AACV,WAAO,KAAKmiB,YAAL,CAAkBpC,QAAlB,EAAP;AACA;;AAED;;;;;;;kCAIe;AACd,WAAO,KAAKoC,YAAL,CAAkB9E,YAAlB,EAAP;AACA;;AAED;;;;;;;;;;uCAOoBrnB,KAAK4tB,YAAY;AACpC,QAAIhpB,KAAK,KAAK,SAAS5E,IAAI6tB,MAAJ,CAAW,CAAX,EAAc/N,WAAd,EAAT,GAAuC9f,IAAImU,KAAJ,CAAU,CAAV,CAA5C,CAAT;AACA,QAAIvI,WAAWhH,EAAX,CAAJ,EAAoB;AACnB,SAAI,CAACgpB,UAAL,EAAiB;AAChB,UAAI9C,UAAU,KAAKC,cAAL,EAAd;AACA6C,mBAAa;AACZjG,eAAQmD,QAAQxT,GAAR,CAAYtX,GAAZ,CADI;AAEZynB,gBAAShmB;AAFG,OAAb;AAIA;AACDmD,QAAGjF,IAAH,CAAQ,IAAR,EAAciuB,WAAWjG,MAAzB,EAAiCiG,WAAWnG,OAA5C;AACA;AACD;;AAED;;;;;;;iCAIc;AACb,WAAO,KAAKuE,SAAZ;AACA;;AAED;;;;;;;;2CAKwBrrB,MAAM;AAC7B,SAAKmtB,QAAL,CAAcntB,IAAd;AACA,SAAKmT,IAAL,CAAU,UAAV,EAAsBnT,IAAtB;AACA;;AAED;;;;;;;;;uCAMoBkS,OAAO;AAC1B,SAAKkb,qBAAL,CAA2Blb,MAAMsV,OAAjC;AACA,SAAKrU,IAAL,CAAU,aAAV,EAAyBjB,KAAzB;AACA;;AAED;;;;;;;;;sCAMmBA,OAAO;AACzB,SAAK4Y,kBAAL,CAAwB5Y,KAAxB,IAAiC,IAAjC;AACA;;AAED;;;;;;;;;;AASA;;;;;;wCAMqBmV,QAAQ;AAC5B,QAAIgG,SAAS,EAAb;AACA,WAAOhG,OAAOiG,MAAP,CAAc,UAAS3iB,GAAT,EAAc;AAClC,SAAI,CAACA,GAAD,IAAQ0iB,OAAO1iB,GAAP,CAAZ,EAAyB;AACxB,aAAO,KAAP;AACA,MAFD,MAEO;AACN0iB,aAAO1iB,GAAP,IAAc,IAAd;AACA,aAAO,IAAP;AACA;AACD,KAPM,EAOJ4iB,IAPI,CAOC,GAPD,CAAP;AAQA;;AAED;;;;;;;;qCAKkBrb,OAAO;AACxB,SAAKsb,WAAL;AACA,SAAKzC,kBAAL,CAAwB0C,gBAAxB,CAAyCvb,MAAM8U,MAA/C;AACA,QAAI9U,MAAM8U,MAAV,EAAkB;AACjB,UAAK0G,WAAL,CAAiB,KAAKlC,YAAL,CAAkB7U,GAAlB,CAAsB,SAAtB,CAAjB;AACA;AACD;;AAED;;;;;;;;oCAKiBzE,OAAO;AACvB,SAAK8Y,sBAAL,CAA4Bd,kBAA5B;AACA,SAAK4B,oBAAL,CAA0B5Z,MAAM8U,MAAhC;AACA;;AAED;;;;;;;;;;;;;;;AAsBA;;;;;;;;;;;;;;;;;;2BAkBQ6D,mBAAmB8C,gBAAgB;AAC1C,QAAI,CAACA,cAAL,EAAqB;AACpB,UAAKxa,IAAL,CAAU,QAAV;AACA;AACD,SAAKqa,WAAL;AACA,SAAKI,UAAL;AACA,SAAKC,MAAL,CAAYhD,iBAAZ;AACA,SAAKjB,WAAL,GAAmB,IAAnB;AACA;;AAED;;;;;;;;;0CAMuB;AACtB,SAAKoC,OAAL,CAAa,IAAb,EAAmB,IAAnB;AACA;;AAED;;;;;;;;;;;;;kCAUenB,mBAAmBuB,oBAAoB;AACrD,QAAIva,UAAU,KAAKA,OAAnB;AACA,QAAIA,YAAYua,sBAAsB,CAACva,QAAQtR,UAA3C,CAAJ,EAA4D;AAC3D,SAAIc,SAASgc,UAAUwN,iBAAV,KAAgC,KAAKM,sBAAlD;AACA9pB,YAAOmC,YAAP,CAAoBqO,OAApB,EAA6BwL,UAAU+O,kBAAV,CAA7B;AACA;AACD;;AAED;;;;;;;;;AAyBA;;;;;;;4BAOS7G,OAAO5F,cAAc;AAC7B,SAAK6L,YAAL,CAAkBlC,QAAlB,CAA2B/D,KAA3B,EAAkC5F,YAAlC;AACA;;AAED;;;;;;;;;;2CAOwBhV,KAAK;AAC5B,QAAI,KAAKtB,WAAL,CAAiBykB,sBAArB,EAA6C;AAC5CnjB,YAAO,MAAM,KAAKtB,WAAL,CAAiBykB,sBAA9B;AACA;AACD,WAAOnjB,IAAIkS,IAAJ,EAAP;AACA;;AAED;;;;;;;;iCAKc;AACb,QAAI,KAAKkO,kBAAT,EAA6B;AAC5B;AACA;;AAED,QAAIgD,QAAQ,IAAIxP,oBAAJ,CAAyB,KAAK1M,OAA9B,EAAuC,IAAvC,CAAZ;AACA,SAAKkZ,kBAAL,GAA0BgD,KAA1B;;AAEA5d,WAAOrR,GAAP,CAAW,KAAKgsB,kBAAhB,EAAoCiD,MAAM3X,UAAN,CAAiBtI,IAAjB,CAAsBigB,KAAtB,CAApC;AACA,SAAKjD,kBAAL,GAA0B,IAA1B;;AAEA,SAAKa,kBAAL,CAAwBpZ,cAAxB;AACA,SAAKoZ,kBAAL,GAA0B,IAA1B;AACA;;AAED;;;;;;;gCAIa;AACZ,QAAI/a,OAAO,KAAK4a,YAAL,CAAkBwC,WAAlB,EAAX;AACA,SAAK,IAAIvtB,IAAI,CAAb,EAAgBA,IAAImQ,KAAKlQ,MAAzB,EAAiCD,GAAjC,EAAsC;AACrC,UAAKwtB,mBAAL,CAAyBrd,KAAKnQ,CAAL,CAAzB;AACA;AACD;;AAED;;;;;;;;;yCAMsB+mB,SAAS;AAC9B,SAAK,IAAInoB,GAAT,IAAgBmoB,OAAhB,EAAyB;AACxB,UAAKyG,mBAAL,CAAyB5uB,GAAzB,EAA8BmoB,QAAQnoB,GAAR,CAA9B;AACA;AACD;;AAED;;;;;;;;+BAKY2nB,QAAQ;AACnB,QAAI,KAAKnV,OAAT,EAAkB;AACjB,UAAKA,OAAL,CAAa9K,KAAb,CAAmB0H,OAAnB,GAA6BuY,SAAS,EAAT,GAAc,MAA3C;AACA;AACD;;AAED;;;;;;;;8BAKW,CAAE;;AAEb;;;;;;;;;sCAMmBrc,KAAK;AACvB,WAAO,CAACE,gBAAgBF,GAAhB,CAAD,IAAyBS,SAAST,GAAT,CAAhC;AACA;;;uBA/iBa;AACb,WAAO,KAAKujB,WAAZ;AACA;qBA0bWvjB,KAAK;AAChB,QAAI,CAACxK,UAAUwK,GAAV,CAAD,IAAmB,CAACY,SAASZ,GAAT,CAApB,IAAqCE,gBAAgBF,GAAhB,CAAzC,EAA+D;AAC9D;AACA;;AAED,QAAIA,GAAJ,EAAS;AACRA,WAAM0S,UAAU1S,GAAV,KAAkB,KAAKujB,WAA7B;AACA;;AAED,QAAI,KAAKA,WAAL,KAAqBvjB,GAAzB,EAA8B;AAC7B,SAAI5H,OAAO,KAAKmrB,WAAhB;AACA,UAAKA,WAAL,GAAmBvjB,GAAnB;AACA,SAAI,KAAKohB,iBAAT,EAA4B;AAC3B,WAAK5Y,IAAL,CAAU,gBAAV,EAA4B;AAC3B2T,gBAAS/jB,IADkB;AAE3BikB,eAAQrc;AAFmB,OAA5B;AAIA;AACD;AACD;;;mCAlJsB1G,IAAI;AAC1B,WAAOA,GAAGvF,SAAH,IAAgBuF,GAAGvF,SAAH,CAAaksB,UAAUuD,cAAvB,CAAvB;AACA;;;0BAqDaC,MAAMC,qBAAqBC,aAAa;AACrD,QAAI5L,SAAS2L,mBAAb;AACA,QAAIxc,UAAUyc,WAAd;AACA,QAAInuB,UAAUkuB,mBAAV,CAAJ,EAAoC;AACnC3L,cAAS,IAAT;AACA7Q,eAAUwc,mBAAV;AACA;AACD,QAAIE,WAAW,IAAIH,IAAJ,CAAS1L,MAAT,EAAiB,KAAjB,CAAf;AACA6L,aAASvC,OAAT,CAAiBna,OAAjB;AACA,WAAO0c,QAAP;AACA;;;GAhesB9b;;AAopBxB;;;;;;;AAKAmY,WAAU8B,IAAV,GAAiB;AAChB;;;;AAIA8B,kBAAgB;AACfnL,WAAQ,yBADO;AAEf5B,cAAWlW,QAFI;AAGf1K,UAAO;AAHQ,GALA;;AAWhB;;;;;;AAMAgS,UAAQ;AACP4O,cAAW,oBADJ;AAEP5gB,UAAO;AAFA,GAjBQ;;AAsBhB;;;;AAIA4tB,WAAS;AACRhN,cAAW/W,SADH;AAER7J,UAAO;AAFC;AA1BO,EAAjB;;AAgCA+pB,WAAUuD,cAAV,GAA2B,qBAA3B;;AAEA;;;;;AAKAvD,WAAU8D,YAAV,GAAyBrG,oBAAzB;;AAEA;;;;;;AAMAuC,WAAU+D,eAAV,GAA4B,EAA5B;;AAEA;;;;;;;AAOA/D,WAAUgE,QAAV,GAAqB/E,iBAArB;;AAEA;;;;;;AAMAe,WAAUiE,YAAV,GAAyB,KAAzB;;AAEA;;;;AAIAjE,WAAUlsB,SAAV,CAAoBksB,UAAUuD,cAA9B,IAAgD,IAAhD;;8BAEevD;;AChyBf;;;KAES5gB;;AAET;;;;;;KAKM8kB;;;;;;;;AACL;;;;;;;kCAOsBluB,MAAM;AAC3B,QAAImuB,gBAAgBD,kBAAkBE,WAAlB,CAA8BpuB,IAA9B,CAApB;AACA,QAAI,CAACmuB,aAAL,EAAoB;AACnB1b,aAAQmE,KAAR,CACC,0DACA,QADA,GACW5W,IADX,GACkB,yCADlB,GAEA,6BAHD;AAKA;AACD,WAAOmuB,aAAP;AACA;;AAED;;;;;;;;;;;4BAQgBA,eAAeE,UAAU;AACxC,QAAIruB,OAAOquB,QAAX;AACA,QAAI,CAACruB,IAAL,EAAW;AACV,SAAImuB,cAAcvwB,cAAd,CAA6B,MAA7B,CAAJ,EAA0C;AACzCoC,aAAOmuB,cAAcG,IAArB;AACA,MAFD,MAEO;AACNtuB,aAAOoJ,gBAAgB+kB,aAAhB,CAAP;AACA;AACD;AACDA,kBAAcG,IAAd,GAAqBtuB,IAArB;AACAkuB,sBAAkBE,WAAlB,CAA8BpuB,IAA9B,IAAsCmuB,aAAtC;AACA;;;;;AAGF;;;;;;;;AAMAD,mBAAkBE,WAAlB,GAAgC,EAAhC;;sCAEeF;;AC3Df;;;MAEOlE;MACAvC;MACAyG;MACAjF;+BAEQe;;iDACNA;4DAAWvC;yDAAsByG;yDAAmBjF;;ACR7D;;;KAGS9d;KAAOoE;;AAEhB;;;;KAGMgf;;;;;;;;AACL;;;;oCAIwB;AACvB,WAAOC,QAAQ,CAAR,CAAP;AACA;;AAED;;;;;;;;;;;;;;;qCAYyBC,KAAK;AAC7B,QAAIC,YAAYH,kBAAkBI,cAAlB,EAAhB;AACAF,UAAMlf,OAAOrR,GAAP,CAAWuwB,GAAX,EAAgB,UAACzuB,IAAD,EAAOC,KAAP;AAAA,YAAiBA,MAAMiN,IAAN,CAAW,IAAX,EAAiBwhB,UAAU1uB,IAAV,CAAjB,CAAjB;AAAA,KAAhB,CAAN;AACAwuB,YAAQruB,IAAR,CAAaoP,OAAOiF,KAAP,CAAa,EAAb,EAAiBka,SAAjB,EAA4BD,GAA5B,EAAiC;AAC7C1uB,WAAM6uB,MADuC;AAE7CjnB,qBAAgBknB,SAF6B;AAG7CnnB,uBAAkBonB,WAH2B;AAI7ChnB,kBAAainB;AAJgC,KAAjC,CAAb;AAMA;;AAED;;;;;;;sCAI0B;AACzB,QAAIP,QAAQ1uB,MAAR,GAAiB,CAArB,EAAwB;AACvB0uB,aAAQQ,GAAR;AACA;AACD;;;;;AAGF,KAAIR,UAAU,CAAC;AACdzuB,QAAMtC,eAAesC,IADP;AAEdH,cAAYnC,eAAemC,UAAf,CAA0BnC,eAAe+H,OAAf,CAAuBC,OAAjD,CAFE;AAGdoC,gBAAcpK,eAAeoK,YAHf;AAIdZ,eAAaxJ,eAAewJ,WAJd;AAKdU,kBAAgBlK,eAAekK,cALjB;AAMdD,oBAAkBjK,eAAeiK,gBANnB;AAOdI,eAAarK,eAAeqK,WAPd;AAQd7I,QAAMxB,eAAewB;AARP,EAAD,CAAd;;AAWA,KAAIgwB,gBAAgB,EAApB;;AAEA,UAASL,MAAT,CAAgB5uB,IAAhB,EAAsBC,KAAtB,EAA6B;AAC5BgvB,gBAAc9uB,IAAd,CAAmBH,IAAnB,EAAyBC,KAAzB;AACA;;AAED,UAAS6uB,WAAT,CAAqBtuB,GAArB,EAA0B/B,GAA1B,EAA+ByI,OAA/B,EAAwC;AACvC+nB,kBAAgB,CAACzuB,GAAD,EAAM/B,GAAN,EAAWyI,OAAX,CAAhB;AACA;;AAED,UAAS2nB,SAAT,GAAqB;AACpB,SAAOK,MAAM,aAAN,EAAqBtnB,KAArB,CAA2B,IAA3B,EAAiCqnB,aAAjC,CAAP;AACA;;AAED,UAASF,MAAT,CAAgBvuB,GAAhB,EAAqB;AACpB0uB,QAAM,aAAN,EAAqBtnB,KAArB,CAA2B,IAA3B,EAAiCL,SAAjC;AACA,SAAO2nB,MAAM,cAAN,EAAsB1uB,GAAtB,CAAP;AACA;;AAED,UAAS0uB,KAAT,CAAelvB,IAAf,EAAqB;AACpB,SAAOwuB,QAAQA,QAAQ1uB,MAAR,GAAiB,CAAzB,EAA4BE,IAA5B,CAAP;AACA;;AAED,UAASmvB,UAAT,CAAoBnvB,IAApB,EAA0B;AACzB,SAAOkvB,MAAMlvB,IAAN,EAAY4H,KAAZ,CAAkB,IAAlB,EAAwBuD,MAAMyH,KAAN,CAAYrL,SAAZ,EAAuB,CAAvB,CAAxB,CAAP;AACA;;AAED9J,gBAAesC,IAAf,GAAsBovB,WAAWjiB,IAAX,CAAgB,IAAhB,EAAsB,MAAtB,CAAtB;AACAzP,gBAAeoK,YAAf,GAA8BsnB,WAAWjiB,IAAX,CAAgB,IAAhB,EAAsB,cAAtB,CAA9B;AACAzP,gBAAewJ,WAAf,GAA6BkoB,WAAWjiB,IAAX,CAAgB,IAAhB,EAAsB,aAAtB,CAA7B;AACAzP,gBAAekK,cAAf,GAAgCwnB,WAAWjiB,IAAX,CAAgB,IAAhB,EAAsB,gBAAtB,CAAhC;AACAzP,gBAAeiK,gBAAf,GAAkCynB,WAAWjiB,IAAX,CAAgB,IAAhB,EAAsB,kBAAtB,CAAlC;AACAzP,gBAAeqK,WAAf,GAA6BqnB,WAAWjiB,IAAX,CAAgB,IAAhB,EAAsB,aAAtB,CAA7B;AACAzP,gBAAewB,IAAf,GAAsBkwB,WAAWjiB,IAAX,CAAgB,IAAhB,EAAsB,MAAtB,CAAtB;;AAEAzP,gBAAemC,UAAf,CAA0BnC,eAAe+H,OAAf,CAAuBC,OAAjD,IAA4D0pB,WAAWjiB,IAAX,CAC3D,IAD2D,EAE3D,YAF2D,CAA5D;;sCAKeqhB;;ACtGf;;;KAES5jB;;AAET;;;;KAGMykB;;;;;;;;AACL;;;;;;uCAM2Bzc,MAAM;AAChC,QAAImP,SAAS,EAAb;AACA,QAAInP,KAAK,CAAL,CAAJ,EAAa;AACZmP,YAAOrjB,GAAP,GAAakU,KAAK,CAAL,CAAb;AACA;AACD,QAAIhU,WAAW,CAACgU,KAAK,CAAL,KAAW,EAAZ,EAAgBE,MAAhB,CAAuBF,KAAKC,KAAL,CAAW,CAAX,CAAvB,CAAf;AACA,SAAK,IAAI/S,IAAI,CAAb,EAAgBA,IAAIlB,SAASmB,MAA7B,EAAqCD,KAAK,CAA1C,EAA6C;AAC5CiiB,YAAOnjB,SAASkB,CAAT,CAAP,IAAsBlB,SAASkB,IAAI,CAAb,CAAtB;AACA;AACD,WAAOiiB,MAAP;AACA;;AAED;;;;;;;;;uCAM2BthB,KAAKshB,QAAQ;AACvC,QAAI1jB,OAAO,CAACoC,GAAD,EAAMshB,OAAOrjB,GAAb,EAAkB,EAAlB,CAAX;AACA,QAAIuR,OAAOnS,OAAOmS,IAAP,CAAY8R,MAAZ,CAAX;AACA,SAAK,IAAIjiB,IAAI,CAAb,EAAgBA,IAAImQ,KAAKlQ,MAAzB,EAAiCD,GAAjC,EAAsC;AACrC,SAAImQ,KAAKnQ,CAAL,MAAY,UAAhB,EAA4B;AAC3BzB,WAAK+B,IAAL,CAAU6P,KAAKnQ,CAAL,CAAV,EAAmBiiB,OAAO9R,KAAKnQ,CAAL,CAAP,CAAnB;AACA;AACD;AACD,WAAOzB,IAAP;AACA;;AAED;;;;;;;;kCAKsBoC,KAAK;AAC1B,WAAO,CAACmK,SAASnK,GAAT,CAAD,IAAkBA,IAAI,CAAJ,MAAWA,IAAI,CAAJ,EAAO+d,WAAP,EAApC;AACA;;;;;wCAGa6Q;;ACrDf;;;KAESplB;KACFukB;KACAa;;AAEP;;;;;;KAKMC;;;;;;;;AACL;;;;;;;2BAOerN,UAAUzV,UAAU;AAClCke,gBAAYzI,QAAZ;AACAsN,gBAAY/iB,QAAZ;AACAgjB,YAAQ;AACPpL,YAAO;AACNqL,gBAAU;AADJ;AADA,KAAR;AAKAD,UAAMzN,MAAN,GAAeyN,MAAMpL,KAArB;AACAsL,qBAAiBF,KAAjB;AACAG,mBAAe,IAAf;AACAnB,sBAAkBoB,iBAAlB,CAAoC;AACnC9nB,mBAAc+nB,2BADqB;AAEnC3oB,kBAAa4oB,0BAFsB;AAGnC5wB,WAAM6wB;AAH6B,KAApC;AAKA;;AAED;;;;;;;;qCAKyB;AACxB,WAAOC,cAAP;AACA;;AAED;;;;;;;;4BAKgB5wB,MAAM;AACrB,WAAOA,KAAKkwB,uBAAuBW,WAA5B,CAAP;AACA;;AAED;;;;;;;;;;0BAOcC,MAAMC,cAAc;AACjC,QAAIR,YAAJ,EAAkB;AACjB;AACAS,oBAAeF,IAAf;AACA;AACA;;AAEDF,qBAAiBV,uBAAuBe,QAAvB,CAAgCH,IAAhC,CAAjB;AACA,QAAIC,gBAAgBA,aAAaD,IAAb,CAApB,EAAwC;AACvCF,sBAAiB,IAAjB;AACA;AACA;;AAED,QAAI/lB,MAAMimB,KAAKhxB,IAAX,CAAJ,EAAsB;AACrB,SAAI0T,OAAOsd,KAAKtd,IAAL,GAAYsd,KAAKtd,IAAjB,GAAwB,EAAnC;AACAA,UAAK,CAAL,IAAUsd,KAAKhxB,IAAf;AACAxB,oBAAewB,IAAf,CAAoB2I,KAApB,CAA0B,IAA1B,EAAgC+K,IAAhC;AACA,KAJD,MAIO;AACN,SAAIA,QAAOyc,oBAAoBiB,mBAApB,CAAwCJ,KAAKzvB,GAA7C,EAAkDyvB,KAAK9L,KAAvD,CAAX;AACA1mB,oBAAewJ,WAAf,CAA2BW,KAA3B,CAAiC,IAAjC,EAAuC+K,KAAvC;AACA,SAAIsd,KAAK9L,KAAL,CAAWqL,QAAf,EAAyB;AACxB,WAAK,IAAI3vB,IAAI,CAAb,EAAgBA,IAAIowB,KAAK9L,KAAL,CAAWqL,QAAX,CAAoB1vB,MAAxC,EAAgDD,GAAhD,EAAqD;AACpDwvB,8BAAuBlG,MAAvB,CAA8B8G,KAAK9L,KAAL,CAAWqL,QAAX,CAAoB3vB,CAApB,CAA9B,EAAsDqwB,YAAtD;AACA;AACD;AACDzyB,oBAAeoK,YAAf,CAA4BooB,KAAKzvB,GAAjC;AACA;AACDuvB,qBAAiB,IAAjB;AACA;;;;;AAGF,KAAIT,SAAJ;AACA,KAAIS,cAAJ;AACA,KAAIN,cAAJ;AACA,KAAIC,eAAe,KAAnB;AACA,KAAIjF,SAAJ;AACA,KAAI8E,KAAJ;;AAEA;;;;;;;AAOA,UAASe,mBAAT,CAA6B3d,IAA7B,EAAmC4d,UAAnC,EAA+C;AAC9C,MAAInwB;AACHK,WAAQgvB;AADL,KAEFJ,uBAAuBW,WAFrB,EAEmCvF,SAFnC,CAAJ;;AAKA,MAAI8F,UAAJ,EAAgB;AACfnwB,SAAMnB,IAAN,GAAa0T,KAAK,CAAL,CAAb;AACA,OAAIA,KAAK7S,MAAL,GAAc,CAAlB,EAAqB;AACpBM,UAAMuS,IAAN,GAAaA,IAAb;AACA;AACD,GALD,MAKO;AACNvS,SAAMI,GAAN,GAAYmS,KAAK,CAAL,CAAZ;AACAvS,SAAM+jB,KAAN,GAAciL,oBAAoBoB,mBAApB,CAAwC7d,IAAxC,CAAd;AACAvS,SAAM+jB,KAAN,CAAYqL,QAAZ,GAAuB,EAAvB;AACApvB,SAAM0hB,MAAN,GAAe1hB,MAAM+jB,KAArB;AACA;;AAEDgM,iBAAe/vB,KAAf;AACA,SAAOA,KAAP;AACA;;AAED,UAAS+vB,cAAT,CAAwB/vB,KAAxB,EAA+B;AAC9BqvB,iBAAetL,KAAf,CAAqBqL,QAArB,CAA8BrvB,IAA9B,CAAmCC,KAAnC;AACA;;AAED;;;;;AAKA,UAASwvB,2BAAT,GAAuC;AACtC,MAAIH,mBAAmBF,KAAvB,EAA8B;AAC7BhB,qBAAkBkC,gBAAlB;AACAf,kBAAe,KAAf;AACAJ,aAAUC,KAAV;AACAD,eAAY,IAAZ;AACAG,oBAAiB,IAAjB;AACAhF,eAAY,IAAZ;AACA8E,WAAQ,IAAR;AACA,GARD,MAQO;AACNE,oBAAiBA,eAAehvB,MAAhC;AACA;AACD;;AAED;;;;;;AAMA,UAASovB,0BAAT,CAAoCa,UAApC,EAAyD;AAAA,oCAAN/d,IAAM;AAANA,OAAM;AAAA;;AACxD8c,mBAAiBa,oBAAoB3d,IAApB,CAAjB;AACA;;AAED;;;;;AAKA,UAASmd,0BAAT,CAAoCY,UAApC,EAAyD;AAAA,qCAAN/d,IAAM;AAANA,OAAM;AAAA;;AACxD2d,sBAAoB3d,IAApB,EAA0B,IAA1B;AACA;;AAGD;;;;;;AAMA0c,wBAAuBW,WAAvB,GAAqC,mBAArC;;2CAEeX;;ACpLf;;;AAEA,KAAIsB,SAAS,EAAb;AACA,KAAIC,aAAa,KAAjB;;KAEMC;;;;;;;;AACL;;;;mCAIuB;AACtB,QAAID,UAAJ,EAAgB;AACf;AACA;AACDA,iBAAa,IAAb;;AAEA,SAAK,IAAI/wB,IAAI,CAAb,EAAgBA,IAAI8wB,OAAO7wB,MAA3B,EAAmCD,GAAnC,EAAwC;AACvC,SAAIixB,OAAOH,OAAO9wB,CAAP,CAAX;AACA,SAAI,CAACixB,KAAKlf,UAAL,EAAD,IAAsB,CAACkf,KAAK7O,WAAL,GAAmBC,SAAnB,EAA3B,EAA2D;AAC1D;AACA;AACA4O,WAAK7f,OAAL,GAAe,IAAf;AACA6f,WAAKxI,OAAL;AACA;AACD;AACDqI,aAAS,EAAT;AACAC,iBAAa,KAAb;AACA;;AAED;;;;;;;;4BAKgBG,OAAO;AACtB,SAAK,IAAIlxB,IAAI,CAAb,EAAgBA,IAAIkxB,MAAMjxB,MAA1B,EAAkCD,GAAlC,EAAuC;AACtC,SAAI,CAACkxB,MAAMlxB,CAAN,EAAS+R,UAAT,EAAL,EAA4B;AAC3Bmf,YAAMlxB,CAAN,EAASoiB,WAAT,GAAuB+O,OAAvB,GAAiC,IAAjC;AACAL,aAAOxwB,IAAP,CAAY4wB,MAAMlxB,CAAN,CAAZ;AACA;AACD;AACD;;;;;mDAGagxB;;AC5Cf;;;KAIC3nB;KACAM;KACAM;KACAE;KACAC;KACAU;KACA4E;KAEQ6I;KAAQW;KAAU/H;KAAS6I;KAC3BmQ;KAAWkE;KAAmBjF;KAChCsF;KACAc;KACAwB;KACAzB;;AAEP;;;;KAGM6B;;;AACL;;;AAGA,kCAAYH,IAAZ,EAAkB;AAAA;;AAAA,2JACXA,IADW;;AAGjBA,QAAKjuB,OAAL,GAAe,EAAf;AACAiuB,QAAK/H,IAAL,GAAY,EAAZ;AACA,SAAKmI,OAAL,GAAeJ,KAAK3I,gBAAL,EAAf;AACA,SAAKgJ,gBAAL,GAAwB,EAAxB;AACA,SAAKC,aAAL;AACAN,QAAK9b,EAAL,CAAQ,UAAR,EAAoB,MAAKqc,eAAL,CAAqBnkB,IAArB,OAApB;;AAEA;AACA;AACA,SAAKokB,gCAAL,GACC,MAAKA,gCAAL,CAAsCpkB,IAAtC,OADD;AAEA,SAAK0iB,2BAAL,GACC,MAAKA,2BAAL,CAAiC1iB,IAAjC,OADD;AAEA,SAAK2iB,0BAAL,GACC,MAAKA,0BAAL,CAAgC3iB,IAAhC,OADD;AAEA,SAAKqkB,uBAAL,GAA+B,MAAKA,uBAAL,CAA6BrkB,IAA7B,OAA/B;AACA,SAAKskB,kBAAL,GAA0B,MAAKA,kBAAL,CAAwBtkB,IAAxB,OAA1B;AACA,SAAKukB,0BAAL,GAAkC,MAAKA,0BAAL,CAAgCvkB,IAAhC,OAAlC;AApBiB;AAqBjB;;AAED;;;;;;;;;;;sCAOmB0gB,gBAAgBjb,MAAM;AACxC,SAAK,IAAI9S,IAAI,CAAb,EAAgBA,IAAI8S,KAAK7S,MAAzB,EAAiCD,KAAK,CAAtC,EAAyC;AACxC,SAAI8S,KAAK9S,CAAL,MAAY,OAAhB,EAAyB;AACxB8S,WAAK9S,IAAI,CAAT,IAAc,KAAK6xB,uBAAL,CACb/e,KAAK9S,IAAI,CAAT,IAAc,GAAd,GAAoB+tB,cADP,CAAd;AAGA;AACA;AACD;AACD,WAAOjb,KAAK7S,MAAL,GAAc,CAArB,EAAwB;AACvB6S,UAAKxS,IAAL,CAAU,IAAV;AACA;AACDwS,SAAKxS,IAAL,CAAU,OAAV,EAAmBytB,cAAnB;AACA;;AAED;;;;;;;;;;;;;6CAU0BzuB,MAAMwT,MAAM;AACrC,QAAI,CAAC,KAAKgV,UAAL,CAAgBqB,WAArB,EAAkC;AACjC,SAAItqB,QAAQ,CAACiU,KAAK,CAAL,KAAW,EAAZ,EAAgBE,MAAhB,CAAuBF,KAAKC,KAAL,CAAW,CAAX,CAAvB,CAAZ;AACA,UAAK,IAAI/S,IAAI,CAAb,EAAgBA,IAAInB,MAAMoB,MAA1B,EAAkCD,KAAK,CAAvC,EAA0C;AACzC,UAAI+X,YAAY,KAAK+Z,yBAAL,CAA+BjzB,MAAMmB,CAAN,CAA/B,CAAhB;AACA,UAAI+X,aAAa,CAACzY,KAAKyY,YAAY,YAAjB,CAAlB,EAAkD;AACjD,YAAKga,YAAL,CAAkBzyB,IAAlB,EAAwBT,MAAMmB,CAAN,CAAxB,EAAkC+X,SAAlC,EAA6ClZ,MAAMmB,IAAI,CAAV,CAA7C;AACA;AACD;AACD;AACD;;AAED;;;;;;;;;;;gCAQaoR,SAASxS,KAAKmZ,WAAWvU,IAAI;AACzC,QAAIwuB,YAAYja,YAAY,YAA5B;AACA,QAAI3G,QAAQ4gB,SAAR,CAAJ,EAAwB;AACvB5gB,aAAQ4gB,SAAR,EAAmBlgB,cAAnB;AACAV,aAAQ4gB,SAAR,IAAqB,IAArB;AACA;;AAED5gB,YAAQxS,GAAR,IAAe4E,EAAf;AACA,QAAIA,EAAJ,EAAQ;AACP,SAAIsH,SAAStH,EAAT,CAAJ,EAAkB;AACjB,UAAI5E,IAAI,CAAJ,MAAW,GAAf,EAAoB;AACnB;AACA;AACAwS,eAAQjL,YAAR,CAAqBvH,GAArB,EAA0B4E,EAA1B;AACA;AACDA,WAAK,KAAKskB,UAAL,CAAgBwE,aAAhB,CAA8B9oB,EAA9B,CAAL;AACA;AACD4N,aAAQ4gB,SAAR,IAAqB9Y,SAASnL,QAAT,EAAmBgK,SAAnB,EAA8B3G,OAA9B,EAAuC5N,EAAvC,CAArB;AACA,KAVD,MAUO;AACN4N,aAAQpL,eAAR,CAAwBpH,GAAxB;AACA;AACD;;AAED;;;;;;;;;kCAMe+wB,UAAU;AACxB,WAAOA,SAAS1vB,MAAT,KAAoB,CAApB,GAAwBgyB,cAAxB,GAAyCtC,QAAhD;AACA;;AAED;;;;;;;;;;4CAOyB;AACxB,WAAO,CAAC,KAAKuC,QAAN,CAAP;AACA;;AAED;;;;;;;mCAIgB;AACf,SAAKA,QAAL,GAAgB,EAAhB;AACA;;AAED;;;;;;qCAGkB;AACjB;;AAEA,QAAIjB,OAAO,KAAKnJ,UAAhB;AACA,QAAIiE,MAAM,KAAKsF,OAAL,CAAatF,GAAvB;AACA,QAAIoG,QAAQ,KAAK5B,QAAL,EAAZ;AACA,QAAI4B,SAASA,MAAMlJ,UAAf,IAA6BkJ,MAAMlJ,UAAN,CAAiB8C,GAAjB,MAA0BkF,IAA3D,EAAiE;AAChE,YAAOkB,MAAMlJ,UAAN,CAAiB8C,GAAjB,CAAP;AACA;;AAED,SAAK,IAAI/rB,IAAI,CAAb,EAAgBA,IAAI,KAAKsxB,gBAAL,CAAsBrxB,MAA1C,EAAkDD,GAAlD,EAAuD;AACtD,SAAMO,QAAQ,KAAK+wB,gBAAL,CAAsBtxB,CAAtB,CAAd;AACA,SAAI,CAACO,MAAMwR,UAAN,EAAL,EAAyB;AACxBxR,YAAM6Q,OAAN,GAAgB,IAAhB;AACA7Q,YAAMkoB,OAAN;AACA;AACD;AACD,SAAK6I,gBAAL,GAAwB,IAAxB;AACA;;AAED;;;;;;;;AA8CA;;;;;;;6CAO0BpxB,MAAM;AAC/B,QAAIuE,UAAU2sB,uBAAuBgB,cAAvB,CAAsCC,IAAtC,CAA2CnyB,IAA3C,CAAd;AACA,QAAI6X,YAAYtT,UAAWA,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAb,GAA0BA,QAAQ,CAAR,CAArC,GAAmD,IAAnE;AACA,WAAOsT,YAAYA,UAAU8G,WAAV,EAAZ,GAAsC,IAA7C;AACA;;AAED;;;;;;;;8BAKW;AACV,WAAO,KAAKyT,MAAZ;AACA;;AAED;;;;;;;;+BAKY;AACX,WAAO,KAAKnB,OAAZ;AACA;;AAED;;;;;;;;;;2BAOQlP,QAAQ;AACf,QAAMsQ,aAAalpB,0BAAnB;AACA,QAAIkpB,UAAJ,EAAgB;AACf,SAAMC,YAAYD,WAAWC,SAA7B;AACA,SAAMC,SAAS,CAACD,SAAD,IACdA,UAAUhsB,OAAV,CAAkB,KAAKoC,WAAvB,MAAwC,CAAC,CAD3B,IAEd4pB,UAAUhsB,OAAV,CAAkB,KAAKoC,WAAL,CAAiB8pB,aAAnC,MAAsD,CAAC,CAFxD;AAGA,SAAID,UAAUxQ,OAAOrjB,GAAjB,IAAwB,CAACqjB,OAAO8J,GAApC,EAAyC;AACxC,aAAO9J,OAAOrjB,GAAd;AACA;AACD;AACD,WAAOqjB,OAAO8J,GAAd;AACA;;AAED;;;;;;;;;;;;oCASiB4G,WAAW1Q,QAAQkQ,OAAO;AAC1C,QAAIxE,OAAOgF,SAAX;AACA,QAAI7nB,SAAS6iB,IAAT,CAAJ,EAAoB;AACnBA,YAAOU,kBAAkBuE,cAAlB,CAAiCD,SAAjC,CAAP;AACA;;AAED,QAAM5G,MAAM,KAAK8G,OAAL,CAAa5Q,MAAb,CAAZ;AACA,QAAI1iB,OAAO6xB,uBAAuB0B,cAAvB,EAAX;AACA,QAAI7B,IAAJ;AACA,QAAI9mB,MAAM4hB,GAAN,CAAJ,EAAgB;AACfkF,YAAO,KAAK8B,MAAL,CAAYZ,MAAMlJ,UAAN,CAAiB8C,GAAjB,CAAZ,EAAmC4B,IAAnC,EAAyC1L,MAAzC,CAAP;AACAkQ,WAAMa,eAAN,CAAsBjH,GAAtB,EAA2BkF,IAA3B;AACAkB,WAAMjJ,IAAN,CAAW6C,GAAX,IAAkBkF,IAAlB;AACA,KAJD,MAIO,IAAI9mB,MAAM8X,OAAOrjB,GAAb,CAAJ,EAAuB;AAC7BqyB,YAAO,KAAK8B,MAAL,CAAYxzB,KAAK0zB,SAAL,CAAe9iB,IAAf,CAAoB8R,OAAOrjB,GAA3B,CAAZ,EAA6C+uB,IAA7C,EAAmD1L,MAAnD,CAAP;AACA1iB,UAAK2zB,SAAL,CAAe/iB,IAAf,CAAoB8R,OAAOrjB,GAA3B,IAAkCqyB,IAAlC;AACA,KAHM,MAGA;AACN,SAAIlqB,OAAO4C,OAAOgkB,IAAP,EAAa,IAAb,CAAX;AACApuB,UAAK2zB,SAAL,CAAeC,KAAf,CAAqBpsB,IAArB,IAA6BxH,KAAK2zB,SAAL,CAAeC,KAAf,CAAqBpsB,IAArB,KAA8B,EAA3D;AACA,SAAIosB,QAAQ5zB,KAAK2zB,SAAL,CAAeC,KAAf,CAAqBpsB,IAArB,CAAZ;AACAkqB,YAAO,KAAK8B,MAAL,CAAY,CAACxzB,KAAK0zB,SAAL,CAAeE,KAAf,CAAqBpsB,IAArB,KAA8B,EAA/B,EAAmCosB,MAAMlzB,MAAzC,CAAZ,EAA8D0tB,IAA9D,EAAoE1L,MAApE,CAAP;AACAkR,WAAM7yB,IAAN,CAAW2wB,IAAX;AACA;;AAED,WAAOA,IAAP;AACA;;AAED;;;;;;;;;;sCAOmB;AAClB,QAAI7f,UAAU,KAAK0W,UAAL,CAAgB1W,OAA9B;AACA,QAAI,CAACA,OAAD,IAAY,CAACA,QAAQtR,UAAzB,EAAqC;AACpC,SAAIc,SAASmN,SAASjN,aAAT,CAAuB,KAAvB,CAAb;AACA,SAAIsQ,OAAJ,EAAa;AACZmH,aAAO3X,MAAP,EAAewQ,OAAf;AACA;AACD,YAAOxQ,MAAP;AACA;AACD;;AAED;;;;;;;;mCAKgBrB,MAAM;AACrB,SAAK6zB,WAAL,GAAmB7zB,IAAnB;AACA;;AAED;;;;;;;;2CAKwB6wB,MAAM;AAAA,8BACV,KAAKiD,kBADK;AAAA,QACxB/O,KADwB,uBACxBA,KADwB;AAAA,QACjB3jB,GADiB,uBACjBA,GADiB;;AAE7B2jB,UAAMqL,QAAN,GAAiB,KAAK2D,cAAL,CAAoBlD,KAAK9L,KAAL,CAAWqL,QAA/B,CAAjB;AACA,SAAK0D,kBAAL,GAA0B,IAA1B;AACA,SAAKE,cAAL,CAAoB5yB,GAApB,EAAyB2jB,KAAzB;AACA;;AAED;;;;;;;;;;;sCAQmBhlB,MAAM;AACxB,QAAIA,KAAKqB,GAAL,IAAY4uB,oBAAoBiE,cAApB,CAAmCl0B,KAAKqB,GAAxC,CAAhB,EAA8D;AAC7DrB,UAAKglB,KAAL,CAAWqL,QAAX,GAAsB,KAAK2D,cAAL,CAAoBh0B,KAAKglB,KAAL,CAAWqL,QAA/B,CAAtB;AACA,UAAK4D,cAAL,CAAoBj0B,KAAKqB,GAAzB,EAA8BrB,KAAKglB,KAAnC;AACA,YAAO,IAAP;AACA;AACD;;AAED;;;;;;+CAG4B;AAC3B;;AAEA,QAAIoF,UAAU,KAAK5B,UAAL,CAAgB6B,cAAhB,EAAd;AACA,QAAI,CAAC,KAAK7B,UAAL,CAAgBlf,WAAhB,CAA4BghB,mBAAjC,EAAsD;AACrD;AACA;AACA;AACAF,aAAQvU,EAAR,CAAW,iBAAX,EAA8B,KAAKse,sBAAL,CAA4BpmB,IAA5B,CAAiC,IAAjC,CAA9B;AACA;;AAEDqc,YAAQ/R,GAAR,CACC,UADD,EAEC;AACCqJ,gBAAWpV,MAAMC,OADlB;AAECzL,YAAO6xB;AAFR,KAFD,EAMC,KAAKZ,OAAL,CAAa1B,QAAb,IAAyBsC,cAN1B;AAQA;;AAED;;;;;;;;;0CAMuB1yB,MAAM;AAC5B,SAAK2yB,QAAL,CAAc3yB,KAAKX,GAAnB,IAA0BW,IAA1B;AACA;;AAED;;;;;;;;;;;;oDASiCsxB,YAAYzf,SAASjR,MAAMC,OAAO;AAClE,QAAI2X,YAAY,KAAK+Z,yBAAL,CAA+B3xB,IAA/B,CAAhB;AACA,QAAI4X,SAAJ,EAAe;AACd,UAAKga,YAAL,CAAkB3gB,OAAlB,EAA2BjR,IAA3B,EAAiC4X,SAAjC,EAA4C3X,KAA5C;AACA;AACA;;AAED,QAAID,SAAS,SAAb,EAAwB;AACvB;AACA;AACA;AACA;AACAC,aAAQgK,gBAAgBhK,KAAhB,KAA0BA,UAAU,KAA5C;AACA;;AAED,QAAID,SAAS,OAAT,IAAoBiR,QAAQhR,KAAR,KAAkBA,KAA1C,EAAiD;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACAgR,aAAQjR,IAAR,IAAgBC,KAAhB;AACA;;AAED,QAAI6J,UAAU7J,KAAV,CAAJ,EAAsB;AACrB;AACA;AACA;AACAgR,aAAQjR,IAAR,IAAgBC,KAAhB;AACA,SAAIA,KAAJ,EAAW;AACVgR,cAAQjL,YAAR,CAAqBhG,IAArB,EAA2B,EAA3B;AACA,MAFD,MAEO;AACNiR,cAAQpL,eAAR,CAAwB7F,IAAxB;AACA;AACD,KAVD,MAUO;AACN0wB,gBAAWzf,OAAX,EAAoBjR,IAApB,EAA0BC,KAA1B;AACA;AACD;;AAED;;;;;;;;;;+CAO4BywB,YAAYlwB,KAAK;AAC5C,SAAK+R,IAAL,CAAU0e,uBAAuBsC,cAAjC,EAAiD,EAAC/yB,QAAD,EAAjD;AACA,QAAIyQ,UAAUyf,WAAWlwB,GAAX,CAAd;AACA,SAAKgzB,UAAL,CAAgBxiB,QAAQ+E,GAAR,CAAY9E,OAAZ,EAAqBwiB,WAArC;AACA,WAAOxiB,OAAP;AACA;;AAED;;;;;;;;;;8CAO2Byf,YAAYlwB,KAAK;AAC3C,QAAI4uB,oBAAoBiE,cAApB,CAAmC7yB,GAAnC,CAAJ,EAA6C;AAC5C,YAAO,KAAKkzB,uBAAL,CAA6B9rB,KAA7B,CAAmC,IAAnC,EAAyCL,SAAzC,CAAP;AACA,KAFD,MAEO;AACN,YAAO,KAAKosB,kBAAL,CAAwB/rB,KAAxB,CAA8B,IAA9B,EAAoCL,SAApC,CAAP;AACA;AACD;;AAED;;;;;;;;;;;iDAQ8BnI,MAAM;AACnC,SAAKk0B,sBAAL,CAA4Bl0B,IAA5B;AACA,8KAAoCA,IAApC;AACA;;AAED;;;;;;;;;;sCAOmBsxB,YAAqB;AAAA,sCAAN/d,IAAM;AAANA,SAAM;AAAA;;AACvC,SAAKJ,IAAL,CAAU0e,uBAAuB2C,cAAjC,EAAiD,EAACjhB,UAAD,EAAjD;AACA,QAAIkhB,WAAW5C,uBAAuB6C,yBAAvB,EAAf;AACA,QAAIC,eAAeF,SAAS5R,WAAT,EAAnB;AACA,QAAI,CAAC8R,aAAaC,mBAAlB,EAAuC;AACtC,SAAID,aAAa7C,OAAb,CAAqBzyB,GAAzB,EAA8B;AAC7BkU,WAAK,CAAL,IAAUohB,aAAa7C,OAAb,CAAqBzyB,GAA/B;AACA;AACD,SAAImvB,iBAAiBiG,SAASrK,cAAT,GAA0BzT,GAA1B,CAA8B,gBAA9B,CAArB;AACA,SAAI6X,cAAJ,EAAoB;AACnB,WAAKqG,kBAAL,CAAwBrG,cAAxB,EAAwCjb,IAAxC;AACA;AACD;;AAGD,QAAIxT,OAAOuxB,WAAW9oB,KAAX,CAAiB,IAAjB,EAAuB+K,IAAvB,CAAX;AACA,SAAKuhB,yBAAL,CAA+B/0B,IAA/B,EAAqCwT,IAArC;AACA,SAAKwhB,0BAAL,CAAgCh1B,IAAhC;;AAEA,QAAM2iB,SAASsN,oBAAoBoB,mBAApB,CAAwC7d,IAAxC,CAAf;AACA,QAAI1I,gBAAgB6X,OAAO8J,GAAvB,CAAJ,EAAiC;AAChC,SAAMoG,QAAQ3C,uBAAuB+E,eAAvB,MAA4C,IAA1D;AACApC,WAAMqC,YAAN,GAAqBtL,IAArB,CAA0BjH,OAAO8J,GAAjC,IAAwCzsB,IAAxC;AACA;AACD,WAAOA,IAAP;AACA;;AAED;;;;;;;;;;2CAOwBuxB,YAAqB;AAAA,uCAAN/d,IAAM;AAANA,SAAM;AAAA;;AAC5C,QAAIwR,QAAQiL,oBAAoBoB,mBAApB,CAAwC7d,IAAxC,CAAZ;AACA,SAAKugB,kBAAL,GAA0B;AACzB/O,iBADyB;AAEzB3jB,UAAKmS,KAAK,CAAL;AAFoB,KAA1B;AAIA0c,2BAAuBiF,OAAvB,CAA+B,IAA/B,EAAqC,KAAK/C,uBAA1C;AACA;;AAED;;;;;;;;qCAKkB;AACjB,WAAO1zB,OAAOmS,IAAP,CAAY,KAAK+hB,QAAjB,EAA2BjyB,MAA3B,GAAoC,CAA3C;AACA;;AAED;;;;;;;gCAIa;AACZyuB,sBAAkBoB,iBAAlB,CAAoC;AACnC/vB,iBAAY,KAAK0xB,gCADkB;AAEnCzpB,mBAAc,KAAK+nB,2BAFgB;AAGnC3oB,kBAAa,KAAK4oB;AAHiB,KAApC;AAKA;;AAED;;;;;;;;;;AASA;;;;;;;4BAOSiB,MAAMtD,MAAM;AACpB,QAAI,CAACsD,IAAD,IAASA,KAAKroB,WAAL,KAAqB+kB,IAA9B,IAAsCsD,KAAKlf,UAAL,EAA1C,EAA6D;AAC5D,YAAO,KAAP;AACA;AACD,WAAOkf,KAAK7O,WAAL,GAAmBmO,QAAnB,OAAkC,KAAKzI,UAA9C;AACA;;AAED;;;;;;;;;;;;;0BAUOmJ,MAAMtD,MAAM1L,QAAQ;AAC1B,QAAI,CAAC,KAAKyS,QAAL,CAAczD,IAAd,EAAoBtD,IAApB,CAAL,EAAgC;AAC/BsD,YAAO,IAAItD,IAAJ,CAAS1L,MAAT,EAAiB,KAAjB,CAAP;AACA;AACD,QAAIgP,KAAK9H,WAAT,EAAsB;AACrB8H,UAAK7O,WAAL,GAAmBuS,gBAAnB;AACA1D,UAAKtH,cAAL,GAAsBf,kBAAtB,CAAyC3G,MAAzC;AACAgP,UAAK7O,WAAL,GAAmBwS,eAAnB;AACA;AACD3D,SAAK7O,WAAL,GAAmBiP,OAAnB,GAA6BpP,MAA7B;AACA,WAAOgP,IAAP;AACA;;AAED;;;;;;;2BAIQ;AACP,QAAI,CAAC,KAAKnJ,UAAL,CAAgB1W,OAAjB,IAA4B,KAAK+f,OAArC,EAA8C;AAC7C;AACA;AACA;AACA,UAAKA,OAAL,CAAa/O,WAAb,GAA2Bja,KAA3B;AACA;AACA;;AAED,QAAI0sB,aAAa,KAAKC,gBAAL,EAAjB;AACA,QAAID,UAAJ,EAAgB;AACfj3B,oBAAeuK,KAAf,CAAqB0sB,UAArB,EAAiC,KAAKjD,0BAAtC;AACA5X,kBAAa,KAAK8N,UAAL,CAAgB1W,OAA7B;AACA,SAAI,KAAK0W,UAAL,CAAgB1W,OAAhB,IAA2B,KAAK0W,UAAL,CAAgB0C,UAA/C,EAA2D;AAC1D,WAAK1C,UAAL,CAAgB8D,cAAhB,CACC,KAAKwH,WAAL,CAAiBxyB,MADlB,EAEC,KAAKwyB,WAAL,CAAiBvH,OAFlB;AAIA;AACD,KATD,MASO;AACN,SAAMza,UAAU,KAAK0W,UAAL,CAAgB1W,OAAhC;AACAxT,oBAAewG,UAAf,CAA0BgN,OAA1B,EAAmC,KAAKwgB,0BAAxC;AACA;AACD;;AAED;;;;;;;;;2CAMwBmD,YAAY;AACnC,QAAIC,eAAe,EAAnB;AACA,QAAIC,MAAMF,WAAWhlB,KAAX,CAAiB,KAAjB,CAAV;AACA,QAAImlB,OAAO,EAAX;AACA,SAAK,IAAIl1B,IAAI,CAAb,EAAgBA,IAAIi1B,IAAIh1B,MAAxB,EAAgCD,GAAhC,EAAqC;AACpC,SAAI,CAACk1B,KAAKD,IAAIj1B,CAAJ,CAAL,CAAL,EAAmB;AAClBk1B,WAAKD,IAAIj1B,CAAJ,CAAL,IAAe,IAAf;AACAg1B,mBAAa10B,IAAb,CAAkB20B,IAAIj1B,CAAJ,CAAlB;AACA;AACD;AACD,WAAOg1B,aAAalI,IAAb,CAAkB,GAAlB,CAAP;AACA;;AAED;;;;;;;;;;;;;;;AA8BA;;;;4BAIS;AACR,SAAK3kB,KAAL;AACA;;AAED;;;;;;;;;AAQA;;;;+BAIY5H,OAAO;AAClB,SAAK40B,UAAL;AACA3F,2BAAuBlG,MAAvB,CAA8B/oB,KAA9B,EAAqC,KAAKoxB,kBAA1C;AACAjD,sBAAkBkC,gBAAlB;AACA;;AAED;;;;;;;;;kCAMejwB,KAAKshB,QAAQ;AAC3B,QAAInX,SAASnK,GAAT,KAAiBA,IAAI1C,SAAJ,CAAcmkB,WAAnC,EAAgD;AAC/C,SAAI6O,OAAO,KAAKmE,mBAAL,CAAyBz0B,GAAzB,EAA8BshB,MAA9B,CAAX;AACA,UAAKqS,0BAAL,CAAgCrD,KAAK7f,OAArC;AACA,YAAO6f,KAAK7f,OAAZ;AACA,KAJD,MAIO;AACN,YAAOzQ,IAAIshB,MAAJ,CAAP;AACA;AACD;;AAED;;;;;;;;kCAKe;AACd,QAAI,KAAK6F,UAAL,CAAgBwB,MAApB,EAA4B;AAC3B,UAAKxB,UAAL,CAAgBwB,MAAhB;AACA,KAFD,MAEO;AACN1rB,oBAAeqK,WAAf,CAA2B,KAA3B;AACA;AACD;;AAED;;;;;;;;uCAKoB;AACnB,QAAI,KAAK6f,UAAL,CAAgBqB,WAAhB,IACH,CAAC,KAAKkM,YAAL,EADE,IAEHz3B,eAAe4H,cAAf,OAAoC,KAAKsiB,UAAL,CAAgB1W,OAFrD,EAE8D;AAC7D,SAAI,KAAK0W,UAAL,CAAgB1W,OAApB,EAA6B;AAC5BxT,qBAAe8H,QAAf;AACA;AACD;AACA;AACD,SAAKksB,0BAAL;AACA;;AAED;;;;;;;;gDAK6B;AAC5BR,2BAAuBkE,yBAAvB,CAAiD,KAAKxN,UAAtD;AACA,SAAKyJ,aAAL;AACA,SAAK4C,mBAAL,GAA2B,KAA3B;AACAnD,mCAA+BuE,QAA/B,CAAwC,KAAKjE,gBAA7C;AACA,SAAKA,gBAAL,GAAwB,EAAxB;AACA,SAAKxJ,UAAL,CAAgBoB,IAAhB,GAAuB,EAAvB;AACA,SAAKiM,UAAL;AACA,SAAKK,YAAL;AACA9G,sBAAkBkC,gBAAlB;AACA,QAAI,CAAC,KAAKuD,mBAAV,EAA+B;AAC9B,UAAKrM,UAAL,CAAgB1W,OAAhB,GAA0B,IAA1B;AACA;AACD,SAAKsB,IAAL,CAAU,UAAV,EAAsB,CAAC,KAAKuX,WAA5B;AACAmH,2BAAuBqE,0BAAvB;AACA,SAAK9B,UAAL,CAAgB,KAAKC,WAArB;AACA;;AAED;;;;;;;;;;;;;uCAUoBjB,WAAW1Q,QAAQ;AACtC,QAAMyT,gBAAgBlG,uBAAuB+E,eAAvB,MAA4C,IAAlE;AACA,QAAMpC,QAAQuD,cAAclB,YAAd,EAAd;AACA,QAAIvD,OAAO,KAAK0E,gBAAL,CAAsBhD,SAAtB,EAAiC1Q,MAAjC,EAAyCkQ,KAAzC,CAAX;AACA,SAAKyD,cAAL,CAAoB3E,IAApB;AACA,QAAI9O,WAAW8O,KAAK7O,WAAL,EAAf;AACA,QAAID,oBAAoBiP,sBAAxB,EAAgD;AAC/C,SAAMyE,aAAazE,uBAAuB6C,yBAAvB,EAAnB;AACA,SAAM6B,iBAAiBD,WAAWzT,WAAX,EAAvB;AACA0T,oBAAexE,gBAAf,CAAgChxB,IAAhC,CAAqC2wB,IAArC;AACA9O,cAASgP,OAAT,GAAmB0E,UAAnB;AACA1T,cAASmQ,MAAT,GAAkBH,KAAlB;AACA,SAAI,CAAClQ,OAAOrjB,GAAR,IAAe,CAACk3B,eAAe3B,mBAAnC,EAAwD;AACvDlS,aAAOrjB,GAAP,GAAak3B,eAAezE,OAAf,CAAuBzyB,GAApC;AACA;AACDujB,cAAS4T,iBAAT;AACA,KAVD,MAUO;AACNnjB,aAAQC,IAAR,CACC,sEACA,uDAFD,EAGCoe,IAHD;AAKA;AACD,QAAI,CAACA,KAAK9H,WAAV,EAAuB;AACtB8H,UAAK+E,oBAAL;AACA;AACD,WAAO/E,IAAP;AACA;;AAED;;;;;;;;;8BAMW1xB,MAAM;AAChB,QAAIA,IAAJ,EAAU;AACTA,UAAK0zB,SAAL,CAAe9iB,IAAf,GAAsB5Q,KAAK2zB,SAAL,CAAe/iB,IAArC;AACA5Q,UAAK0zB,SAAL,CAAeE,KAAf,GAAuB5zB,KAAK2zB,SAAL,CAAeC,KAAtC;AACA5zB,UAAK2zB,SAAL,CAAe/iB,IAAf,GAAsB,EAAtB;AACA5Q,UAAK2zB,SAAL,CAAeC,KAAf,GAAuB,EAAvB;AACA;AACD;;AAED;;;;;;;;;;kCAOe;AACd,QAAI,CAAC,KAAK8C,eAAL,EAAL,EAA6B;AAC5B,YAAO,KAAP;AACA;AACD,QAAI,KAAKnO,UAAL,CAAgBuN,YAApB,EAAkC;AAAA;;AACjC,YAAO,oBAAKvN,UAAL,EAAgBuN,YAAhB,mDAAgC,KAAKa,sBAAL,EAAhC,EAAP;AACA;AACD,WAAO,IAAP;AACA;;AAED;;;;;;;;;8CAM2B;AAC1B,SAAK5E,gBAAL,GAAwB,EAAxB;AACA;;AAED;;;;;;;;;AAQA;;;;;;4BAMS;AACR,QAAI,KAAK+D,YAAL,EAAJ,EAAyB;AACxB,UAAKltB,KAAL;AACA;AACD;;AAED;;;;;;;;;8CAM2B7I,MAAM;AAChC,QAAI00B,WAAW5C,uBAAuB6C,yBAAvB,EAAf;AACA,QAAIC,eAAeF,SAAS5R,WAAT,EAAnB;AACA,QAAI,CAAC8R,aAAaC,mBAAlB,EAAuC;AACtCD,kBAAaC,mBAAb,GAAmC,IAAnC;AACA,SAAIH,SAAS5iB,OAAT,KAAqB9R,IAAzB,EAA+B;AAC9B00B,eAAS5iB,OAAT,GAAmB9R,IAAnB;AACA;AACD;AACD;;AAED;;;;;;;;;kCAMe2xB,MAAM;AACpB,QAAIjuB,UAAUiuB,KAAKjuB,OAAnB;AACA,QAAIpC,SAASwwB,uBAAuB6C,yBAAvB,EAAb;AACA,QAAIkC,eAAev1B,OAAOw1B,eAAP,GAAyBx1B,OAAOw1B,eAAP,EAAzB,GAAoD,EAAvE;AACA1mB,WAAOiF,KAAP,CAAa3R,OAAb,EAAsBpC,OAAOoC,OAA7B,EAAsCmzB,YAAtC;AACAlF,SAAKjuB,OAAL,GAAeA,OAAf;AACA;;;gDA5tBmC;AACnCqzB,yBAAqBlH,GAArB;AACA,QAAIkH,qBAAqBp2B,MAArB,KAAgC,CAApC,EAAuC;AACtC+wB,oCAA+BsF,aAA/B;AACA;AACD;;AAED;;;;;;;+CAImC;AAClC,WAAOD,qBAAqBA,qBAAqBp2B,MAArB,GAA8B,CAAnD,CAAP;AACA;;AAED;;;;;;;;;;oCAOwB;AACvB,QAAImR,UAAUxT,eAAe2H,cAAf,EAAd;AACA,QAAI0rB,OAAOG,uBAAuB6C,yBAAvB,EAAX;AACA,QAAI9R,WAAW8O,KAAK7O,WAAL,EAAf;AACA,QAAIvb,MAAMsb,QAAV;AACA,QAAIA,SAASgS,mBAAT,IAAgC/iB,YAAY6f,KAAK7f,OAAL,CAAatR,UAA7D,EAAyE;AACxE+G,WAAMsK,QAAQ+E,GAAR,CAAY9E,OAAZ,CAAN;AACA;AACDvK,QAAI+sB,WAAJ,GAAkB/sB,IAAI+sB,WAAJ,IAAmB;AACpCV,gBAAW;AACV/iB,YAAM,EADI;AAEVgjB,aAAO;AAFG,MADyB;AAKpCF,gBAAW;AACV9iB,YAAM,EADI;AAEVgjB,aAAO;AAFG;AALyB,KAArC;AAUA,WAAOtsB,IAAI+sB,WAAX;AACA;;;gCA2VmBt0B,MAAM;AACzB,WAAO,CAAC,CAACA,KAAKkwB,uBAAuBW,WAA5B,CAAT;AACA;;;0BAiGaoG,UAAUC,mBAAmBC,YAAY;AACtD,QAAI,CAACtM,UAAUuM,eAAV,CAA0BH,QAA1B,CAAL,EAA0C;AACzC,SAAI/yB,KAAK+yB,QAAT;;AADyC,SAEnCI,aAFmC;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,iCAG9B;AACT,YAAIvF,uBAAuB6C,yBAAvB,EAAJ,EAAwD;AACvD,cAAK7R,WAAL,GAAmBwT,cAAnB,CAAkC,IAAlC;AACA;AACD;AAPuC;AAAA;AAAA,gCAS/B;AACRpyB,WAAG,KAAK4e,WAAL,GAAmBiP,OAAtB;AACA;AAXuC;AAAA;AAAA,OAEblH,SAFa;;AAazCwM,mBAAcxI,QAAd,GAAyBiD,sBAAzB;AACAmF,gBAAWI,aAAX;AACA;AACD,WAAOxM,UAAUb,MAAV,CAAiBiN,QAAjB,EAA2BC,iBAA3B,EAA8CC,UAA9C,CAAP;AACA;;;+BAckBl2B,OAAO;AACzBA,UAAMivB,uBAAuBW,WAA7B,EAA0CyG,WAA1C,CAAsDr2B,KAAtD;AACA;;;6CAsKgC0wB,MAAM;AACtCoF,yBAAqB/1B,IAArB,CAA0B2wB,IAA1B;AACA;;;GA90BmC7H;;AA43BrC,KAAIiN,uBAAuB,EAA3B;AACA,KAAIpE,iBAAiB,EAArB;;AAEA;AACAb,wBAAuB2C,cAAvB,GAAwC,eAAxC;AACA3C,wBAAuBsC,cAAvB,GAAwC,eAAxC;;AAEA;AACAtC,wBAAuBgB,cAAvB,GAAwC,qCAAxC;;AAEA;AACA;AACA;AACAhB,wBAAuBsB,aAAvB,GAAuC,iBAAvC;;2CAEetB;;ACj6Bf;;;KAEShnB;KACFgnB;;;AAEP,KAAMyF,gBAAgB,EAAtB;;AAEA;;;;KAGMC;;;AACL;;;AAGA,uBAAY7F,IAAZ,EAAkB;AAAA;;AAAA,qIACXA,IADW;;AAGjB,SAAK9b,EAAL,CAAQic,uBAAuB2C,cAA/B,EAA+C,MAAKgD,uBAApD;AACA,SAAK5hB,EAAL,CAAQic,uBAAuBsC,cAA/B,EAA+C,MAAKsD,uBAApD;AAJiB;AAKjB;;AAED;;;;;;;4CAGyB;AACxB,WAAO,CAAC,KAAK9E,QAAN,EAAgB,KAAK+E,YAArB,CAAP;AACA;;AAED;;;;;;mCAGgB;AACf;AACA,SAAKA,YAAL,GAAoB,EAApB;AACA;;AAED;;;;;;0CAGuB13B,MAAM;AAC5B,QAAIA,KAAKwH,IAAL,KAAc,OAAlB,EAA2B;AAC1B,UAAKkwB,YAAL,CAAkB13B,KAAKX,GAAvB,IAA8BW,IAA9B;AACA,KAFD,MAEO;AACN,kJAA6BA,IAA7B;AACA;AACD;;AAED;;;;;;;;;;;iDAQgC;AAAA,QAAPuT,IAAO,QAAPA,IAAO;;AAC/B,QAAIokB,QAAQ,CAAZ;AACA,QAAIL,cAAc52B,MAAd,GAAuB,CAA3B,EAA8B;AAC7Bi3B,aAAQ,EAAEL,cAAcA,cAAc52B,MAAd,GAAuB,CAArC,CAAV;AACA;;AAED,QAAI,CAACmK,gBAAgB0I,KAAK,CAAL,CAAhB,CAAL,EAA+B;AAC9B,SAAIokB,KAAJ,EAAW;AACVpkB,WAAK,CAAL,IAAUgkB,YAAYK,UAAZ,GAAyBD,KAAnC;AACA,MAFD,MAEO;AACN;AACA;AACA,UAAM53B,OAAO1B,eAAe4H,cAAf,EAAb;AACA,UAAIlG,QAAQA,KAAK83B,oBAAjB,EAAuC;AACtCtkB,YAAK,CAAL,IAAUxT,KAAK83B,oBAAL,CAA0Bx4B,GAApC;AACA;AACD;AACD;AACDi4B,kBAAcv2B,IAAd,CAAmB,CAAnB;AACA;;AAED;;;;;;;6CAI0B;AACzBu2B,kBAAc1H,GAAd;AACA;;AAED;;;;;;qCAGkB;AACjB,WAAO,yIAA2BnxB,OAAOmS,IAAP,CAAY,KAAK8mB,YAAjB,EAA+Bh3B,MAA/B,GAAwC,CAA1E;AACA;;AAED;;;;;;;;;kCAMe;AACd,QAAI,KAAK6nB,UAAL,CAAgBwB,MAApB,EAA4B;AAC3B+N,iBAAYC,eAAZ,CAA4B,KAAKxP,UAAL,CAAgBwB,MAAhB,EAA5B;AACA,KAFD,MAEO;AACN;AACA;AACD;;AAED;;;;;;;+BAImB;AAClB,QAAIuN,cAAc52B,MAAd,GAAuB,CAA3B,EAA8B;AAC7B42B,mBAAcA,cAAc52B,MAAd,GAAuB,CAArC;AACA;AACD;;;GAvGwBmxB;;AA0G1B0F,aAAYK,UAAZ,GAAyB,aAAzB;AACAL,aAAYpE,aAAZ,GAA4B,KAA5B;;gCAEeoE;;ACvHf;;;KAEO1F;KACA0F;;AAEP;;;;;;AAMAj5B,QAAOw5B,WAAP,GAAqBx5B,OAAOw5B,WAAP,IAAsB,EAA3C;;AAEAx5B,QAAOw5B,WAAP,CAAmBn3B,IAAnB,GAA0B,UAASE,KAAT,EAAgBm3B,QAAhB,EAA0B;AACnD35B,iBAAesC,IAAf,CAAoBq3B,QAApB,EAA8Bn3B,KAA9B;AACA,EAFD;;AAIAvC,QAAOw5B,WAAP,CAAmBG,MAAnB,GAA4B,UAAS9nB,MAAT,EAAiB+nB,QAAjB,EAA2B;AACtD,MAAIC,SAAS15B,OAAOC,SAAP,CAAiBF,cAA9B;AACA,OAAK,IAAIwI,IAAT,IAAiBmJ,MAAjB,EAAyB;AACxB,OAAIgoB,OAAOn5B,IAAP,CAAYmR,MAAZ,EAAoBnJ,IAApB,CAAJ,EAA+B;AAC9BkxB,aAAS/nB,OAAOnJ,IAAP,CAAT,EAAuBA,IAAvB;AACA;AACD;AACD,EAPD;;AASA1I,QAAOw5B,WAAP,CAAmBM,UAAnB,GAAgC,UAASC,cAAT,EAAyB9kB,IAAzB,EAA+B;AAC9D,MAAI+kB,UAAU/kB,OAAO,YAAW;AAC/B,UAAO8kB,eAAe7vB,KAAf,CAAqB,IAArB,EAA2B+K,IAA3B,CAAP;AACA,GAFa,GAEV8kB,cAFJ;AAGAC,UAAQC,eAAR,GAA0B,IAA1B;AACA,SAAOD,OAAP;AACA,EAND;;AAQAh6B,QAAOw5B,WAAP,CAAmBC,eAAnB,GAAqC,UAAS/2B,KAAT,EAAgB;AACpD,MAAIwG,cAAcxG,KAAd,qDAAcA,KAAd,CAAJ;AACA,MAAIwG,SAAS,QAAT,IAAsBA,SAAS,QAAT,IAAqBxG,SAASA,iBAAiBwK,MAAzE,EAAkF;AACjFnN,kBAAewB,IAAf,CAAoBmB,KAApB;AACA,GAFD,MAEO,IAAIwG,SAAS,UAAT,IAAuBxG,MAAMu3B,eAAjC,EAAkD;AACxDv3B;AACA,GAFM,MAEA,IAAIqL,MAAMC,OAAN,CAActL,KAAd,CAAJ,EAA0B;AAChCA,SAAMmV,OAAN,CAAc7X,OAAOw5B,WAAP,CAAmBC,eAAjC;AACA,GAFM,MAEA,IAAIvsB,OAAOxK,KAAP,MAAkB,iBAAtB,EAAyC;AAC/C;AACA,OAAI6wB,uBAAuB2G,YAAvB,CAAoCx3B,KAApC,CAAJ,EAAgD;AAC/C6wB,2BAAuBwF,WAAvB,CAAmCr2B,KAAnC;AACA,IAFD,MAEO;AACN1C,WAAOw5B,WAAP,CAAmBG,MAAnB,CAA0Bj3B,KAA1B,EAAiC1C,OAAOw5B,WAAP,CAAmBC,eAApD;AACA;AACD,GAPM,MAOA,IAAI,CAAC/2B,KAAL,EAAY;AAClBu2B,eAAYkB,SAAZ;AACA;AACD,EAlBD;;gCAoBen6B,OAAOw5B;;ACtDtB;;;KAESrsB;KAA2B0E;KAC3BkY;KACF9E;;KAEDmV;;;;;;;;;;;AACL;;;;;;;yBAOM;AAAA;;AACL,oBAAKC,MAAL,EAAYvT,UAAZ,gBAA0Bjd,SAA1B;AACA;;AAED;;;;;;;;yCAKsBnI,MAAM;AAC3B,QAAI4Q,OAAOnS,OAAOmS,IAAP,CAAY5Q,IAAZ,CAAX;AACA,SAAK,IAAIS,IAAI,CAAb,EAAgBA,IAAImQ,KAAKlQ,MAAzB,EAAiCD,GAAjC,EAAsC;AACrC,SAAI,CAAC,KAAKk4B,MAAL,CAAYlR,WAAZ,CAAwB7W,KAAKnQ,CAAL,CAAxB,CAAL,EAAuC;AACtC,WAAK8nB,UAAL,CAAgBxD,KAAhB,CAAsBnU,KAAKnQ,CAAL,CAAtB,IAAiCT,KAAK4Q,KAAKnQ,CAAL,CAAL,CAAjC;AACA;AACD;AACD;;AAED;;;;;;;;;;;2CAQwBT,MAAM;AAC7B,QAAMilB,OAAO,KAAKsD,UAAL,CAAgBlf,WAA7B;AACAoC,8BAA0BwZ,IAA1B,EAAgC,OAAhC,EAAyC1B,MAAM4E,UAA/C;AACA,WAAOhY,OAAOiF,KAAP,CAAa,EAAb,EAAiBpV,IAAjB,EAAuB,KAAKuoB,UAAL,CAAgBlf,WAAhB,CAA4BuvB,YAAnD,CAAP;AACA;;AAED;;;;;;;;;;gCAOa54B,MAAM;AAAA;;AAClB,SAAKuoB,UAAL,CAAgBxD,KAAhB,GAAwB,EAAxB;AACA,6IAAmB/kB,IAAnB,EAAyB,KAAKuoB,UAAL,CAAgBxD,KAAzC;AACA,SAAK4T,MAAL,GAAc,KAAKjQ,MAAnB;AACA,SAAKmQ,qBAAL,CAA2B,KAAKtQ,UAAL,CAAgBQ,gBAAhB,EAA3B;;AAEA,SAAKR,UAAL,CAAgBhD,KAAhB,GAAwB,EAAxB;AACA,SAAKmD,MAAL,GAAc,IAAInF,KAAJ,CAAU,EAAV,EAAc,KAAKgF,UAAL,CAAgBhD,KAA9B,EAAqC,KAAKgD,UAA1C,EAAsD;AACnEiB,eAAU;AADyD,KAAtD,CAAd;AAGA,SAAKd,MAAL,CAAYtD,UAAZ,CAAuB,KAAKmD,UAAL,CAAgBlf,WAAhB,CAA4Bgc,YAAnD;;AAEA,QAAMlT,WAAW,SAAXA,QAAW;AAAA,uCAAIoB,IAAJ;AAAIA,UAAJ;AAAA;;AAAA,YAAa,OAAKyV,KAAL,eAAczV,IAAd,SAAoB,OAApB,GAAb;AAAA,KAAjB;AACA,SAAKmV,MAAL,CAAY9S,EAAZ,CAAe,cAAf,EAA+BzD,QAA/B;AACA,SAAKuW,MAAL,CAAY9S,EAAZ,CAAe,iBAAf,EAAkCzD,QAAlC;AACA;;AAED;;;;;;qCAGkB;AACjB;;AAEA,SAAKwmB,MAAL,CAAYzP,OAAZ;AACA,SAAKyP,MAAL,GAAc,IAAd;AACA;;AAED;;;;;;;;;;;yBAQM34B,MAAMkS,OAA2B;AAAA,QAApB4mB,QAAoB,uEAAT,OAAS;;AACtC94B,SAAKwH,IAAL,GAAYsxB,QAAZ;AACA,sIAAY94B,IAAZ,EAAkBkS,KAAlB;AACA;;AAED;;;;;;;;;;uBAOItR,MAAM;AACT,WAAO,KAAK+3B,MAAL,CAAYhiB,GAAZ,CAAgB/V,IAAhB,CAAP;AACA;;AAED;;;;;;;sCAImB;AAClB,WAAO,KAAK+3B,MAAZ;AACA;;AAED;;;;;;;;;iCAMc;AACb,WAAO,KAAKA,MAAL,CAAYjS,YAAZ,EAAP;AACA;;AAED;;;;;;;;sCAKmB1mB,MAAM;AACxB,QAAI+4B,YAAY5oB,OAAOiF,KAAP,CAAa,EAAb,EAAiB,KAAKmT,UAAL,CAAgBxD,KAAjC,CAAhB;AACAsD,yBAAqBgB,kBAArB,CAAwCrpB,IAAxC,EAA8C,KAAK24B,MAAnD;AACA,SAAKE,qBAAL,CAA2B74B,IAA3B;AACA,QAAI,KAAKuoB,UAAL,CAAgByQ,YAApB,EAAkC;AACjC,UAAKzQ,UAAL,CAAgByQ,YAAhB,CAA6BD,SAA7B;AACA;AACD;;;GAhI2B1Q;;AAmI7BqQ,gBAAejP,SAAf,GAA2B,EAA3B;;mCAEeiP;;AC3If;;;KAGSxX;KAAYiC;KACdyH;KACAiH;KACA6G;KACAnB;;AAEP;;;;;;;;;;;;KAWM0B;;;;;;;;;;;AACL;;;;;;;;;;4BAUuB;AACtB,WAAOpH,uBAAuB9H,MAAvB,yCAAP;AACA;;;GAbyBa;;AAgB3BqO,cAAavK,YAAb,GAA4BgK,cAA5B;AACAO,cAAarK,QAAb,GAAwB2I,WAAxB;;iCAEe0B;;oDACN/X;gDAAYiC;sDAAQ8V;;ACxC7B;;;KAEOA;;KAEDC;;;;;;;;;;4BACI;AAAA;AAAA;AAAA;AAER;;;GAHmCD;;2CAMtBC","file":"jsFiddleMetalComponent.js","sourcesContent":["/* jshint ignore:start */\n\n/**\n * @license\n * Copyright 2015 The Incremental DOM Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n(function (global, factory) {\n  (factory((global.IncrementalDOM = global.IncrementalDOM || {})));\n}(window, function (exports) { 'use strict';\n\n  /**\n   * Copyright 2015 The Incremental DOM Authors. All Rights Reserved.\n   *\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   *      http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS-IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   */\n\n  /**\n   * A cached reference to the hasOwnProperty function.\n   */\n  var hasOwnProperty = Object.prototype.hasOwnProperty;\n\n  /**\n   * A constructor function that will create blank objects.\n   * @constructor\n   */\n  function Blank() {}\n\n  Blank.prototype = Object.create(null);\n\n  /**\n   * Used to prevent property collisions between our \"map\" and its prototype.\n   * @param {!Object<string, *>} map The map to check.\n   * @param {string} property The property to check.\n   * @return {boolean} Whether map has property.\n   */\n  var has = function (map, property) {\n    return hasOwnProperty.call(map, property);\n  };\n\n  /**\n   * Creates an map object without a prototype.\n   * @return {!Object}\n   */\n  var createMap = function () {\n    return new Blank();\n  };\n\n  /**\n   * The property name where we store Incremental DOM data.\n   */\n  var DATA_PROP = '__incrementalDOMData';\n\n  /**\n   * Keeps track of information needed to perform diffs for a given DOM node.\n   * @param {!string} nodeName\n   * @param {?string=} key\n   * @constructor\n   */\n  function NodeData(nodeName, key) {\n    /**\n     * The attributes and their values.\n     * @const {!Object<string, *>}\n     */\n    this.attrs = createMap();\n\n    /**\n     * An array of attribute name/value pairs, used for quickly diffing the\n     * incomming attributes to see if the DOM node's attributes need to be\n     * updated.\n     * @const {Array<*>}\n     */\n    this.attrsArr = [];\n\n    /**\n     * The incoming attributes for this Node, before they are updated.\n     * @const {!Object<string, *>}\n     */\n    this.newAttrs = createMap();\n\n    /**\n     * Whether or not the statics have been applied for the node yet.\n     * {boolean}\n     */\n    this.staticsApplied = false;\n\n    /**\n     * The key used to identify this node, used to preserve DOM nodes when they\n     * move within their parent.\n     * @const\n     */\n    this.key = key;\n\n    /**\n     * Keeps track of children within this node by their key.\n     * {!Object<string, !Element>}\n     */\n    this.keyMap = createMap();\n\n    /**\n     * Whether or not the keyMap is currently valid.\n     * @type {boolean}\n     */\n    this.keyMapValid = true;\n\n    /**\n     * Whether or the associated node is, or contains, a focused Element.\n     * @type {boolean}\n     */\n    this.focused = false;\n\n    /**\n     * The node name for this node.\n     * @const {string}\n     */\n    this.nodeName = nodeName;\n\n    /**\n     * @type {?string}\n     */\n    this.text = null;\n  }\n\n  /**\n   * Initializes a NodeData object for a Node.\n   *\n   * @param {Node} node The node to initialize data for.\n   * @param {string} nodeName The node name of node.\n   * @param {?string=} key The key that identifies the node.\n   * @return {!NodeData} The newly initialized data object\n   */\n  var initData = function (node, nodeName, key) {\n    var data = new NodeData(nodeName, key);\n    node[DATA_PROP] = data;\n    return data;\n  };\n\n  /**\n   * Retrieves the NodeData object for a Node, creating it if necessary.\n   *\n   * @param {?Node} node The Node to retrieve the data for.\n   * @return {!NodeData} The NodeData for this Node.\n   */\n  var getData = function (node) {\n    importNode(node);\n    return node[DATA_PROP];\n  };\n\n  /**\n   * Imports node and its subtree, initializing caches.\n   *\n   * @param {?Node} node The Node to import.\n   */\n  var importNode = function (node) {\n    if (node[DATA_PROP]) {\n      return;\n    }\n\n    var isElement = node instanceof Element;\n    var nodeName = isElement ? node.localName : node.nodeName;\n    var key = isElement ? node.getAttribute('key') : null;\n    var data = initData(node, nodeName, key);\n\n    if (key) {\n      getData(node.parentNode).keyMap[key] = node;\n    }\n\n    if (isElement) {\n      var attributes = node.attributes;\n      var attrs = data.attrs;\n      var newAttrs = data.newAttrs;\n      var attrsArr = data.attrsArr;\n\n      for (var i = 0; i < attributes.length; i += 1) {\n        var attr = attributes[i];\n        var name = attr.name;\n        var value = attr.value;\n\n        attrs[name] = value;\n        newAttrs[name] = undefined;\n        attrsArr.push(name);\n        attrsArr.push(value);\n      }\n    }\n\n    for (var child = node.firstChild; child; child = child.nextSibling) {\n      importNode(child);\n    }\n  };\n\n  /**\n   * Gets the namespace to create an element (of a given tag) in.\n   * @param {string} tag The tag to get the namespace for.\n   * @param {?Node} parent\n   * @return {?string} The namespace to create the tag in.\n   */\n  var getNamespaceForTag = function (tag, parent) {\n    if (tag === 'svg') {\n      return 'http://www.w3.org/2000/svg';\n    }\n\n    if (getData(parent).nodeName === 'foreignObject') {\n      return null;\n    }\n\n    return parent.namespaceURI;\n  };\n\n  /**\n   * Creates an Element.\n   * @param {Document} doc The document with which to create the Element.\n   * @param {?Node} parent\n   * @param {string} tag The tag for the Element.\n   * @param {?string=} key A key to identify the Element.\n   * @return {!Element}\n   */\n  var createElement = function (doc, parent, tag, key) {\n    var namespace = getNamespaceForTag(tag, parent);\n    var el = undefined;\n\n    if (namespace) {\n      el = doc.createElementNS(namespace, tag);\n    } else {\n      el = doc.createElement(tag);\n    }\n\n    initData(el, tag, key);\n\n    return el;\n  };\n\n  /**\n   * Creates a Text Node.\n   * @param {Document} doc The document with which to create the Element.\n   * @return {!Text}\n   */\n  var createText = function (doc) {\n    var node = doc.createTextNode('');\n    initData(node, '#text', null);\n    return node;\n  };\n\n  /**\n   * Copyright 2015 The Incremental DOM Authors. All Rights Reserved.\n   *\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   *      http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS-IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   */\n\n  /** @const */\n  var notifications = {\n    /**\n     * Called after patch has compleated with any Nodes that have been created\n     * and added to the DOM.\n     * @type {?function(Array<!Node>)}\n     */\n    nodesCreated: null,\n\n    /**\n     * Called after patch has compleated with any Nodes that have been removed\n     * from the DOM.\n     * Note it's an applications responsibility to handle any childNodes.\n     * @type {?function(Array<!Node>)}\n     */\n    nodesDeleted: null\n  };\n\n  /**\n   * Keeps track of the state of a patch.\n   * @constructor\n   */\n  function Context() {\n    /**\n     * @type {(Array<!Node>|undefined)}\n     */\n    this.created = notifications.nodesCreated && [];\n\n    /**\n     * @type {(Array<!Node>|undefined)}\n     */\n    this.deleted = notifications.nodesDeleted && [];\n  }\n\n  /**\n   * @param {!Node} node\n   */\n  Context.prototype.markCreated = function (node) {\n    if (this.created) {\n      this.created.push(node);\n    }\n  };\n\n  /**\n   * @param {!Node} node\n   */\n  Context.prototype.markDeleted = function (node) {\n    if (this.deleted) {\n      this.deleted.push(node);\n    }\n  };\n\n  /**\n   * Notifies about nodes that were created during the patch opearation.\n   */\n  Context.prototype.notifyChanges = function () {\n    if (this.created && this.created.length > 0) {\n      notifications.nodesCreated(this.created);\n    }\n\n    if (this.deleted && this.deleted.length > 0) {\n      notifications.nodesDeleted(this.deleted);\n    }\n  };\n\n  /**\n   * Copyright 2016 The Incremental DOM Authors. All Rights Reserved.\n   *\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   *      http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS-IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   */\n\n  /**\n   * @param {!Node} node\n   * @return {boolean} True if the node the root of a document, false otherwise.\n   */\n  var isDocumentRoot = function (node) {\n    // For ShadowRoots, check if they are a DocumentFragment instead of if they\n    // are a ShadowRoot so that this can work in 'use strict' if ShadowRoots are\n    // not supported.\n    return node instanceof Document || node instanceof DocumentFragment;\n  };\n\n  /**\n   * @param {!Node} node The node to start at, inclusive.\n   * @param {?Node} root The root ancestor to get until, exclusive.\n   * @return {!Array<!Node>} The ancestry of DOM nodes.\n   */\n  var getAncestry = function (node, root) {\n    var ancestry = [];\n    var cur = node;\n\n    while (cur !== root) {\n      ancestry.push(cur);\n      cur = cur.parentNode;\n    }\n\n    return ancestry;\n  };\n\n  /**\n   * @param {!Node} node\n   * @return {!Node} The root node of the DOM tree that contains node.\n   */\n  var getRoot = function (node) {\n    var cur = node;\n    var prev = cur;\n\n    while (cur) {\n      prev = cur;\n      cur = cur.parentNode;\n    }\n\n    return prev;\n  };\n\n  /**\n   * @param {!Node} node The node to get the activeElement for.\n   * @return {?Element} The activeElement in the Document or ShadowRoot\n   *     corresponding to node, if present.\n   */\n  var getActiveElement = function (node) {\n    var root = getRoot(node);\n    return isDocumentRoot(root) ? root.activeElement : null;\n  };\n\n  /**\n   * Gets the path of nodes that contain the focused node in the same document as\n   * a reference node, up until the root.\n   * @param {!Node} node The reference node to get the activeElement for.\n   * @param {?Node} root The root to get the focused path until.\n   * @return {!Array<Node>}\n   */\n  var getFocusedPath = function (node, root) {\n    var activeElement = getActiveElement(node);\n\n    if (!activeElement || !node.contains(activeElement)) {\n      return [];\n    }\n\n    return getAncestry(activeElement, root);\n  };\n\n  /**\n   * Like insertBefore, but instead instead of moving the desired node, instead\n   * moves all the other nodes after.\n   * @param {?Node} parentNode\n   * @param {!Node} node\n   * @param {?Node} referenceNode\n   */\n  var moveBefore = function (parentNode, node, referenceNode) {\n    var insertReferenceNode = node.nextSibling;\n    var cur = referenceNode;\n\n    while (cur !== node) {\n      var next = cur.nextSibling;\n      parentNode.insertBefore(cur, insertReferenceNode);\n      cur = next;\n    }\n  };\n\n  /** @type {?Context} */\n  var context = null;\n\n  /** @type {?Node} */\n  var currentNode = null;\n\n  /** @type {?Node} */\n  var currentParent = null;\n\n  /** @type {?Document} */\n  var doc = null;\n\n  /**\n   * @param {!Array<Node>} focusPath The nodes to mark.\n   * @param {boolean} focused Whether or not they are focused.\n   */\n  var markFocused = function (focusPath, focused) {\n    for (var i = 0; i < focusPath.length; i += 1) {\n      getData(focusPath[i]).focused = focused;\n    }\n  };\n\n  /**\n   * Returns a patcher function that sets up and restores a patch context,\n   * running the run function with the provided data.\n   * @param {function((!Element|!DocumentFragment),!function(T),T=): ?Node} run\n   * @return {function((!Element|!DocumentFragment),!function(T),T=): ?Node}\n   * @template T\n   */\n  var patchFactory = function (run) {\n    /**\n     * TODO(moz): These annotations won't be necessary once we switch to Closure\n     * Compiler's new type inference. Remove these once the switch is done.\n     *\n     * @param {(!Element|!DocumentFragment)} node\n     * @param {!function(T)} fn\n     * @param {T=} data\n     * @return {?Node} node\n     * @template T\n     */\n    var f = function (node, fn, data) {\n      var prevContext = context;\n      var prevDoc = doc;\n      var prevCurrentNode = currentNode;\n      var prevCurrentParent = currentParent;\n      var previousInAttributes = false;\n      var previousInSkip = false;\n\n      context = new Context();\n      doc = node.ownerDocument;\n      currentParent = node.parentNode;\n\n      if ('production' !== 'production') {}\n\n      var focusPath = getFocusedPath(node, currentParent);\n      markFocused(focusPath, true);\n      var retVal = run(node, fn, data);\n      markFocused(focusPath, false);\n\n      if ('production' !== 'production') {}\n\n      context.notifyChanges();\n\n      context = prevContext;\n      doc = prevDoc;\n      currentNode = prevCurrentNode;\n      currentParent = prevCurrentParent;\n\n      return retVal;\n    };\n    return f;\n  };\n\n  /**\n   * Patches the document starting at node with the provided function. This\n   * function may be called during an existing patch operation.\n   * @param {!Element|!DocumentFragment} node The Element or Document\n   *     to patch.\n   * @param {!function(T)} fn A function containing elementOpen/elementClose/etc.\n   *     calls that describe the DOM.\n   * @param {T=} data An argument passed to fn to represent DOM state.\n   * @return {!Node} The patched node.\n   * @template T\n   */\n  var patchInner = patchFactory(function (node, fn, data) {\n    currentNode = node;\n\n    enterNode();\n    fn(data);\n    exitNode();\n\n    if ('production' !== 'production') {}\n\n    return node;\n  });\n\n  /**\n   * Patches an Element with the the provided function. Exactly one top level\n   * element call should be made corresponding to `node`.\n   * @param {!Element} node The Element where the patch should start.\n   * @param {!function(T)} fn A function containing elementOpen/elementClose/etc.\n   *     calls that describe the DOM. This should have at most one top level\n   *     element call.\n   * @param {T=} data An argument passed to fn to represent DOM state.\n   * @return {?Node} The node if it was updated, its replacedment or null if it\n   *     was removed.\n   * @template T\n   */\n  var patchOuter = patchFactory(function (node, fn, data) {\n    var startNode = /** @type {!Element} */{ nextSibling: node };\n    var expectedNextNode = null;\n    var expectedPrevNode = null;\n\n    if ('production' !== 'production') {}\n\n    currentNode = startNode;\n    fn(data);\n\n    if ('production' !== 'production') {}\n\n    if (node !== currentNode && node.parentNode) {\n      removeChild(currentParent, node, getData(currentParent).keyMap);\n    }\n\n    return startNode === currentNode ? null : currentNode;\n  });\n\n  /**\n   * Checks whether or not the current node matches the specified nodeName and\n   * key.\n   *\n   * @param {!Node} matchNode A node to match the data to.\n   * @param {?string} nodeName The nodeName for this node.\n   * @param {?string=} key An optional key that identifies a node.\n   * @return {boolean} True if the node matches, false otherwise.\n   */\n  var matches = function (matchNode, nodeName, key) {\n    var data = getData(matchNode);\n\n    // Key check is done using double equals as we want to treat a null key the\n    // same as undefined. This should be okay as the only values allowed are\n    // strings, null and undefined so the == semantics are not too weird.\n    return nodeName === data.nodeName && key == data.key;\n  };\n\n  /**\n   * Aligns the virtual Element definition with the actual DOM, moving the\n   * corresponding DOM node to the correct location or creating it if necessary.\n   * @param {string} nodeName For an Element, this should be a valid tag string.\n   *     For a Text, this should be #text.\n   * @param {?string=} key The key used to identify this element.\n   */\n  var alignWithDOM = function (nodeName, key) {\n    if (currentNode && matches(currentNode, nodeName, key)) {\n      return;\n    }\n\n    var parentData = getData(currentParent);\n    var currentNodeData = currentNode && getData(currentNode);\n    var keyMap = parentData.keyMap;\n    var node = undefined;\n\n    // Check to see if the node has moved within the parent.\n    if (key) {\n      var keyNode = keyMap[key];\n      if (keyNode) {\n        if (matches(keyNode, nodeName, key)) {\n          node = keyNode;\n        } else if (keyNode === currentNode) {\n          context.markDeleted(keyNode);\n        } else {\n          removeChild(currentParent, keyNode, keyMap);\n        }\n      }\n    }\n\n    // Create the node if it doesn't exist.\n    if (!node) {\n      if (nodeName === '#text') {\n        node = createText(doc);\n      } else {\n        node = createElement(doc, currentParent, nodeName, key);\n      }\n\n      if (key) {\n        keyMap[key] = node;\n      }\n\n      context.markCreated(node);\n    }\n\n    // Re-order the node into the right position, preserving focus if either\n    // node or currentNode are focused by making sure that they are not detached\n    // from the DOM.\n    if (getData(node).focused) {\n      // Move everything else before the node.\n      moveBefore(currentParent, node, currentNode);\n    } else if (currentNodeData && currentNodeData.key && !currentNodeData.focused) {\n      // Remove the currentNode, which can always be added back since we hold a\n      // reference through the keyMap. This prevents a large number of moves when\n      // a keyed item is removed or moved backwards in the DOM.\n      currentParent.replaceChild(node, currentNode);\n      parentData.keyMapValid = false;\n    } else {\n      currentParent.insertBefore(node, currentNode);\n    }\n\n    currentNode = node;\n  };\n\n  /**\n   * @param {?Node} node\n   * @param {?Node} child\n   * @param {?Object<string, !Element>} keyMap\n   */\n  var removeChild = function (node, child, keyMap) {\n    node.removeChild(child);\n    context.markDeleted( /** @type {!Node}*/child);\n\n    var key = getData(child).key;\n    if (key) {\n      delete keyMap[key];\n    }\n  };\n\n  /**\n   * Clears out any unvisited Nodes, as the corresponding virtual element\n   * functions were never called for them.\n   */\n  var clearUnvisitedDOM = function () {\n    var node = currentParent;\n    var data = getData(node);\n    var keyMap = data.keyMap;\n    var keyMapValid = data.keyMapValid;\n    var child = node.lastChild;\n    var key = undefined;\n\n    if (child === currentNode && keyMapValid) {\n      return;\n    }\n\n    while (child !== currentNode) {\n      removeChild(node, child, keyMap);\n      child = node.lastChild;\n    }\n\n    // Clean the keyMap, removing any unusued keys.\n    if (!keyMapValid) {\n      for (key in keyMap) {\n        child = keyMap[key];\n        if (child.parentNode !== node) {\n          context.markDeleted(child);\n          delete keyMap[key];\n        }\n      }\n\n      data.keyMapValid = true;\n    }\n  };\n\n  /**\n   * Changes to the first child of the current node.\n   */\n  var enterNode = function () {\n    currentParent = currentNode;\n    currentNode = null;\n  };\n\n  /**\n   * @return {?Node} The next Node to be patched.\n   */\n  var getNextNode = function () {\n    if (currentNode) {\n      return currentNode.nextSibling;\n    } else {\n      return currentParent.firstChild;\n    }\n  };\n\n  /**\n   * Changes to the next sibling of the current node.\n   */\n  var nextNode = function () {\n    currentNode = getNextNode();\n  };\n\n  /**\n   * Changes to the parent of the current node, removing any unvisited children.\n   */\n  var exitNode = function () {\n    clearUnvisitedDOM();\n\n    currentNode = currentParent;\n    currentParent = currentParent.parentNode;\n  };\n\n  /**\n   * Makes sure that the current node is an Element with a matching tagName and\n   * key.\n   *\n   * @param {string} tag The element's tag.\n   * @param {?string=} key The key used to identify this element. This can be an\n   *     empty string, but performance may be better if a unique value is used\n   *     when iterating over an array of items.\n   * @return {!Element} The corresponding Element.\n   */\n  var coreElementOpen = function (tag, key) {\n    nextNode();\n    alignWithDOM(tag, key);\n    enterNode();\n    return (/** @type {!Element} */currentParent\n    );\n  };\n\n  /**\n   * Closes the currently open Element, removing any unvisited children if\n   * necessary.\n   *\n   * @return {!Element} The corresponding Element.\n   */\n  var coreElementClose = function () {\n    if ('production' !== 'production') {}\n\n    exitNode();\n    return (/** @type {!Element} */currentNode\n    );\n  };\n\n  /**\n   * Makes sure the current node is a Text node and creates a Text node if it is\n   * not.\n   *\n   * @return {!Text} The corresponding Text Node.\n   */\n  var coreText = function () {\n    nextNode();\n    alignWithDOM('#text', null);\n    return (/** @type {!Text} */currentNode\n    );\n  };\n\n  /**\n   * Gets the current Element being patched.\n   * @return {!Element}\n   */\n  var currentElement = function () {\n    if ('production' !== 'production') {}\n    return (/** @type {!Element} */currentParent\n    );\n  };\n\n  /**\n   * @return {Node} The Node that will be evaluated for the next instruction.\n   */\n  var currentPointer = function () {\n    if ('production' !== 'production') {}\n    return getNextNode();\n  };\n\n  /**\n   * Skips the children in a subtree, allowing an Element to be closed without\n   * clearing out the children.\n   */\n  var skip = function () {\n    if ('production' !== 'production') {}\n    currentNode = currentParent.lastChild;\n  };\n\n  /**\n   * Skips the next Node to be patched, moving the pointer forward to the next\n   * sibling of the current pointer.\n   */\n  var skipNode = nextNode;\n\n  /**\n   * Copyright 2015 The Incremental DOM Authors. All Rights Reserved.\n   *\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   *      http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS-IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   */\n\n  /** @const */\n  var symbols = {\n    default: '__default'\n  };\n\n  /**\n   * @param {string} name\n   * @return {string|undefined} The namespace to use for the attribute.\n   */\n  var getNamespace = function (name) {\n    if (name.lastIndexOf('xml:', 0) === 0) {\n      return 'http://www.w3.org/XML/1998/namespace';\n    }\n\n    if (name.lastIndexOf('xlink:', 0) === 0) {\n      return 'http://www.w3.org/1999/xlink';\n    }\n  };\n\n  /**\n   * Applies an attribute or property to a given Element. If the value is null\n   * or undefined, it is removed from the Element. Otherwise, the value is set\n   * as an attribute.\n   * @param {!Element} el\n   * @param {string} name The attribute's name.\n   * @param {?(boolean|number|string)=} value The attribute's value.\n   */\n  var applyAttr = function (el, name, value) {\n    if (value == null) {\n      el.removeAttribute(name);\n    } else {\n      var attrNS = getNamespace(name);\n      if (attrNS) {\n        el.setAttributeNS(attrNS, name, value);\n      } else {\n        el.setAttribute(name, value);\n      }\n    }\n  };\n\n  /**\n   * Applies a property to a given Element.\n   * @param {!Element} el\n   * @param {string} name The property's name.\n   * @param {*} value The property's value.\n   */\n  var applyProp = function (el, name, value) {\n    el[name] = value;\n  };\n\n  /**\n   * Applies a value to a style declaration. Supports CSS custom properties by\n   * setting properties containing a dash using CSSStyleDeclaration.setProperty.\n   * @param {CSSStyleDeclaration} style\n   * @param {!string} prop\n   * @param {*} value\n   */\n  var setStyleValue = function (style, prop, value) {\n    if (prop.indexOf('-') >= 0) {\n      style.setProperty(prop, /** @type {string} */value);\n    } else {\n      style[prop] = value;\n    }\n  };\n\n  /**\n   * Applies a style to an Element. No vendor prefix expansion is done for\n   * property names/values.\n   * @param {!Element} el\n   * @param {string} name The attribute's name.\n   * @param {*} style The style to set. Either a string of css or an object\n   *     containing property-value pairs.\n   */\n  var applyStyle = function (el, name, style) {\n    if (typeof style === 'string') {\n      el.style.cssText = style;\n    } else {\n      el.style.cssText = '';\n      var elStyle = el.style;\n      var obj = /** @type {!Object<string,string>} */style;\n\n      for (var prop in obj) {\n        if (has(obj, prop)) {\n          setStyleValue(elStyle, prop, obj[prop]);\n        }\n      }\n    }\n  };\n\n  /**\n   * Updates a single attribute on an Element.\n   * @param {!Element} el\n   * @param {string} name The attribute's name.\n   * @param {*} value The attribute's value. If the value is an object or\n   *     function it is set on the Element, otherwise, it is set as an HTML\n   *     attribute.\n   */\n  var applyAttributeTyped = function (el, name, value) {\n    var type = typeof value;\n\n    if (type === 'object' || type === 'function') {\n      applyProp(el, name, value);\n    } else {\n      applyAttr(el, name, /** @type {?(boolean|number|string)} */value);\n    }\n  };\n\n  /**\n   * Calls the appropriate attribute mutator for this attribute.\n   * @param {!Element} el\n   * @param {string} name The attribute's name.\n   * @param {*} value The attribute's value.\n   */\n  var updateAttribute = function (el, name, value) {\n    var data = getData(el);\n    var attrs = data.attrs;\n\n    if (attrs[name] === value) {\n      return;\n    }\n\n    var mutator = attributes[name] || attributes[symbols.default];\n    mutator(el, name, value);\n\n    attrs[name] = value;\n  };\n\n  /**\n   * A publicly mutable object to provide custom mutators for attributes.\n   * @const {!Object<string, function(!Element, string, *)>}\n   */\n  var attributes = createMap();\n\n  // Special generic mutator that's called for any attribute that does not\n  // have a specific mutator.\n  attributes[symbols.default] = applyAttributeTyped;\n\n  attributes['style'] = applyStyle;\n\n  /**\n   * The offset in the virtual element declaration where the attributes are\n   * specified.\n   * @const\n   */\n  var ATTRIBUTES_OFFSET = 3;\n\n  /**\n   * Builds an array of arguments for use with elementOpenStart, attr and\n   * elementOpenEnd.\n   * @const {Array<*>}\n   */\n  var argsBuilder = [];\n\n  /**\n   * @param {string} tag The element's tag.\n   * @param {?string=} key The key used to identify this element. This can be an\n   *     empty string, but performance may be better if a unique value is used\n   *     when iterating over an array of items.\n   * @param {?Array<*>=} statics An array of attribute name/value pairs of the\n   *     static attributes for the Element. These will only be set once when the\n   *     Element is created.\n   * @param {...*} var_args, Attribute name/value pairs of the dynamic attributes\n   *     for the Element.\n   * @return {!Element} The corresponding Element.\n   */\n  var elementOpen = function (tag, key, statics, var_args) {\n    if ('production' !== 'production') {}\n\n    var node = coreElementOpen(tag, key);\n    var data = getData(node);\n\n    if (!data.staticsApplied) {\n      if (statics) {\n        for (var _i = 0; _i < statics.length; _i += 2) {\n          var name = /** @type {string} */statics[_i];\n          var value = statics[_i + 1];\n          updateAttribute(node, name, value);\n        }\n      }\n      // Down the road, we may want to keep track of the statics array to use it\n      // as an additional signal about whether a node matches or not. For now,\n      // just use a marker so that we do not reapply statics.\n      data.staticsApplied = true;\n    }\n\n    /*\n     * Checks to see if one or more attributes have changed for a given Element.\n     * When no attributes have changed, this is much faster than checking each\n     * individual argument. When attributes have changed, the overhead of this is\n     * minimal.\n     */\n    var attrsArr = data.attrsArr;\n    var newAttrs = data.newAttrs;\n    var isNew = !attrsArr.length;\n    var i = ATTRIBUTES_OFFSET;\n    var j = 0;\n\n    for (; i < arguments.length; i += 2, j += 2) {\n      var _attr = arguments[i];\n      if (isNew) {\n        attrsArr[j] = _attr;\n        newAttrs[_attr] = undefined;\n      } else if (attrsArr[j] !== _attr) {\n        break;\n      }\n\n      var value = arguments[i + 1];\n      if (isNew || attrsArr[j + 1] !== value) {\n        attrsArr[j + 1] = value;\n        updateAttribute(node, _attr, value);\n      }\n    }\n\n    if (i < arguments.length || j < attrsArr.length) {\n      for (; i < arguments.length; i += 1, j += 1) {\n        attrsArr[j] = arguments[i];\n      }\n\n      if (j < attrsArr.length) {\n        attrsArr.length = j;\n      }\n\n      /*\n       * Actually perform the attribute update.\n       */\n      for (i = 0; i < attrsArr.length; i += 2) {\n        var name = /** @type {string} */attrsArr[i];\n        var value = attrsArr[i + 1];\n        newAttrs[name] = value;\n      }\n\n      for (var _attr2 in newAttrs) {\n        updateAttribute(node, _attr2, newAttrs[_attr2]);\n        newAttrs[_attr2] = undefined;\n      }\n    }\n\n    return node;\n  };\n\n  /**\n   * Declares a virtual Element at the current location in the document. This\n   * corresponds to an opening tag and a elementClose tag is required. This is\n   * like elementOpen, but the attributes are defined using the attr function\n   * rather than being passed as arguments. Must be folllowed by 0 or more calls\n   * to attr, then a call to elementOpenEnd.\n   * @param {string} tag The element's tag.\n   * @param {?string=} key The key used to identify this element. This can be an\n   *     empty string, but performance may be better if a unique value is used\n   *     when iterating over an array of items.\n   * @param {?Array<*>=} statics An array of attribute name/value pairs of the\n   *     static attributes for the Element. These will only be set once when the\n   *     Element is created.\n   */\n  var elementOpenStart = function (tag, key, statics) {\n    if ('production' !== 'production') {}\n\n    argsBuilder[0] = tag;\n    argsBuilder[1] = key;\n    argsBuilder[2] = statics;\n  };\n\n  /***\n   * Defines a virtual attribute at this point of the DOM. This is only valid\n   * when called between elementOpenStart and elementOpenEnd.\n   *\n   * @param {string} name\n   * @param {*} value\n   */\n  var attr = function (name, value) {\n    if ('production' !== 'production') {}\n\n    argsBuilder.push(name);\n    argsBuilder.push(value);\n  };\n\n  /**\n   * Closes an open tag started with elementOpenStart.\n   * @return {!Element} The corresponding Element.\n   */\n  var elementOpenEnd = function () {\n    if ('production' !== 'production') {}\n\n    var node = elementOpen.apply(null, argsBuilder);\n    argsBuilder.length = 0;\n    return node;\n  };\n\n  /**\n   * Closes an open virtual Element.\n   *\n   * @param {string} tag The element's tag.\n   * @return {!Element} The corresponding Element.\n   */\n  var elementClose = function (tag) {\n    if ('production' !== 'production') {}\n\n    var node = coreElementClose();\n\n    if ('production' !== 'production') {}\n\n    return node;\n  };\n\n  /**\n   * Declares a virtual Element at the current location in the document that has\n   * no children.\n   * @param {string} tag The element's tag.\n   * @param {?string=} key The key used to identify this element. This can be an\n   *     empty string, but performance may be better if a unique value is used\n   *     when iterating over an array of items.\n   * @param {?Array<*>=} statics An array of attribute name/value pairs of the\n   *     static attributes for the Element. These will only be set once when the\n   *     Element is created.\n   * @param {...*} var_args Attribute name/value pairs of the dynamic attributes\n   *     for the Element.\n   * @return {!Element} The corresponding Element.\n   */\n  var elementVoid = function (tag, key, statics, var_args) {\n    elementOpen.apply(null, arguments);\n    return elementClose(tag);\n  };\n\n  /**\n   * Declares a virtual Text at this point in the document.\n   *\n   * @param {string|number|boolean} value The value of the Text.\n   * @param {...(function((string|number|boolean)):string)} var_args\n   *     Functions to format the value which are called only when the value has\n   *     changed.\n   * @return {!Text} The corresponding text node.\n   */\n  var text = function (value, var_args) {\n    if ('production' !== 'production') {}\n\n    var node = coreText();\n    var data = getData(node);\n\n    if (data.text !== value) {\n      data.text = /** @type {string} */value;\n\n      var formatted = value;\n      for (var i = 1; i < arguments.length; i += 1) {\n        /*\n         * Call the formatter function directly to prevent leaking arguments.\n         * https://github.com/google/incremental-dom/pull/204#issuecomment-178223574\n         */\n        var fn = arguments[i];\n        formatted = fn(formatted);\n      }\n\n      node.data = formatted;\n    }\n\n    return node;\n  };\n\n  exports.patch = patchInner;\n  exports.patchInner = patchInner;\n  exports.patchOuter = patchOuter;\n  exports.currentElement = currentElement;\n  exports.currentPointer = currentPointer;\n  exports.skip = skip;\n  exports.skipNode = skipNode;\n  exports.elementVoid = elementVoid;\n  exports.elementOpenStart = elementOpenStart;\n  exports.elementOpenEnd = elementOpenEnd;\n  exports.elementOpen = elementOpen;\n  exports.elementClose = elementClose;\n  exports.text = text;\n  exports.attr = attr;\n  exports.symbols = symbols;\n  exports.attributes = attributes;\n  exports.applyAttr = applyAttr;\n  exports.applyProp = applyProp;\n  exports.notifications = notifications;\n  exports.importNode = importNode;\n\n}));\n\n/* jshint ignore:end */\n","'use strict';\n\n/**\n * A collection of core utility functions.\n * @const\n */\n\nlet compatibilityModeData_;\n\n/**\n * Counter for unique id.\n * @type {Number}\n * @private\n */\nlet uniqueIdCounter_ = 1;\n\n/**\n * Unique id property prefix.\n * @type {String}\n * @protected\n */\nexport const UID_PROPERTY = 'core_' + ((Math.random() * 1e9) >>> 0);\n\n/**\n * When defining a class Foo with an abstract method bar(), you can do:\n * Foo.prototype.bar = abstractMethod\n *\n * Now if a subclass of Foo fails to override bar(), an error will be thrown\n * when bar() is invoked.\n *\n * @type {!Function}\n * @throws {Error} when invoked to indicate the method should be overridden.\n */\nexport function abstractMethod() {\n\tthrow Error('Unimplemented abstract method');\n}\n\n/**\n * Loops constructor super classes collecting its properties values. If\n * property is not available on the super class `undefined` will be\n * collected as value for the class hierarchy position.\n * @param {!function()} constructor Class constructor.\n * @param {string} propertyName Property name to be collected.\n * @return {Array.<*>} Array of collected values.\n * TODO(*): Rethink superclass loop.\n */\nexport function collectSuperClassesProperty(constructor, propertyName) {\n\tvar propertyValues = [constructor[propertyName]];\n\twhile (constructor.__proto__ && !constructor.__proto__.isPrototypeOf(Function)) {\n\t\tconstructor = constructor.__proto__;\n\t\tpropertyValues.push(constructor[propertyName]);\n\t}\n\treturn propertyValues;\n}\n\n/**\n * Disables Metal.js's compatibility mode.\n */\nexport function disableCompatibilityMode() {\n\tcompatibilityModeData_ = null;\n}\n\n/**\n * Enables Metal.js's compatibility mode with the following features from rc\n * and 1.x versions:\n *     - Using \"key\" to reference component instances. In the current version\n *       this should be done via \"ref\" instead. This allows old code still\n *       using \"key\" to keep working like before. NOTE: this may cause\n *       problems, since \"key\" is meant to be used differently. Only use this\n *       if it's not possible to upgrade the code to use \"ref\" instead.\n * @param {Object=} opt_data Optional object with data to specify more\n *     details, such as:\n *         - renderers {Array} the template renderers that should be in\n *           compatibility mode, either their constructors or strings\n *           representing them (e.g. 'soy' or 'jsx'). By default, all the ones\n *           that extend from IncrementalDomRenderer.\n * @type {Object}\n */\nexport function enableCompatibilityMode(opt_data = {}) {\n\tcompatibilityModeData_ = opt_data;\n}\n\n/**\n * Returns the data used for compatibility mode, or nothing if it hasn't been\n * enabled.\n * @return {Object}\n */\nexport function getCompatibilityModeData() {\n\t// Compatibility mode can be set via the __METAL_COMPATIBILITY__ global var.\n\tif (!compatibilityModeData_) {\n\t\tif (typeof window !== 'undefined' && window.__METAL_COMPATIBILITY__) {\n\t\t\tenableCompatibilityMode(window.__METAL_COMPATIBILITY__);\n\t\t}\n\t}\n\treturn compatibilityModeData_;\n}\n\n/**\n * Gets the name of the given function. If the current browser doesn't\n * support the `name` property, this will calculate it from the function's\n * content string.\n * @param {!function()} fn\n * @return {string}\n */\nexport function getFunctionName(fn) {\n\tif (!fn.name) {\n\t\tvar str = fn.toString();\n\t\tfn.name = str.substring(9, str.indexOf('('));\n\t}\n\treturn fn.name;\n}\n\n/**\n * Gets an unique id. If `opt_object` argument is passed, the object is\n * mutated with an unique id. Consecutive calls with the same object\n * reference won't mutate the object again, instead the current object uid\n * returns. See {@link UID_PROPERTY}.\n * @param {Object=} opt_object Optional object to be mutated with the uid. If\n *     not specified this method only returns the uid.\n * @param {boolean=} opt_noInheritance Optional flag indicating if this\n *     object's uid property can be inherited from parents or not.\n * @throws {Error} when invoked to indicate the method should be overridden.\n */\nexport function getUid(opt_object, opt_noInheritance) {\n\tif (opt_object) {\n\t\tvar id = opt_object[UID_PROPERTY];\n\t\tif (opt_noInheritance && !opt_object.hasOwnProperty(UID_PROPERTY)) {\n\t\t\tid = null;\n\t\t}\n\t\treturn id || (opt_object[UID_PROPERTY] = uniqueIdCounter_++);\n\t}\n\treturn uniqueIdCounter_++;\n}\n\n/**\n * The identity function. Returns its first argument.\n * @param {*=} opt_returnValue The single value that will be returned.\n * @return {?} The first argument.\n */\nexport function identityFunction(opt_returnValue) {\n\treturn opt_returnValue;\n}\n\n/**\n * Returns true if the specified value is a boolean.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is boolean.\n */\nexport function isBoolean(val) {\n\treturn typeof val === 'boolean';\n}\n\n/**\n * Returns true if the specified value is not undefined.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is defined.\n */\nexport function isDef(val) {\n\treturn val !== undefined;\n}\n\n/**\n * Returns true if value is not undefined or null.\n * @param {*} val\n * @return {boolean}\n */\nexport function isDefAndNotNull(val) {\n\treturn isDef(val) && !isNull(val);\n}\n\n/**\n * Returns true if value is a document.\n * @param {*} val\n * @return {boolean}\n */\nexport function isDocument(val) {\n\treturn val && typeof val === 'object' && val.nodeType === 9;\n}\n\n/**\n * Returns true if value is a dom element.\n * @param {*} val\n * @return {boolean}\n */\nexport function isElement(val) {\n\treturn val && typeof val === 'object' && val.nodeType === 1;\n}\n\n/**\n * Returns true if the specified value is a function.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is a function.\n */\nexport function isFunction(val) {\n\treturn typeof val === 'function';\n}\n\n/**\n * Returns true if value is null.\n * @param {*} val\n * @return {boolean}\n */\nexport function isNull(val) {\n\treturn val === null;\n}\n\n/**\n * Returns true if the specified value is a number.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is a number.\n */\nexport function isNumber(val) {\n\treturn typeof val === 'number';\n}\n\n/**\n * Returns true if value is a window.\n * @param {*} val\n * @return {boolean}\n */\nexport function isWindow(val) {\n\treturn val !== null && val === val.window;\n}\n\n/**\n * Returns true if the specified value is an object. This includes arrays\n * and functions.\n * @param {?} val Variable to test.\n * @return {boolean} Whether variable is an object.\n */\nexport function isObject(val) {\n\tvar type = typeof val;\n\treturn type === 'object' && val !== null || type === 'function';\n}\n\n/**\n * Returns true if value is a Promise.\n * @param {*} val\n * @return {boolean}\n */\nexport function isPromise(val) {\n\treturn val && typeof val === 'object' && typeof val.then === 'function';\n}\n\n/**\n * Returns true if value is a string.\n * @param {*} val\n * @return {boolean}\n */\nexport function isString(val) {\n\treturn typeof val === 'string' || val instanceof String;\n}\n\n/**\n * Merges the values of a export function property a class with the values of that\n * property for all its super classes, and stores it as a new static\n * property of that class. If the export function property already existed, it won't\n * be recalculated.\n * @param {!function()} constructor Class constructor.\n * @param {string} propertyName Property name to be collected.\n * @param {function(*, *):*=} opt_mergeFn Function that receives an array filled\n *   with the values of the property for the current class and all its super classes.\n *   Should return the merged value to be stored on the current class.\n * @return {boolean} Returns true if merge happens, false otherwise.\n */\nexport function mergeSuperClassesProperty(constructor, propertyName, opt_mergeFn) {\n\tvar mergedName = propertyName + '_MERGED';\n\tif (constructor.hasOwnProperty(mergedName)) {\n\t\treturn false;\n\t}\n\n\tvar merged = collectSuperClassesProperty(constructor, propertyName);\n\tif (opt_mergeFn) {\n\t\tmerged = opt_mergeFn(merged);\n\t}\n\tconstructor[mergedName] = merged;\n\treturn true;\n}\n\n/**\n * Null function used for default values of callbacks, etc.\n * @return {void} Nothing.\n */\nexport function nullFunction() {}\n","'use strict';\n\n// This file exists just for backwards compatibility, making sure that old\n// default imports for this file still work. It's best to use the named exports\n// for each function instead though, since that allows bundlers like Rollup to\n// reduce the bundle size by removing unused code.\nimport * as core from './coreNamed';\n\nexport default core;\nexport { core };\nexport * from './coreNamed';\n","'use strict';\n\nimport { isDef } from '../core';\n\nclass array {\n\t/**\n\t * Checks if the given arrays have the same content.\n\t * @param {!Array<*>} arr1\n\t * @param {!Array<*>} arr2\n\t * @return {boolean}\n\t */\n\tstatic equal(arr1, arr2) {\n\t\tif (arr1.length !== arr2.length) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (var i = 0; i < arr1.length; i++) {\n\t\t\tif (arr1[i] !== arr2[i]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns the first value in the given array that isn't undefined.\n\t * @param {!Array} arr\n\t * @return {*}\n\t */\n\tstatic firstDefinedValue(arr) {\n\t\tfor (var i = 0; i < arr.length; i++) {\n\t\t\tif (arr[i] !== undefined) {\n\t\t\t\treturn arr[i];\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Transforms the input nested array to become flat.\n\t * @param {Array.<*|Array.<*>>} arr Nested array to flatten.\n\t * @param {Array.<*>} opt_output Optional output array.\n\t * @return {Array.<*>} Flat array.\n\t */\n\tstatic flatten(arr, opt_output) {\n\t\tvar output = opt_output || [];\n\t\tfor (var i = 0; i < arr.length; i++) {\n\t\t\tif (Array.isArray(arr[i])) {\n\t\t\t\tarray.flatten(arr[i], output);\n\t\t\t} else {\n\t\t\t\toutput.push(arr[i]);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Removes the first occurrence of a particular value from an array.\n\t * @param {Array.<T>} arr Array from which to remove value.\n\t * @param {T} obj Object to remove.\n\t * @return {boolean} True if an element was removed.\n\t * @template T\n\t */\n\tstatic remove(arr, obj) {\n\t\tvar i = arr.indexOf(obj);\n\t\tvar rv;\n\t\tif ( (rv = i >= 0) ) {\n\t\t\tarray.removeAt(arr, i);\n\t\t}\n\t\treturn rv;\n\t}\n\n\t/**\n\t * Removes from an array the element at index i\n\t * @param {Array} arr Array or array like object from which to remove value.\n\t * @param {number} i The index to remove.\n\t * @return {boolean} True if an element was removed.\n\t */\n\tstatic removeAt(arr, i) {\n\t\treturn Array.prototype.splice.call(arr, i, 1).length === 1;\n\t}\n\n\t/**\n\t * Slices the given array, just like Array.prototype.slice, but this\n\t * is faster and working on all array-like objects (like arguments).\n\t * @param {!Object} arr Array-like object to slice.\n\t * @param {number} start The index that should start the slice.\n\t * @param {number=} opt_end The index where the slice should end, not\n\t *   included in the final array. If not given, all elements after the\n\t *   start index will be included.\n\t * @return {!Array}\n\t */\n\tstatic slice(arr, start, opt_end) {\n\t\tvar sliced = [];\n\t\tvar end = isDef(opt_end) ? opt_end : arr.length;\n\t\tfor (var i = start; i < end; i++) {\n\t\t\tsliced.push(arr[i]);\n\t\t}\n\t\treturn sliced;\n\t}\n}\n\nexport default array;\n","/*!\n * Polyfill from Google's Closure Library.\n * Copyright 2013 The Closure Library Authors. All Rights Reserved.\n */\n\n'use strict';\n\nvar async = {};\n\n\n/**\n * Throw an item without interrupting the current execution context.  For\n * example, if processing a group of items in a loop, sometimes it is useful\n * to report an error while still allowing the rest of the batch to be\n * processed.\n * @param {*} exception\n */\nasync.throwException = function(exception) {\n\t// Each throw needs to be in its own context.\n\tasync.nextTick(function() {\n\t\tthrow exception;\n\t});\n};\n\n\n/**\n * Fires the provided callback just before the current callstack unwinds, or as\n * soon as possible after the current JS execution context.\n * @param {function(this:THIS)} callback\n * @param {THIS=} opt_context Object to use as the \"this value\" when calling\n *     the provided function.\n * @template THIS\n */\nasync.run = function(callback, opt_context) {\n\tif (!async.run.workQueueScheduled_) {\n\t\t// Nothing is currently scheduled, schedule it now.\n\t\tasync.nextTick(async.run.processWorkQueue);\n\t\tasync.run.workQueueScheduled_ = true;\n\t}\n\n\tasync.run.workQueue_.push(\n\t\tnew async.run.WorkItem_(callback, opt_context));\n};\n\n\n/** @private {boolean} */\nasync.run.workQueueScheduled_ = false;\n\n\n/** @private {!Array.<!async.run.WorkItem_>} */\nasync.run.workQueue_ = [];\n\n/**\n * Run any pending async.run work items. This function is not intended\n * for general use, but for use by entry point handlers to run items ahead of\n * async.nextTick.\n */\nasync.run.processWorkQueue = function() {\n\t// NOTE: additional work queue items may be pushed while processing.\n\twhile (async.run.workQueue_.length) {\n\t\t// Don't let the work queue grow indefinitely.\n\t\tvar workItems = async.run.workQueue_;\n\t\tasync.run.workQueue_ = [];\n\t\tfor (var i = 0; i < workItems.length; i++) {\n\t\t\tvar workItem = workItems[i];\n\t\t\ttry {\n\t\t\t\tworkItem.fn.call(workItem.scope);\n\t\t\t} catch (e) {\n\t\t\t\tasync.throwException(e);\n\t\t\t}\n\t\t}\n\t}\n\n\t// There are no more work items, reset the work queue.\n\tasync.run.workQueueScheduled_ = false;\n};\n\n\n/**\n * @constructor\n * @final\n * @struct\n * @private\n *\n * @param {function()} fn\n * @param {Object|null|undefined} scope\n */\nasync.run.WorkItem_ = function(fn, scope) {\n\t/** @const */\n\tthis.fn = fn;\n\t/** @const */\n\tthis.scope = scope;\n};\n\n\n/**\n * Fires the provided callbacks as soon as possible after the current JS\n * execution context. setTimeout(…, 0) always takes at least 5ms for legacy\n * reasons.\n * @param {function(this:SCOPE)} callback Callback function to fire as soon as\n *     possible.\n * @param {SCOPE=} opt_context Object in whose scope to call the listener.\n * @template SCOPE\n */\nasync.nextTick = function(callback, opt_context) {\n\tvar cb = callback;\n\tif (opt_context) {\n\t\tcb = callback.bind(opt_context);\n\t}\n\tcb = async.nextTick.wrapCallback_(cb);\n\t// Introduced and currently only supported by IE10.\n\t// Verify if variable is defined on the current runtime (i.e., node, browser).\n\t// Can't use typeof enclosed in a function (such as core.isFunction) or an\n\t// exception will be thrown when the function is called on an environment\n\t// where the variable is undefined.\n\tif (typeof setImmediate === 'function') {\n\t\tsetImmediate(cb);\n\t\treturn;\n\t}\n\t// Look for and cache the custom fallback version of setImmediate.\n\tif (!async.nextTick.setImmediate_) {\n\t\tasync.nextTick.setImmediate_ = async.nextTick.getSetImmediateEmulator_();\n\t}\n\tasync.nextTick.setImmediate_(cb);\n};\n\n\n/**\n * Cache for the setImmediate implementation.\n * @type {function(function())}\n * @private\n */\nasync.nextTick.setImmediate_ = null;\n\n\n/**\n * Determines the best possible implementation to run a function as soon as\n * the JS event loop is idle.\n * @return {function(function())} The \"setImmediate\" implementation.\n * @private\n */\nasync.nextTick.getSetImmediateEmulator_ = function() {\n\t// Create a private message channel and use it to postMessage empty messages\n\t// to ourselves.\n\tvar Channel;\n\n\t// Verify if variable is defined on the current runtime (i.e., node, browser).\n\t// Can't use typeof enclosed in a function (such as core.isFunction) or an\n\t// exception will be thrown when the function is called on an environment\n\t// where the variable is undefined.\n\tif (typeof MessageChannel === 'function') {\n\t\tChannel = MessageChannel;\n\t}\n\n\t// If MessageChannel is not available and we are in a browser, implement\n\t// an iframe based polyfill in browsers that have postMessage and\n\t// document.addEventListener. The latter excludes IE8 because it has a\n\t// synchronous postMessage implementation.\n\tif (typeof Channel === 'undefined' && typeof window !== 'undefined' &&\n\t\twindow.postMessage && window.addEventListener) {\n\t\t/** @constructor */\n\t\tChannel = function() {\n\t\t\t// Make an empty, invisible iframe.\n\t\t\tvar iframe = document.createElement('iframe');\n\t\t\tiframe.style.display = 'none';\n\t\t\tiframe.src = '';\n\t\t\tdocument.documentElement.appendChild(iframe);\n\t\t\tvar win = iframe.contentWindow;\n\t\t\tvar doc = win.document;\n\t\t\tdoc.open();\n\t\t\tdoc.write('');\n\t\t\tdoc.close();\n\t\t\tvar message = 'callImmediate' + Math.random();\n\t\t\tvar origin = win.location.protocol + '//' + win.location.host;\n\t\t\tvar onmessage = function(e) {\n\t\t\t\t// Validate origin and message to make sure that this message was\n\t\t\t\t// intended for us.\n\t\t\t\tif (e.origin !== origin && e.data !== message) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.port1.onmessage();\n\t\t\t}.bind(this);\n\t\t\twin.addEventListener('message', onmessage, false);\n\t\t\tthis.port1 = {};\n\t\t\tthis.port2 = {\n\t\t\t\tpostMessage: function() {\n\t\t\t\t\twin.postMessage(message, origin);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t}\n\tif (typeof Channel !== 'undefined') {\n\t\tvar channel = new Channel();\n\t\t// Use a fifo linked list to call callbacks in the right order.\n\t\tvar head = {};\n\t\tvar tail = head;\n\t\tchannel.port1.onmessage = function() {\n\t\t\thead = head.next;\n\t\t\tvar cb = head.cb;\n\t\t\thead.cb = null;\n\t\t\tcb();\n\t\t};\n\t\treturn function(cb) {\n\t\t\ttail.next = {\n\t\t\t\tcb: cb\n\t\t\t};\n\t\t\ttail = tail.next;\n\t\t\tchannel.port2.postMessage(0);\n\t\t};\n\t}\n\t// Implementation for IE6-8: Script elements fire an asynchronous\n\t// onreadystatechange event when inserted into the DOM.\n\tif (typeof document !== 'undefined' && 'onreadystatechange' in\n\t\tdocument.createElement('script')) {\n\t\treturn function(cb) {\n\t\t\tvar script = document.createElement('script');\n\t\t\tscript.onreadystatechange = function() {\n\t\t\t\t// Clean up and call the callback.\n\t\t\t\tscript.onreadystatechange = null;\n\t\t\t\tscript.parentNode.removeChild(script);\n\t\t\t\tscript = null;\n\t\t\t\tcb();\n\t\t\t\tcb = null;\n\t\t\t};\n\t\t\tdocument.documentElement.appendChild(script);\n\t\t};\n\t}\n\t// Fall back to setTimeout with 0. In browsers this creates a delay of 5ms\n\t// or more.\n\treturn function(cb) {\n\t\tsetTimeout(cb, 0);\n\t};\n};\n\n\n/**\n * Helper function that is overrided to protect callbacks with entry point\n * monitor if the application monitors entry points.\n * @param {function()} callback Callback function to fire as soon as possible.\n * @return {function()} The wrapped callback.\n * @private\n */\nasync.nextTick.wrapCallback_ = function(opt_returnValue) {\n\treturn opt_returnValue;\n};\n\nexport default async;\n","'use strict';\n\n/**\n * Disposable utility. When inherited provides the `dispose` function to its\n * subclass, which is responsible for disposing of any object references\n * when an instance won't be used anymore. Subclasses should override\n * `disposeInternal` to implement any specific disposing logic.\n * @constructor\n */\nclass Disposable {\n\tconstructor() {\n\t\t/**\n\t\t * Flag indicating if this instance has already been disposed.\n\t\t * @type {boolean}\n\t\t * @protected\n\t\t */\n\t\tthis.disposed_ = false;\n\t}\n\n\t/**\n\t * Disposes of this instance's object references. Calls `disposeInternal`.\n\t */\n\tdispose() {\n\t\tif (!this.disposed_) {\n\t\t\tthis.disposeInternal();\n\t\t\tthis.disposed_ = true;\n\t\t}\n\t}\n\n\t/**\n\t * Subclasses should override this method to implement any specific\n\t * disposing logic (like clearing references and calling `dispose` on other\n\t * disposables).\n\t */\n\tdisposeInternal() {}\n\n\t/**\n\t * Checks if this instance has already been disposed.\n\t * @return {boolean}\n\t */\n\tisDisposed() {\n\t\treturn this.disposed_;\n\t}\n}\n\nexport default Disposable;\n","'use strict';\n\nclass object {\n\t/**\n\t * Copies all the members of a source object to a target object.\n\t * @param {Object} target Target object.\n\t * @param {...Object} var_args The objects from which values will be copied.\n\t * @return {Object} Returns the target object reference.\n\t */\n\tstatic mixin(target) {\n\t\tvar key, source;\n\t\tfor (var i = 1; i < arguments.length; i++) {\n\t\t\tsource = arguments[i];\n\t\t\tfor (key in source) {\n\t\t\t\ttarget[key] = source[key];\n\t\t\t}\n\t\t}\n\t\treturn target;\n\t}\n\n\t/**\n\t * Returns an object based on its fully qualified external name.\n\t * @param {string} name The fully qualified name.\n\t * @param {object=} opt_obj The object within which to look; default is\n\t *     <code>window</code>.\n\t * @return {?} The value (object or primitive) or, if not found, undefined.\n\t */\n\tstatic getObjectByName(name, opt_obj) {\n\t\tvar scope = opt_obj || window;\n\t\tvar parts = name.split('.');\n\t\treturn parts.reduce((part, key) => part[key], scope);\n\t}\n\n\t/**\n\t * Returns a new object with the same keys as the given one, but with\n\t * their values set to the return values of the specified function.\n\t * @param {!Object} obj\n\t * @param {!function(string, *)} fn\n\t * @return {!Object}\n\t */\n\tstatic map(obj, fn) {\n\t\tvar mappedObj = {};\n\t\tvar keys = Object.keys(obj);\n\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\tmappedObj[keys[i]] = fn(keys[i], obj[keys[i]]);\n\t\t}\n\t\treturn mappedObj;\n\t}\n\n\t/**\n\t * Checks if the two given objects are equal. This is done via a shallow\n\t * check, including only the keys directly contained by the 2 objects.\n\t * @return {boolean}\n\t */\n\tstatic shallowEqual(obj1, obj2) {\n\t\tif (obj1 === obj2) {\n\t\t\treturn true;\n\t\t}\n\n\t\tvar keys1 = Object.keys(obj1);\n\t\tvar keys2 = Object.keys(obj2);\n\t\tif (keys1.length !== keys2.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (var i = 0; i < keys1.length; i++) {\n\t\t\tif (obj1[keys1[i]] !== obj2[keys1[i]]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n}\n\nexport default object;\n","'use strict';\n\nclass string {\n\t/**\n\t * Removes the breaking spaces from the left and right of the string and\n\t * collapses the sequences of breaking spaces in the middle into single spaces.\n\t * The original and the result strings render the same way in HTML.\n\t * @param {string} str A string in which to collapse spaces.\n\t * @return {string} Copy of the string with normalized breaking spaces.\n\t */\n\tstatic collapseBreakingSpaces(str) {\n\t\treturn str.replace(/[\\t\\r\\n ]+/g, ' ').replace(/^[\\t\\r\\n ]+|[\\t\\r\\n ]+$/g, '');\n\t}\n\n\t/**\n\t* Escapes characters in the string that are not safe to use in a RegExp.\n\t* @param {*} str The string to escape. If not a string, it will be casted\n\t*     to one.\n\t* @return {string} A RegExp safe, escaped copy of {@code s}.\n\t*/\n\tstatic escapeRegex(str) {\n\t\treturn String(str)\n\t\t\t.replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g, '\\\\$1')\n\t\t\t.replace(/\\x08/g, '\\\\x08');\n\t}\n\n\t/**\n\t* Returns a string with at least 64-bits of randomness.\n\t* @return {string} A random string, e.g. sn1s7vb4gcic.\n\t*/\n\tstatic getRandomString() {\n\t\tvar x = 2147483648;\n\t\treturn Math.floor(Math.random() * x).toString(36) +\n\t\t\tMath.abs(Math.floor(Math.random() * x) ^ Date.now()).toString(36);\n\t}\n\n\t/**\n\t * Calculates the hashcode for a string. The hashcode value is computed by\n\t * the sum algorithm: s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]. A nice\n\t * property of using 31 prime is that the multiplication can be replaced by\n\t * a shift and a subtraction for better performance: 31*i == (i<<5)-i.\n\t * Modern VMs do this sort of optimization automatically.\n\t * @param {String} val Target string.\n\t * @return {Number} Returns the string hashcode.\n\t */\n\tstatic hashCode(val) {\n\t\tvar hash = 0;\n\t\tfor (var i = 0, len = val.length; i < len; i++) {\n\t\t\thash = 31 * hash + val.charCodeAt(i);\n\t\t\thash %= 0x100000000;\n\t\t}\n\t\treturn hash;\n\t}\n\n\t/**\n\t * Replaces interval into the string with specified value, e.g.\n\t * `replaceInterval(\"abcde\", 1, 4, \"\")` returns \"ae\".\n\t * @param {string} str The input string.\n\t * @param {Number} start Start interval position to be replaced.\n\t * @param {Number} end End interval position to be replaced.\n\t * @param {string} value The value that replaces the specified interval.\n\t * @return {string}\n\t */\n\tstatic replaceInterval(str, start, end, value) {\n\t\treturn str.substring(0, start) + value + str.substring(end);\n\t}\n}\n\nexport default string;\n","'use strict';\n\nimport core from './core';\nimport array from './array/array';\nimport async from './async/async';\nimport Disposable from './disposable/Disposable';\nimport object from './object/object';\nimport string from './string/string';\n\nexport * from './core';\nexport { array, async, Disposable, object, string };\nexport default core;\n","'use strict';\n\nconst METAL_DATA = '__metal_data__';\n\nclass domData {\n\t/**\n\t * Gets Metal.js's data for the given element.\n\t * @param {!Element} element\n\t * @return {!Object}\n\t */\n\tstatic get(element) {\n\t\tif (!element[METAL_DATA]) {\n\t\t\telement[METAL_DATA] = {\n\t\t\t\tdelegating: {},\n\t\t\t\tlisteners: {}\n\t\t\t};\n\t\t}\n\t\treturn element[METAL_DATA];\n\t}\n}\n\nexport default domData;\n","'use strict';\n\nimport { Disposable } from 'metal';\n\n/**\n * EventHandle utility. Holds information about an event subscription, and\n * allows removing them easily.\n * EventHandle is a Disposable, but it's important to note that the\n * EventEmitter that created it is not the one responsible for disposing it.\n * That responsibility is for the code that holds a reference to it.\n * @param {!EventEmitter} emitter Emitter the event was subscribed to.\n * @param {string} event The name of the event that was subscribed to.\n * @param {!Function} listener The listener subscribed to the event.\n * @constructor\n * @extends {Disposable}\n */\nclass EventHandle extends Disposable {\n\tconstructor(emitter, event, listener) {\n\t\tsuper();\n\n\t\t/**\n\t\t * The EventEmitter instance that the event was subscribed to.\n\t\t * @type {EventEmitter}\n\t\t * @protected\n\t\t */\n\t\tthis.emitter_ = emitter;\n\n\t\t/**\n\t\t * The name of the event that was subscribed to.\n\t\t * @type {string}\n\t\t * @protected\n\t\t */\n\t\tthis.event_ = event;\n\n\t\t/**\n\t\t * The listener subscribed to the event.\n\t\t * @type {Function}\n\t\t * @protected\n\t\t */\n\t\tthis.listener_ = listener;\n\t}\n\n\t/**\n\t * Disposes of this instance's object references.\n\t * @override\n\t */\n\tdisposeInternal() {\n\t\tthis.removeListener();\n\t\tthis.emitter_ = null;\n\t\tthis.listener_ = null;\n\t}\n\n\t/**\n\t * Removes the listener subscription from the emitter.\n\t */\n\tremoveListener() {\n\t\tif (!this.emitter_.isDisposed()) {\n\t\t\tthis.emitter_.removeListener(this.event_, this.listener_);\n\t\t}\n\t}\n}\n\nexport default EventHandle;\n","'use strict';\n\nimport { array, Disposable, isFunction, isString } from 'metal';\nimport EventHandle from './EventHandle';\n\n/**\n * EventEmitter utility.\n * @constructor\n * @extends {Disposable}\n */\nclass EventEmitter extends Disposable {\n\tconstructor() {\n\t\tsuper();\n\n\t\t/**\n\t\t * Holds event listeners scoped by event type.\n\t\t * @type {!Object<string, !Array<!function()>>}\n\t\t * @protected\n\t\t */\n\t\tthis.events_ = [];\n\n\t\t/**\n\t\t * The maximum number of listeners allowed for each event type. If the number\n\t\t * becomes higher than the max, a warning will be issued.\n\t\t * @type {number}\n\t\t * @protected\n\t\t */\n\t\tthis.maxListeners_ = 10;\n\n\t\t/**\n\t\t * Configuration option which determines if an event facade should be sent\n\t\t * as a param of listeners when emitting events. If set to true, the facade\n\t\t * will be passed as the first argument of the listener.\n\t\t * @type {boolean}\n\t\t * @protected\n\t\t */\n\t\tthis.shouldUseFacade_ = false;\n\t}\n\n\t/**\n\t * Adds a listener to the end of the listeners array for the specified events.\n\t * @param {!(Array|string)} events\n\t * @param {!Function} listener\n\t * @param {boolean} opt_default Flag indicating if this listener is a default\n\t *   action for this event. Default actions are run last, and only if no previous\n\t *   listener call `preventDefault()` on the received event facade.\n\t * @return {!EventHandle} Can be used to remove the listener.\n\t */\n\taddListener(events, listener, opt_default) {\n\t\tthis.validateListener_(listener);\n\n\t\tevents = this.normalizeEvents_(events);\n\t\tfor (var i = 0; i < events.length; i++) {\n\t\t\tthis.addSingleListener_(events[i], listener, opt_default);\n\t\t}\n\n\t\treturn new EventHandle(this, events, listener);\n\t}\n\n\t/**\n\t * Adds a listener to the end of the listeners array for a single event.\n\t * @param {string} event\n\t * @param {!Function} listener\n\t * @param {boolean} opt_default Flag indicating if this listener is a default\n\t *   action for this event. Default actions are run last, and only if no previous\n\t *   listener call `preventDefault()` on the received event facade.\n\t * @return {!EventHandle} Can be used to remove the listener.\n\t * @param {Function=} opt_origin The original function that was added as a\n\t *   listener, if there is any.\n\t * @protected\n\t */\n\taddSingleListener_(event, listener, opt_default, opt_origin) {\n\t\tthis.emit('newListener', event, listener);\n\n\t\tif (!this.events_[event]) {\n\t\t\tthis.events_[event] = [];\n\t\t}\n\t\tthis.events_[event].push({\n\t\t\tdefault: opt_default,\n\t\t\tfn: listener,\n\t\t\torigin: opt_origin\n\t\t});\n\n\t\tvar listeners = this.events_[event];\n\t\tif (listeners.length > this.maxListeners_ && !listeners.warned) {\n\t\t\tconsole.warn(\n\t\t\t\t'Possible EventEmitter memory leak detected. %d listeners added ' +\n\t\t\t\t'for event %s. Use emitter.setMaxListeners() to increase limit.',\n\t\t\t\tlisteners.length,\n\t\t\t\tevent\n\t\t\t);\n\t\t\tlisteners.warned = true;\n\t\t}\n\t}\n\n\t/**\n\t * Disposes of this instance's object references.\n\t * @override\n\t */\n\tdisposeInternal() {\n\t\tthis.events_ = [];\n\t}\n\n\t/**\n\t * Execute each of the listeners in order with the supplied arguments.\n\t * @param {string} event\n\t * @param {*} opt_args [arg1], [arg2], [...]\n\t * @return {boolean} Returns true if event had listeners, false otherwise.\n\t */\n\temit(event) {\n\t\tvar args = array.slice(arguments, 1);\n\t\tvar listeners = (this.events_[event] || []).concat();\n\n\t\tvar facade;\n\t\tif (this.getShouldUseFacade()) {\n\t\t\tfacade = {\n\t\t\t\tpreventDefault: function() {\n\t\t\t\t\tfacade.preventedDefault = true;\n\t\t\t\t},\n\t\t\t\ttarget: this,\n\t\t\t\ttype: event\n\t\t\t};\n\t\t\targs.push(facade);\n\t\t}\n\n\t\tvar defaultListeners = [];\n\t\tfor (var i = 0; i < listeners.length; i++) {\n\t\t\tif (listeners[i].default) {\n\t\t\t\tdefaultListeners.push(listeners[i]);\n\t\t\t} else {\n\t\t\t\tlisteners[i].fn.apply(this, args);\n\t\t\t}\n\t\t}\n\t\tif (!facade || !facade.preventedDefault) {\n\t\t\tfor (var j = 0; j < defaultListeners.length; j++) {\n\t\t\t\tdefaultListeners[j].fn.apply(this, args);\n\t\t\t}\n\t\t}\n\n\n\t\tif (event !== '*') {\n\t\t\tthis.emit.apply(this, ['*', event].concat(args));\n\t\t}\n\n\t\treturn listeners.length > 0;\n\t}\n\n\t/**\n\t * Gets the configuration option which determines if an event facade should\n\t * be sent as a param of listeners when emitting events. If set to true, the\n\t * facade will be passed as the first argument of the listener.\n\t * @return {boolean}\n\t */\n\tgetShouldUseFacade() {\n\t\treturn this.shouldUseFacade_;\n\t}\n\n\t/**\n\t * Returns an array of listeners for the specified event.\n\t * @param {string} event\n\t * @return {Array} Array of listeners.\n\t */\n\tlisteners(event) {\n\t\treturn (this.events_[event] || []).map(listener => listener.fn);\n\t}\n\n\t/**\n\t * Adds a listener that will be invoked a fixed number of times for the\n\t * events. After each event is triggered the specified amount of times, the\n\t * listener is removed for it.\n\t * @param {!(Array|string)} events\n\t * @param {number} amount The amount of times this event should be listened\n\t * to.\n\t * @param {!Function} listener\n\t * @return {!EventHandle} Can be used to remove the listener.\n\t */\n\tmany(events, amount, listener) {\n\t\tevents = this.normalizeEvents_(events);\n\t\tfor (var i = 0; i < events.length; i++) {\n\t\t\tthis.many_(events[i], amount, listener);\n\t\t}\n\n\t\treturn new EventHandle(this, events, listener);\n\t}\n\n\t/**\n\t * Adds a listener that will be invoked a fixed number of times for a single\n\t * event. After the event is triggered the specified amount of times, the\n\t * listener is removed.\n\t * @param {string} event\n\t * @param {number} amount The amount of times this event should be listened\n\t * to.\n\t * @param {!Function} listener\n\t * @protected\n\t */\n\tmany_(event, amount, listener) {\n\t\tvar self = this;\n\n\t\tif (amount <= 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction handlerInternal() {\n\t\t\tif (--amount === 0) {\n\t\t\t\tself.removeListener(event, handlerInternal);\n\t\t\t}\n\t\t\tlistener.apply(self, arguments);\n\t\t}\n\n\t\tself.addSingleListener_(event, handlerInternal, false, listener);\n\t}\n\n\t/**\n\t * Checks if a listener object matches the given listener function. To match,\n\t * it needs to either point to that listener or have it as its origin.\n\t * @param {!Object} listenerObj\n\t * @param {!Function} listener\n\t * @return {boolean}\n\t * @protected\n\t */\n\tmatchesListener_(listenerObj, listener) {\n\t\treturn listenerObj.fn === listener ||\n\t\t\t(listenerObj.origin && listenerObj.origin === listener);\n\t}\n\n\t/**\n\t * Converts the parameter to an array if only one event is given.\n\t * @param  {!(Array|string)} events\n\t * @return {!Array}\n\t * @protected\n\t */\n\tnormalizeEvents_(events) {\n\t\treturn isString(events) ? [events] : events;\n\t}\n\n\t/**\n\t * Removes a listener for the specified events.\n\t * Caution: changes array indices in the listener array behind the listener.\n\t * @param {!(Array|string)} events\n\t * @param {!Function} listener\n\t * @return {!Object} Returns emitter, so calls can be chained.\n\t */\n\toff(events, listener) {\n\t\tthis.validateListener_(listener);\n\n\t\tevents = this.normalizeEvents_(events);\n\t\tfor (var i = 0; i < events.length; i++) {\n\t\t\tvar listenerObjs = this.events_[events[i]] || [];\n\t\t\tthis.removeMatchingListenerObjs_(listenerObjs, listener);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Adds a listener to the end of the listeners array for the specified events.\n\t * @param {!(Array|string)} events\n\t * @param {!Function} listener\n\t * @return {!EventHandle} Can be used to remove the listener.\n\t */\n\ton() {\n\t\treturn this.addListener.apply(this, arguments);\n\t}\n\n\t/**\n\t * Adds a one time listener for the events. This listener is invoked only the\n\t * next time each event is fired, after which it is removed.\n\t * @param {!(Array|string)} events\n\t * @param {!Function} listener\n\t * @return {!EventHandle} Can be used to remove the listener.\n\t */\n\tonce(events, listener) {\n\t\treturn this.many(events, 1, listener);\n\t}\n\n\t/**\n\t * Removes all listeners, or those of the specified events. It's not a good\n\t * idea to remove listeners that were added elsewhere in the code,\n\t * especially when it's on an emitter that you didn't create.\n\t * @param {(Array|string)=} opt_events\n\t * @return {!Object} Returns emitter, so calls can be chained.\n\t */\n\tremoveAllListeners(opt_events) {\n\t\tif (opt_events) {\n\t\t\tvar events = this.normalizeEvents_(opt_events);\n\t\t\tfor (var i = 0; i < events.length; i++) {\n\t\t\t\tthis.events_[events[i]] = null;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.events_ = {};\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Removes all listener objects from the given array that match the given\n\t * listener function.\n\t * @param {!Array.<Object>} listenerObjs\n\t * @param {!Function} listener\n\t * @protected\n\t */\n\tremoveMatchingListenerObjs_(listenerObjs, listener) {\n\t\tfor (var i = listenerObjs.length - 1; i >= 0; i--) {\n\t\t\tif (this.matchesListener_(listenerObjs[i], listener)) {\n\t\t\t\tlistenerObjs.splice(i, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Removes a listener for the specified events.\n\t * Caution: changes array indices in the listener array behind the listener.\n\t * @param {!(Array|string)} events\n\t * @param {!Function} listener\n\t * @return {!Object} Returns emitter, so calls can be chained.\n\t */\n\tremoveListener() {\n\t\treturn this.off.apply(this, arguments);\n\t}\n\n\t/**\n\t * By default EventEmitters will print a warning if more than 10 listeners\n\t * are added for a particular event. This is a useful default which helps\n\t * finding memory leaks. Obviously not all Emitters should be limited to 10.\n\t * This function allows that to be increased. Set to zero for unlimited.\n\t * @param {number} max The maximum number of listeners.\n\t * @return {!Object} Returns emitter, so calls can be chained.\n\t */\n\tsetMaxListeners(max) {\n\t\tthis.maxListeners_ = max;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Sets the configuration option which determines if an event facade should\n\t * be sent as a param of listeners when emitting events. If set to true, the\n\t * facade will be passed as the first argument of the listener.\n\t * @param {boolean} shouldUseFacade\n\t * @return {!Object} Returns emitter, so calls can be chained.\n\t */\n\tsetShouldUseFacade(shouldUseFacade) {\n\t\tthis.shouldUseFacade_ = shouldUseFacade;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Checks if the given listener is valid, throwing an exception when it's not.\n\t * @param  {*} listener\n\t * @protected\n\t */\n\tvalidateListener_(listener) {\n\t\tif (!isFunction(listener)) {\n\t\t\tthrow new TypeError('Listener must be a function');\n\t\t}\n\t}\n}\n\nexport default EventEmitter;\n","'use strict';\n\nimport { array, object, Disposable } from 'metal';\n\n/**\n * EventEmitterProxy utility. It's responsible for linking two EventEmitter\n * instances together, emitting events from the first emitter through the\n * second one. That means that listening to a supported event on the target\n * emitter will mean listening to it on the origin emitter as well.\n * @param {EventEmitter} originEmitter Events originated on this emitter\n *   will be fired for the target emitter's listeners as well.\n * @param {EventEmitter} targetEmitter Event listeners attached to this emitter\n *   will also be triggered when the event is fired by the origin emitter.\n * @param {Object} opt_blacklist Optional blacklist of events that should not be\n *   proxied.\n * @constructor\n * @extends {Disposable}\n */\nclass EventEmitterProxy extends Disposable {\n\tconstructor(originEmitter, targetEmitter, opt_blacklist, opt_whitelist) {\n\t\tsuper();\n\n\t\t/**\n\t\t * Map of events that should not be proxied.\n\t\t * @type {Object}\n\t\t * @protected\n\t\t */\n\t\tthis.blacklist_ = object.mixin({\n\t\t\tnewListener: true\n\t\t}, opt_blacklist);\n\n\t\t/**\n\t\t * The origin emitter. This emitter's events will be proxied through the\n\t\t * target emitter.\n\t\t * @type {EventEmitter}\n\t\t * @protected\n\t\t */\n\t\tthis.originEmitter_ = originEmitter;\n\n\t\t/**\n\t\t * A list of events that are pending to be listened by an actual origin\n\t\t * emitter. Events are stored here when the origin doesn't exist, so they\n\t\t * can be set on a new origin when one is set.\n\t\t * @type {!Array}\n\t\t * @protected\n\t\t */\n\t\tthis.pendingEvents_ = [];\n\n\t\t/**\n\t\t * Holds a map of events from the origin emitter that are already being proxied.\n\t\t * @type {Object<string, !EventHandle>}\n\t\t * @protected\n\t\t */\n\t\tthis.proxiedEvents_ = {};\n\n\t\t/**\n\t\t * The target emitter. This emitter will emit all events that come from\n\t\t * the origin emitter.\n\t\t * @type {EventEmitter}\n\t\t * @protected\n\t\t */\n\t\tthis.targetEmitter_ = targetEmitter;\n\n\t\t/**\n\t\t * Map of events that should be proxied. If whitelist is set blacklist is ignored.\n\t\t * @type {Object}\n\t\t * @protected\n\t\t */\n\t\tthis.whitelist_ = opt_whitelist;\n\n\t\tthis.startProxy_();\n\t}\n\n\t/**\n\t * Adds the given listener for the given event.\n\t * @param {string} event\n\t * @param {!function()} listener\n\t * @return {!EventHandle} The listened event's handle.\n\t * @protected\n\t */\n\taddListener_(event, listener) {\n\t\treturn this.originEmitter_.on(event, listener);\n\t}\n\n\t/**\n\t * Adds the proxy listener for the given event.\n\t * @param {string} event\n\t * @return {!EventHandle} The listened event's handle.\n\t * @protected\n\t */\n\taddListenerForEvent_(event) {\n\t\treturn this.addListener_(event, this.emitOnTarget_.bind(this, event));\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdisposeInternal() {\n\t\tthis.removeListeners_();\n\t\tthis.proxiedEvents_ = null;\n\t\tthis.originEmitter_ = null;\n\t\tthis.targetEmitter_ = null;\n\t}\n\n\t/**\n\t * Emits the specified event type on the target emitter.\n\t * @param {string} eventType\n\t * @protected\n\t */\n\temitOnTarget_(eventType) {\n\t\tvar args = [eventType].concat(array.slice(arguments, 1));\n\t\tthis.targetEmitter_.emit.apply(this.targetEmitter_, args);\n\t}\n\n\t/**\n\t * Proxies the given event from the origin to the target emitter.\n\t * @param {string} event\n\t */\n\tproxyEvent(event) {\n\t\tif (this.shouldProxyEvent_(event)) {\n\t\t\tthis.tryToAddListener_(event);\n\t\t}\n\t}\n\n\t/**\n\t * Removes the proxy listener for all events.\n\t * @protected\n\t */\n\tremoveListeners_() {\n\t\tvar events = Object.keys(this.proxiedEvents_);\n\t\tfor (var i = 0; i < events.length; i++) {\n\t\t\tthis.proxiedEvents_[events[i]].removeListener();\n\t\t}\n\t\tthis.proxiedEvents_ = {};\n\t\tthis.pendingEvents_ = [];\n\t}\n\n\t/**\n\t * Changes the origin emitter. This automatically detaches any events that\n\t * were already being proxied from the previous emitter, and starts proxying\n\t * them on the new emitter instead.\n\t * @param {!EventEmitter} originEmitter\n\t */\n\tsetOriginEmitter(originEmitter) {\n\t\tvar events = this.originEmitter_ ?\n\t\t\tObject.keys(this.proxiedEvents_) :\n\t\t\tthis.pendingEvents_;\n\t\tthis.removeListeners_();\n\t\tthis.originEmitter_ = originEmitter;\n\t\tevents.forEach(event => this.proxyEvent(event));\n\t}\n\n\t/**\n\t * Checks if the given event should be proxied.\n\t * @param {string} event\n\t * @return {boolean}\n\t * @protected\n\t */\n\tshouldProxyEvent_(event) {\n\t\tif (this.whitelist_ && !this.whitelist_[event]) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this.blacklist_[event]) {\n\t\t\treturn false;\n\t\t}\n\t\treturn !this.proxiedEvents_[event];\n\t}\n\n\t/**\n\t * Starts proxying all events from the origin to the target emitter.\n\t * @protected\n\t */\n\tstartProxy_() {\n\t\tthis.targetEmitter_.on('newListener', this.proxyEvent.bind(this));\n\t}\n\n\t/**\n\t * Adds a listener to the origin emitter, if it exists. Otherwise, stores\n\t * the pending listener so it can be used on a future origin emitter.\n\t * @param {string} event\n\t * @protected\n\t */\n\ttryToAddListener_(event) {\n\t\tif (this.originEmitter_) {\n\t\t\tthis.proxiedEvents_[event] = this.addListenerForEvent_(event);\n\t\t} else {\n\t\t\tthis.pendingEvents_.push(event);\n\t\t}\n\t}\n}\n\nexport default EventEmitterProxy;\n","'use strict';\n\nimport { Disposable } from 'metal';\n\n/**\n * EventHandler utility. It's useful for easily removing a group of\n * listeners from different EventEmitter instances.\n * @constructor\n * @extends {Disposable}\n */\nclass EventHandler extends Disposable {\n\tconstructor() {\n\t\tsuper();\n\n\t\t/**\n\t\t * An array that holds the added event handles, so the listeners can be\n\t\t * removed later.\n\t\t * @type {Array.<EventHandle>}\n\t\t * @protected\n\t\t */\n\t\tthis.eventHandles_ = [];\n\t}\n\n\t/**\n\t * Adds event handles to be removed later through the `removeAllListeners`\n\t * method.\n\t * @param {...(!EventHandle)} var_args\n\t */\n\tadd() {\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tthis.eventHandles_.push(arguments[i]);\n\t\t}\n\t}\n\n\t/**\n\t * Disposes of this instance's object references.\n\t * @override\n\t */\n\tdisposeInternal() {\n\t\tthis.eventHandles_ = null;\n\t}\n\n\t/**\n\t * Removes all listeners that have been added through the `add` method.\n\t */\n\tremoveAllListeners() {\n\t\tfor (var i = 0; i < this.eventHandles_.length; i++) {\n\t\t\tthis.eventHandles_[i].removeListener();\n\t\t}\n\n\t\tthis.eventHandles_ = [];\n\t}\n}\n\nexport default EventHandler;\n","'use strict';\n\nimport { registerCustomEvent } from './dom';\nimport features from './features';\n\nvar mouseEventMap = {\n\tmouseenter: 'mouseover',\n\tmouseleave: 'mouseout',\n\tpointerenter: 'pointerover',\n\tpointerleave: 'pointerout'\n};\nObject.keys(mouseEventMap).forEach(function(eventName) {\n\tregisterCustomEvent(eventName, {\n\t\tdelegate: true,\n\t\thandler: function(callback, event) {\n\t\t\tvar related = event.relatedTarget;\n\t\t\tvar target = event.delegateTarget;\n\t\t\tif (!related || (related !== target && !target.contains(related))) {\n\t\t\t\tevent.customType = eventName;\n\t\t\t\treturn callback(event);\n\t\t\t}\n\t\t},\n\t\toriginalEvent: mouseEventMap[eventName]\n\t});\n});\n\nvar animationEventMap = {\n\tanimation: 'animationend',\n\ttransition: 'transitionend'\n};\nObject.keys(animationEventMap).forEach(function(eventType) {\n\tvar eventName = animationEventMap[eventType];\n\tregisterCustomEvent(eventName, {\n\t\tevent: true,\n\t\tdelegate: true,\n\t\thandler: function(callback, event) {\n\t\t\tevent.customType = eventName;\n\t\t\treturn callback(event);\n\t\t},\n\t\toriginalEvent: features.checkAnimationEventName()[eventType]\n\t});\n});\n","'use strict';\n\nimport { array, isString } from 'metal';\nimport domData from './domData';\nimport { EventHandle } from 'metal-events';\n\n/**\n * This is a special EventHandle, that is responsible for dom delegated events\n * (only the ones that receive a target element, not a selector string).\n * @extends {EventHandle}\n */\nclass DomDelegatedEventHandle extends EventHandle {\n\t/**\n\t * The constructor for `DomDelegatedEventHandle`.\n\t * @param {!Event} emitter Element the event was subscribed to.\n\t * @param {string} event The name of the event that was subscribed to.\n\t * @param {!Function} listener The listener subscribed to the event.\n\t * @param {string=} opt_selector An optional selector used when delegating\n\t *     the event.\n\t * @constructor\n\t */\n\tconstructor(emitter, event, listener, opt_selector) {\n\t\tsuper(emitter, event, listener);\n\t\tthis.selector_ = opt_selector;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tremoveListener() {\n\t\tvar data = domData.get(this.emitter_);\n\t\tvar selector = this.selector_;\n\t\tvar arr = isString(selector) ? data.delegating[this.event_].selectors : data.listeners;\n\t\tvar key = isString(selector) ? selector : this.event_;\n\n\t\tarray.remove(arr[key] || [], this.listener_);\n\t\tif (arr[key] && arr[key].length === 0) {\n\t\t\tdelete arr[key];\n\t\t}\n\t}\n}\n\nexport default DomDelegatedEventHandle;\n","'use strict';\n\nimport { EventHandle } from 'metal-events';\n\n/**\n * This is a special EventHandle, that is responsible for dom events, instead\n * of EventEmitter events.\n * @extends {EventHandle}\n */\nclass DomEventHandle extends EventHandle {\n\t/**\n\t * The constructor for `DomEventHandle`.\n\t * @param {!EventEmitter} emitter Emitter the event was subscribed to.\n\t * @param {string} event The name of the event that was subscribed to.\n\t * @param {!Function} listener The listener subscribed to the event.\n\t * @param {boolean} opt_capture Flag indicating if listener should be triggered\n\t *   during capture phase, instead of during the bubbling phase. Defaults to false.\n\t * @constructor\n\t */\n\tconstructor(emitter, event, listener, opt_capture) {\n\t\tsuper(emitter, event, listener);\n\t\tthis.capture_ = opt_capture;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tremoveListener() {\n\t\tthis.emitter_.removeEventListener(this.event_, this.listener_, this.capture_);\n\t}\n}\n\nexport default DomEventHandle;\n","'use strict';\n\nimport { isDef, isDocument, isElement, isObject, isString, object } from 'metal';\nimport domData from './domData';\nimport DomDelegatedEventHandle from './DomDelegatedEventHandle';\nimport DomEventHandle from './DomEventHandle';\n\nconst elementsByTag_ = {};\nexport const customEvents = {};\n\nconst NEXT_TARGET = '__metal_next_target__';\nconst USE_CAPTURE = {\n\tblur: true,\n\terror: true,\n\tfocus: true,\n\tinvalid: true,\n\tload: true,\n\tscroll: true\n};\n\n/**\n * Adds the requested CSS classes to an element.\n * @param {!Element|!Nodelist} elements The element or elements to add CSS classes to.\n * @param {string} classes CSS classes to add.\n */\nexport function addClasses(elements, classes) {\n\tif (!isObject(elements) || !isString(classes)) {\n\t\treturn;\n\t}\n\n\tif (!elements.length) {\n\t\telements = [elements];\n\t}\n\n\tfor (let i = 0; i < elements.length; i++) {\n\t\tif ('classList' in elements[i]) {\n\t\t\taddClassesWithNative_(elements[i], classes);\n\t\t} else {\n\t\t\taddClassesWithoutNative_(elements[i], classes);\n\t\t}\n\t}\n}\n\n/**\n * Adds the requested CSS classes to an element using classList.\n * @param {!Element} element The element to add CSS classes to.\n * @param {string} classes CSS classes to add.\n * @private\n */\nfunction addClassesWithNative_(element, classes) {\n\tclasses.split(' ').forEach(function(className) {\n\t\tif (className) {\n\t\t\telement.classList.add(className);\n\t\t}\n\t});\n}\n\n/**\n * Adds the requested CSS classes to an element without using classList.\n * @param {!Element} element The element to add CSS classes to.\n * @param {string} classes CSS classes to add.\n * @private\n */\nfunction addClassesWithoutNative_(element, classes) {\n\tvar elementClassName = ' ' + element.className + ' ';\n\tvar classesToAppend = '';\n\n\tclasses = classes.split(' ');\n\n\tfor (var i = 0; i < classes.length; i++) {\n\t\tvar className = classes[i];\n\n\t\tif (elementClassName.indexOf(' ' + className + ' ') === -1) {\n\t\t\tclassesToAppend += ' ' + className;\n\t\t}\n\t}\n\n\tif (classesToAppend) {\n\t\telement.className = element.className + classesToAppend;\n\t}\n}\n\n/**\n * Adds an event listener to the given element, to be triggered via delegate.\n * @param {!Element} element\n * @param {string} eventName\n * @param {!function()} listener\n * @private\n */\nfunction addElementListener_(element, eventName, listener) {\n\tvar data = domData.get(element);\n\taddToArr_(data.listeners, eventName, listener);\n}\n\n/**\n * Adds an event listener to the given element, to be triggered via delegate\n * selectors.\n * @param {!Element} element\n * @param {string} eventName\n * @param {string} selector\n * @param {!function()} listener\n * @private\n */\nfunction addSelectorListener_(element, eventName, selector, listener) {\n\tvar data = domData.get(element);\n\taddToArr_(data.delegating[eventName].selectors, selector, listener);\n}\n\n/**\n * Adds a value to an array inside an object, creating it first if it doesn't\n * yet exist.\n * @param {!Array} arr\n * @param {string} key\n * @param {*} value\n * @private\n */\nfunction addToArr_(arr, key, value) {\n\tif (!arr[key]) {\n\t\tarr[key] = [];\n\t}\n\tarr[key].push(value);\n}\n\n/**\n * Attaches a delegate listener, unless there's already one attached.\n * @param {!Element} element\n * @param {string} eventName\n * @private\n */\nfunction attachDelegateEvent_(element, eventName) {\n\tvar data = domData.get(element);\n\tif (!data.delegating[eventName]) {\n\t\tdata.delegating[eventName] = {\n\t\t\thandle: on(\n\t\t\t\telement,\n\t\t\t\teventName,\n\t\t\t\thandleDelegateEvent_,\n\t\t\t\t!!USE_CAPTURE[eventName]\n\t\t\t),\n\t\t\tselectors: {}\n\t\t};\n\t}\n}\n\n/**\n * Gets the closest element up the tree from the given element (including\n * itself) that matches the specified selector, or null if none match.\n * @param {Element} element\n * @param {string} selector\n * @return {Element}\n */\nexport function closest(element, selector) {\n\twhile (element && !match(element, selector)) {\n\t\telement = element.parentNode;\n\t}\n\treturn element;\n}\n\n/**\n * Appends a child node with text or other nodes to a parent node. If\n * child is a HTML string it will be automatically converted to a document\n * fragment before appending it to the parent.\n * @param {!Element} parent The node to append nodes to.\n * @param {!(Element|NodeList|string)} child The thing to append to the parent.\n * @return {!Element} The appended child.\n */\nexport function append(parent, child) {\n\tif (isString(child)) {\n\t\tchild = buildFragment(child);\n\t}\n\tif (child instanceof NodeList) {\n\t\tvar childArr = Array.prototype.slice.call(child);\n\t\tfor (var i = 0; i < childArr.length; i++) {\n\t\t\tparent.appendChild(childArr[i]);\n\t\t}\n\t} else {\n\t\tparent.appendChild(child);\n\t}\n\treturn child;\n}\n\n/**\n * Helper for converting a HTML string into a document fragment.\n * @param {string} htmlString The HTML string to convert.\n * @return {!Element} The resulting document fragment.\n */\nexport function buildFragment(htmlString) {\n\tvar tempDiv = document.createElement('div');\n\ttempDiv.innerHTML = '<br>' + htmlString;\n\ttempDiv.removeChild(tempDiv.firstChild);\n\n\tvar fragment = document.createDocumentFragment();\n\twhile (tempDiv.firstChild) {\n\t\tfragment.appendChild(tempDiv.firstChild);\n\t}\n\treturn fragment;\n}\n\n/**\n * Checks if the first element contains the second one.\n * @param {!Element} element1\n * @param {!Element} element2\n * @return {boolean}\n */\nexport function contains(element1, element2) {\n\tif (isDocument(element1)) {\n\t\t// document.contains is not defined on IE9, so call it on documentElement instead.\n\t\treturn element1.documentElement.contains(element2);\n\t} else {\n\t\treturn element1.contains(element2);\n\t}\n}\n\n/**\n * Listens to the specified event on the given DOM element, but only calls the\n * given callback listener when it's triggered by elements that match the\n * given selector or target element.\n * @param {!Element} element The DOM element the event should be listened on.\n * @param {string} eventName The name of the event to listen to.\n * @param {!Element|string} selectorOrTarget Either an element or css selector\n *     that should match the event for the listener to be triggered.\n * @param {!function(!Object)} callback Function to be called when the event\n *     is triggered. It will receive the normalized event object.\n * @param {boolean=} opt_default Optional flag indicating if this is a default\n *     listener. That means that it would only be executed after all non\n *     default listeners, and only if the event isn't prevented via\n *     `preventDefault`.\n * @return {!EventHandle} Can be used to remove the listener.\n */\nexport function delegate(element, eventName, selectorOrTarget, callback, opt_default) {\n\tvar customConfig = customEvents[eventName];\n\tif (customConfig && customConfig.delegate) {\n\t\teventName = customConfig.originalEvent;\n\t\tcallback = customConfig.handler.bind(customConfig, callback);\n\t}\n\n\tif (opt_default) {\n\t\t// Wrap callback so we don't set property directly on it.\n\t\tcallback = callback.bind();\n\t\tcallback.defaultListener_ = true;\n\t}\n\n\tattachDelegateEvent_(element, eventName);\n\tif (isString(selectorOrTarget)) {\n\t\taddSelectorListener_(element, eventName, selectorOrTarget, callback);\n\t} else {\n\t\taddElementListener_(selectorOrTarget, eventName, callback);\n\t}\n\n\treturn new DomDelegatedEventHandle(\n\t\tisString(selectorOrTarget) ? element : selectorOrTarget,\n\t\teventName,\n\t\tcallback,\n\t\tisString(selectorOrTarget) ? selectorOrTarget : null\n\t);\n}\n\n/**\n * Verifies if the element is able to trigger the Click event,\n * simulating browsers behaviour, avoiding event listeners to be called by triggerEvent method.\n * @param {Element} node Element to be checked.\n * @param {string} eventName The event name.\n * @private\n */\nfunction isAbleToInteractWith_(node, eventName, opt_eventObj) {\n\tif (opt_eventObj && eventName === 'click' && opt_eventObj.button === 2) {\n\t\t// Firefox triggers \"click\" events on the document for right clicks. This\n\t\t// causes our delegate logic to trigger it for regular elements too, which\n\t\t// shouldn't happen. Ignoring them here.\n\t\treturn false;\n\t}\n\n  var matchesSelector = ['BUTTON', 'INPUT', 'SELECT', 'TEXTAREA', 'FIELDSET'];\n  if (eventName === 'click' && matchesSelector.indexOf(node.tagName) > -1) {\n    return !(node.disabled || parent(node, 'fieldset[disabled]'));\n  }\n  return true;\n}\n\n/**\n * Inserts node in document as last element.\n * @param {Element} node Element to remove children from.\n */\nexport function enterDocument(node) {\n\tnode && append(document.body, node);\n}\n\n/**\n * Removes node from document.\n * @param {Element} node Element to remove children from.\n */\nexport function exitDocument(node) {\n\tif (node && node.parentNode) {\n\t\tnode.parentNode.removeChild(node);\n\t}\n}\n\n/**\n * This is called when an event is triggered by a delegate listener. All\n * matching listeners of this event type from `target` to `currentTarget` will\n * be triggered.\n * @param {!Event} event The event payload.\n * @return {boolean} False if at least one of the triggered callbacks returns\n *     false, or true otherwise.\n * @private\n */\nfunction handleDelegateEvent_(event) {\n\tnormalizeDelegateEvent_(event);\n\tvar currElement = isDef(event[NEXT_TARGET]) ?\n\t\tevent[NEXT_TARGET] :\n\t\tevent.target;\n\tvar ret = true;\n\tvar container = event.currentTarget;\n\tvar limit = event.currentTarget.parentNode;\n\tvar defFns = [];\n\n\tret &= triggerDelegatedListeners_(container, currElement, event, limit, defFns);\n\tret &= triggerDefaultDelegatedListeners_(defFns, event);\n\n\tevent.delegateTarget = null;\n\tevent[NEXT_TARGET] = limit;\n\treturn ret;\n}\n\n/**\n * Checks if the given element has the requested css class.\n * @param {!Element} element\n * @param {string} className\n * @return {boolean}\n */\nexport function hasClass(element, className) {\n\tif ('classList' in element) {\n\t\treturn hasClassWithNative_(element, className);\n\t} else {\n\t\treturn hasClassWithoutNative_(element, className);\n\t}\n}\n\n/**\n * Checks if the given element has the requested css class using classList.\n * @param {!Element} element\n * @param {string} className\n * @return {boolean}\n * @private\n */\nfunction hasClassWithNative_(element, className) {\n\treturn element.classList.contains(className);\n}\n\n/**\n * Checks if the given element has the requested css class without using classList.\n * @param {!Element} element\n * @param {string} className\n * @return {boolean}\n * @private\n */\nfunction hasClassWithoutNative_(element, className) {\n\treturn (' ' + element.className + ' ').indexOf(' ' + className + ' ') >= 0;\n}\n\n/**\n * Checks if the given element is empty or not.\n * @param {!Element} element\n * @return {boolean}\n */\nexport function isEmpty(element) {\n\treturn element.childNodes.length === 0;\n}\n\n/**\n * Check if an element matches a given selector.\n * @param {Element} element\n * @param {string} selector\n * @return {boolean}\n */\nexport function match(element, selector) {\n\tif (!element || element.nodeType !== 1) {\n\t\treturn false;\n\t}\n\n\tvar p = Element.prototype;\n\tvar m = p.matches || p.webkitMatchesSelector || p.mozMatchesSelector || p.msMatchesSelector || p.oMatchesSelector;\n\tif (m) {\n\t\treturn m.call(element, selector);\n\t}\n\n\treturn matchFallback_(element, selector);\n}\n\n/**\n * Check if an element matches a given selector, using an internal implementation\n * instead of calling existing javascript functions.\n * @param {Element} element\n * @param {string} selector\n * @return {boolean}\n * @private\n */\nfunction matchFallback_(element, selector) {\n\tvar nodes = document.querySelectorAll(selector, element.parentNode);\n\tfor (var i = 0; i < nodes.length; ++i) {\n\t\tif (nodes[i] === element) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\n/**\n * Returns the next sibling of the given element that matches the specified\n * selector, or null if there is none.\n * @param {!Element} element\n * @param {?string} selector\n */\nexport function next(element, selector) {\n\tdo {\n\t\telement = element.nextSibling;\n\t\tif (element && match(element, selector)) {\n\t\t\treturn element;\n\t\t}\n\t} while (element);\n\treturn null;\n}\n\n/**\n * Normalizes the event payload for delegate listeners.\n * @param {!Event} event\n * @private\n */\nfunction normalizeDelegateEvent_(event) {\n\tevent.stopPropagation = stopPropagation_;\n\tevent.stopImmediatePropagation = stopImmediatePropagation_;\n}\n\n/**\n * Listens to the specified event on the given DOM element. This function normalizes\n * DOM event payloads and functions so they'll work the same way on all supported\n * browsers.\n * @param {!Element|string} element The DOM element to listen to the event on, or\n *   a selector that should be delegated on the entire document.\n * @param {string} eventName The name of the event to listen to.\n * @param {!function(!Object)} callback Function to be called when the event is\n *   triggered. It will receive the normalized event object.\n * @param {boolean} opt_capture Flag indicating if listener should be triggered\n *   during capture phase, instead of during the bubbling phase. Defaults to false.\n * @return {!DomEventHandle} Can be used to remove the listener.\n */\nexport function on(element, eventName, callback, opt_capture) {\n\tif (isString(element)) {\n\t\treturn delegate(document, eventName, element, callback);\n\t}\n\tvar customConfig = customEvents[eventName];\n\tif (customConfig && customConfig.event) {\n\t\teventName = customConfig.originalEvent;\n\t\tcallback = customConfig.handler.bind(customConfig, callback);\n\t}\n\telement.addEventListener(eventName, callback, opt_capture);\n\treturn new DomEventHandle(element, eventName, callback, opt_capture);\n}\n\n/**\n * Listens to the specified event on the given DOM element once. This\n * function normalizes DOM event payloads and functions so they'll work the\n * same way on all supported browsers.\n * @param {!Element} element The DOM element to listen to the event on.\n * @param {string} eventName The name of the event to listen to.\n * @param {!function(!Object)} callback Function to be called when the event\n *   is triggered. It will receive the normalized event object.\n * @return {!DomEventHandle} Can be used to remove the listener.\n */\nexport function once(element, eventName, callback) {\n\tvar domEventHandle = on(element, eventName, function() {\n\t\tdomEventHandle.removeListener();\n\t\treturn callback.apply(this, arguments);\n\t});\n\treturn domEventHandle;\n}\n\n/**\n * Gets the first parent from the given element that matches the specified\n * selector, or null if none match.\n * @param {!Element} element\n * @param {string} selector\n * @return {Element}\n */\nexport function parent(element, selector) {\n\treturn closest(element.parentNode, selector);\n}\n\n/**\n * Registers a custom event.\n * @param {string} eventName The name of the custom event.\n * @param {!Object} customConfig An object with information about how the event\n *   should be handled.\n */\nexport function registerCustomEvent(eventName, customConfig) {\n\tcustomEvents[eventName] = customConfig;\n}\n\n/**\n * Removes all the child nodes on a DOM node.\n * @param {Element} node Element to remove children from.\n */\nexport function removeChildren(node) {\n\tvar child;\n\twhile ((child = node.firstChild)) {\n\t\tnode.removeChild(child);\n\t}\n}\n\n/**\n * Removes the requested CSS classes from an element.\n * @param {!Element|!NodeList} elements The element or elements to remove CSS classes from.\n * @param {string} classes CSS classes to remove.\n */\nexport function removeClasses(elements, classes) {\n\tif (!isObject(elements) || !isString(classes)) {\n\t\treturn;\n\t}\n\n\tif (!elements.length) {\n\t\telements = [elements];\n\t}\n\n\tfor (let i = 0; i < elements.length; i++) {\n\t\tif ('classList' in elements[i]) {\n\t\t\tremoveClassesWithNative_(elements[i], classes);\n\t\t} else {\n\t\t\tremoveClassesWithoutNative_(elements[i], classes);\n\t\t}\n\t}\n}\n\n/**\n * Removes the requested CSS classes from an element using classList.\n * @param {!Element} element The element to remove CSS classes from.\n * @param {string} classes CSS classes to remove.\n * @private\n */\nfunction removeClassesWithNative_(element, classes) {\n\tclasses.split(' ').forEach(function(className) {\n\t\tif (className) {\n\t\t\telement.classList.remove(className);\n\t\t}\n\t});\n}\n\n/**\n * Removes the requested CSS classes from an element without using classList.\n * @param {!Element} element The element to remove CSS classes from.\n * @param {string} classes CSS classes to remove.\n * @private\n */\nfunction removeClassesWithoutNative_(element, classes) {\n\tvar elementClassName = ' ' + element.className + ' ';\n\n\tclasses = classes.split(' ');\n\n\tfor (var i = 0; i < classes.length; i++) {\n\t\telementClassName = elementClassName.replace(' ' + classes[i] + ' ', ' ');\n\t}\n\n\telement.className = elementClassName.trim();\n}\n\n/**\n * Replaces the first element with the second.\n * @param {Element} element1\n * @param {Element} element2\n */\nexport function replace(element1, element2) {\n\tif (element1 && element2 && element1 !== element2 && element1.parentNode) {\n\t\telement1.parentNode.insertBefore(element2, element1);\n\t\telement1.parentNode.removeChild(element1);\n\t}\n}\n\n/**\n * The function that replaces `stopImmediatePropagation_` for events.\n * @private\n */\nfunction stopImmediatePropagation_() {\n\tconst event = this; // jshint ignore:line\n\tevent.stopped = true;\n\tevent.stoppedImmediate = true;\n\tEvent.prototype.stopImmediatePropagation.call(event);\n}\n\n/**\n * The function that replaces `stopPropagation` for events.\n * @private\n */\nfunction stopPropagation_() {\n\tconst event = this; // jshint ignore:line\n\tevent.stopped = true;\n\tEvent.prototype.stopPropagation.call(event);\n}\n\n/**\n * Checks if the given element supports the given event type.\n * @param {!Element|string} element The DOM element or element tag name to check.\n * @param {string} eventName The name of the event to check.\n * @return {boolean}\n */\nexport function supportsEvent(element, eventName) {\n\tif (customEvents[eventName]) {\n\t\treturn true;\n\t}\n\n\tif (isString(element)) {\n\t\tif (!elementsByTag_[element]) {\n\t\t\telementsByTag_[element] = document.createElement(element);\n\t\t}\n\t\telement = elementsByTag_[element];\n\t}\n\treturn 'on' + eventName in element;\n}\n\n/**\n * This triggers all default matched delegated listeners of a given event type.\n * @param {!Array} defaultFns Array to collect default listeners in, instead\n * @param {!Event} event\n * @return {boolean} False if at least one of the triggered callbacks returns\n *     false, or true otherwise.\n * @private\n */\nfunction triggerDefaultDelegatedListeners_(defFns, event) {\n\tlet ret = true;\n\n\tfor (var i = 0; i < defFns.length && !event.defaultPrevented; i++) {\n\t\tevent.delegateTarget = defFns[i].element;\n\t\tret &= defFns[i].fn(event);\n\t}\n\n\treturn ret;\n}\n\n/**\n * This triggers all matched delegated listeners of a given event type when its\n * delegated target is able to interact.\n * @param {!Element} container\n * @param {!Element} currElement\n * @param {!Event} event\n * @param {!Element} limit the fartest parent of the given element\n * @param {!Array} defaultFns Array to collect default listeners in, instead\n *     of running them.\n * @return {boolean} False if at least one of the triggered callbacks returns\n *     false, or true otherwise.\n * @private\n */\nfunction triggerDelegatedListeners_(container, currElement, event, limit, defaultFns) {\n\tlet ret = true;\n\n\twhile (currElement && currElement !== limit && !event.stopped) {\n\t\tif (isAbleToInteractWith_(currElement, event.type, event)) {\n\t\t\tevent.delegateTarget = currElement;\n\t\t\tret &= triggerMatchedListeners_(container, currElement, event, defaultFns);\n\t\t}\n\t\tcurrElement = currElement.parentNode;\n\t}\n\n\treturn ret;\n}\n\n/**\n * Converts the given argument to a DOM element. Strings are assumed to\n * be selectors, and so a matched element will be returned. If the arg\n * is already a DOM element it will be the return value.\n * @param {string|Element|Document} selectorOrElement\n * @return {Element} The converted element, or null if none was found.\n */\nexport function toElement(selectorOrElement) {\n\tif (isElement(selectorOrElement) || isDocument(selectorOrElement)) {\n\t\treturn selectorOrElement;\n\t} else if (isString(selectorOrElement)) {\n\t\tif (selectorOrElement[0] === '#' && selectorOrElement.indexOf(' ') === -1) {\n\t\t\treturn document.getElementById(selectorOrElement.substr(1));\n\t\t} else {\n\t\t\treturn document.querySelector(selectorOrElement);\n\t\t}\n\t} else {\n\t\treturn null;\n\t}\n}\n\n/**\n * Adds or removes one or more classes from an element. If any of the classes\n * is present, it will be removed from the element, or added otherwise.\n * @param {!Element} element The element which classes will be toggled.\n * @param {string} classes The classes which have to added or removed from the element.\n */\nexport function toggleClasses(element, classes) {\n\tif (!isObject(element) || !isString(classes)) {\n\t\treturn;\n\t}\n\n\tif ('classList' in element) {\n\t\ttoggleClassesWithNative_(element, classes);\n\t} else {\n\t\ttoggleClassesWithoutNative_(element, classes);\n\t}\n}\n\n/**\n * Adds or removes one or more classes from an element using classList.\n * If any of the classes is present, it will be removed from the element,\n * or added otherwise.\n * @param {!Element} element The element which classes will be toggled.\n * @param {string} classes The classes which have to added or removed from the element.\n * @private\n */\nfunction toggleClassesWithNative_(element, classes) {\n\tclasses.split(' ').forEach(function(className) {\n\t\telement.classList.toggle(className);\n\t});\n}\n\n/**\n * Adds or removes one or more classes from an element without using classList.\n * If any of the classes is present, it will be removed from the element,\n * or added otherwise.\n * @param {!Element} element The element which classes will be toggled.\n * @param {string} classes The classes which have to added or removed from the element.\n * @private\n */\nfunction toggleClassesWithoutNative_(element, classes) {\n\tvar elementClassName = ' ' + element.className + ' ';\n\n\tclasses = classes.split(' ');\n\n\tfor (var i = 0; i < classes.length; i++) {\n\t\tvar className = ' ' + classes[i] + ' ';\n\t\tvar classIndex = elementClassName.indexOf(className);\n\n\t\tif (classIndex === -1) {\n\t\t\telementClassName = elementClassName + classes[i] + ' ';\n\t\t} else {\n\t\t\telementClassName = elementClassName.substring(0, classIndex) + ' ' +\n\t\t\t\telementClassName.substring(classIndex + className.length);\n\t\t}\n\t}\n\n\telement.className = elementClassName.trim();\n}\n\n/**\n * Triggers the specified event on the given element.\n * NOTE: This should mostly be used for testing, not on real code.\n * @param {!Element} element The node that should trigger the event.\n * @param {string} eventName The name of the event to be triggred.\n * @param {Object=} opt_eventObj An object with data that should be on the\n *   triggered event's payload.\n */\nexport function triggerEvent(element, eventName, opt_eventObj) {\n\tif (isAbleToInteractWith_(element, eventName, opt_eventObj)) {\n\t\tvar eventObj = document.createEvent('HTMLEvents');\n\t\teventObj.initEvent(eventName, true, true);\n\t\tobject.mixin(eventObj, opt_eventObj);\n\t\telement.dispatchEvent(eventObj);\n\t}\n}\n\n/**\n * Triggers the given listeners array.\n * @param {Array<!function()>} listeners\n * @param {!Event} event\n * @param {!Element} element\n * @param {!Array} defaultFns Array to collect default listeners in, instead\n *     of running them.\n * @return {boolean} False if at least one of the triggered callbacks returns\n *     false, or true otherwise.\n * @private\n */\nfunction triggerListeners_(listeners, event, element, defaultFns) {\n\tvar ret = true;\n\tlisteners = listeners || [];\n\tfor (var i = 0; i < listeners.length && !event.stoppedImmediate; i++) {\n\t\tif (listeners[i].defaultListener_) {\n\t\t\tdefaultFns.push({\n\t\t\t\telement,\n\t\t\t\tfn: listeners[i]\n\t\t\t});\n\t\t} else {\n\t\t\tret &= listeners[i](event);\n\t\t}\n\t}\n\treturn ret;\n}\n\n/**\n * Triggers all listeners for the given event type that are stored in the\n * specified element.\n * @param {!Element} container\n * @param {!Element} element\n * @param {!Event} event\n * @param {!Array} defaultFns Array to collect default listeners in, instead\n *     of running them.\n * @return {boolean} False if at least one of the triggered callbacks returns\n *     false, or true otherwise.\n * @private\n */\nfunction triggerMatchedListeners_(container, element, event, defaultFns) {\n\tvar data = domData.get(element);\n\tvar listeners = data.listeners[event.type];\n\tvar ret = triggerListeners_(listeners, event, element, defaultFns);\n\n\tvar selectorsMap = domData.get(container).delegating[event.type].selectors;\n\tvar selectors = Object.keys(selectorsMap);\n\tfor (var i = 0; i < selectors.length && !event.stoppedImmediate; i++) {\n\t\tif (match(element, selectors[i])) {\n\t\t\tlisteners = selectorsMap[selectors[i]];\n\t\t\tret &= triggerListeners_(listeners, event, element, defaultFns);\n\t\t}\n\t}\n\n\treturn ret;\n}\n","'use strict';\n\nimport dom from '../dom';\nimport domData from '../domData';\nimport DomEventEmitterProxy from '../DomEventEmitterProxy';\nimport DomEventHandle from '../DomEventHandle';\nimport features from '../features';\nimport globalEval from '../globalEval';\nimport globalEvalStyles from '../globalEvalStyles';\nimport '../events';\n\nexport * from '../dom';\nexport { domData, DomEventEmitterProxy, DomEventHandle, features, globalEval, globalEvalStyles };\nexport default dom;\n","'use strict';\n\nimport { delegate, on, supportsEvent } from './dom';\nimport { EventEmitterProxy } from 'metal-events';\n\n/**\n * DomEventEmitterProxy utility. It extends `EventEmitterProxy` to also accept\n * dom elements as origin emitters.\n * @extends {EventEmitterProxy}\n */\nclass DomEventEmitterProxy extends EventEmitterProxy {\n\t/**\n\t * Adds the given listener for the given event.\n\t * @param {string} event\n\t * @param {!function()} listener\n\t * @return {!EventHandle} The listened event's handle.\n\t * @protected\n\t * @override\n\t */\n\taddListener_(event, listener) {\n\t\tif (this.originEmitter_.addEventListener) {\n\t\t\tif (this.isDelegateEvent_(event)) {\n\t\t\t\tvar index = event.indexOf(':', 9);\n\t\t\t\tvar eventName = event.substring(9, index);\n\t\t\t\tvar selector = event.substring(index + 1);\n\t\t\t\treturn delegate(this.originEmitter_, eventName, selector, listener);\n\t\t\t} else {\n\t\t\t\treturn on(this.originEmitter_, event, listener);\n\t\t\t}\n\t\t} else {\n\t\t\treturn super.addListener_(event, listener);\n\t\t}\n\t}\n\n\t/**\n\t * Checks if the given event is of the delegate type.\n\t * @param {string} event\n\t * @return {boolean}\n\t * @protected\n\t */\n\tisDelegateEvent_(event) {\n\t\treturn event.substr(0, 9) === 'delegate:';\n\t}\n\n\t/**\n\t * Checks if the given event is supported by the origin element.\n\t * @param {string} event\n\t * @protected\n\t */\n\tisSupportedDomEvent_(event) {\n\t\tif (!this.originEmitter_ || !this.originEmitter_.addEventListener) {\n\t\t\treturn true;\n\t\t}\n\t\treturn (this.isDelegateEvent_(event) && event.indexOf(':', 9) !== -1) ||\n\t\t\tsupportsEvent(this.originEmitter_, event);\n\t}\n\n\t/**\n\t * Checks if the given event should be proxied.\n\t * @param {string} event\n\t * @return {boolean}\n\t * @protected\n\t * @override\n\t */\n\tshouldProxyEvent_(event) {\n\t\treturn super.shouldProxyEvent_(event) && this.isSupportedDomEvent_(event);\n\t}\n}\n\nexport default DomEventEmitterProxy;\n","'use strict';\n\nimport { append } from './dom';\nimport { string } from 'metal';\n\n/**\n * Class with static methods responsible for doing browser feature checks.\n */\nclass features {\n\t/**\n\t * Some browsers still supports prefixed animation events. This method can\n\t * be used to retrieve the current browser event name for both, animation\n\t * and transition.\n\t * @return {object}\n\t */\n\tstatic checkAnimationEventName() {\n\t\tif (features.animationEventName_ === undefined) {\n\t\t\tfeatures.animationEventName_ = {\n\t\t\t\tanimation: features.checkAnimationEventName_('animation'),\n\t\t\t\ttransition: features.checkAnimationEventName_('transition')\n\t\t\t};\n\t\t}\n\t\treturn features.animationEventName_;\n\t}\n\n\t/**\n\t * @protected\n\t * @param {string} type Type to test: animation, transition.\n\t * @return {string} Browser event name.\n\t */\n\tstatic checkAnimationEventName_(type) {\n\t\tvar prefixes = ['Webkit', 'MS', 'O', ''];\n\t\tvar typeTitleCase = string.replaceInterval(type, 0, 1, type.substring(0, 1).toUpperCase());\n\t\tvar suffixes = [typeTitleCase + 'End', typeTitleCase + 'End', typeTitleCase + 'End', type + 'end'];\n\t\tfor (var i = 0; i < prefixes.length; i++) {\n\t\t\tif (features.animationElement_.style[prefixes[i] + typeTitleCase] !== undefined) {\n\t\t\t\treturn prefixes[i].toLowerCase() + suffixes[i];\n\t\t\t}\n\t\t}\n\t\treturn type + 'end';\n\t}\n\n\t/**\n\t * Some browsers (like IE9) change the order of element attributes, when html\n\t * is rendered. This method can be used to check if this behavior happens on\n\t * the current browser.\n\t * @return {boolean}\n\t */\n\tstatic checkAttrOrderChange() {\n\t\tif (features.attrOrderChange_ === undefined) {\n\t\t\tvar originalContent = '<div data-component=\"\" data-ref=\"\"></div>';\n\t\t\tvar element = document.createElement('div');\n\t\t\tappend(element, originalContent);\n\t\t\tfeatures.attrOrderChange_ = originalContent !== element.innerHTML;\n\t\t}\n\t\treturn features.attrOrderChange_;\n\t}\n}\n\nfeatures.animationElement_ = document.createElement('div');\nfeatures.animationEventName_ = undefined;\nfeatures.attrOrderChange_ = undefined;\n\nexport default features;\n","'use strict';\n\nimport { async } from 'metal';\nimport { exitDocument, once } from './dom';\n\n/**\n * Utility functions for running javascript code in the global scope.\n */\nclass globalEval {\n\t/**\n\t * Evaluates the given string in the global scope.\n\t * @param {string} text\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t * @return {Element} script\n\t */\n\tstatic run(text, opt_appendFn) {\n\t\tvar script = document.createElement('script');\n\t\tscript.text = text;\n\t\tif (opt_appendFn) {\n\t\t\topt_appendFn(script);\n\t\t} else {\n\t\t\tdocument.head.appendChild(script);\n\t\t}\n\t\texitDocument(script);\n\t\treturn script;\n\t}\n\n\t/**\n\t * Evaluates the given javascript file in the global scope.\n\t * @param {string} src The file's path.\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the script has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t * @return {Element} script\n\t */\n\tstatic runFile(src, opt_callback, opt_appendFn) {\n\t\tvar script = document.createElement('script');\n\t\tscript.src = src;\n\n\t\tvar callback = function() {\n\t\t\texitDocument(script);\n\t\t\topt_callback && opt_callback();\n\t\t};\n\t\tonce(script, 'load', callback);\n\t\tonce(script, 'error', callback);\n\n\t\tif (opt_appendFn) {\n\t\t\topt_appendFn(script);\n\t\t} else {\n\t\t\tdocument.head.appendChild(script);\n\t\t}\n\n\t\treturn script;\n\t}\n\n\t/**\n\t * Evaluates the code referenced by the given script element.\n\t * @param {!Element} script\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the script has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t * @return {Element} script\n\t */\n\tstatic runScript(script, opt_callback, opt_appendFn) {\n\t\tvar callback = function() {\n\t\t\topt_callback && opt_callback();\n\t\t};\n\t\tif (script.type && script.type !== 'text/javascript') {\n\t\t\tasync.nextTick(callback);\n\t\t\treturn;\n\t\t}\n\t\texitDocument(script);\n\t\tif (script.src) {\n\t\t\treturn globalEval.runFile(script.src, opt_callback, opt_appendFn);\n\t\t} else {\n\t\t\tasync.nextTick(callback);\n\t\t\treturn globalEval.run(script.text, opt_appendFn);\n\t\t}\n\t}\n\n\t/**\n\t * Evaluates any script tags present in the given element.\n\t * @param {!Element} element\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the script has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t */\n\tstatic runScriptsInElement(element, opt_callback, opt_appendFn) {\n\t\tvar scripts = element.querySelectorAll('script');\n\t\tif (scripts.length) {\n\t\t\tglobalEval.runScriptsInOrder(scripts, 0, opt_callback, opt_appendFn);\n\t\t} else if (opt_callback) {\n\t\t\tasync.nextTick(opt_callback);\n\t\t}\n\t}\n\n\t/**\n\t * Runs the given scripts elements in the order that they appear.\n\t * @param {!NodeList} scripts\n\t * @param {number} index\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the script has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t */\n\tstatic runScriptsInOrder(scripts, index, opt_callback, opt_appendFn) {\n\t\tglobalEval.runScript(scripts.item(index), function() {\n\t\t\tif (index < scripts.length - 1) {\n\t\t\t\tglobalEval.runScriptsInOrder(scripts, index + 1, opt_callback, opt_appendFn);\n\t\t\t} else if (opt_callback) {\n\t\t\t\tasync.nextTick(opt_callback);\n\t\t\t}\n\t\t}, opt_appendFn);\n\t}\n}\n\nexport default globalEval;\n","'use strict';\n\nimport { async } from 'metal';\nimport { once } from './dom';\n\n/**\n * Utility functions for running styles.\n */\nclass globalEvalStyles {\n\t/**\n\t * Evaluates the given style.\n\t * @param {string} text\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t * @return {Element} style\n\t */\n\tstatic run(text, opt_appendFn) {\n\t\tvar style = document.createElement('style');\n\t\tstyle.innerHTML = text;\n\t\tif (opt_appendFn) {\n\t\t\topt_appendFn(style);\n\t\t} else {\n\t\t\tdocument.head.appendChild(style);\n\t\t}\n\t\treturn style;\n\t}\n\n\t/**\n\t * Evaluates the given style file.\n\t * @param {string} href The file's path.\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the styles has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t * @return {Element} style\n\t */\n\tstatic runFile(href, opt_callback, opt_appendFn) {\n\t\tvar link = document.createElement('link');\n\t\tlink.rel = 'stylesheet';\n\t\tlink.href = href;\n\t\tglobalEvalStyles.runStyle(link, opt_callback, opt_appendFn);\n\t\treturn link;\n\t}\n\n\t/**\n\t * Evaluates the code referenced by the given style/link element.\n\t * @param {!Element} style\n\t * @param {function()=} opt_callback Optional function to be called\n\t *   when the script has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t *  @return {Element} style\n\t */\n\tstatic runStyle(style, opt_callback, opt_appendFn) {\n\t\tvar callback = function() {\n\t\t\topt_callback && opt_callback();\n\t\t};\n\t\tif (style.rel && style.rel !== 'stylesheet') {\n\t\t\tasync.nextTick(callback);\n\t\t\treturn;\n\t\t}\n\n\t\tif (style.tagName === 'STYLE') {\n\t\t\tasync.nextTick(callback);\n\t\t} else {\n\t\t\tonce(style, 'load', callback);\n\t\t\tonce(style, 'error', callback);\n\t\t}\n\n\t\tif (opt_appendFn) {\n\t\t\topt_appendFn(style);\n\t\t} else {\n\t\t\tdocument.head.appendChild(style);\n\t\t}\n\n\t\treturn style;\n\t}\n\n\t/**\n\t * Evaluates any style present in the given element.\n\t * @param {!Element} element\n\t * @param {function()=} opt_callback Optional function to be called when the\n\t *   style has been run.\n\t * @param {function()=} opt_appendFn Optional function to append the node\n\t *   into document.\n\t */\n\tstatic runStylesInElement(element, opt_callback, opt_appendFn) {\n\t\tvar styles = element.querySelectorAll('style,link');\n\t\tif (styles.length === 0 && opt_callback) {\n\t\t\tasync.nextTick(opt_callback);\n\t\t\treturn;\n\t\t}\n\n\t\tvar loadCount = 0;\n\t\tvar callback = function() {\n\t\t\tif (opt_callback && ++loadCount === styles.length) {\n\t\t\t\tasync.nextTick(opt_callback);\n\t\t\t}\n\t\t};\n\t\tfor (var i = 0; i < styles.length; i++) {\n\t\t\tglobalEvalStyles.runStyle(styles[i], callback, opt_appendFn);\n\t\t}\n\t}\n}\n\nexport default globalEvalStyles;\n","'use strict';\n\nimport { getFunctionName, isDef, isDefAndNotNull, isNull } from 'metal';\n\n/**\n * Provides access to various type validators that will return an\n * instance of Error when validation fails. Note that all type validators\n * will also accept null or undefined values. To not accept these you should\n * instead make your state property required.\n */\nconst validators = {\n\tany: () => () => true,\n\tarray: validateType('array'),\n\tbool: validateType('boolean'),\n\tfunc: validateType('function'),\n\tnumber: validateType('number'),\n\tobject: validateType('object'),\n\tstring: validateType('string'),\n\n\t/**\n\t * Creates a validator that checks the values of an array against a type.\n\t * @param {function()} validator Type validator to check each index against.\n\t * @return {function()} Validator.\n\t */\n\tarrayOf: function(validator) {\n\t\treturn maybe((value, name, context) => {\n\t\t\tvar result = validators.array(value, name, context);\n\t\t\tif (isInvalid(result)) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tfor (var i = 0; i < value.length; i++) {\n\t\t\t\tif (isInvalid(validator(value[i], name, context))) {\n\t\t\t\t\treturn composeError('Expected an array of single type', name, context);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t},\n\n\t/**\n\t * Creates a validator that compares a value to a specific class.\n\t * @param {function()} expectedClass Class to check value against.\n\t * @return {function()} Validator.\n\t */\n\tinstanceOf: function(expectedClass) {\n\t\treturn maybe((value, name, context) => {\n\t\t\tif (!(value instanceof expectedClass)) {\n\t\t\t\treturn composeError(\n\t\t\t\t\t`Expected instance of ${expectedClass}`,\n\t\t\t\t\tname,\n\t\t\t\t\tcontext\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t},\n\n\t/**\n\t * Creates a validator that checks the values of an object against a type.\n\t * @param {function()} typeValidator Validator to check value against.\n\t * @return {function()} Validator.\n\t */\n\tobjectOf: function(typeValidator) {\n\t\treturn maybe((value, name, context) => {\n\t\t\tfor (let key in value) {\n\t\t\t\tif (isInvalid(typeValidator(value[key]))) {\n\t\t\t\t\treturn composeError('Expected object of one type', name, context);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t},\n\n\t/**\n\t * Creates a validator that checks equality against specific values.\n\t * @param {!Array} arrayOfValues Array of values to check equality against.\n\t * @return {function()} Validator.\n\t */\n\toneOf: function(arrayOfValues) {\n\t\treturn maybe((value, name, context) => {\n\t\t\tconst result = validators.array(arrayOfValues, name, context);\n\t\t\tif (isInvalid(result)) {\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < arrayOfValues.length; i++) {\n\t\t\t\tconst oneOfValue = arrayOfValues[i];\n\t\t\t\tif (value === oneOfValue) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn composeError('Expected one of given values.', name, context);\n\t\t});\n\t},\n\n\t/**\n\t * Creates a validator that checks a value against multiple types and only has\n\t * to pass one.\n\t * @param {!Array} arrayOfTypeValidators Array of validators to check value\n\t *     against.\n\t * @return {function()} Validator.\n\t */\n\toneOfType: function(arrayOfTypeValidators) {\n\t\treturn maybe((value, name, context) => {\n\t\t\tconst result = validators.array(arrayOfTypeValidators, name, context);\n\t\t\tif (isInvalid(result)) {\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < arrayOfTypeValidators.length; i++) {\n\t\t\t\tif (!isInvalid(arrayOfTypeValidators[i](value, name, context))) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn composeError('Expected one of given types.', name, context);\n\t\t});\n\t},\n\n\t/**\n\t * Creates a validator that checks the shape of an object.\n\t * @param {!Object} shape An object containing type validators for each key.\n\t * @return {function()} Validator.\n\t */\n\tshapeOf: function(shape) {\n\t\treturn maybe((value, name, context) => {\n\t\t\tconst result = validators.object(shape, name, context);\n\t\t\tif (isInvalid(result)) {\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tfor (let key in shape) {\n\t\t\t\tlet required = false;\n\t\t\t\tlet validator = shape[key];\n\t\t\t\tif (validator.config) {\n\t\t\t\t\trequired = validator.config.required;\n\t\t\t\t\tvalidator = validator.config.validator;\n\t\t\t\t}\n\t\t\t\tif ((required && !isDefAndNotNull(value[key])) ||\n\t\t\t\t\tisInvalid(validator(value[key]))) {\n\t\t\t\t\treturn composeError(\n\t\t\t\t\t\t'Expected object with a specific shape',\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tcontext\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n};\n\n/**\n * Composes a warning a warning message.\n * @param {string} error Error message to display to console.\n * @param {?string} name Name of state property that is giving the error.\n * @param {Object} context\n * @return {!Error} Instance of Error class.\n */\nfunction composeError(error, name, context) {\n\tconst compName = context ? getFunctionName(context.constructor) : null;\n\tvar renderer = context && context.getRenderer && context.getRenderer();\n\tconst parent = renderer && renderer.getParent ?\n\t\tcontext.getRenderer().getParent() :\n\t\tnull;\n\tconst parentName = parent ? getFunctionName(parent.constructor) : null;\n\tconst location = parentName ? `Check render method of '${parentName}'.` : '';\n\treturn new Error(\n\t\t`Warning: Invalid state passed to '${name}'. ` +\n\t\t`${error} Passed to '${compName}'. ${location}`\n\t);\n}\n\n/**\n * Returns the type of the given value.\n * @param {*} value Any value.\n * @return {string} Type of value.\n */\nfunction getType(value) {\n\tconst type = typeof value;\n\tif (Array.isArray(value)) {\n\t\treturn 'array';\n\t}\n\treturn type;\n}\n\n/**\n * Checks if the given validator result says that the value is invalid.\n * @param {boolean|!Error} result\n * @return {boolean}\n */\nfunction isInvalid(result) {\n\treturn result instanceof Error;\n}\n\n/**\n * Creates a validator that checks a value against a single type, null, or\n * undefined.\n * @param {function()} typeValidator Validator to check value against.\n * @return {function()} Validator.\n */\nfunction maybe(typeValidator) {\n\treturn (value, name, context) => {\n\t\tif (!isDef(value) || isNull(value)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn typeValidator(value, name, context);\n\t};\n}\n\n/**\n * Creates a validator that checks against a specific primitive type. If this\n * validator is called with no arguments, it will return the actual validator\n * function instead of running it. That's done to allow all validators to be\n * used consistently, since some (like `arrayOf`) always require that you call\n * the function before receiving the actual validator.\n * @param {string} expectedType Type to check against.\n * @return {function()} Validator if called with arguments, or wrapper function\n *     that returns the validator otherwise.\n */\nfunction validateType(expectedType) {\n\tconst validatorFn = maybe((value, name, context) => {\n\t\tconst type = getType(value);\n\t\tif (type !== expectedType) {\n\t\t\treturn composeError(\n\t\t\t\t`Expected type '${expectedType}', but received type '${type}'.`,\n\t\t\t\tname,\n\t\t\t\tcontext\n\t\t\t);\n\t\t}\n\t\treturn true;\n\t});\n\treturn (...args) => {\n\t\tif (args.length === 0) {\n\t\t\treturn validatorFn;\n\t\t} else {\n\t\t\treturn validatorFn(...args);\n\t\t}\n\t};\n}\n\nexport default validators;\n","'use strict';\n\nimport { object } from 'metal';\nimport validators from './validators';\n\n/**\n * Sugar api that can be used as an alternative for manually building `State`\n * configuration in the expected format. For example, instead of having\n * something like this:\n *\n * ```js\n * MyClass.STATE = {\n *   foo: {\n *     required: true,\n *     validator: validators.number,\n *     value: 13\n *   }\n * };\n * ```\n *\n * You could instead do:\n *\n * ```js\n * MyClass.STATE = {\n *   foo: Config.required().number().value(13)\n * };\n * ```\n */\nconst Config = {\n\t/**\n\t * Adds the `required` flag to the `State` configuration.\n\t * @param {boolean} required Flag to set \"required\" to. True by default.\n\t * @return {!Object} `State` configuration object.\n\t */\n\trequired(required = true) {\n\t\treturn mergeConfig(this, {required});\n\t},\n\n\t/**\n\t * Adds a setter to the `State` configuration.\n\t * @param {!function()} setter\n\t * @return {!Object} `State` configuration object.\n\t */\n\tsetter(setter) {\n\t\treturn mergeConfig(this, {setter});\n\t},\n\n\t/**\n\t * Adds a validator to the `State` configuration.\n\t * @param {!function()} validator\n\t * @return {!Object} `State` configuration object.\n\t */\n\tvalidator(validator) {\n\t\treturn mergeConfig(this, {validator});\n\t},\n\n\t/**\n\t * Adds a default value to the `State` configuration.\n\t * @param {*} value\n\t * @return {!Object} `State` configuration object.\n\t */\n\tvalue(value) {\n\t\treturn mergeConfig(this, {value});\n\t}\n};\n\n/**\n * Merges the given config object into the one that has been built so far.\n * @param {!Object} context The object calling this function.\n * @param {!Object} config The object to merge to the built config.\n * @return {!Object} The final object containing the built config.\n */\nfunction mergeConfig(context, config) {\n\tvar obj = context;\n\tif (obj === Config) {\n\t\tobj = Object.create(Config);\n\t\tobj.config = {};\n\t}\n\tobject.mixin(obj.config, config);\n\treturn obj;\n}\n\n// Add all validators to `Config`.\nvar fnNames = Object.keys(validators);\nfnNames.forEach(\n\tname => Config[name] = function() {\n\t\treturn this.validator(validators[name]);\n\t}\n);\n\nexport default Config;\n","'use strict';\n\nimport {\n\tarray,\n\tasync,\n\tisDefAndNotNull,\n\tisFunction,\n\tisObject,\n\tisString,\n\tmergeSuperClassesProperty,\n\tobject\n} from 'metal';\nimport { EventEmitter } from 'metal-events';\n\n/**\n * State adds support for having object properties that can be watched for\n * changes, as well as configured with validators, setters and other options.\n * See the `addToState` method for a complete list of available configuration\n * options for each state key.\n * @extends {EventEmitter}\n */\nclass State extends EventEmitter {\n\t/**\n\t * Constructor function for `State`.\n\t * @param {Object=} opt_config Optional config object with initial values to\n\t *     set state properties to.\n\t * @param {Object=} opt_obj Optional object that should hold the state\n\t *     properties. If none is given, they will be added directly to `this`\n\t *     instead.\n\t * @param {Object=} opt_context Optional context to call functions (like\n\t *     validators and setters) on. Defaults to `this`.\n\t * @param {Object=} opt_commonOpts Optional common option values to be used\n\t *     by all this instance's state properties.\n\t */\n\tconstructor(opt_config, opt_obj, opt_context, opt_commonOpts) {\n\t\tsuper();\n\n\t\t/**\n\t\t * Common option values to be used by all this instance's state properties.\n\t\t * @type {Object}\n\t\t * @protected\n\t\t */\n\t\tthis.commonOpts_ = opt_commonOpts;\n\n\t\t/**\n\t\t * Context to call functions (like validators and setters) on.\n\t\t * @type {!Object}\n\t\t * @protected\n\t\t */\n\t\tthis.context_ = opt_context || this;\n\n\t\t/**\n\t\t * Map of keys that can not be used as state keys.\n\t\t * @type {!Object<string, boolean>}\n\t\t * @protected\n\t\t */\n\t\tthis.keysBlacklist_ = {};\n\n\t\t/**\n\t\t * Object that should hold the state properties.\n\t\t * @type {!Object}\n\t\t * @protected\n\t\t */\n\t\tthis.obj_ = opt_obj || this;\n\n\t\t/**\n\t\t * Object with information about the batch event that is currently\n\t\t * scheduled, or null if none is.\n\t\t * @type {Object}\n\t\t * @protected\n\t\t */\n\t\tthis.scheduledBatchData_ = null;\n\n\t\t/**\n\t\t * Object that contains information about all this instance's state keys.\n\t\t * @type {!Object<string, !Object>}\n\t\t * @protected\n\t\t */\n\t\tthis.stateInfo_ = {};\n\n\t\tthis.setShouldUseFacade(true);\n\t\tthis.mergeInvalidKeys_();\n\t\tthis.addToStateFromStaticHint_(opt_config);\n\t}\n\n\t/**\n\t * Adds the given key to the state.\n\t * @param {string} name The name of the new state key.\n\t * @param {Object.<string, *>=} config The configuration object for the new\n\t *     key. See `addToState` for supported settings.\n\t * @param {*} initialValue The initial value of the new key.\n\t */\n\taddKeyToState(name, config, initialValue) {\n\t\tthis.buildKeyInfo_(name, config, initialValue, arguments.length > 2);\n\t\tObject.defineProperty(\n\t\t\tthis.obj_,\n\t\t\tname,\n\t\t\tthis.buildKeyPropertyDef_(name)\n\t\t);\n\t\tthis.validateInitialValue_(name);\n\t\tthis.assertGivenIfRequired_(name);\n\t}\n\n\t/**\n\t * Adds the given key(s) to the state, together with its(their) configs.\n\t * Config objects support the given settings:\n\t *     required - When set to `true`, causes errors to be printed (via\n\t *     `console.error`) if no value is given for the property.\n\t *\n\t *     setter - Function for normalizing state key values. It receives the new\n\t *     value that was set, and returns the value that should be stored.\n\t *\n\t *     validator - Function that validates state key values. When it returns\n\t *     false, the new value is ignored. When it returns an instance of Error,\n\t *     it will emit the error to the console.\n\t *\n\t *     value - The default value for the state key. Note that setting this to\n\t *     an object will cause all class instances to use the same reference to\n\t *     the object. To have each instance use a different reference for objects,\n\t *     use the `valueFn` option instead.\n\t *\n\t *     valueFn - A function that returns the default value for a state key.\n\t *\n\t *     writeOnce - Ignores writes to the state key after it's been first\n\t *     written to. That is, allows writes only when setting the value for the\n\t *     first time.\n\t * @param {!Object.<string, !Object>|string} configsOrName An object that maps\n\t *     configuration options for keys to be added to the state or the name of\n\t *     a single key to be added.\n\t * @param {Object.<string, *>=} opt_initialValuesOrConfig An object that maps\n\t *     state keys to their initial values. These values have higher precedence\n\t *     than the default values specified in the configurations. If a single\n\t *     key name was passed as the first param instead though, then this should\n\t *     be the configuration object for that key.\n\t * @param {boolean|Object|*=} opt_contextOrInitialValue If the first\n\t *     param passed to this method was a config object, this should be the\n\t *     context where the added state keys will be defined (defaults to `this`),\n\t *     or false if they shouldn't be defined at all. If the first param was a\n\t *     single key name though, this should be its initial value.\n\t */\n\taddToState(configsOrName, opt_initialValuesOrConfig, opt_contextOrInitialValue) {\n\t\tif (isString(configsOrName)) {\n\t\t\treturn this.addKeyToState(...arguments);\n\t\t}\n\n\t\tvar initialValues = opt_initialValuesOrConfig || {};\n\t\tvar names = Object.keys(configsOrName);\n\n\t\tvar props = {};\n\t\tfor (let i = 0; i < names.length; i++) {\n\t\t\tvar name = names[i];\n\t\t\tthis.buildKeyInfo_(\n\t\t\t\tname,\n\t\t\t\tconfigsOrName[name],\n\t\t\t\tinitialValues[name],\n\t\t\t\tinitialValues.hasOwnProperty(name)\n\t\t\t);\n\t\t\tprops[name] = this.buildKeyPropertyDef_(name, opt_contextOrInitialValue);\n\t\t\tthis.assertGivenIfRequired_(name);\n\t\t}\n\n\t\tif (opt_contextOrInitialValue !== false) {\n\t\t\tObject.defineProperties(\n\t\t\t\topt_contextOrInitialValue || this.obj_,\n\t\t\t\tprops\n\t\t\t);\n\t\t}\n\n\t\t// Validate initial values after all properties have been defined, otherwise\n\t\t// it won't be possible to access those properties within validators.\n\t\tfor (let i = 0; i < names.length; i++) {\n\t\t\tthis.validateInitialValue_(names[i]);\n\t\t}\n\t}\n\n\t/**\n\t * Adds state keys from super classes static hint `MyClass.STATE = {};`.\n\t * @param {Object.<string, !Object>=} opt_config An object that maps all the\n\t *     configurations for state keys.\n\t * @protected\n\t */\n\taddToStateFromStaticHint_(opt_config) {\n\t\tvar ctor = this.constructor;\n\t\tvar defineContext;\n\t\tvar merged = State.mergeStateStatic(ctor);\n\t\tif (this.obj_ === this) {\n\t\t\tdefineContext = merged ? ctor.prototype : false;\n\t\t}\n\t\tthis.addToState(ctor.STATE_MERGED, opt_config, defineContext);\n\t}\n\n\t/**\n\t * Logs an error if the given property is required but wasn't given.\n\t * @param {string} name\n\t * @protected\n\t */\n\tassertGivenIfRequired_(name) {\n\t\tvar info = this.stateInfo_[name];\n\t\tif (info.config.required) {\n\t\t\tvar value = info.state === State.KeyStates.INITIALIZED ?\n\t\t\t\tthis.get(name) :\n\t\t\t\tinfo.initialValue;\n\t\t\tif (!isDefAndNotNull(value)) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t'The property called \"' + name + '\" is required but didn\\'t ' +\n\t\t\t\t\t'receive a value.'\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Checks that the given name is a valid state key name. If it's not, an error\n\t * will be thrown.\n\t * @param {string} name The name to be validated.\n\t * @throws {Error}\n\t * @protected\n\t */\n\tassertValidStateKeyName_(name) {\n\t\tif (this.constructor.INVALID_KEYS_MERGED[name] || this.keysBlacklist_[name]) {\n\t\t\tthrow new Error('It\\'s not allowed to create a state key with the name \"' + name + '\".');\n\t\t}\n\t}\n\n\t/**\n\t * Builds the info object for the specified state key.\n\t * @param {string} name The name of the key.\n\t * @param {Object} config The config object for the key.\n\t * @param {*} initialValue The initial value of the key.\n\t * @param {boolean} hasInitialValue Flag indicating if an initial value was\n\t *     given or not (important since `initialValue` can also be `undefined`).\n\t * @protected\n\t */\n\tbuildKeyInfo_(name, config, initialValue, hasInitialValue) {\n\t\tthis.assertValidStateKeyName_(name);\n\t\tconfig = (config && config.config) ? config.config : (config || {});\n\t\tif (this.commonOpts_) {\n\t\t\tconfig = object.mixin({}, config, this.commonOpts_);\n\t\t}\n\t\tthis.stateInfo_[name] = {\n\t\t\tconfig,\n\t\t\tstate: State.KeyStates.UNINITIALIZED\n\t\t};\n\t\tif (hasInitialValue) {\n\t\t\tthis.stateInfo_[name].initialValue = initialValue;\n\t\t}\n\t}\n\n\t/**\n\t * Builds the property definition object for the specified state key.\n\t * @param {string} name The name of the key.\n\t * @param {Object=} opt_context The object where the property will be added.\n\t * @return {!Object}\n\t * @protected\n\t */\n\tbuildKeyPropertyDef_(name, opt_context) {\n\t\tvar stateObj = opt_context === this.constructor.prototype ? null : this;\n\t\treturn {\n\t\t\tconfigurable: true,\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn (stateObj || this).getStateKeyValue_(name);\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\t(stateObj || this).setStateKeyValue_(name, val);\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Calls the requested function, running the appropriate code for when it's\n\t * passed as an actual function object or just the function's name.\n\t * @param {!Function|string} fn Function, or name of the function to run.\n\t * @param {!Array} An optional array of parameters to be passed to the\n\t *   function that will be called.\n\t * @return {*} The return value of the called function.\n\t * @protected\n\t */\n\tcallFunction_(fn, args) {\n\t\tif (isString(fn)) {\n\t\t\treturn this.context_[fn].apply(this.context_, args);\n\t\t} else if (isFunction(fn)) {\n\t\t\treturn fn.apply(this.context_, args);\n\t\t}\n\t}\n\n\t/**\n\t * Calls the state key's setter, if there is one.\n\t * @param {string} name The name of the key.\n\t * @param {*} value The value to be set.\n\t * @param {*} currentValue The current value.\n\t * @return {*} The final value to be set.\n\t * @protected\n\t */\n\tcallSetter_(name, value, currentValue) {\n\t\tvar info = this.stateInfo_[name];\n\t\tvar config = info.config;\n\t\tif (config.setter) {\n\t\t\tvalue = this.callFunction_(config.setter, [value, currentValue]);\n\t\t}\n\t\treturn value;\n\t}\n\n\t/**\n\t * Calls the state key's validator, if there is one. Emits console\n\t * warning if validator returns a string.\n\t * @param {string} name The name of the key.\n\t * @param {*} value The value to be validated.\n\t * @return {boolean} Flag indicating if value is valid or not.\n\t * @protected\n\t */\n\tcallValidator_(name, value) {\n\t\tvar info = this.stateInfo_[name];\n\t\tvar config = info.config;\n\t\tif (config.validator) {\n\t\t\tvar validatorReturn = this.callFunction_(\n\t\t\t\tconfig.validator,\n\t\t\t\t[value, name, this.context_]\n\t\t\t);\n\n\t\t\tif (validatorReturn instanceof Error) {\n\t\t\t\tconsole.error(`Warning: ${validatorReturn}`);\n\t\t\t}\n\t\t\treturn validatorReturn;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Checks if the it's allowed to write on the requested state key.\n\t * @param {string} name The name of the key.\n\t * @return {boolean}\n\t */\n\tcanSetState(name) {\n\t\tvar info = this.stateInfo_[name];\n\t\treturn !info.config.writeOnce || !info.written;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdisposeInternal() {\n\t\tsuper.disposeInternal();\n\t\tthis.stateInfo_ = null;\n\t\tthis.scheduledBatchData_ = null;\n\t}\n\n\t/**\n\t * Emits the state change batch event.\n\t * @protected\n\t */\n\temitBatchEvent_() {\n\t\tif (!this.isDisposed()) {\n\t\t\tvar data = this.scheduledBatchData_;\n\t\t\tthis.scheduledBatchData_ = null;\n\t\t\tthis.emit('stateChanged', data);\n\t\t}\n\t}\n\n\t/**\n\t * Returns the value of the requested state key.\n\t * Note: this can and should be accomplished by accessing the value as a\n\t * regular property. This should only be used in cases where a function is\n\t * actually needed.\n\t * @param {string} name\n\t * @return {*}\n\t */\n\tget(name) {\n\t\treturn this.obj_[name];\n\t}\n\n\t/**\n\t * Returns an object that maps state keys to their values.\n\t * @param {Array<string>=} opt_names A list of names of the keys that should\n\t *   be returned. If none is given, the whole state will be returned.\n\t * @return {Object.<string, *>}\n\t */\n\tgetState(opt_names) {\n\t\tvar state = {};\n\t\tvar names = opt_names || this.getStateKeys();\n\n\t\tfor (var i = 0; i < names.length; i++) {\n\t\t\tstate[names[i]] = this.get(names[i]);\n\t\t}\n\n\t\treturn state;\n\t}\n\n\t/**\n\t * Gets the config object for the requested state key.\n\t * @param {string} name The key's name.\n\t * @return {Object}\n\t * @protected\n\t */\n\tgetStateKeyConfig(name) {\n\t\treturn (this.stateInfo_[name] || {}).config;\n\t}\n\n\t/**\n\t * Returns an array with all state keys.\n\t * @return {!Array.<string>}\n\t */\n\tgetStateKeys() {\n\t\treturn this.stateInfo_ ? Object.keys(this.stateInfo_) : [];\n\t}\n\n\t/**\n\t * Gets the value of the specified state key. This is passed as that key's\n\t * getter to the `Object.defineProperty` call inside the `addKeyToState` method.\n\t * @param {string} name The name of the key.\n\t * @return {*}\n\t * @protected\n\t */\n\tgetStateKeyValue_(name) {\n\t\tif (!this.warnIfDisposed_(name)) {\n\t\t\tthis.initStateKey_(name);\n\t\t\treturn this.stateInfo_[name].value;\n\t\t}\n\t}\n\n\t/**\n\t * Checks if the value of the state key with the given name has already been\n\t * set. Note that this doesn't run the key's getter.\n\t * @param {string} name The name of the key.\n\t * @return {boolean}\n\t */\n\thasBeenSet(name) {\n\t\tvar info = this.stateInfo_[name];\n\t\treturn info.state === State.KeyStates.INITIALIZED ||\n\t\t\tthis.hasInitialValue_(name);\n\t}\n\n\t/**\n\t * Checks if an initial value was given to the specified state property.\n\t * @param {string} name The name of the key.\n\t * @return {boolean}\n\t * @protected\n\t */\n\thasInitialValue_(name) {\n\t\treturn this.stateInfo_[name].hasOwnProperty('initialValue');\n\t}\n\n\t/**\n\t * Checks if the given key is present in this instance's state.\n\t * @param {string} key\n\t * @return {boolean}\n\t */\n\thasStateKey(key) {\n\t\tif (!this.warnIfDisposed_(key)) {\n\t\t\treturn !!this.stateInfo_[key];\n\t\t}\n\t}\n\n\t/**\n\t * Informs of changes to a state key's value through an event. Won't trigger\n\t * the event if the value hasn't changed or if it's being initialized.\n\t * @param {string} name The name of the key.\n\t * @param {*} prevVal The previous value of the key.\n\t * @protected\n\t */\n\tinformChange_(name, prevVal) {\n\t\tif (this.shouldInformChange_(name, prevVal)) {\n\t\t\tvar data = {\n\t\t\t\tkey: name,\n\t\t\t\tnewVal: this.get(name),\n\t\t\t\tprevVal: prevVal\n\t\t\t};\n\t\t\tthis.emit(name + 'Changed', data);\n\t\t\tthis.emit('stateKeyChanged', data);\n\t\t\tthis.scheduleBatchEvent_(data);\n\t\t}\n\t}\n\n\t/**\n\t * Initializes the specified state key, giving it a first value.\n\t * @param {string} name The name of the key.\n\t * @protected\n\t */\n\tinitStateKey_(name) {\n\t\tvar info = this.stateInfo_[name];\n\t\tif (info.state !== State.KeyStates.UNINITIALIZED) {\n\t\t\treturn;\n\t\t}\n\n\t\tinfo.state = State.KeyStates.INITIALIZING;\n\t\tthis.setInitialValue_(name);\n\t\tif (!info.written) {\n\t\t\tthis.setDefaultValue(name);\n\t\t}\n\t\tinfo.state = State.KeyStates.INITIALIZED;\n\t}\n\n\t/**\n\t * Merges an array of values for the STATE property into a single object.\n\t * @param {!Array} values The values to be merged.\n\t * @return {!Object} The merged value.\n\t * @static\n\t */\n\tstatic mergeState(values) {\n\t\treturn object.mixin.apply(null, [{}].concat(values.reverse()));\n\t}\n\n\t/**\n\t * Merges the STATE static variable for the given constructor function.\n\t * @param  {!Function} ctor Constructor function.\n\t * @return {boolean} Returns true if merge happens, false otherwise.\n\t * @static\n\t */\n\tstatic mergeStateStatic(ctor) {\n\t\treturn mergeSuperClassesProperty(ctor, 'STATE', State.mergeState);\n\t}\n\n\t/**\n\t * Merges the values of the `INVALID_KEYS` static for the whole hierarchy of\n\t * the current instance.\n\t * @protected\n\t */\n\tmergeInvalidKeys_() {\n\t\tmergeSuperClassesProperty(this.constructor, 'INVALID_KEYS', function(values) {\n\t\t\treturn array.flatten(values).reduce(function(merged, val) {\n\t\t\t\tif (val) {\n\t\t\t\t\tmerged[val] = true;\n\t\t\t\t}\n\t\t\t\treturn merged;\n\t\t\t}, {});\n\t\t});\n\t}\n\n\t/**\n\t * Removes the requested state key.\n\t * @param {string} name The name of the key.\n\t */\n\tremoveStateKey(name) {\n\t\tthis.stateInfo_[name] = null;\n\t\tdelete this.obj_[name];\n\t}\n\n\t/**\n\t * Schedules a state change batch event to be emitted asynchronously.\n\t * @param {!Object} changeData Information about a state key's update.\n\t * @protected\n\t */\n\tscheduleBatchEvent_(changeData) {\n\t\tif (!this.scheduledBatchData_) {\n\t\t\tasync.nextTick(this.emitBatchEvent_, this);\n\t\t\tthis.scheduledBatchData_ = {\n\t\t\t\tchanges: {}\n\t\t\t};\n\t\t}\n\n\t\tvar name = changeData.key;\n\t\tvar changes = this.scheduledBatchData_.changes;\n\t\tif (changes[name]) {\n\t\t\tchanges[name].newVal = changeData.newVal;\n\t\t} else {\n\t\t\tchanges[name] = changeData;\n\t\t}\n\t}\n\n\t/**\n\t * Sets the value of the requested state key.\n\t * Note: this can and should be accomplished by setting the state key as a\n\t * regular property. This should only be used in cases where a function is\n\t * actually needed.\n\t * @param {string} name\n\t * @param {*} value\n\t * @return {*}\n\t */\n\tset(name, value) {\n\t\tif (this.hasStateKey(name)) {\n\t\t\tthis.obj_[name] = value;\n\t\t}\n\t}\n\n\t/**\n\t * Sets the default value of the requested state key.\n\t * @param {string} name The name of the key.\n\t * @return {*}\n\t */\n\tsetDefaultValue(name) {\n\t\tvar config = this.stateInfo_[name].config;\n\n\t\tif (config.value !== undefined) {\n\t\t\tthis.set(name, config.value);\n\t\t} else {\n\t\t\tthis.set(name, this.callFunction_(config.valueFn));\n\t\t}\n\t}\n\n\t/**\n\t * Sets the initial value of the requested state key.\n\t * @param {string} name The name of the key.\n\t * @return {*}\n\t * @protected\n\t */\n\tsetInitialValue_(name) {\n\t\tif (this.hasInitialValue_(name)) {\n\t\t\tvar info = this.stateInfo_[name];\n\t\t\tthis.set(name, info.initialValue);\n\t\t\tinfo.initialValue = undefined;\n\t\t}\n\t}\n\n\t/**\n\t * Sets a map of keys that are not valid state keys.\n\t * @param {!Object<string, boolean>}\n\t */\n\tsetKeysBlacklist_(blacklist) {\n\t\tthis.keysBlacklist_ = blacklist;\n\t}\n\n\t/**\n\t * Sets the value of all the specified state keys.\n\t * @param {!Object.<string,*>} values A map of state keys to the values they\n\t *   should be set to.\n\t * @param {function()=} opt_callback An optional function that will be run\n\t *   after the next batched update is triggered.\n\t */\n\tsetState(values, opt_callback) {\n\t\tObject.keys(values).forEach(name => this.set(name, values[name]));\n\t\tif (opt_callback && this.scheduledBatchData_) {\n\t\t\tthis.once('stateChanged', opt_callback);\n\t\t}\n\t}\n\n\t/**\n\t * Sets the value of the specified state key. This is passed as that key's\n\t * setter to the `Object.defineProperty` call inside the `addKeyToState`\n\t * method.\n\t * @param {string} name The name of the key.\n\t * @param {*} value The new value of the key.\n\t * @protected\n\t */\n\tsetStateKeyValue_(name, value) {\n\t\tif (this.warnIfDisposed_(name) ||\n\t\t\t!this.canSetState(name) ||\n\t\t\t!this.validateKeyValue_(name, value)) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar info = this.stateInfo_[name];\n\t\tif (!this.hasInitialValue_(name) && info.state === State.KeyStates.UNINITIALIZED) {\n\t\t\tinfo.state = State.KeyStates.INITIALIZED;\n\t\t}\n\n\t\tvar prevVal = this.get(name);\n\t\tinfo.value = this.callSetter_(name, value, prevVal);\n\t\tthis.assertGivenIfRequired_(name);\n\t\tinfo.written = true;\n\t\tthis.informChange_(name, prevVal);\n\t}\n\n\t/**\n\t * Checks if we should inform about a state update. Updates are ignored during\n\t * state initialization. Otherwise, updates to primitive values are only\n\t * informed when the new value is different from the previous one. Updates to\n\t * objects (which includes functions and arrays) are always informed outside\n\t * initialization though, since we can't be sure if all of the internal data\n\t * has stayed the same.\n\t * @param {string} name The name of the key.\n\t * @param {*} prevVal The previous value of the key.\n\t * @return {boolean}\n\t * @protected\n\t */\n\tshouldInformChange_(name, prevVal) {\n\t\tvar info = this.stateInfo_[name];\n\t\treturn (info.state === State.KeyStates.INITIALIZED) &&\n\t\t\t(isObject(prevVal) || prevVal !== this.get(name));\n\t}\n\n\t/**\n\t * Validates the initial value for the state property with the given name.\n\t * @param {string} name\n\t * @protected\n\t */\n\tvalidateInitialValue_(name) {\n\t\tvar info = this.stateInfo_[name];\n\t\tif (this.hasInitialValue_(name) && !this.callValidator_(name, info.initialValue)) {\n\t\t\tdelete info.initialValue;\n\t\t}\n\t}\n\n\t/**\n\t * Validates the state key's value, which includes calling the validator\n\t * defined in the key's configuration object, if there is one.\n\t * @param {string} name The name of the key.\n\t * @param {*} value The value to be validated.\n\t * @return {boolean} Flag indicating if value is valid or not.\n\t * @protected\n\t */\n\tvalidateKeyValue_(name, value) {\n\t\tvar info = this.stateInfo_[name];\n\n\t\treturn info.state === State.KeyStates.INITIALIZING ||\n\t\t\tthis.callValidator_(name, value);\n\t}\n\n\t/**\n\t * Warns if this instance has already been disposed.\n\t * @param {string} name Name of the property to be accessed if not disposed.\n\t * @return {boolean} True if disposed, or false otherwise.\n\t * @protected\n\t */\n\twarnIfDisposed_(name) {\n\t\tconst disposed = this.isDisposed();\n\t\tif (disposed) {\n\t\t\tconsole.warn(\n\t\t\t\t`Error. Trying to access property \"${name}\" on disposed instance`\n\t\t\t);\n\t\t}\n\t\treturn disposed;\n\t}\n}\n\n/**\n * A list with state key names that will automatically be rejected as invalid.\n * Subclasses can define their own invalid keys by setting this static on their\n * constructors, which will be merged together and handled automatically.\n * @type {!Array<string>}\n */\nState.INVALID_KEYS = ['state', 'stateKey'];\n\n/**\n * Constants that represent the states that a state key can be in.\n * @type {!Object}\n */\nState.KeyStates = {\n\tUNINITIALIZED: 0,\n\tINITIALIZING: 1,\n\tINITIALIZED: 2\n};\n\nexport default State;\n","'use strict';\n\nimport validators from '../validators';\nimport Config from '../Config';\nimport State from '../State';\n\nexport default State;\nexport { validators, Config, State };\n","'use strict';\n\nimport { array, mergeSuperClassesProperty, object } from 'metal';\nimport { EventEmitter, EventEmitterProxy } from 'metal-events';\nimport State from 'metal-state';\n\nclass ComponentDataManager extends EventEmitter {\n\t/**\n\t * Constructor for `ComponentDataManager`.\n\t * @param {!Component} component\n\t * @param {!Object} data\n\t */\n\tconstructor(component, data) {\n\t\tsuper();\n\t\tthis.component_ = component;\n\n\t\tmergeSuperClassesProperty(\n\t\t\tthis.constructor,\n\t\t\t'BLACKLIST',\n\t\t\tarray.firstDefinedValue\n\t\t);\n\t\tState.mergeStateStatic(this.component_.constructor);\n\n\t\tthis.createState_(data, this.component_);\n\t}\n\n\t/**\n\t * Adds a state property to the component.\n\t * @param {string} name\n\t * @param {!Object} config\n\t * @param {*} opt_initialValue\n\t */\n\tadd() {\n\t\tthis.state_.addToState(...arguments);\n\t}\n\n\t/**\n\t * Builds the configuration data that will be passed to the `State` instance.\n\t * @param {!Object} data\n\t * @return {!Object}\n\t * @protected\n\t */\n\tbuildStateInstanceData_(data) {\n\t\treturn object.mixin({}, data, this.component_.constructor.STATE_MERGED);\n\t}\n\n\t/**\n\t * Creates the `State` instance that will handle the main component data.\n\t * @param {!Object} data\n\t * @param {!Object} holder The object that should hold the data properties.\n\t * @protected\n\t */\n\tcreateState_(data, holder) {\n\t\tconst state = new State({}, holder, this.component_);\n\t\tstate.setKeysBlacklist_(this.constructor.BLACKLIST_MERGED);\n\t\tstate.addToState(\n\t\t\tthis.buildStateInstanceData_(data),\n\t\t\tthis.component_.getInitialConfig()\n\t\t);\n\n\t\tconst listener = this.emit_.bind(this);\n\t\tstate.on('stateChanged', listener);\n\t\tstate.on('stateKeyChanged', listener);\n\t\tthis.state_ = state;\n\n\t\tthis.proxy_ = new EventEmitterProxy(state, this.component_);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdisposeInternal() {\n\t\tsuper.disposeInternal();\n\n\t\tthis.state_.dispose();\n\t\tthis.state_ = null;\n\n\t\tthis.proxy_.dispose();\n\t\tthis.proxy_ = null;\n\t}\n\n\t/**\n\t * Emits the specified event.\n\t * @param {!Object} data\n\t * @param {!Object} event\n\t * @protected\n\t */\n\temit_(data, event) {\n\t\tconst orig = event.type;\n\t\tconst name = orig === 'stateChanged' ? 'dataChanged' : 'dataPropChanged';\n\t\tthis.emit(name, data);\n\t}\n\n\t/**\n\t * Gets the data with the given name.\n\t * @param {string} name\n\t * @return {*}\n\t */\n\tget(name) {\n\t\treturn this.state_.get(name);\n\t}\n\n\t/**\n\t * Gets the keys for state data that can be synced via `sync` functions.\n\t * @return {!Array<string>}\n\t */\n\tgetSyncKeys() {\n\t\treturn this.state_.getStateKeys();\n\t}\n\n\t/**\n\t * Gets the keys for state data.\n\t * @return {!Array<string>}\n\t */\n\tgetStateKeys() {\n\t\treturn this.state_.getStateKeys();\n\t}\n\n\t/**\n\t * Gets the whole state data.\n\t * @return {!Object}\n\t */\n\tgetState() {\n\t\treturn this.state_.getState();\n\t}\n\n\t/**\n\t * Gets the `State` instance being used.\n\t * @return {!Object}\n\t */\n\tgetStateInstance() {\n\t\treturn this.state_;\n\t}\n\n\t/**\n\t * Updates all non internal data with the given values (or to the default\n\t * value if none is given).\n\t * @param {!Object} data\n\t */\n\treplaceNonInternal(data) {\n\t\tComponentDataManager.replaceNonInternal(data, this.state_);\n\t}\n\n\t/**\n\t * Updates all non internal data with the given values (or to the default\n\t * value if none is given).\n\t * @param {!Object} data\n\t * @param {!State} state\n\t */\n\tstatic replaceNonInternal(data, state) {\n\t\tconst keys = state.getStateKeys();\n\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\tconst key = keys[i];\n\t\t\tif (!state.getStateKeyConfig(key).internal) {\n\t\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\t\tstate.set(key, data[key]);\n\t\t\t\t} else {\n\t\t\t\t\tstate.setDefaultValue(key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Sets the value of all the specified state keys.\n\t * @param {!Object.<string,*>} values A map of state keys to the values they\n\t *   should be set to.\n\t * @param {function()=} opt_callback An optional function that will be run\n\t *   after the next batched update is triggered.\n\t */\n\tsetState(state, opt_callback) {\n\t\tthis.state_.setState(state, opt_callback);\n\t}\n}\n\nComponentDataManager.BLACKLIST = {\n\tcomponents: true,\n\tcontext: true,\n\telement: true,\n\trefs: true,\n\twasRendered: true\n};\n\nexport default ComponentDataManager;\n","'use strict';\n\nimport { EventEmitter, EventHandler } from 'metal-events';\n\n/**\n * Base class that component renderers should extend from. It defines the\n * required methods all renderers should have.\n */\nclass ComponentRenderer extends EventEmitter {\n\t/**\n\t * Constructor function for `ComponentRenderer`.\n\t * @param {!Component} component The component that this renderer is\n\t *     responsible for.\n\t */\n\tconstructor(component) {\n\t\tsuper();\n\t\tthis.component_ = component;\n\n\t\tthis.componentRendererEvents_ = new EventHandler();\n\t\tthis.componentRendererEvents_.add(\n\t\t\tthis.component_.once('render', this.render.bind(this))\n\t\t);\n\t\tthis.on('rendered', this.handleRendered_);\n\t\tcomponent.on('dataManagerCreated', this.handleDataManagerCreated_.bind(this));\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdisposeInternal() {\n\t\tthis.componentRendererEvents_.removeAllListeners();\n\t\tthis.componentRendererEvents_ = null;\n\t}\n\n\t/**\n\t * Returns this renderer's component.\n\t * @return {!Component}\n\t */\n\tgetComponent() {\n\t\treturn this.component_;\n\t}\n\n\t/**\n\t * Handles a `dataManagerCreated` event from the component. Listens to events\n\t * on the manager that has been created.\n\t * @protected\n\t */\n\thandleDataManagerCreated_() {\n\t\tconst manager = this.component_.getDataManager();\n\t\tif (this.component_.constructor.SYNC_UPDATES_MERGED) {\n\t\t\tthis.componentRendererEvents_.add(\n\t\t\t\tmanager.on(\n\t\t\t\t\t'dataPropChanged',\n\t\t\t\t\tthis.handleManagerDataPropChanged_.bind(this)\n\t\t\t\t)\n\t\t\t);\n\t\t} else {\n\t\t\tthis.componentRendererEvents_.add(\n\t\t\t\tmanager.on(\n\t\t\t\t\t'dataChanged',\n\t\t\t\t\tthis.handleManagerDataChanged_.bind(this)\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Handles a `dataChanged` event from the component's data manager. Calls the\n\t * `update` function if the component has already been rendered for the first\n\t * time.\n\t * @param {!Object<string, Object>} changes Object containing the names\n\t *     of all changed state keys, each mapped to an object with its new\n\t *     (newVal) and previous (prevVal) values.\n\t * @protected\n\t */\n\thandleManagerDataChanged_(changes) {\n\t\tif (this.shouldRerender_()) {\n\t\t\tthis.update(changes);\n\t\t}\n\t}\n\n\t/**\n\t * Handles a `dataPropChanged` event from the component's data manager. This\n\t * is similar to `handleManagerDataChanged_`, but only called for\n\t * components that have requested updates to happen synchronously.\n\t * @param {!{key: string, newVal: *, prevVal: *}} data\n\t * @protected\n\t */\n\thandleManagerDataPropChanged_(data) {\n\t\tif (this.shouldRerender_()) {\n\t\t\tthis.update({\n\t\t\t\tchanges: {\n\t\t\t\t\t[data.key]: data\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Handles the \"rendered\" event.\n\t * @protected\n\t */\n\thandleRendered_() {\n\t\tthis.isRendered_ = true;\n\t}\n\n\t/**\n\t * Renders the component's whole content (including its main element).\n\t */\n\trender() {\n\t\tif (!this.component_.element) {\n\t\t\tthis.component_.element = document.createElement('div');\n\t\t}\n\t\tthis.emit('rendered', !this.isRendered_);\n\t}\n\n\t/**\n\t * Checks if changes should cause a rerender right now.\n\t * @return {boolean}\n\t * @protected\n\t */\n\tshouldRerender_() {\n\t\treturn this.isRendered_ && !this.skipUpdates_;\n\t}\n\n\t/**\n\t * Skips updates until `stopSkipUpdates` is called.\n\t */\n\tstartSkipUpdates() {\n\t\tthis.skipUpdates_ = true;\n\t}\n\n\t/**\n\t * Stops skipping updates.\n\t */\n\tstopSkipUpdates() {\n\t\tthis.skipUpdates_ = false;\n\t}\n\n\t/**\n\t * Updates the component's element html. This is automatically called when\n\t * the value of at least one of the component's state keys has changed.\n\t * @param {Object.<string, Object>} changes Object containing the names\n\t *     of all changed state keys, each mapped to an object with its new\n\t *     (newVal) and previous (prevVal) values.\n\t */\n\tupdate() {}\n}\n\nexport default ComponentRenderer;\n","'use strict';\n\nimport {\n\tarray,\n\tgetFunctionName,\n\tisBoolean,\n\tisDefAndNotNull,\n\tisElement,\n\tisFunction,\n\tisObject,\n\tisString,\n\tmergeSuperClassesProperty,\n\tobject\n} from 'metal';\nimport { DomEventEmitterProxy, toElement } from 'metal-dom';\nimport ComponentDataManager from './ComponentDataManager';\nimport ComponentRenderer from './ComponentRenderer';\nimport { EventEmitter, EventHandler } from 'metal-events';\n\n/**\n * Component collects common behaviors to be followed by UI components, such\n * as Lifecycle, CSS classes management, events encapsulation and support for\n * different types of rendering.\n * Rendering logic can be done by either:\n *     - Listening to the `render` event inside the `created` lifecycle function\n *       and adding the rendering logic to the listener.\n *     - Using an existing implementation of `ComponentRenderer` like `Soy`,\n *       and following its patterns.\n *     - Building your own implementation of a `ComponentRenderer`.\n * Specifying the renderer that will be used can be done by setting the RENDERER\n * static variable to the renderer's constructor function.\n *\n * Example:\n *\n * <code>\n * class CustomComponent extends Component {\n *   constructor(config) {\n *     super(config);\n *   }\n *\n *   created() {\n *   }\n *\n *   rendered() {\n *   }\n *\n *   attached() {\n *   }\n *\n *   detached() {\n *   }\n * }\n *\n * CustomComponent.RENDERER = MyRenderer;\n *\n * CustomComponent.STATE = {\n *   title: { value: 'Title' },\n *   fontSize: { value: '10px' }\n * };\n * </code>\n *\n * @extends {State}\n */\nclass Component extends EventEmitter {\n\t/**\n\t * Constructor function for `Component`.\n\t * @param {Object=} opt_config An object with the initial values for this\n\t *     component's state.\n\t * @param {boolean|string|Element=} opt_parentElement The element where the\n\t *     component should be rendered. Can be given as a selector or an element.\n\t *     If `false` is passed, the component won't be rendered automatically\n\t *     after created.\n\t * @constructor\n\t */\n\tconstructor(opt_config, opt_parentElement) {\n\t\tsuper();\n\n\t\t/**\n\t\t * All listeners that were attached until the `DomEventEmitterProxy` instance\n\t\t * was created.\n\t\t * @type {!Object<string, bool>}\n\t\t * @protected\n\t\t */\n\t\tthis.attachedListeners_ = {};\n\n\t\t/**\n\t\t * Gets all nested components.\n\t\t * @type {!Array<!Component>}\n\t\t */\n\t\tthis.components = {};\n\n\t\t/**\n\t\t * Instance of `DomEventEmitterProxy` which proxies events from the component's\n\t\t * element to the component itself.\n\t\t * @type {DomEventEmitterProxy}\n\t\t * @protected\n\t\t */\n\t\tthis.elementEventProxy_ = null;\n\n\t\t/**\n\t\t * The `EventHandler` instance for events attached from the `events` state key.\n\t\t * @type {!EventHandler}\n\t\t * @protected\n\t\t */\n\t\tthis.eventsStateKeyHandler_ = new EventHandler();\n\n\t\t/**\n\t\t * Whether the element is in document.\n\t\t * @type {boolean}\n\t\t */\n\t\tthis.inDocument = false;\n\n\t\t/**\n\t\t * The initial config option passed to this constructor.\n\t\t * @type {!Object}\n\t\t * @protected\n\t\t */\n\t\tthis.initialConfig_ = opt_config || {};\n\n\t\t/**\n\t\t * Whether the element was rendered.\n\t\t * @type {boolean}\n\t\t */\n\t\tthis.wasRendered = false;\n\n\t\t/**\n\t\t * The component's element will be appended to the element this variable is\n\t\t * set to, unless the user specifies another parent when calling `render` or\n\t\t * `attach`.\n\t\t * @type {!Element}\n\t\t */\n\t\tthis.DEFAULT_ELEMENT_PARENT = document.body;\n\n\t\tmergeSuperClassesProperty(this.constructor, 'ELEMENT_CLASSES', this.mergeElementClasses_);\n\t\tmergeSuperClassesProperty(this.constructor, 'SYNC_UPDATES', array.firstDefinedValue);\n\n\t\tthis.element = this.initialConfig_.element;\n\n\t\tthis.renderer_ = this.createRenderer();\n\t\tthis.renderer_.on('rendered', this.handleRendererRendered_.bind(this));\n\n\t\tthis.dataManager_ = this.createDataManager();\n\t\tthis.emit('dataManagerCreated');\n\n\t\tthis.on('stateChanged', this.handleStateChanged_);\n\t\tthis.newListenerHandle_ = this.on('newListener', this.handleNewListener_);\n\t\tthis.on('eventsChanged', this.onEventsChanged_);\n\t\tthis.addListenersFromObj_(this.dataManager_.get('events'));\n\n\t\tthis.created();\n\t\tthis.componentCreated_ = true;\n\t\tif (opt_parentElement !== false) {\n\t\t\tthis.render_(opt_parentElement);\n\t\t}\n\t\tthis.on('elementChanged', this.onElementChanged_);\n\t}\n\n\t/**\n\t * Getter logic for the element property.\n\t * @return {Element}\n\t */\n\tget element() {\n\t\treturn this.elementVal_;\n\t}\n\n\t/**\n\t * Adds the listeners specified in the given object.\n\t * @param {Object} events\n\t * @protected\n\t */\n\taddListenersFromObj_(events) {\n\t\tvar eventNames = Object.keys(events || {});\n\t\tfor (var i = 0; i < eventNames.length; i++) {\n\t\t\tvar info = this.extractListenerInfo_(events[eventNames[i]]);\n\t\t\tif (info.fn) {\n\t\t\t\tvar handler;\n\t\t\t\tif (info.selector) {\n\t\t\t\t\thandler = this.delegate(eventNames[i], info.selector, info.fn);\n\t\t\t\t} else {\n\t\t\t\t\thandler = this.on(eventNames[i], info.fn);\n\t\t\t\t}\n\t\t\t\tthis.eventsStateKeyHandler_.add(handler);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Invokes the attached Lifecycle. When attached, the component element is\n\t * appended to the DOM and any other action to be performed must be\n\t * implemented in this method, such as, binding DOM events. A component can\n\t * be re-attached multiple times.\n\t * @param {(string|Element)=} opt_parentElement Optional parent element\n\t *     to render the component.\n\t * @param {(string|Element)=} opt_siblingElement Optional sibling element\n\t *     to render the component before it. Relevant when the component needs\n\t *     to be rendered before an existing element in the DOM.\n\t * @protected\n\t * @chainable\n\t */\n\tattach(opt_parentElement, opt_siblingElement) {\n\t\tif (!this.inDocument) {\n\t\t\tthis.renderElement_(opt_parentElement, opt_siblingElement);\n\t\t\tthis.inDocument = true;\n\t\t\tthis.emit('attached', {\n\t\t\t\tparent: opt_parentElement,\n\t\t\t\tsibling: opt_siblingElement\n\t\t\t});\n\t\t\tthis.attached();\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Lifecycle. When attached, the component element is appended to the DOM\n\t * and any other action to be performed must be implemented in this method,\n\t * such as, binding DOM events. A component can be re-attached multiple\n\t * times, therefore the undo behavior for any action performed in this phase\n\t * must be implemented on the detach phase.\n\t */\n\tattached() {}\n\n\t/**\n\t * Adds the given sub component, replacing any existing one with the same ref.\n\t * @param {string} ref\n\t * @param {!Component} component\n\t */\n\taddSubComponent(ref, component) {\n\t\tthis.components[ref] = component;\n\t}\n\n\t/**\n\t * Lifecycle. This is called when the component has just been created, before\n\t * it's rendered.\n\t */\n\tcreated() {}\n\n\t/**\n\t * Creates the data manager for this component. Sub classes can override this\n\t * to return a custom manager as needed.\n\t * @return {!ComponentDataManager}\n\t */\n\tcreateDataManager() {\n\t\tmergeSuperClassesProperty(this.constructor, 'DATA_MANAGER', array.firstDefinedValue);\n\t\treturn new this.constructor.DATA_MANAGER_MERGED(this, Component.DATA);\n\t}\n\n\t/**\n\t * Creates the renderer for this component. Sub classes can override this to\n\t * return a custom renderer as needed.\n\t * @return {!ComponentRenderer}\n\t */\n\tcreateRenderer() {\n\t\tmergeSuperClassesProperty(this.constructor, 'RENDERER', array.firstDefinedValue);\n\t\treturn new this.constructor.RENDERER_MERGED(this);\n\t}\n\n\t/**\n\t * Listens to a delegate event on the component's element.\n\t * @param {string} eventName The name of the event to listen to.\n\t * @param {string} selector The selector that matches the child elements that\n\t *   the event should be triggered for.\n\t * @param {!function(!Object)} callback Function to be called when the event is\n\t *   triggered. It will receive the normalized event object.\n\t * @return {!EventHandle} Can be used to remove the listener.\n\t */\n\tdelegate(eventName, selector, callback) {\n\t\treturn this.on('delegate:' + eventName + ':' + selector, callback);\n\t}\n\n\t/**\n\t * Invokes the detached Lifecycle. When detached, the component element is\n\t * removed from the DOM and any other action to be performed must be\n\t * implemented in this method, such as, unbinding DOM events. A component\n\t * can be detached multiple times.\n\t * @chainable\n\t */\n\tdetach() {\n\t\tif (this.inDocument) {\n\t\t\tif (this.element && this.element.parentNode) {\n\t\t\t\tthis.element.parentNode.removeChild(this.element);\n\t\t\t}\n\t\t\tthis.inDocument = false;\n\t\t\tthis.detached();\n\t\t}\n\t\tthis.emit('detached');\n\t\treturn this;\n\t}\n\n\t/**\n\t * Lifecycle. When detached, the component element is removed from the DOM\n\t * and any other action to be performed must be implemented in this method,\n\t * such as, unbinding DOM events. A component can be detached multiple\n\t * times, therefore the undo behavior for any action performed in this phase\n\t * must be implemented on the attach phase.\n\t */\n\tdetached() {}\n\n\t/**\n\t * Lifecycle. Called when the component is disposed. Should be overridden by\n\t * sub classes to dispose of any internal data or events.\n\t */\n\tdisposed() {}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdisposeInternal() {\n\t\tthis.disposed();\n\n\t\tthis.detach();\n\n\t\tif (this.elementEventProxy_) {\n\t\t\tthis.elementEventProxy_.dispose();\n\t\t\tthis.elementEventProxy_ = null;\n\t\t}\n\n\t\tthis.disposeSubComponents(Object.keys(this.components));\n\t\tthis.components = null;\n\n\t\tthis.dataManager_.dispose();\n\t\tthis.dataManager_ = null;\n\n\t\tthis.renderer_.dispose();\n\t\tthis.renderer_ = null;\n\n\t\tsuper.disposeInternal();\n\t}\n\n\t/**\n\t * Calls `dispose` on all subcomponents.\n\t * @param {!Array<string>} keys\n\t */\n\tdisposeSubComponents(keys) {\n\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\tvar component = this.components[keys[i]];\n\t\t\tif (component && !component.isDisposed()) {\n\t\t\t\tcomponent.element = null;\n\t\t\t\tcomponent.dispose();\n\t\t\t\tdelete this.components[keys[i]];\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Extracts listener info from the given value.\n\t * @param {function()|string|{selector:string,fn:function()|string}} value\n\t * @return {!{selector:string,fn:function()}}\n\t * @protected\n\t */\n\textractListenerInfo_(value) {\n\t\tvar info = {\n\t\t\tfn: value\n\t\t};\n\t\tif (isObject(value) && !isFunction(value)) {\n\t\t\tinfo.selector = value.selector;\n\t\t\tinfo.fn = value.fn;\n\t\t}\n\t\tif (isString(info.fn)) {\n\t\t\tinfo.fn = this.getListenerFn(info.fn);\n\t\t}\n\t\treturn info;\n\t}\n\n\t/**\n\t * Gets the `ComponentDataManager` instance being used.\n\t * @return {!ComponentDataManager}\n\t */\n\tgetDataManager() {\n\t\treturn this.dataManager_;\n\t}\n\n\t/**\n\t * Gets the configuration object that was passed to this component's constructor.\n\t * @return {!Object}\n\t */\n\tgetInitialConfig() {\n\t\treturn this.initialConfig_;\n\t}\n\n\t/**\n\t * Gets the listener function from its name. If the name is prefixed with a\n\t * component id, the function will be called on that specified component. Otherwise\n\t * it will be called on this component instead.\n\t * @param {string} fnName\n\t * @return {function()}\n\t */\n\tgetListenerFn(fnName) {\n\t\tif (isFunction(this[fnName])) {\n\t\t\treturn this[fnName].bind(this);\n\t\t} else {\n\t\t\tconsole.error('No function named \"' + fnName + '\" was found in the ' +\n\t\t\t\t'component \"' + getFunctionName(this.constructor) + '\". Make ' +\n\t\t\t\t'sure that you specify valid function names when adding inline listeners.'\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Gets state data for this component.\n\t * @return {!Object}\n\t */\n\tgetState() {\n\t\treturn this.dataManager_.getState();\n\t}\n\n\t/**\n\t * Gets the keys for the state data.\n\t * @return {!Array<string>}\n\t */\n\tgetStateKeys() {\n\t\treturn this.dataManager_.getStateKeys();\n\t}\n\n\t/**\n\t * Calls the synchronization function for the state key.\n\t * @param {string} key\n\t * @param {Object.<string, Object>=} opt_change Object containing newVal and\n\t *     prevVal keys.\n\t * @protected\n\t */\n\tfireStateKeyChange_(key, opt_change) {\n\t\tvar fn = this['sync' + key.charAt(0).toUpperCase() + key.slice(1)];\n\t\tif (isFunction(fn)) {\n\t\t\tif (!opt_change) {\n\t\t\t\tvar manager = this.getDataManager();\n\t\t\t\topt_change = {\n\t\t\t\t\tnewVal: manager.get(key),\n\t\t\t\t\tprevVal: undefined\n\t\t\t\t};\n\t\t\t}\n\t\t\tfn.call(this, opt_change.newVal, opt_change.prevVal);\n\t\t}\n\t}\n\n\t/**\n\t * Gets the `ComponentRenderer` instance being used.\n\t * @return {!ComponentRenderer}\n\t */\n\tgetRenderer() {\n\t\treturn this.renderer_;\n\t}\n\n\t/**\n\t * Handles a `rendered` event from the current renderer instance.\n\t * @param {!Object}\n\t * @protected\n\t */\n\thandleRendererRendered_(data) {\n\t\tthis.rendered(data);\n\t\tthis.emit('rendered', data);\n\t}\n\n\t/**\n\t * Handles state batch changes. Calls any existing `sync` functions that\n\t * match the changed state keys.\n\t * @param {Event} event\n\t * @protected\n\t */\n\thandleStateChanged_(event) {\n\t\tthis.syncStateFromChanges_(event.changes);\n\t\tthis.emit('stateSynced', event);\n\t}\n\n\t/**\n\t * Handles the `newListener` event. Just flags that this event type has been\n\t * attached, so we can start proxying it when `DomEventEmitterProxy` is created.\n\t * @param {string} event\n\t * @protected\n\t */\n\thandleNewListener_(event) {\n\t\tthis.attachedListeners_[event] = true;\n\t}\n\n\t/**\n\t * Checks if the given function is a component constructor.\n\t * @param {!function()} fn Any function\n\t * @return {boolean}\n\t */\n\tstatic isComponentCtor(fn) {\n\t\treturn fn.prototype && fn.prototype[Component.COMPONENT_FLAG];\n\t}\n\n\t/**\n\t * Merges an array of values for the ELEMENT_CLASSES property into a single object.\n\t * @param {!Array.<string>} values The values to be merged.\n\t * @return {!string} The merged value.\n\t * @protected\n\t */\n\tmergeElementClasses_(values) {\n\t\tvar marked = {};\n\t\treturn values.filter(function(val) {\n\t\t\tif (!val || marked[val]) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tmarked[val] = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}).join(' ');\n\t}\n\n\t/**\n\t * Fired when the `element` state value is changed.\n\t * @param {!Object} event\n\t * @protected\n\t */\n\tonElementChanged_(event) {\n\t\tthis.setUpProxy_();\n\t\tthis.elementEventProxy_.setOriginEmitter(event.newVal);\n\t\tif (event.newVal) {\n\t\t\tthis.syncVisible(this.dataManager_.get('visible'));\n\t\t}\n\t}\n\n\t/**\n\t * Fired when the `events` state value is changed.\n\t * @param {!Object} event\n\t * @protected\n\t */\n\tonEventsChanged_(event) {\n\t\tthis.eventsStateKeyHandler_.removeAllListeners();\n\t\tthis.addListenersFromObj_(event.newVal);\n\t}\n\n\t/**\n\t * Creates and renders a component for the given constructor function. This\n\t * will always make sure that the constructor runs without rendering the\n\t * component, having the `render` step happen only after it has finished.\n\t * @param {!function()} Ctor The component's constructor function.\n\t * @param {Object|Element=} opt_configOrElement Optional config data or parent\n\t *     for the component.\n\t * @param {Element=} opt_element Optional parent for the component.\n\t * @return {!Component} The rendered component's instance.\n\t */\n\tstatic render(Ctor, opt_configOrElement, opt_element) {\n\t\tvar config = opt_configOrElement;\n\t\tvar element = opt_element;\n\t\tif (isElement(opt_configOrElement)) {\n\t\t\tconfig = null;\n\t\t\telement = opt_configOrElement;\n\t\t}\n\t\tvar instance = new Ctor(config, false);\n\t\tinstance.render_(element);\n\t\treturn instance;\n\t}\n\n\t/**\n\t * Lifecycle. Renders the component into the DOM.\n\t *\n\t * Render Lifecycle:\n\t *   render event - The \"render\" event is emitted. Renderers act on this step.\n\t *   state synchronization - All synchronization methods are called.\n\t *   attach - Attach Lifecycle is called.\n\t *\n\t * @param {(string|Element|boolean)=} opt_parentElement Optional parent element\n\t *     to render the component. If set to `false`, the element won't be\n\t *     attached to any element after rendering. In this case, `attach` should\n\t *     be called manually later to actually attach it to the dom.\n\t * @param {boolean=} opt_skipRender Optional flag indicating that the actual\n\t *     rendering should be skipped. Only the other render lifecycle logic will\n\t *     be run, like syncing state and attaching the element. Should only\n\t *     be set if the component has already been rendered, like sub components.\n\t * @protected\n\t */\n\trender_(opt_parentElement, opt_skipRender) {\n\t\tif (!opt_skipRender) {\n\t\t\tthis.emit('render');\n\t\t}\n\t\tthis.setUpProxy_();\n\t\tthis.syncState_();\n\t\tthis.attach(opt_parentElement);\n\t\tthis.wasRendered = true;\n\t}\n\n\t/**\n\t * Renders this component as a subcomponent, meaning that no actual rendering is\n\t * needed since it was already rendered by the parent component. This just handles\n\t * other logics from the rendering lifecycle, like calling sync methods for the\n\t * state.\n\t */\n\trenderAsSubComponent() {\n\t\tthis.render_(null, true);\n\t}\n\n\t/**\n\t * Renders the component element into the DOM.\n\t * @param {(string|Element)=} opt_parentElement Optional parent element\n\t *     to render the component.\n\t * @param {(string|Element)=} opt_siblingElement Optional sibling element\n\t *     to render the component before it. Relevant when the component needs\n\t *     to be rendered before an existing element in the DOM, e.g.\n\t *     `component.attach(null, existingElement)`.\n\t * @protected\n\t */\n\trenderElement_(opt_parentElement, opt_siblingElement) {\n\t\tvar element = this.element;\n\t\tif (element && (opt_siblingElement || !element.parentNode)) {\n\t\t\tvar parent = toElement(opt_parentElement) || this.DEFAULT_ELEMENT_PARENT;\n\t\t\tparent.insertBefore(element, toElement(opt_siblingElement));\n\t\t}\n\t}\n\n\t/**\n\t * Setter logic for the element property.\n\t * @param {?string|Element} val\n\t */\n\tset element(val) {\n\t\tif (!isElement(val) && !isString(val) && isDefAndNotNull(val)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (val) {\n\t\t\tval = toElement(val) || this.elementVal_;\n\t\t}\n\n\t\tif (this.elementVal_ !== val) {\n\t\t\tvar prev = this.elementVal_;\n\t\t\tthis.elementVal_ = val;\n\t\t\tif (this.componentCreated_) {\n\t\t\t\tthis.emit('elementChanged', {\n\t\t\t\t\tprevVal: prev,\n\t\t\t\t\tnewVal: val\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Sets the value of all the specified state keys.\n\t * @param {!Object.<string,*>} values A map of state keys to the values they\n\t *   should be set to.\n\t * @param {function()=} opt_callback An optional function that will be run\n\t *   after the next batched update is triggered.\n\t */\n\tsetState(state, opt_callback) {\n\t\tthis.dataManager_.setState(state, opt_callback);\n\t}\n\n\t/**\n\t * Setter for the `elementClasses` data property. Appends given value with\n\t * the one specified in `ELEMENT_CLASSES`.\n\t * @param {string} val\n\t * @return {string}\n\t * @protected\n\t */\n\tsetterElementClassesFn_(val) {\n\t\tif (this.constructor.ELEMENT_CLASSES_MERGED) {\n\t\t\tval += ' ' + this.constructor.ELEMENT_CLASSES_MERGED;\n\t\t}\n\t\treturn val.trim();\n\t}\n\n\t/**\n\t * Creates the `DomEventEmitterProxy` instance and has it start proxying any\n\t * listeners that have already been listened to.\n\t * @protected\n\t */\n\tsetUpProxy_() {\n\t\tif (this.elementEventProxy_) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar proxy = new DomEventEmitterProxy(this.element, this);\n\t\tthis.elementEventProxy_ = proxy;\n\n\t\tobject.map(this.attachedListeners_, proxy.proxyEvent.bind(proxy));\n\t\tthis.attachedListeners_ = null;\n\n\t\tthis.newListenerHandle_.removeListener();\n\t\tthis.newListenerHandle_ = null;\n\t}\n\n\t/**\n\t * Fires state synchronization functions.\n\t * @protected\n\t */\n\tsyncState_() {\n\t\tvar keys = this.dataManager_.getSyncKeys();\n\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\tthis.fireStateKeyChange_(keys[i]);\n\t\t}\n\t}\n\n\t/**\n\t * Fires synchronization changes for state keys.\n\t * @param {Object.<string, Object>} changes Object containing the state key\n\t *     name as key and an object with newVal and prevVal as value.\n\t * @protected\n\t */\n\tsyncStateFromChanges_(changes) {\n\t\tfor (var key in changes) {\n\t\t\tthis.fireStateKeyChange_(key, changes[key]);\n\t\t}\n\t}\n\n\t/**\n\t * State synchronization logic for `visible` state key.\n\t * Updates the element's display value according to its visibility.\n\t * @param {boolean} newVal\n\t */\n\tsyncVisible(newVal) {\n\t\tif (this.element) {\n\t\t\tthis.element.style.display = newVal ? '' : 'none';\n\t\t}\n\t}\n\n\t/**\n\t * Lifecycle. Called whenever the component has just been rendered.\n\t * @param {boolean} firstRender Flag indicating if this was the component's\n\t *     first render.\n\t */\n\trendered() {}\n\n\t/**\n\t * Validator logic for the `events` state key.\n\t * @param {Object} val\n\t * @return {boolean}\n\t * @protected\n\t */\n\tvalidatorEventsFn_(val) {\n\t\treturn !isDefAndNotNull(val) || isObject(val);\n\t}\n}\n\n/**\n * Component data definition.\n * @type {Object}\n * @static\n */\nComponent.DATA = {\n\t/**\n\t * CSS classes to be applied to the element.\n\t * @type {string}\n\t */\n\telementClasses: {\n\t\tsetter: 'setterElementClassesFn_',\n\t\tvalidator: isString,\n\t\tvalue: ''\n\t},\n\n\t/**\n\t * Listeners that should be attached to this component. Should be provided as an object,\n\t * where the keys are event names and the values are the listener functions (or function\n\t * names).\n\t * @type {Object<string, (function()|string|{selector: string, fn: function()|string})>}\n\t */\n\tevents: {\n\t\tvalidator: 'validatorEventsFn_',\n\t\tvalue: null\n\t},\n\n\t/**\n\t * Indicates if the component is visible or not.\n\t * @type {boolean}\n\t */\n\tvisible: {\n\t\tvalidator: isBoolean,\n\t\tvalue: true\n\t}\n};\n\nComponent.COMPONENT_FLAG = '__metal_component__';\n\n/**\n * The `ComponentDataManager` class that should be used. This class will be\n * responsible for handling the component's data. Each component may have its\n * own implementation.\n */\nComponent.DATA_MANAGER = ComponentDataManager;\n\n/**\n * CSS classes to be applied to the element.\n * @type {string}\n * @protected\n * @static\n */\nComponent.ELEMENT_CLASSES = '';\n\n/**\n * The `ComponentRenderer` that should be used. Components need to set this\n * to a subclass of `ComponentRenderer` that has the rendering logic, like\n * `SoyRenderer`.\n * @type {!ComponentRenderer}\n * @static\n */\nComponent.RENDERER = ComponentRenderer;\n\n/**\n * Flag indicating if component updates will happen synchronously. Updates are\n * done asynchronously by default, which allows changes to be batched and\n * applied together.\n * @type {boolean}\n */\nComponent.SYNC_UPDATES = false;\n\n/**\n * Sets a prototype flag to easily determine if a given constructor is for\n * a component or not.\n */\nComponent.prototype[Component.COMPONENT_FLAG] = true;\n\nexport default Component;\n","'use strict';\n\nimport { getFunctionName } from 'metal';\n\n/**\n * The component registry is used to register components, so they can\n * be accessible by name.\n * @type {Object}\n */\nclass ComponentRegistry {\n\t/**\n\t * Gets the constructor function for the given component name, or\n\t * undefined if it hasn't been registered yet.\n\t * @param {string} name The component's name.\n\t * @return {?function()}\n\t * @static\n\t */\n\tstatic getConstructor(name) {\n\t\tvar constructorFn = ComponentRegistry.components_[name];\n\t\tif (!constructorFn) {\n\t\t\tconsole.error(\n\t\t\t\t'There\\'s no constructor registered for the component ' +\n\t\t\t\t'named ' + name + '. Components need to be registered via ' +\n\t\t\t\t'ComponentRegistry.register.'\n\t\t\t);\n\t\t}\n\t\treturn constructorFn;\n\t}\n\n\t/**\n\t * Registers a component, so it can be found by its name.\n\t * @param {!Function} constructorFn The component's constructor function.\n\t * @param {string=} opt_name Name of the registered component. If none is given\n\t *   the name defined by the NAME static variable will be used instead. If that\n\t *   isn't set as well, the name of the constructor function will be used.\n\t * @static\n\t */\n\tstatic register(constructorFn, opt_name) {\n\t\tvar name = opt_name;\n\t\tif (!name) {\n\t\t\tif (constructorFn.hasOwnProperty('NAME')) {\n\t\t\t\tname = constructorFn.NAME;\n\t\t\t} else {\n\t\t\t\tname = getFunctionName(constructorFn);\n\t\t\t}\n\t\t}\n\t\tconstructorFn.NAME = name;\n\t\tComponentRegistry.components_[name] = constructorFn;\n\t}\n}\n\n/**\n * Holds all registered components, indexed by their names.\n * @type {!Object<string, function()>}\n * @protected\n * @static\n */\nComponentRegistry.components_ = {};\n\nexport default ComponentRegistry;\n","'use strict';\n\nimport Component from '../Component';\nimport ComponentDataManager from '../ComponentDataManager';\nimport ComponentRegistry from '../ComponentRegistry';\nimport ComponentRenderer from '../ComponentRenderer';\n\nexport default Component;\nexport { Component, ComponentDataManager, ComponentRegistry, ComponentRenderer };\n","'use strict';\n\nimport './incremental-dom';\nimport { array, object } from 'metal';\n\n/**\n * Class responsible for intercepting incremental dom functions through AOP.\n */\nclass IncrementalDomAop {\n\t/**\n\t * Gets the original functions that are intercepted by `IncrementalDomAop`.\n\t * @return {!Object}\n\t */\n\tstatic getOriginalFns() {\n\t\treturn fnStack[0];\n\t}\n\n\t/**\n\t * Starts intercepting calls to incremental dom, replacing them with the given\n\t * functions. Note that `elementVoid`, `elementOpenStart`, `elementOpenEnd`\n\t * and `attr` are the only ones that can't be intercepted, since they'll\n\t * automatically be converted into equivalent calls to `elementOpen` and\n\t * `elementClose`.\n\t * @param {!Object} fns Functions to be called instead of the original ones\n\t *     from incremental DOM. Should be given as a map from the function name\n\t *     to the function that should intercept it. All interceptors will receive\n\t *     the original function as the first argument, the actual arguments from\n\t *     from the original call following it.\n\t */\n\tstatic startInterception(fns) {\n\t\tvar originals = IncrementalDomAop.getOriginalFns();\n\t\tfns = object.map(fns, (name, value) => value.bind(null, originals[name]));\n\t\tfnStack.push(object.mixin({}, originals, fns, {\n\t\t\tattr: fnAttr,\n\t\t\telementOpenEnd: fnOpenEnd,\n\t\t\telementOpenStart: fnOpenStart,\n\t\t\telementVoid: fnVoid\n\t\t}));\n\t}\n\n\t/**\n\t * Restores the original `elementOpen` function from incremental dom to the\n\t * implementation it used before the last call to `startInterception`.\n\t */\n\tstatic stopInterception() {\n\t\tif (fnStack.length > 1) {\n\t\t\tfnStack.pop();\n\t\t}\n\t}\n}\n\nvar fnStack = [{\n\tattr: IncrementalDOM.attr,\n\tattributes: IncrementalDOM.attributes[IncrementalDOM.symbols.default],\n\telementClose: IncrementalDOM.elementClose,\n\telementOpen: IncrementalDOM.elementOpen,\n\telementOpenEnd: IncrementalDOM.elementOpenEnd,\n\telementOpenStart: IncrementalDOM.elementOpenStart,\n\telementVoid: IncrementalDOM.elementVoid,\n\ttext: IncrementalDOM.text\n}];\n\nvar collectedArgs = [];\n\nfunction fnAttr(name, value) {\n\tcollectedArgs.push(name, value);\n}\n\nfunction fnOpenStart(tag, key, statics) {\n\tcollectedArgs = [tag, key, statics];\n}\n\nfunction fnOpenEnd() {\n\treturn getFn('elementOpen').apply(null, collectedArgs);\n}\n\nfunction fnVoid(tag) {\n\tgetFn('elementOpen').apply(null, arguments);\n\treturn getFn('elementClose')(tag);\n}\n\nfunction getFn(name) {\n\treturn fnStack[fnStack.length - 1][name];\n}\n\nfunction handleCall(name) {\n\treturn getFn(name).apply(null, array.slice(arguments, 1));\n}\n\nIncrementalDOM.attr = handleCall.bind(null, 'attr');\nIncrementalDOM.elementClose = handleCall.bind(null, 'elementClose');\nIncrementalDOM.elementOpen = handleCall.bind(null, 'elementOpen');\nIncrementalDOM.elementOpenEnd = handleCall.bind(null, 'elementOpenEnd');\nIncrementalDOM.elementOpenStart = handleCall.bind(null, 'elementOpenStart');\nIncrementalDOM.elementVoid = handleCall.bind(null, 'elementVoid');\nIncrementalDOM.text = handleCall.bind(null, 'text');\n\nIncrementalDOM.attributes[IncrementalDOM.symbols.default] = handleCall.bind(\n\tnull,\n\t'attributes'\n);\n\nexport default IncrementalDomAop;\n","'use strict';\n\nimport { isString } from 'metal';\n\n/**\n * Utility functions used to handle incremental dom calls.\n */\nclass IncrementalDomUtils {\n\t/**\n\t * Builds the component config object from its incremental dom call's\n\t * arguments.\n\t * @param {!Array} args\n\t * @return {!Object}\n\t */\n\tstatic buildConfigFromCall(args) {\n\t\tvar config = {};\n\t\tif (args[1]) {\n\t\t\tconfig.key = args[1];\n\t\t}\n\t\tvar attrsArr = (args[2] || []).concat(args.slice(3));\n\t\tfor (var i = 0; i < attrsArr.length; i += 2) {\n\t\t\tconfig[attrsArr[i]] = attrsArr[i + 1];\n\t\t}\n\t\treturn config;\n\t}\n\n\t/**\n\t * Builds an incremental dom call array from the given tag and config object.\n\t * @param {string} tag\n\t * @param {!Object} config\n\t * @return {!Array}\n\t */\n\tstatic buildCallFromConfig(tag, config) {\n\t\tvar call = [tag, config.key, []];\n\t\tvar keys = Object.keys(config);\n\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\tif (keys[i] !== 'children') {\n\t\t\t\tcall.push(keys[i], config[keys[i]]);\n\t\t\t}\n\t\t}\n\t\treturn call;\n\t}\n\n\t/**\n\t * Checks if the given tag represents a metal component.\n\t * @param {string} tag\n\t * @return {boolean}\n\t */\n\tstatic isComponentTag(tag) {\n\t\treturn !isString(tag) || tag[0] === tag[0].toUpperCase();\n\t}\n}\n\nexport default IncrementalDomUtils;\n","'use strict';\n\nimport { isDef } from 'metal';\nimport IncrementalDomAop from '../IncrementalDomAop';\nimport IncrementalDomUtils from '../utils/IncrementalDomUtils';\n\n/**\n * Provides helpers for capturing children elements from incremental dom calls,\n * as well as actually rendering those captured children via incremental dom\n * later.\n */\nclass IncrementalDomChildren {\n\t/**\n\t * Captures all child elements from incremental dom calls.\n\t * @param {!IncrementalDomRenderer} renderer The renderer that is capturing\n\t *   children.\n\t * @param {!function()} callback Function to be called when children have all\n\t *     been captured.\n \t */\n\tstatic capture(renderer, callback) {\n\t\trenderer_ = renderer;\n\t\tcallback_ = callback;\n\t\ttree_ = {\n\t\t\tprops: {\n\t\t\t\tchildren: []\n\t\t\t}\n\t\t};\n\t\ttree_.config = tree_.props;\n\t\tcurrentParent_ = tree_;\n\t\tisCapturing_ = true;\n\t\tIncrementalDomAop.startInterception({\n\t\t\telementClose: handleInterceptedCloseCall_,\n\t\t\telementOpen: handleInterceptedOpenCall_,\n\t\t\ttext: handleInterceptedTextCall_\n\t\t});\n\t}\n\n\t/**\n\t * Returns the owner of the current child node being rendered (or nothing\n\t * if there's no child being rendered).\n\t * @return {ComponentRenderer}\n\t */\n\tstatic getCurrentOwner() {\n\t\treturn currNodeOwner_;\n\t}\n\n\t/**\n\t * Gets the node's original owner's renderer.\n\t * @param {!Object} node\n\t * @return {ComponentRenderer}\n\t */\n\tstatic getOwner(node) {\n\t\treturn node[IncrementalDomChildren.CHILD_OWNER];\n\t}\n\n\t/**\n\t * Renders a children tree through incremental dom.\n\t * @param {!{args: Array, children: !Array, isText: ?boolean}}\n\t * @param {function()=} opt_skipNode Optional function that is called for\n\t *     each node to be rendered. If it returns true, the node will be skipped.\n\t * @protected\n\t */\n\tstatic render(tree, opt_skipNode) {\n\t\tif (isCapturing_) {\n\t\t\t// If capturing, just add the node directly to the captured tree.\n\t\t\taddChildToTree(tree);\n\t\t\treturn;\n\t\t}\n\n\t\tcurrNodeOwner_ = IncrementalDomChildren.getOwner(tree);\n\t\tif (opt_skipNode && opt_skipNode(tree)) {\n\t\t\tcurrNodeOwner_ = null;\n\t\t\treturn;\n\t\t}\n\n\t\tif (isDef(tree.text)) {\n\t\t\tlet args = tree.args ? tree.args : [];\n\t\t\targs[0] = tree.text;\n\t\t\tIncrementalDOM.text.apply(null, args);\n\t\t} else {\n\t\t\tlet args = IncrementalDomUtils.buildCallFromConfig(tree.tag, tree.props);\n\t\t\tIncrementalDOM.elementOpen.apply(null, args);\n\t\t\tif (tree.props.children) {\n\t\t\t\tfor (var i = 0; i < tree.props.children.length; i++) {\n\t\t\t\t\tIncrementalDomChildren.render(tree.props.children[i], opt_skipNode);\n\t\t\t\t}\n\t\t\t}\n\t\t\tIncrementalDOM.elementClose(tree.tag);\n\t\t}\n\t\tcurrNodeOwner_ = null;\n\t}\n}\n\nvar callback_;\nvar currNodeOwner_;\nvar currentParent_;\nvar isCapturing_ = false;\nvar renderer_;\nvar tree_;\n\n/**\n * Adds a child element to the tree.\n * @param {!Array} args The arguments passed to the incremental dom call.\n * @param {boolean=} opt_isText Optional flag indicating if the child is a\n *     text element.\n * @protected\n */\nfunction addChildCallToTree_(args, opt_isText) {\n\tvar child = {\n\t\tparent: currentParent_,\n\t\t[IncrementalDomChildren.CHILD_OWNER]: renderer_\n\t};\n\n\tif (opt_isText) {\n\t\tchild.text = args[0];\n\t\tif (args.length > 1) {\n\t\t\tchild.args = args;\n\t\t}\n\t} else {\n\t\tchild.tag = args[0];\n\t\tchild.props = IncrementalDomUtils.buildConfigFromCall(args);\n\t\tchild.props.children = [];\n\t\tchild.config = child.props;\n\t}\n\n\taddChildToTree(child);\n\treturn child;\n}\n\nfunction addChildToTree(child) {\n\tcurrentParent_.props.children.push(child);\n}\n\n/**\n * Handles an intercepted call to the `elementClose` function from incremental\n * dom.\n * @protected\n */\nfunction handleInterceptedCloseCall_() {\n\tif (currentParent_ === tree_) {\n\t\tIncrementalDomAop.stopInterception();\n\t\tisCapturing_ = false;\n\t\tcallback_(tree_);\n\t\tcallback_ = null;\n\t\tcurrentParent_ = null;\n\t\trenderer_ = null;\n\t\ttree_ = null;\n\t} else {\n\t\tcurrentParent_ = currentParent_.parent;\n\t}\n}\n\n/**\n * Handles an intercepted call to the `elementOpen` function from incremental\n * dom.\n * @param {!function()} originalFn The original function before interception.\n * @protected\n */\nfunction handleInterceptedOpenCall_(originalFn, ...args) {\n\tcurrentParent_ = addChildCallToTree_(args);\n}\n\n/**\n * Handles an intercepted call to the `text` function from incremental dom.\n * @param {!function()} originalFn The original function before interception.\n * @protected\n */\nfunction handleInterceptedTextCall_(originalFn, ...args) {\n\taddChildCallToTree_(args, true);\n}\n\n\n/**\n * Property identifying a specific object as a Metal.js child node, and\n * pointing to the renderer instance that created it.\n * @type {string}\n * @static\n */\nIncrementalDomChildren.CHILD_OWNER = '__metalChildOwner';\n\nexport default IncrementalDomChildren;\n","'use strict';\n\nvar comps_ = [];\nvar disposing_ = false;\n\nclass IncrementalDomUnusedComponents {\n\t/**\n\t * Disposes all sub components that were not rerendered since the last\n\t * time this function was scheduled.\n\t */\n\tstatic disposeUnused() {\n\t\tif (disposing_) {\n\t\t\treturn;\n\t\t}\n\t\tdisposing_ = true;\n\n\t\tfor (var i = 0; i < comps_.length; i++) {\n\t\t\tvar comp = comps_[i];\n\t\t\tif (!comp.isDisposed() && !comp.getRenderer().getParent()) {\n\t\t\t\t// Don't let disposing cause the element to be removed, since it may\n\t\t\t\t// be currently being reused by another component.\n\t\t\t\tcomp.element = null;\n\t\t\t\tcomp.dispose();\n\t\t\t}\n\t\t}\n\t\tcomps_ = [];\n\t\tdisposing_ = false;\n\t}\n\n\t/**\n\t * Schedules the given components to be checked and disposed if not used\n\t * anymore, when `IncrementalDomUnusedComponents.disposeUnused` is called.\n\t * @param {!Array<!Component>} comps\n\t */\n\tstatic schedule(comps) {\n\t\tfor (var i = 0; i < comps.length; i++) {\n\t\t\tif (!comps[i].isDisposed()) {\n\t\t\t\tcomps[i].getRenderer().parent_ = null;\n\t\t\t\tcomps_.push(comps[i]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport default IncrementalDomUnusedComponents;\n","'use strict';\n\nimport './incremental-dom';\nimport {\n\tgetCompatibilityModeData,\n\tgetUid,\n\tisBoolean,\n\tisDef,\n\tisDefAndNotNull,\n\tisString,\n\tobject\n} from 'metal';\nimport { append, delegate, domData, exitDocument } from 'metal-dom';\nimport { Component, ComponentRegistry, ComponentRenderer } from 'metal-component';\nimport IncrementalDomAop from './IncrementalDomAop';\nimport IncrementalDomChildren from './children/IncrementalDomChildren';\nimport IncrementalDomUnusedComponents from './cleanup/IncrementalDomUnusedComponents';\nimport IncrementalDomUtils from './utils/IncrementalDomUtils';\n\n/**\n * Class responsible for rendering components via incremental dom.\n */\nclass IncrementalDomRenderer extends ComponentRenderer {\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor(comp) {\n\t\tsuper(comp);\n\n\t\tcomp.context = {};\n\t\tcomp.refs = {};\n\t\tthis.config_ = comp.getInitialConfig();\n\t\tthis.childComponents_ = [];\n\t\tthis.clearChanges_();\n\t\tcomp.on('attached', this.handleAttached_.bind(this));\n\n\t\t// Binds functions that will be used many times, to avoid creating new\n\t\t// functions each time.\n\t\tthis.handleInterceptedAttributesCall_ =\n\t\t\tthis.handleInterceptedAttributesCall_.bind(this);\n\t\tthis.handleInterceptedCloseCall_ =\n\t\t\tthis.handleInterceptedCloseCall_.bind(this);\n\t\tthis.handleInterceptedOpenCall_ =\n\t\t\tthis.handleInterceptedOpenCall_.bind(this);\n\t\tthis.handleChildrenCaptured_ = this.handleChildrenCaptured_.bind(this);\n\t\tthis.handleChildRender_ = this.handleChildRender_.bind(this);\n\t\tthis.renderInsidePatchDontSkip_ = this.renderInsidePatchDontSkip_.bind(this);\n\t}\n\n\t/**\n\t * Adds the given css classes to the specified arguments for an incremental\n\t * dom call, merging with the existing value if there is one.\n\t * @param {string} elementClasses\n\t * @param {!Array} args\n\t * @protected\n\t */\n\taddElementClasses_(elementClasses, args) {\n\t\tfor (var i = 3; i < args.length; i += 2) {\n\t\t\tif (args[i] === 'class') {\n\t\t\t\targs[i + 1] = this.removeDuplicateClasses_(\n\t\t\t\t\targs[i + 1] + ' ' + elementClasses\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\twhile (args.length < 3) {\n\t\t\targs.push(null);\n\t\t}\n\t\targs.push('class', elementClasses);\n\t}\n\n\t/**\n\t * Attaches inline listeners found on the first component render, since those\n\t * may come from existing elements on the page that already have\n\t * data-on[eventname] attributes set to its final value. This won't trigger\n\t * `handleInterceptedAttributesCall_`, so we need manual work to guarantee\n\t * that projects using progressive enhancement like this will still work.\n\t * @param {!Element} node\n\t * @param {!Array} args\n\t * @protected\n\t */\n\tattachDecoratedListeners_(node, args) {\n\t\tif (!this.component_.wasRendered) {\n\t\t\tvar attrs = (args[2] || []).concat(args.slice(3));\n\t\t\tfor (var i = 0; i < attrs.length; i += 2) {\n\t\t\t\tvar eventName = this.getEventFromListenerAttr_(attrs[i]);\n\t\t\t\tif (eventName && !node[eventName + '__handle__']) {\n\t\t\t\t\tthis.attachEvent_(node, attrs[i], eventName, attrs[i + 1]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Listens to the specified event, attached via incremental dom calls.\n\t * @param {!Element} element\n\t * @param {string} key\n\t * @param {string} eventName\n\t * @param {function()|string} fn\n\t * @protected\n\t */\n\tattachEvent_(element, key, eventName, fn) {\n\t\tvar handleKey = eventName + '__handle__';\n\t\tif (element[handleKey]) {\n\t\t\telement[handleKey].removeListener();\n\t\t\telement[handleKey] = null;\n\t\t}\n\n\t\telement[key] = fn;\n\t\tif (fn) {\n\t\t\tif (isString(fn)) {\n\t\t\t\tif (key[0] === 'd') {\n\t\t\t\t\t// Allow data-on[eventkey] listeners to stay in the dom, as they\n\t\t\t\t\t// won't cause conflicts.\n\t\t\t\t\telement.setAttribute(key, fn);\n\t\t\t\t}\n\t\t\t\tfn = this.component_.getListenerFn(fn);\n\t\t\t}\n\t\t\telement[handleKey] = delegate(document, eventName, element, fn);\n\t\t} else {\n\t\t\telement.removeAttribute(key);\n\t\t}\n\t}\n\n\t/**\n\t * Builds the \"children\" array to be passed to the current component.\n\t * @param {!Array<!Object>} children\n\t * @return {!Array<!Object>}\n\t * @protected\n\t */\n\tbuildChildren_(children) {\n\t\treturn children.length === 0 ? emptyChildren_ : children;\n\t}\n\n\t/**\n\t * Returns an array with the args that should be passed to the component's\n\t * `shouldUpdate` method. This can be overridden by sub classes to change\n\t * what the method should receive.\n\t * @return {!Array}\n\t * @protected\n\t */\n\tbuildShouldUpdateArgs_() {\n\t\treturn [this.changes_];\n\t}\n\n\t/**\n\t * Clears the changes object.\n\t * @protected;\n\t */\n\tclearChanges_() {\n\t\tthis.changes_ = {};\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdisposeInternal() {\n\t\tsuper.disposeInternal();\n\n\t\tvar comp = this.component_;\n\t\tvar ref = this.config_.ref;\n\t\tvar owner = this.getOwner();\n\t\tif (owner && owner.components && owner.components[ref] === comp) {\n\t\t\tdelete owner.components[ref];\n\t\t}\n\n\t\tfor (var i = 0; i < this.childComponents_.length; i++) {\n\t\t\tconst child = this.childComponents_[i];\n\t\t\tif (!child.isDisposed()) {\n\t\t\t\tchild.element = null;\n\t\t\t\tchild.dispose();\n\t\t\t}\n\t\t}\n\t\tthis.childComponents_ = null;\n\t}\n\n\t/**\n\t * Removes the most recent component from the queue of rendering components.\n\t */\n\tstatic finishedRenderingComponent() {\n\t\trenderingComponents_.pop();\n\t\tif (renderingComponents_.length === 0) {\n\t\t\tIncrementalDomUnusedComponents.disposeUnused();\n\t\t}\n\t}\n\n\t/**\n\t * Gets the component being currently rendered via `IncrementalDomRenderer`.\n\t * @return {Component}\n\t */\n\tstatic getComponentBeingRendered() {\n\t\treturn renderingComponents_[renderingComponents_.length - 1];\n\t}\n\n\t/**\n\t * Gets the data object that should be currently used. This object will either\n\t * come from the current element being rendered by incremental dom or from\n\t * the component instance being rendered (only when the current element is the\n\t * component's direct parent).\n\t * @return {!Object}\n\t */\n\tstatic getCurrentData() {\n\t\tvar element = IncrementalDOM.currentElement();\n\t\tvar comp = IncrementalDomRenderer.getComponentBeingRendered();\n\t\tvar renderer = comp.getRenderer();\n\t\tvar obj = renderer;\n\t\tif (renderer.rootElementReached_ && element !== comp.element.parentNode) {\n\t\t\tobj = domData.get(element);\n\t\t}\n\t\tobj.incDomData_ = obj.incDomData_ || {\n\t\t\tcurrComps: {\n\t\t\t\tkeys: {},\n\t\t\t\torder: {}\n\t\t\t},\n\t\t\tprevComps: {\n\t\t\t\tkeys: {},\n\t\t\t\torder: {}\n\t\t\t}\n\t\t};\n\t\treturn obj.incDomData_;\n\t}\n\n\t/**\n\t * Returns the event name if the given attribute is a listener (of the form\n\t * \"on<EventName>\"), or null if it isn't.\n\t * @param {string} attr\n\t * @return {?string}\n\t * @protected\n\t */\n\tgetEventFromListenerAttr_(attr) {\n\t\tvar matches = IncrementalDomRenderer.LISTENER_REGEX.exec(attr);\n\t\tvar eventName = matches ? (matches[1] ? matches[1] : matches[2]) : null;\n\t\treturn eventName ? eventName.toLowerCase() : null;\n\t}\n\n\t/**\n\t * Gets the component that is this component's owner (that is, the one that\n\t * passed its data and holds its ref), or null if there's none.\n\t * @return {Component}\n\t */\n\tgetOwner() {\n\t\treturn this.owner_;\n\t}\n\n\t/**\n\t * Gets the component that is this component's parent (that is, the one that\n\t * actually rendered it), or null if there's no parent.\n\t * @return {Component}\n\t */\n\tgetParent() {\n\t\treturn this.parent_;\n\t}\n\n\t/**\n\t * Returns the \"ref\" to be used for a component. Uses \"key\" as \"ref\" when\n\t * compatibility mode is on for the current renderer.\n\t * @param {!Object} config\n\t * @param {?string} ref\n\t * @protected\n\t */\n\tgetRef_(config) {\n\t\tconst compatData = getCompatibilityModeData();\n\t\tif (compatData) {\n\t\t\tconst renderers = compatData.renderers;\n\t\t\tconst useKey = !renderers ||\n\t\t\t\trenderers.indexOf(this.constructor) !== -1 ||\n\t\t\t\trenderers.indexOf(this.constructor.RENDERER_NAME) !== -1;\n\t\t\tif (useKey && config.key && !config.ref) {\n\t\t\t\treturn config.key;\n\t\t\t}\n\t\t}\n\t\treturn config.ref;\n\t}\n\n\t/**\n\t * Gets the sub component referenced by the given tag and config data,\n\t * creating it if it doesn't yet exist.\n\t * @param {string|!Function} tagOrCtor The tag name.\n\t * @param {!Object} config The config object for the sub component.\n\t * @param {!Component} owner\n\t * @return {!Component} The sub component.\n\t * @protected\n\t */\n\tgetSubComponent_(tagOrCtor, config, owner) {\n\t\tvar Ctor = tagOrCtor;\n\t\tif (isString(Ctor)) {\n\t\t\tCtor = ComponentRegistry.getConstructor(tagOrCtor);\n\t\t}\n\n\t\tconst ref = this.getRef_(config);\n\t\tvar data = IncrementalDomRenderer.getCurrentData();\n\t\tvar comp;\n\t\tif (isDef(ref)) {\n\t\t\tcomp = this.match_(owner.components[ref], Ctor, config);\n\t\t\towner.addSubComponent(ref, comp);\n\t\t\towner.refs[ref] = comp;\n\t\t} else if (isDef(config.key)) {\n\t\t\tcomp = this.match_(data.prevComps.keys[config.key], Ctor, config);\n\t\t\tdata.currComps.keys[config.key] = comp;\n\t\t} else {\n\t\t\tvar type = getUid(Ctor, true);\n\t\t\tdata.currComps.order[type] = data.currComps.order[type] || [];\n\t\t\tvar order = data.currComps.order[type];\n\t\t\tcomp = this.match_((data.prevComps.order[type] || [])[order.length], Ctor, config);\n\t\t\torder.push(comp);\n\t\t}\n\n\t\treturn comp;\n\t}\n\n\t/**\n\t * Guarantees that the component's element has a parent. That's necessary\n\t * when calling incremental dom's `patchOuter` for now, as otherwise it will\n\t * throw an error if the element needs to be replaced.\n\t * @return {Element} The parent, in case it was added.\n\t * @protected\n\t */\n\tguaranteeParent_() {\n\t\tvar element = this.component_.element;\n\t\tif (!element || !element.parentNode) {\n\t\t\tvar parent = document.createElement('div');\n\t\t\tif (element) {\n\t\t\t\tappend(parent, element);\n\t\t\t}\n\t\t\treturn parent;\n\t\t}\n\t}\n\n\t/**\n\t * Handles the `attached` listener. Stores attach data.\n\t * @param {!Object} data\n\t * @protected\n\t */\n\thandleAttached_(data) {\n\t\tthis.attachData_ = data;\n\t}\n\n\t/**\n\t * Handles the event of children having finished being captured.\n\t * @param {!Object} The captured children in tree format.\n\t * @protected\n\t */\n\thandleChildrenCaptured_(tree) {\n\t\tvar {props, tag} = this.componentToRender_;\n\t\tprops.children = this.buildChildren_(tree.props.children);\n\t\tthis.componentToRender_ = null;\n\t\tthis.renderFromTag_(tag, props);\n\t}\n\n\t/**\n\t * Handles a child being rendered via `IncrementalDomChildren.render`. Skips\n\t * component nodes so that they can be rendered the correct way without\n\t * having to recapture both them and their children via incremental dom.\n\t * @param {!Object} node\n\t * @return {boolean}\n\t * @protected\n\t */\n\thandleChildRender_(node) {\n\t\tif (node.tag && IncrementalDomUtils.isComponentTag(node.tag)) {\n\t\t\tnode.props.children = this.buildChildren_(node.props.children);\n\t\t\tthis.renderFromTag_(node.tag, node.props);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\thandleDataManagerCreated_() {\n\t\tsuper.handleDataManagerCreated_();\n\n\t\tvar manager = this.component_.getDataManager();\n\t\tif (!this.component_.constructor.SYNC_UPDATES_MERGED) {\n\t\t\t// If the component is being updated synchronously we'll just reuse the\n\t\t\t// `handleComponentRendererStateKeyChanged_` function from\n\t\t\t// `ComponentRenderer`.\n\t\t\tmanager.on('dataPropChanged', this.handleDataPropChanged_.bind(this));\n\t\t}\n\n\t\tmanager.add(\n\t\t\t'children',\n\t\t\t{\n\t\t\t\tvalidator: Array.isArray,\n\t\t\t\tvalue: emptyChildren_\n\t\t\t},\n\t\t\tthis.config_.children || emptyChildren_\n\t\t);\n\t}\n\n\t/**\n\t * Handles the `dataPropChanged` event. Stores data that has changed since the\n\t * last render.\n\t * @param {!Object} data\n\t * @protected\n\t */\n\thandleDataPropChanged_(data) {\n\t\tthis.changes_[data.key] = data;\n\t}\n\n\t/**\n\t * Handles an intercepted call to the attributes default handler from\n\t * incremental dom.\n\t * @param {!function()} originalFn The original function before interception.\n\t * @param {!Element} element\n\t * @param {string} name\n\t * @param {*} value\n\t * @protected\n\t */\n\thandleInterceptedAttributesCall_(originalFn, element, name, value) {\n\t\tvar eventName = this.getEventFromListenerAttr_(name);\n\t\tif (eventName) {\n\t\t\tthis.attachEvent_(element, name, eventName, value);\n\t\t\treturn;\n\t\t}\n\n\t\tif (name === 'checked') {\n\t\t\t// This is a temporary fix to account for incremental dom setting\n\t\t\t// \"checked\" as an attribute only, which can cause bugs since that won't\n\t\t\t// necessarily check/uncheck the element it's set on. See\n\t\t\t// https://github.com/google/incremental-dom/issues/198 for more details.\n\t\t\tvalue = isDefAndNotNull(value) && value !== false;\n\t\t}\n\n\t\tif (name === 'value' && element.value !== value) {\n\t\t\t// This is a temporary fix to account for incremental dom setting\n\t\t\t// \"value\" as an attribute only, which can cause bugs since that won't\n\t\t\t// necessarily update the input's content it's set on. See\n\t\t\t// https://github.com/google/incremental-dom/issues/239 for more details.\n\t\t\t// We only do this if the new value is different though, as otherwise the\n\t\t\t// browser will automatically move the typing cursor to the end of the\n\t\t\t// field.\n\t\t\telement[name] = value;\n\t\t}\n\n\t\tif (isBoolean(value)) {\n\t\t\t// Incremental dom sets boolean values as string data attributes, which\n\t\t\t// is counter intuitive. This changes the behavior to use the actual\n\t\t\t// boolean value.\n\t\t\telement[name] = value;\n\t\t\tif (value) {\n\t\t\t\telement.setAttribute(name, '');\n\t\t\t} else {\n\t\t\t\telement.removeAttribute(name);\n\t\t\t}\n\t\t} else {\n\t\t\toriginalFn(element, name, value);\n\t\t}\n\t}\n\n\t/**\n\t * Handles an intercepted call to the `elementClose` function from incremental\n\t * dom.\n\t * @param {!function()} originalFn The original function before interception.\n\t * @param {string} tag\n\t * @protected\n\t */\n\thandleInterceptedCloseCall_(originalFn, tag) {\n\t\tthis.emit(IncrementalDomRenderer.ELEMENT_CLOSED, {tag});\n\t\tvar element = originalFn(tag);\n\t\tthis.resetData_(domData.get(element).incDomData_);\n\t\treturn element;\n\t}\n\n\t/**\n\t * Handles an intercepted call to the `elementOpen` function from incremental\n\t * dom.\n\t * @param {!function()} originalFn The original function before interception.\n\t * @param {string} tag\n\t * @protected\n\t */\n\thandleInterceptedOpenCall_(originalFn, tag) {\n\t\tif (IncrementalDomUtils.isComponentTag(tag)) {\n\t\t\treturn this.handleSubComponentCall_.apply(this, arguments);\n\t\t} else {\n\t\t\treturn this.handleRegularCall_.apply(this, arguments);\n\t\t}\n\t}\n\n\t/**\n\t * Handles the `dataPropChanged` event. Overrides original method from\n\t * `ComponentRenderer` to guarantee that `IncrementalDomRenderer`'s logic\n\t * will run first.\n\t * @param {!Object} data\n\t * @override\n\t * @protected\n\t */\n\thandleManagerDataPropChanged_(data) {\n\t\tthis.handleDataPropChanged_(data);\n\t\tsuper.handleManagerDataPropChanged_(data);\n\t}\n\n\t/**\n\t * Handles an intercepted call to the `elementOpen` function from incremental\n\t * dom, done for a regular element. Adds any inline listeners found on the\n\t * first render and makes sure that component root elements are always reused.\n\t * @param {!function()} originalFn The original function before interception.\n\t * @protected\n\t */\n\thandleRegularCall_(originalFn, ...args) {\n\t\tthis.emit(IncrementalDomRenderer.ELEMENT_OPENED, {args});\n\t\tvar currComp = IncrementalDomRenderer.getComponentBeingRendered();\n\t\tvar currRenderer = currComp.getRenderer();\n\t\tif (!currRenderer.rootElementReached_) {\n\t\t\tif (currRenderer.config_.key) {\n\t\t\t\targs[1] = currRenderer.config_.key;\n\t\t\t}\n\t\t\tvar elementClasses = currComp.getDataManager().get('elementClasses');\n\t\t\tif (elementClasses) {\n\t\t\t\tthis.addElementClasses_(elementClasses, args);\n\t\t\t}\n\t\t}\n\n\n\t\tvar node = originalFn.apply(null, args);\n\t\tthis.attachDecoratedListeners_(node, args);\n\t\tthis.updateElementIfNotReached_(node);\n\n\t\tconst config = IncrementalDomUtils.buildConfigFromCall(args);\n\t\tif (isDefAndNotNull(config.ref)) {\n\t\t\tconst owner = IncrementalDomChildren.getCurrentOwner() || this;\n\t\t\towner.getComponent().refs[config.ref] = node;\n\t\t}\n\t\treturn node;\n\t}\n\n\t/**\n\t * Handles an intercepted call to the `elementOpen` function from incremental\n\t * dom, done for a sub component element. Creates and updates the appropriate\n\t * sub component.\n\t * @param {!function()} originalFn The original function before interception.\n\t * @protected\n\t */\n\thandleSubComponentCall_(originalFn, ...args) {\n\t\tvar props = IncrementalDomUtils.buildConfigFromCall(args);\n\t\tthis.componentToRender_ = {\n\t\t\tprops,\n\t\t\ttag: args[0]\n\t\t};\n\t\tIncrementalDomChildren.capture(this, this.handleChildrenCaptured_);\n\t}\n\n\t/**\n\t * Checks if the component's data has changed.\n\t * @return {boolean}\n\t * @protected\n\t */\n\thasDataChanged_() {\n\t\treturn Object.keys(this.changes_).length > 0;\n\t}\n\n\t/**\n\t * Intercepts incremental dom calls from this component.\n\t * @protected\n\t */\n\tintercept_() {\n\t\tIncrementalDomAop.startInterception({\n\t\t\tattributes: this.handleInterceptedAttributesCall_,\n\t\t\telementClose: this.handleInterceptedCloseCall_,\n\t\t\telementOpen: this.handleInterceptedOpenCall_\n\t\t});\n\t}\n\n\t/**\n\t * Checks if the given object is an incremental dom node.\n\t * @param {!Object} node\n\t * @return {boolean}\n\t */\n\tstatic isIncDomNode(node) {\n\t\treturn !!node[IncrementalDomChildren.CHILD_OWNER];\n\t}\n\n\t/**\n\t * Checks if the given component can be a match for a constructor.\n\t * @param {!Component} comp\n\t * @param {!function()} Ctor\n\t * @return {boolean}\n\t * @protected\n\t */\n\tisMatch_(comp, Ctor) {\n\t\tif (!comp || comp.constructor !== Ctor || comp.isDisposed()) {\n\t\t\treturn false;\n\t\t}\n\t\treturn comp.getRenderer().getOwner() === this.component_;\n\t}\n\n\t/**\n\t * Returns the given component if it matches the specified constructor\n\t * function. Otherwise, returns a new instance of the given constructor. On\n\t * both cases the component's state and config will be updated.\n\t * @param {Component} comp\n\t * @param {!function()} Ctor\n\t * @param {!Object} config\n\t * @return {!Component}\n\t * @protected\n\t */\n\tmatch_(comp, Ctor, config) {\n\t\tif (!this.isMatch_(comp, Ctor)) {\n\t\t\tcomp = new Ctor(config, false);\n\t\t}\n\t\tif (comp.wasRendered) {\n\t\t\tcomp.getRenderer().startSkipUpdates();\n\t\t\tcomp.getDataManager().replaceNonInternal(config);\n\t\t\tcomp.getRenderer().stopSkipUpdates();\n\t\t}\n\t\tcomp.getRenderer().config_ = config;\n\t\treturn comp;\n\t}\n\n\t/**\n\t * Patches the component's element with the incremental dom function calls\n\t * done by `renderInsidePatchDontSkip_`.\n\t */\n\tpatch() {\n\t\tif (!this.component_.element && this.parent_) {\n\t\t\t// If the component has no content but was rendered from another component,\n\t\t\t// we'll need to patch this parent to make sure that any new content will\n\t\t\t// be added in the right place.\n\t\t\tthis.parent_.getRenderer().patch();\n\t\t\treturn;\n\t\t}\n\n\t\tvar tempParent = this.guaranteeParent_();\n\t\tif (tempParent) {\n\t\t\tIncrementalDOM.patch(tempParent, this.renderInsidePatchDontSkip_);\n\t\t\texitDocument(this.component_.element);\n\t\t\tif (this.component_.element && this.component_.inDocument) {\n\t\t\t\tthis.component_.renderElement_(\n\t\t\t\t\tthis.attachData_.parent,\n\t\t\t\t\tthis.attachData_.sibling\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tconst element = this.component_.element;\n\t\t\tIncrementalDOM.patchOuter(element, this.renderInsidePatchDontSkip_);\n\t\t}\n\t}\n\n\t/**\n\t * Removes duplicate css classes from the given string.\n\t * @param {string} cssClasses\n\t * @return {string}\n\t * @protected\n\t */\n\tremoveDuplicateClasses_(cssClasses) {\n\t\tvar noDuplicates = [];\n\t\tvar all = cssClasses.split(/\\s+/);\n\t\tvar used = {};\n\t\tfor (var i = 0; i < all.length; i++) {\n\t\t\tif (!used[all[i]]) {\n\t\t\t\tused[all[i]] = true;\n\t\t\t\tnoDuplicates.push(all[i]);\n\t\t\t}\n\t\t}\n\t\treturn noDuplicates.join(' ');\n\t}\n\n\t/**\n\t * Creates and renders the given function, which can either be a simple\n\t * incremental dom function or a component constructor.\n\t * @param {!function()} fnOrCtor Either be a simple incremental dom function\n\t or a component constructor.\n\t * @param {Object|Element=} opt_dataOrElement Optional config data for the\n\t *     function or parent for the rendered content.\n\t * @param {Element=} opt_parent Optional parent for the rendered content.\n\t * @return {!Component} The rendered component's instance.\n\t */\n\tstatic render(fnOrCtor, opt_dataOrElement, opt_parent) {\n\t\tif (!Component.isComponentCtor(fnOrCtor)) {\n\t\t\tvar fn = fnOrCtor;\n\t\t\tclass TempComponent extends Component {\n\t\t\t\tcreated() {\n\t\t\t\t\tif (IncrementalDomRenderer.getComponentBeingRendered()) {\n\t\t\t\t\t\tthis.getRenderer().updateContext_(this);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\trender() {\n\t\t\t\t\tfn(this.getRenderer().config_);\n\t\t\t\t}\n\t\t\t}\n\t\t\tTempComponent.RENDERER = IncrementalDomRenderer;\n\t\t\tfnOrCtor = TempComponent;\n\t\t}\n\t\treturn Component.render(fnOrCtor, opt_dataOrElement, opt_parent);\n\t}\n\n\t/**\n\t * Renders the renderer's component for the first time, patching its element\n\t * through the incremental dom function calls done by `renderIncDom`.\n\t */\n\trender() {\n\t\tthis.patch();\n\t}\n\n\t/**\n\t * Renders the given child node via its owner renderer.\n\t * @param {!Object} child\n\t */\n\tstatic renderChild(child) {\n\t\tchild[IncrementalDomChildren.CHILD_OWNER].renderChild(child);\n\t}\n\n\t/**\n\t * Renders the given child node.\n\t * @param {!Object} child\n\t */\n\trenderChild(child) {\n\t\tthis.intercept_();\n\t\tIncrementalDomChildren.render(child, this.handleChildRender_);\n\t\tIncrementalDomAop.stopInterception();\n\t}\n\n\t/**\n\t * Renders the contents for the given tag.\n\t * @param {!function()|string} tag\n\t * @param {!Object} config\n\t * @protected\n\t */\n\trenderFromTag_(tag, config) {\n\t\tif (isString(tag) || tag.prototype.getRenderer) {\n\t\t\tvar comp = this.renderSubComponent_(tag, config);\n\t\t\tthis.updateElementIfNotReached_(comp.element);\n\t\t\treturn comp.element;\n\t\t} else {\n\t\t\treturn tag(config);\n\t\t}\n\t}\n\n\t/**\n\t * Calls functions from `IncrementalDOM` to build the component element's\n\t * content. Can be overriden by subclasses (for integration with template\n\t * engines for example).\n\t */\n\trenderIncDom() {\n\t\tif (this.component_.render) {\n\t\t\tthis.component_.render();\n\t\t} else {\n\t\t\tIncrementalDOM.elementVoid('div');\n\t\t}\n\t}\n\n\t/**\n\t * Runs the incremental dom functions for rendering this component, but\n\t * doesn't call `patch` yet. Rather, this will be the function that should be\n\t * called by `patch`.\n\t */\n\trenderInsidePatch() {\n\t\tif (this.component_.wasRendered &&\n\t\t\t!this.shouldUpdate() &&\n\t\t\tIncrementalDOM.currentPointer() === this.component_.element) {\n\t\t\tif (this.component_.element) {\n\t\t\t\tIncrementalDOM.skipNode();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tthis.renderInsidePatchDontSkip_();\n\t}\n\n\t/**\n\t * The same as `renderInsidePatch`, but without the check that may skip the\n\t * render action.\n\t * @protected\n\t */\n\trenderInsidePatchDontSkip_() {\n\t\tIncrementalDomRenderer.startedRenderingComponent(this.component_);\n\t\tthis.clearChanges_();\n\t\tthis.rootElementReached_ = false;\n\t\tIncrementalDomUnusedComponents.schedule(this.childComponents_);\n\t\tthis.childComponents_ = [];\n\t\tthis.component_.refs = {};\n\t\tthis.intercept_();\n\t\tthis.renderIncDom();\n\t\tIncrementalDomAop.stopInterception();\n\t\tif (!this.rootElementReached_) {\n\t\t\tthis.component_.element = null;\n\t\t}\n\t\tthis.emit('rendered', !this.isRendered_);\n\t\tIncrementalDomRenderer.finishedRenderingComponent();\n\t\tthis.resetData_(this.incDomData_);\n\t}\n\n\t/**\n\t * This updates the sub component that is represented by the given data.\n\t * The sub component is created, added to its parent and rendered. If it\n\t * had already been rendered before though, it will only have its state\n\t * updated instead.\n\t * @param {string|!function()} tagOrCtor The tag name or constructor function.\n\t * @param {!Object} config The config object for the sub component.\n\t * @return {!Component} The updated sub component.\n\t * @protected\n\t */\n\trenderSubComponent_(tagOrCtor, config) {\n\t\tconst ownerRenderer = IncrementalDomChildren.getCurrentOwner() || this;\n\t\tconst owner = ownerRenderer.getComponent();\n\t\tvar comp = this.getSubComponent_(tagOrCtor, config, owner);\n\t\tthis.updateContext_(comp);\n\t\tvar renderer = comp.getRenderer();\n\t\tif (renderer instanceof IncrementalDomRenderer) {\n\t\t\tconst parentComp = IncrementalDomRenderer.getComponentBeingRendered();\n\t\t\tconst parentRenderer = parentComp.getRenderer();\n\t\t\tparentRenderer.childComponents_.push(comp);\n\t\t\trenderer.parent_ = parentComp;\n\t\t\trenderer.owner_ = owner;\n\t\t\tif (!config.key && !parentRenderer.rootElementReached_) {\n\t\t\t\tconfig.key = parentRenderer.config_.key;\n\t\t\t}\n\t\t\trenderer.renderInsidePatch();\n\t\t} else {\n\t\t\tconsole.warn(\n\t\t\t\t'IncrementalDomRenderer doesn\\'t support rendering sub components ' +\n\t\t\t\t'that don\\'t use IncrementalDomRenderer as well, like:',\n\t\t\t\tcomp\n\t\t\t);\n\t\t}\n\t\tif (!comp.wasRendered) {\n\t\t\tcomp.renderAsSubComponent();\n\t\t}\n\t\treturn comp;\n\t}\n\n\t/**\n\t * Resets the given incremental dom data object, preparing it for the next\n\t * pass.\n\t * @param {Object} data\n\t * @protected\n\t */\n\tresetData_(data) {\n\t\tif (data) {\n\t\t\tdata.prevComps.keys = data.currComps.keys;\n\t\t\tdata.prevComps.order = data.currComps.order;\n\t\t\tdata.currComps.keys = {};\n\t\t\tdata.currComps.order = {};\n\t\t}\n\t}\n\n\t/**\n\t * Checks if the component should be updated with the current state changes.\n\t * Can be overridden by subclasses or implemented by components to provide\n\t * customized behavior (only updating when a state property used by the\n\t * template changes, for example).\n\t * @return {boolean}\n\t */\n\tshouldUpdate() {\n\t\tif (!this.hasDataChanged_()) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this.component_.shouldUpdate) {\n\t\t\treturn this.component_.shouldUpdate(...this.buildShouldUpdateArgs_());\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Skips the next disposal of children components, by clearing the array as\n\t * if there were no children rendered the last time. This can be useful for\n\t * allowing components to be reused by other parent components in separate\n\t * render update cycles.\n\t */\n\tskipNextChildrenDisposal() {\n\t\tthis.childComponents_ = [];\n\t}\n\n\t/**\n\t * Stores the component that has just started being rendered.\n\t * @param {!Component} comp\n\t */\n\tstatic startedRenderingComponent(comp) {\n\t\trenderingComponents_.push(comp);\n\t}\n\n\t/**\n\t * Updates the renderer's component when state changes, patching its element\n\t * through the incremental dom function calls done by `renderIncDom`. Makes\n\t * sure that it won't cause a rerender if the only change was for the\n\t * \"element\" property.\n\t */\n\tupdate() {\n\t\tif (this.shouldUpdate()) {\n\t\t\tthis.patch();\n\t\t}\n\t}\n\n\t/**\n\t * Updates this renderer's component's element with the given values, unless\n\t * it has already been reached by an earlier call.\n\t * @param {!Element} node\n\t * @protected\n\t */\n\tupdateElementIfNotReached_(node) {\n\t\tvar currComp = IncrementalDomRenderer.getComponentBeingRendered();\n\t\tvar currRenderer = currComp.getRenderer();\n\t\tif (!currRenderer.rootElementReached_) {\n\t\t\tcurrRenderer.rootElementReached_ = true;\n\t\t\tif (currComp.element !== node) {\n\t\t\t\tcurrComp.element = node;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Updates the given component's context according to the data from the\n\t * component that is currently being rendered.\n\t * @param {!Component} comp\n\t * @protected\n\t */\n\tupdateContext_(comp) {\n\t\tvar context = comp.context;\n\t\tvar parent = IncrementalDomRenderer.getComponentBeingRendered();\n\t\tvar childContext = parent.getChildContext ? parent.getChildContext() : {};\n\t\tobject.mixin(context, parent.context, childContext);\n\t\tcomp.context = context;\n\t}\n}\n\nvar renderingComponents_ = [];\nvar emptyChildren_ = [];\n\n// Constants used as event names.\nIncrementalDomRenderer.ELEMENT_OPENED = 'elementOpened';\nIncrementalDomRenderer.ELEMENT_CLOSED = 'elementClosed';\n\n// Regex pattern used to find inline listeners.\nIncrementalDomRenderer.LISTENER_REGEX = /^(?:on([A-Z]\\w+))|(?:data-on(\\w+))$/;\n\n// Name of this renderer. Renderers should provide this as a way to identify\n// them via a simple string (when calling enableCompatibilityMode to add\n// support to old features for specific renderers for example).\nIncrementalDomRenderer.RENDERER_NAME = 'incremental-dom';\n\nexport default IncrementalDomRenderer;\n","'use strict';\n\nimport { isDefAndNotNull } from 'metal';\nimport IncrementalDomRenderer from 'metal-incremental-dom';\n\nconst childrenCount = [];\n\n/**\n * Renderer that handles JSX.\n */\nclass JSXRenderer extends IncrementalDomRenderer {\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor(comp) {\n\t\tsuper(comp);\n\n\t\tthis.on(IncrementalDomRenderer.ELEMENT_OPENED, this.handleJSXElementOpened_);\n\t\tthis.on(IncrementalDomRenderer.ELEMENT_CLOSED, this.handleJSXElementClosed_);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tbuildShouldUpdateArgs_() {\n\t\treturn [this.changes_, this.propChanges_];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tclearChanges_() {\n\t\tsuper.clearChanges_();\n\t\tthis.propChanges_ = {};\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\thandleDataPropChanged_(data) {\n\t\tif (data.type === 'props') {\n\t\t\tthis.propChanges_[data.key] = data;\n\t\t} else {\n\t\t\tsuper.handleDataPropChanged_(data);\n\t\t}\n\t}\n\n\t/**\n\t * Called when an element is opened during render via incremental dom. Adds\n\t * keys to elements that don't have one yet, according to their position in\n\t * the parent. This helps use cases that use conditionally rendered elements,\n\t * which is very common in JSX.\n\t * @param {!{args: !Array}} data\n\t * @protected\n\t */\n\thandleJSXElementOpened_({args}) {\n\t\tlet count = 0;\n\t\tif (childrenCount.length > 0) {\n\t\t\tcount = ++childrenCount[childrenCount.length - 1];\n\t\t}\n\n\t\tif (!isDefAndNotNull(args[1])) {\n\t\t\tif (count) {\n\t\t\t\targs[1] = JSXRenderer.KEY_PREFIX + count;\n\t\t\t} else {\n\t\t\t\t// If this is the first node being patched, just repeat the key it\n\t\t\t\t// used before (if it has been used before).\n\t\t\t\tconst node = IncrementalDOM.currentPointer();\n\t\t\t\tif (node && node.__incrementalDOMData) {\n\t\t\t\t\targs[1] = node.__incrementalDOMData.key;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tchildrenCount.push(0);\n\t}\n\n\t/**\n\t * Called when an element is closed during render via incremental dom.\n\t * @protected\n\t */\n\thandleJSXElementClosed_() {\n\t\tchildrenCount.pop();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\thasDataChanged_() {\n\t\treturn super.hasDataChanged_() || Object.keys(this.propChanges_).length > 0;\n\t}\n\n\t/**\n\t * Overrides the original method from `IncrementalDomRenderer` to handle the\n\t * case where developers return a child node directly from the \"render\"\n\t * function.\n\t * @override\n\t */\n\trenderIncDom() {\n\t\tif (this.component_.render) {\n\t\t\tiDOMHelpers.renderArbitrary(this.component_.render());\n\t\t} else {\n\t\t\tsuper.renderIncDom();\n\t\t}\n\t}\n\n\t/**\n\t * Skips the current child in the count (used when a conditional render\n\t * decided not to render anything).\n\t */\n\tstatic skipChild() {\n\t\tif (childrenCount.length > 0) {\n\t\t\tchildrenCount[childrenCount.length - 1]++;\n\t\t}\n\t}\n}\n\nJSXRenderer.KEY_PREFIX = '_metal_jsx_';\nJSXRenderer.RENDERER_NAME = 'jsx';\n\nexport default JSXRenderer;\n","'use strict';\n\nimport IncrementalDomRenderer from 'metal-incremental-dom';\nimport JSXRenderer from './JSXRenderer';\n\n/**\n * These helpers are all from \"babel-plugin-incremental-dom\". See its README\n * file for more details:\n * https://github.com/jridgewell/babel-plugin-incremental-dom#runtime\n */\n\nwindow.iDOMHelpers = window.iDOMHelpers || {};\n\nwindow.iDOMHelpers.attr = function(value, attrName) {\n\tIncrementalDOM.attr(attrName, value);\n};\n\nwindow.iDOMHelpers.forOwn = function(object, iterator) {\n\tvar hasOwn = Object.prototype.hasOwnProperty;\n\tfor (var prop in object) {\n\t\tif (hasOwn.call(object, prop)) {\n\t\t\titerator(object[prop], prop);\n\t\t}\n\t}\n};\n\nwindow.iDOMHelpers.jsxWrapper = function(elementClosure, args) {\n\tvar wrapper = args ? function() {\n\t\treturn elementClosure.apply(this, args);\n\t} : elementClosure;\n\twrapper.__jsxDOMWrapper = true;\n\treturn wrapper;\n};\n\nwindow.iDOMHelpers.renderArbitrary = function(child) {\n\tvar type = typeof child;\n\tif (type === 'number' || (type === 'string' || child && child instanceof String)) {\n\t\tIncrementalDOM.text(child);\n\t} else if (type === 'function' && child.__jsxDOMWrapper) {\n\t\tchild();\n\t} else if (Array.isArray(child)) {\n\t\tchild.forEach(window.iDOMHelpers.renderArbitrary);\n\t} else if (String(child) === '[object Object]') {\n\t\t// Renders special incremental dom nodes in a special way :)\n\t\tif (IncrementalDomRenderer.isIncDomNode(child)) {\n\t\t\tIncrementalDomRenderer.renderChild(child);\n\t\t} else {\n\t\t\twindow.iDOMHelpers.forOwn(child, window.iDOMHelpers.renderArbitrary);\n\t\t}\n\t} else if (!child) {\n\t\tJSXRenderer.skipChild();\n\t}\n};\n\nexport default window.iDOMHelpers;\n","'use strict';\n\nimport { mergeSuperClassesProperty, object } from 'metal';\nimport { ComponentDataManager } from 'metal-component';\nimport State from 'metal-state';\n\nclass JSXDataManager extends ComponentDataManager {\n\t/**\n\t * Overrides the original method so we can add properties to `props` by default.\n\t * @param {string} name\n\t * @param {!Object} config\n\t * @param {*} opt_initialValue\n\t * @override\n\t */\n\tadd() {\n\t\tthis.props_.addToState(...arguments);\n\t}\n\n\t/**\n\t * Manually adds props that weren't configured via `PROPS`.\n\t * @param {!Object} data\n\t * @protected\n\t */\n\taddUnconfiguredProps_(data) {\n\t\tlet keys = Object.keys(data);\n\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\tif (!this.props_.hasStateKey(keys[i])) {\n\t\t\t\tthis.component_.props[keys[i]] = data[keys[i]];\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Overrides the original method so that the main `State` instance's data can\n\t * come from `PROPS` instead of `STATE`.\n\t * @param {!Object} data\n\t * @return {!Object}\n\t * @protected\n\t * @override\n\t */\n\tbuildStateInstanceData_(data) {\n\t\tconst ctor = this.component_.constructor;\n\t\tmergeSuperClassesProperty(ctor, 'PROPS', State.mergeState);\n\t\treturn object.mixin({}, data, this.component_.constructor.PROPS_MERGED);\n\t}\n\n\t/**\n\t * Overrides the original method so that we can have two separate `State`\n\t * instances: one responsible for `state` and another for `props`.\n\t * @param {!Object} data\n\t * @protected\n\t * @override\n\t */\n\tcreateState_(data) {\n\t\tthis.component_.props = {};\n\t\tsuper.createState_(data, this.component_.props);\n\t\tthis.props_ = this.state_;\n\t\tthis.addUnconfiguredProps_(this.component_.getInitialConfig());\n\n\t\tthis.component_.state = {};\n\t\tthis.state_ = new State({}, this.component_.state, this.component_, {\n\t\t\tinternal: true\n\t\t});\n\t\tthis.state_.addToState(this.component_.constructor.STATE_MERGED);\n\n\t\tconst listener = (...args) => this.emit_(...args, 'state');\n\t\tthis.state_.on('stateChanged', listener);\n\t\tthis.state_.on('stateKeyChanged', listener);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdisposeInternal() {\n\t\tsuper.disposeInternal();\n\n\t\tthis.props_.dispose();\n\t\tthis.props_ = null;\n\t}\n\n\t/**\n\t * Overrides the original method so we can add the data type to the event.\n\t * @param {!Object} data\n\t * @param {!Object} event\n\t * @param {string=} opt_type Either 'props' or 'state'.\n\t * @protected\n\t * @override\n\t */\n\temit_(data, event, opt_type = 'props') {\n\t\tdata.type = opt_type;\n\t\tsuper.emit_(data, event);\n\t}\n\n\t/**\n\t * Overrides the original method so we can get properties from `props` by\n\t * default.\n\t * @param {string} name\n\t * @return {*}\n\t * @override\n\t */\n\tget(name) {\n\t\treturn this.props_.get(name);\n\t}\n\n\t/**\n\t * Gets the `State` instance being used for \"props\".\n\t * @return {!Object}\n\t */\n\tgetPropsInstance() {\n\t\treturn this.props_;\n\t}\n\n\t/**\n\t * Overrides the original method so we can enable \"sync\" methods just for\n\t * `props`.\n\t * @return {!Array<string>}\n\t * @override\n\t */\n\tgetSyncKeys() {\n\t\treturn this.props_.getStateKeys();\n\t}\n\n\t/**\n\t * Overrides the original method so we can replace values in `props`.\n\t * @param {!Object} data\n\t * @override\n\t */\n\treplaceNonInternal(data) {\n\t\tvar prevProps = object.mixin({}, this.component_.props);\n\t\tComponentDataManager.replaceNonInternal(data, this.props_);\n\t\tthis.addUnconfiguredProps_(data);\n\t\tif (this.component_.propsChanged) {\n\t\t\tthis.component_.propsChanged(prevProps);\n\t\t}\n\t}\n}\n\nJSXDataManager.BLACKLIST = {};\n\nexport default JSXDataManager;\n","'use strict';\n\nimport './iDOMHelpers';\nimport { validators, Config } from 'metal-state';\nimport Component from 'metal-component';\nimport IncrementalDomRenderer from 'metal-incremental-dom';\nimport JSXDataManager from './JSXDataManager';\nimport JSXRenderer from './JSXRenderer';\n\n/**\n * A component that has built-in integration with JSX templates. Example:\n *\n * <code>\n * class MyComponent extends JSXComponent {\n *   render() {\n *     return <div>Hello World</div>\n *   }\n * }\n * </code>\n */\nclass JSXComponent extends Component {\n\t/**\n\t * Creates and renders the given function, which can either be a simple\n\t * JSX function or a component constructor.\n\t * @param {!function()} fnOrCtor Either be a simple jsx dom function or a\n\t *     component constructor.\n\t * @param {Object=} opt_data Optional config data for the function.\n\t * @param {Element=} opt_element Optional parent for the rendered content.\n\t * @return {!Component} The rendered component's instance.\n\t * @override\n\t */\n\tstatic render(...args) {\n\t\treturn IncrementalDomRenderer.render(...args);\n\t}\n}\n\nJSXComponent.DATA_MANAGER = JSXDataManager;\nJSXComponent.RENDERER = JSXRenderer;\n\nexport default JSXComponent;\nexport { validators, Config, JSXComponent };\n","'use strict';\n\nimport JSXComponent from 'metal-jsx';\n\nclass JsFiddleMetalComponent extends JSXComponent {\n\trender() {\n\t\treturn <div>Thx for using MetalJS.</div>;\n\t}\n}\n\nexport default JsFiddleMetalComponent;\n"],"sourceRoot":"/source/"}